Tasks needed before the next release.

* NEW FEATURES

** Face remapping.

** Let mouse-1 follow links.

** Make Rmail find the best version of movemail.
To be done by Sergey Poznyakoff <gray@Mirddin.farlep.net>.

** Make VC-over-Tramp work where possible, or at least fail
gracefully if something isn't supported over Tramp.
To be done by Andre Spiegel <spiegel@gnu.org>.

* FATAL ERRORS

** Investigate face cache related crash.

Indications: Face cache seems to have been cleared, but
redisplay uses an invalidated face_id with FACE_FROM_ID
which then returns a NULL pointer.  Said to happen with
isearch faces.

** Investigate reported crashes in compact_small_strings.

** Investigate reported crashes related to using an
invalid pointer from string_free_list.


* LOSSAGE

** Clean up flymake.el to follow Emacs Lisp conventions.

** Fix up url-ldap.el.

* BUGS

** Ange-ftp should ignore irrelevant IPv6 errors:

Message-Id: <4121-Tue23Mar2004165249+0100-piet@cs.uu.nl>
From: "Piet van Oostrum" <piet@cs.uu.nl>
To: emacs-pretest-bug@gnu.org
Subject: Ange-ftp can't deal with IPV6/IPV4 fallback

Symptoms:

C-x C-f /ftp.nluug.nl:/

The problem is that the DNS first gives an IPV6 address. However our
router doesn't do IPV6. Ftp then falls back to IPV4:

ftp> open ftp.nluug.nl
Trying 2001:610:1:80aa:192:87:102:36...
ftp: connect to address 2001:610:1:80aa:192:87:102:36: No route to host
Trying 192.87.102.36...
Connected to ftp.nluug.nl.

Ange-ftp chokes on the `No route to host' message and doesn't look any
further.

I think in the near future we will see more of this problem, so it might be
time to make anfe-ftp more intelligent.

** Mailabbrev should quote addresses to correspond to RFC 822.
See http://article.gmane.org/gmane.emacs.devel/27585

** The '@' character should not expand addresses in mailabbrev
See http://article.gmane.org/gmane.emacs.devel/27585

** Bug in url-http-parse-headers, reported in
From: Vivek Dasmohapatra <vivek@zeus.com>
Date: Tue, 28 Sep 2004 16:13:13 +0100

Fetching a url with url-retrieve can reult in an anrbitrary buffer
being killed if a 401 (or possibly a 407) result is encountered:

url-http-parse-headers calls url-http-handle-authentication,
which can call url-retrieve.

This results in the current buffer being killed, and a new http buffer
being generated. However, when the old http buffer is killed, emacs
picks the top buffer from the list as the new current buffer, so by the
time we get to the end of url-http-parse-headers, _that_ buffer is marked
as dead even though it is not necessarily a url buffer, so next time the
url libraries reap their dead buffers, an innocent bystander buffer is
killed instead (and an obsolete http buffer may be left lying around too).

A possible fix (which I am currently using) is to call set-buffer
on the return value of url-http-parse-headers:

      (case url-http-response-status
	(401
	 ;; The request requires user authentication.  The response
	 ;; MUST include a WWW-Authenticate header field containing a
	 ;; challenge applicable to the requested resource.  The
	 ;; client MAY repeat the request with a suitable
	 ;; Authorization header field.
	 (url-mark-buffer-as-dead (current-buffer))
	 (set-buffer (url-http-handle-authentication nil)))
etc ....

which makes sure that it is the right http buffer that is current when
we come to mark the http buffers as dead.



* GTK RELATED BUGS

** Make GTK scrollbars behave like others w.r.t. overscrolling.


* REDISPLAY RELATED BUGS

** Strange text scrolling with Emacs + GTK

> I could reproduce the problem with the latest CVS.
>
>   % emacs -Q
>   M-x info RET
>   M->
>   C-l
>   C-x ( C-u - 1 C-v C-x )
>   C-x e e e e ...
>
> I see the problem around "CC mode" and "Forms".

It is not specific for the first line of a buffer.

Rather it happens for lines which are indented but the
indentation is controlled by a display property and
the newline is part of that display property -- in
that case, the indentation is not recognized for the
first display line.


** Avoid unbreakable loops in redisplay.

Redisplay may loop if there is an error in some display property, e.g.
     (space 'left-margin)

A fix would be to somehow disable handling of display properties if an error
is encountered.


** Problem with modeline and window margins:

The mode line's right "box" line is misplaced under the right margin,
rather than at the right window edge.

emacs -Q
(set-window-margins nil 25 25)
C-x 2


** custom mode-line face makes Emacs freeze up

From: Stephen Berman <Stephen.Berman@gmx.net>
Date: Sun, 24 Oct 2004 02:08:56 +0200

1. Start Emacs with -q -no-site-file.

2. Type `M-x customize-face' and at the prompt `mode-line'.

3. In the Custom buffer for mode-line face
   a. check width and give it the value `narrow';
   b. check height and give it the value 120 in 1/10 pt;
   c. check underline and give it the value `on' (or `colored');
   d. check overline and give it the value `on' (or `colored').

4. Set for current session.

5. Invoke Ediff on any two files.

6. Now Emacs is frozen and consumes 95-99% of CPU.

The customizations in step 3 appear to be the minimum necessary to
induce this bug.  Leave out any one of them and Ediff runs without a
problem.  Also if the 1/10 point value of height is 130 or greater
there's no bug (with the default font family; with e.g. Helvetica the
bug is induced only by a value of 100 or less).

I've noticed this freeze up only when invoking Ediff.  The only thing
I've been able to do is kill Emacs externally, via top or with kill
when run in gdb, after interrupting.  When the freeze up happens
within a gdb session, there is no automatic debugging feedback.  After
interrupting I can get a backtrace, here's an example:

Update: Maybe only reveals itself when compiled with GTK+


** line-spacing and Electric-pop-up-window

From: SAITO Takuya <tabmore@rivo.mediatti.net>
Date: Mon, 31 May 2004 02:08:10 +0900 (JST)

Electric-pop-up-window does not work well
if truncate long lines disabled and/or
`line-spacing' is set to positive integer.

For example, start emacs -Q --line-spacing 1, and type M-` .
Then, the last line of *Completions* buffer is not visible.

fit-window-to-buffer works well for me, so I guess
Electric-pop-up-window can use it.


** Partial highlighting of wrapped overlay

From: Ralf Angeli <angeli@iwi.uni-sb.de>
Date: Mon, 18 Oct 2004 19:09:19 +0200

If you put

(let* ((length (+ (- (window-width) (current-column)) 40))
       (start (point))
       (end (+ (point) length))
       (string (make-string length ?x))
       ov)
  (insert string)
  (setq ov (make-overlay start end))
  (overlay-put ov 'mouse-face 'highlight)
  (overlay-put ov 'display string))

into the *scratch* buffer and type `C-x C-e' with point at the last
parenthesis, you will get a string which does not fit into the line
and has to be wrapped.  If you move over it with your mouse, you
should see that only the part on the second line is being highlighted.
The full string is highlighted only if the 'display property is not
set.



* DOCUMENTATION

** Document Custom Themes.

** Finish updating the Emacs Lisp manual.

** Update the Emacs manual.

*** Update man/info.texi.

*** Update man/ack.texi.

** Add missing years in copyright notices of all files.

** Update AUTHORS.

** Reorder NEWS entries.

** Check the Emacs manual.

Each manual section should be proof-read by at least two people.
After each file name, on the same line or the following line, come the
names of the people who have checked it.


SECTION             READERS
-----------------------------
man/abbrevs.texi
man/anti.texi
man/basic.texi      "Luc Teirlinck"
man/buffers.texi    "Luc Teirlinck"
man/building.texi   "Ted Zlatanov" <tzz@lifelogs.com>
man/calendar.texi
man/cmdargs.texi
man/commands.texi   "Luc Teirlinck"
man/custom.texi
man/dired.texi
man/display.texi    "Luc Teirlinck"
man/emacs.texi      "Luc Teirlinck"
man/entering.texi   "Luc Teirlinck"
man/files.texi      "Luc Teirlinck"
man/fixit.texi      "Luc Teirlinck"
man/frames.texi     "Luc Teirlinck"
man/glossary.texi
man/help.texi       "Luc Teirlinck"
man/indent.texi     "Luc Teirlinck"
man/killing.texi    "Luc Teirlinck"
man/kmacro.texi     "Luc Teirlinck"
man/macos.texi
man/maintaining.texi
man/major.texi      "Luc Teirlinck"
man/mark.texi       "Luc Teirlinck"
man/mini.texi       "Luc Teirlinck"
man/misc.texi
man/msdog.texi
man/mule.texi       "Luc Teirlinck"
man/m-x.texi        "Luc Teirlinck"
man/picture.texi
man/programs.texi
man/regs.texi       "Luc Teirlinck"
man/rmail.texi
man/screen.texi     "Luc Teirlinck"
man/search.texi     "Luc Teirlinck"
man/sending.texi
man/text.texi       "Luc Teirlinck"
man/trouble.texi
man/windows.texi    "Luc Teirlinck"
man/xresources.texi

** Check the Emacs Lisp manual.

Each manual section should be proof-read by at least two people.
After each file name, on the same line or the following line, come the
names of the people who have checked it.

SECTION                  READERS
----------------------------------
lispref/abbrevs.texi     "Luc Teirlinck"
lispref/advice.texi	 Joakim Verona <joakim@verona.se>
lispref/anti.texi
lispref/backups.texi     "Luc Teirlinck"
lispref/buffers.texi     "Luc Teirlinck"
lispref/calendar.texi    Joakim Verona <joakim@verona.se>
lispref/commands.texi    "Luc Teirlinck"
lispref/compile.texi     "Luc Teirlinck"
lispref/control.texi     "Luc Teirlinck"
lispref/customize.texi
lispref/debugging.texi   Joakim Verona <joakim@verona.se>
lispref/display.texi
lispref/edebug.texi
lispref/elisp.texi       "Luc Teirlinck"
lispref/errors.texi      "Luc Teirlinck"
lispref/eval.texi        "Luc Teirlinck"
lispref/files.texi       "Luc Teirlinck"
lispref/frames.texi      "Luc Teirlinck"
lispref/functions.texi	 "Luc Teirlinck"
lispref/hash.texi	 "Luc Teirlinck"
lispref/help.texi	 "Luc Teirlinck"
lispref/hooks.texi
lispref/internals.texi	 "Luc Teirlinck"
lispref/intro.texi	 "Luc Teirlinck"
lispref/keymaps.texi	 "Luc Teirlinck"
lispref/lists.texi	 "Luc Teirlinck"
lispref/loading.texi     "Luc Teirlinck"
lispref/locals.texi
lispref/macros.texi      "Luc Teirlinck"
lispref/maps.texi
lispref/markers.texi     "Luc Teirlinck"
lispref/minibuf.texi     "Luc Teirlinck"
lispref/modes.texi
lispref/nonascii.texi    "Luc Teirlinck"
lispref/numbers.texi	 "Luc Teirlinck"
lispref/objects.texi	 "Luc Teirlinck"
lispref/os.texi		 "Luc Teirlinck"
lispref/positions.texi	 "Luc Teirlinck"
lispref/processes.texi
lispref/searching.texi	 "Luc Teirlinck"
lispref/sequences.texi	 "Luc Teirlinck"
lispref/streams.texi	 "Luc Teirlinck"
lispref/strings.texi	 "Luc Teirlinck"
lispref/symbols.texi	 "Luc Teirlinck"
lispref/syntax.texi	 "Luc Teirlinck"
lispref/text.texi
lispref/tips.texi	 "Luc Teirlinck"
lispref/variables.texi	 "Luc Teirlinck"
lispref/windows.texi     "Luc Teirlinck"


Local variables:
mode: outline
end:
