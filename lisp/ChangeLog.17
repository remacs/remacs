2015-04-06  Alan Mackenzie  <acm@muc.de>

	Fix miscellaneous glitches in cc-mode.el.  (Bug#20245)
	* progmodes/cc-mode.el (c-common-init): bind
	\(before\|after\)-change-functions to nil around invocations of
	c-get-state-before-change-functions and
	c-before-font-lock-functions to prevent recursive invocations.
	(c-neutralize-syntax-in-and-mark-CPP): On c-beginning-of-macro,
	check that point has actually moved back.
	(c-fl-decl-start): Check whether c-beginning-of-decl-1 has
	actually found a boundary (as contrasted with hitting a search
	limit).

2015-02-01  Alan Mackenzie  <acm@muc.de>

	CC Mode: Stop Font Lock forcing fontification from BOL.
	* progmodes/cc-mode.el (c-font-lock-init): Setq
	font-lock-extend-region-functions to nil.  (Bug#19669)

2015-04-06  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Do not break IPython magic completions.  (Bug#19736)
	* progmodes/python.el (python-shell-completion-setup-code):
	Cleaner setup; import rlcompleter as last resource.

2015-04-06  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el: Fix lack of "new" packages.
	(package-menu--new-package-list)
	(package-menu--old-archive-contents): No longer local.
	(package-menu--list-to-prompt): New function.
	(package-menu--prompt-transaction-p): Use "Upgrade" to make the
	package-menu-execute prompt less verbose.

2015-04-06  Paul Eggert  <eggert@cs.ucla.edu>

	Spelling fix for 'hfy-optimizations'
	* htmlfontify.el (hfy-optimizations): Rename from hfy-optimisations,
	with an obsolete alias.  All uses changed.

2015-04-06  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Enhance docstring detection following PEP-257.
	* progmodes/python.el (python-docstring-at-p): Remove function.
	(python-info-assignment-statement-p): New function.
	(python-info-assignment-continuation-line-p): Use it.
	(python-info-docstring-p): New function.
	(python-font-lock-syntactic-face-function)
	(python-fill-string): Use it.

2015-04-05  Eli Zaretskii  <eliz@gnu.org>

	* ses.el (ses-sym-rowcol): Move up, before the first use, to avoid
	byte-compiler warnings.

2015-04-05  Alan Mackenzie  <acm@muc.de>

	* jit-lock.el (jit-lock-after-change): Widen the buffer only
	whilst putting the 'fontified text properties.

2015-04-05  Alan Mackenzie  <acm@muc.de>

	Rationalize use of c[ad]+r, expunging cl-c[ad]\{3,4\}r.
	Also expunge eudc-c[ad]+r.
	* subr.el (internal--compiler-macro-cXXr): "New" function,
	copied from cl--compiler-macro-cXXr.
	(caar, cadr, cdar, cddr): Change from defsubsts to defuns with
	the above compiler-macro.
	* net/eudc.el (eudc-cadr, eudc-cdar, eudc-caar, eudc-cdaar): Remove.
	* emacs-lisp/cl.el (Top level dolist doing defaliases):
	Remove caaar, etc., from list of new alias functions.
	* emacs-lisp/cl-lib.el (cl-caaar, etc): Rename to caaar, etc.
	(gen-cXXr--rawname, gen-cXXr-all-cl-aliases): New function/macro
	which generate obsolete cl- aliases for caaar, etc.  Invoke them.
	* desktop.el, edmacro.el, emacs-lisp/cl-macs.el, frameset.el:
	* ibuffer.el, mail/footnote.el, net/dbus.el, net/eudc-export.el:
	* net/eudc.el, net/eudcb-ph.el, net/rcirc.el, net/secrets.el:
	* play/5x5.el, play/decipher.el, play/hanoi.el, progmodes/hideif.el:
	* ses.el: Replace cl-caaar, eudc-cadr, etc. with caaar and cadr, etc.

2015-04-05  Richard Stallman  <rms@gnu.org>

	* mail/rmail.el (rmail-show-message-1): When displaying a mime message,
	indicate start and finish in the echo area.

	* mail/rmail.el	(rmail-epa-decrypt): Disregard <pre> before armor.
	Ignore more kinds of whitespace in mime headers.
	Modify the decrypted mime part's mime type so it will be displayed
	by default when visiting this message again.

	* net/browse-url.el (browse-url-firefox-program): Prefer IceCat, doc.
	(browse-url-firefox-arguments)
	(browse-url-firefox-startup-arguments): Doc fix.

2015-04-05  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el: Add package-initialize to user-init-file.
	(package--ensure-init-file): New function.
	(package-install, package-install-from-buffer): Use it.
	(package-download-transaction, package-install-from-archive): Add
	ASYNC and CALLBACK arguments.
	(package-menu--prompt-transaction-p): New function.
	(package-menu-execute): Use it to prompt the user about operations
	to be executed.
	(package-install): Add ASYNC and CALLBACK arguments.
	(package-menu--perform-transaction): New function.
	(package-menu-execute): Use it to install and delete packages.

2015-04-05  Pete Williamson  <petewil@chromium.org>  (tiny-change)

	Fix .emacs and .emacs.d/init file recursion problem for NaCl
	* files.el (file-truename): Add NaCl to the exception list ms-dos uses.

2015-04-04  Alan Mackenzie  <acm@muc.de>

	* progmodes/cc-mode.el (c-font-lock-init): Revert 2015-03-03 change
	"Stop Font Lock forcing fontification from BOL."  (Bug#20245)

2015-04-04  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--download-and-read-archives): Add
	`package-archives' to `package--downloads-in-progress' instead of
	overwriting it.
	(package--with-work-buffer-async): Protect macro arguments.
	(package--download-one-archive)
	(package--download-and-read-archives): Prevent
	downloads-in-progress list from becoming outdated.

2015-04-04  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cache.el (tramp-flush-directory-property): Quote directory
	name when used in regexp.

2015-04-04  Alan Mackenzie  <acm@muc.de>

	* jit-lock.el (jit-lock-after-change): Widen the buffer before
	putting 'fontified text properties.  (Bug#20240)

2015-04-03  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cache.el (tramp-flush-file-property)
	(tramp-flush-directory-property): Use `directory-file-name' of the
	truename.  (Bug#20249)

2015-04-03  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* pcmpl-unix.el (pcmpl-ssh-known-hosts): Use `char-before' instead
	of `looking-back' (bug#17284).

2015-04-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/js.el (js-indent-line): Do nothing when bol is inside
	a string (https://github.com/mooz/js2-mode/issues/227).

2015-04-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* abbrev.el (define-abbrev-table): Treat a non-string "docstring" as
	part of the "props" arguments rather than silently ignoring it.

	* emacs-lisp/lisp-mnt.el (lm-version): Don't burp in a non-file buffer.

2015-04-01  Alan Mackenzie  <acm@muc.de>

	Fix the CC Mode fixes from 2015-03-30.  (Bug#20240)
	* progmodes/cc-mode.el (c-extend-after-change-region):
	Widen before applying text properties.
	* progmodes/cc-langs.el (c-before-font-lock-functions):
	Update an entry to a new function name.

2015-04-01  Paul Eggert  <eggert@cs.ucla.edu>

	* emacs-lisp/package.el: Spelling fixes and use active voice.

2015-04-01  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el: Implement asynchronous refreshing.
	(package--with-work-buffer-async)
	(package--check-signature-content)
	(package--update-downloads-in-progress): New functions.
	(package--check-signature, package--download-one-archive)
	(package--download-and-read-archives, package-refresh-contents):
	Optional arguments for async usage.
	(package--post-download-archives-hook): New variable.  Hook run
	after every refresh.

	* emacs-lisp/package.el: Make package-menu asynchronous.
	(package-menu-async): New variable.  Controls whether
	`list-packages' is asynchronous.
	(list-packages): Now asynchronous by default.
	(package-menu--new-package-list): Always buffer-local.
	(package-menu--post-refresh)
	(package-menu--find-and-notify-upgrades)
	(package-menu--populate-new-package-list): New functions.

2015-03-31  Simen Heggestøyl  <simenheg@gmail.com>

	* textmodes/css-mode.el (css-mode): Derive from `prog-mode'.

2015-03-31  Stefan Monnier  <monnier@iro.umontreal.ca>

	* jit-lock.el (jit-lock--run-functions): Fix min/max copy&paste error.

	Let jit-lock know the result of font-lock-extend-region-functions.
	* jit-lock.el (jit-lock--run-functions): New function.
	(jit-lock-fontify-now): Use it.  Handle fontification bounds more
	precisely in case the backend functions fontify more than requested.
	Don't round up to whole lines since that shouldn't be needed
	any more.
	* font-lock.el (font-lock-fontify-region-function): Adjust docstring.
	(font-lock-inhibit-thing-lock): Make obsolete.
	(font-lock-default-fontify-region): Return the bounds actually used.

	* emacs-lisp/eieio-base.el (eieio-persistent-validate/fix-slot-value):
	Fix compilation error.

2015-03-30  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el: Reorganize package.el and divide it with
	page-breaks and comments.

2015-03-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-base.el (make-instance) <eieio-named>: New instance
	which stores the old-style object name argument into the
	object-name field.

2015-03-30  Alan Mackenzie  <acm@muc.de>

	Correct calculation of CC Mode's font-lock region.
	* progmodes/cc-mode.el (c-fl-decl-start): Rename from
	c-set-fl-decl-start.  Change signature such that nil is returned
	when no declaration is found.
	(c-change-expand-fl-region): Rename from
	c-change-set-fl-decl-start.  This now also handles expanding the
	font lock region to whole lines.
	(c-context-expand-fl-region): Rename from
	c-context-set-fl-decl-start.  This now also handles expanding the
	font lock region to whole lines.
	(c-font-lock-fontify-region): When a change font lock region is
	spuriously enlarged to the beginning-of-line by jit-lock, fontify
	the extra bit separately from the region calculated by CC Mode.
	(c-extend-after-change-region): Explicitly apply 'fontified
	properties to the extended bits of the font lock region.
	* progmodes/cc-langs.el (c-before-font-lock-functions)
	(c-before-context-fontification-functions): Use new names for
	existing functions (see above).

2015-03-30  Richard Ryniker  <ryniker@alum.mit.edu>  (tiny change)

	* mail/sendmail.el (sendmail-send-it): Do not attempt to switch
	to non-existent buffer (errbuf is not created when customization
	variable mail-interactive is nil).  (Bug#20211)

2015-03-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-backward-sexp-command)
	(smie-forward-sexp-command): Don't pretend the arg is optional
	(bug#20205).

2015-03-29  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-before-regexp-re):
	Detect regexps after `!'.  (Bug#19285)

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Use `font-lock-constant-face' for nil, true and false.
	Highlight `self' as a keyword.  (Bug#17733)

2015-03-29  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* progmodes/ruby-mode.el (ruby-syntax-before-regexp-re):
	Expect beginning of regexp also after open brace or vertical bar.
	(Bug#20026)

2015-03-28  Jan Djärv  <jan.h.d@swipnet.se>

	* emacs-lisp/package.el (package-refresh-contents): Fix spelling
	error in previous change.

2015-03-28  Tom Willemse  <tom@ryuslash.org>  (tiny change)

	* elec-pair.el (electric-pair-local-mode): New command.
	(electric-pair-mode): Mention `electric-pair-local-mode' in the
	docstring.

2015-03-28  Jan Djärv  <jan.h.d@swipnet.se>

	* emacs-lisp/package.el (package-refresh-contents): Add a message at
	the end so it does not appear to have hanged (Bug#17879).

2015-03-27  Wolfgang Jenkner  <wjenkner@inode.at>

	* font-lock.el (font-lock--remove-face-from-text-property):
	New function.  Adapted from the previously commented out
	remove-single-text-property.
	Remove previously unused and commented out auxiliary function
	remove-text-property and obsolete comment.
	* comint.el (comint-output-filter): Use it to remove
	comint-highlight-prompt.
	(comint-snapshot-last-prompt, comint-output-filter):
	Use font-lock-prepend-text-property for comint-highlight-prompt.
	(Bug#20084)

2015-03-26  Daniel Colascione  <dancol@dancol.org>

	* progmodes/python.el
	(python-indent-guess-indent-offset-verbose): New defcustom.
	(python-indent-guess-indent-offset): Use it.

2015-03-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (defclass): Change internal name so as to make
	sure only EIEIO files should have "eieio--" prefixes in their .elc.

	* emacs-lisp/cl-macs.el (cl-dolist, cl-dotimes): Silence byte-compiler.

2015-03-26  Boruch Baum  <boruch_baum@gmx.com>  (tiny change)

	* bookmark.el (bookmark-show-all-annotations): Sort them (bug#20177).

2015-03-25  Dmitry Gutov  <dgutov@yandex.ru>

	* json.el (json-special-chars): Don't treat `/' specially, there's
	no need to.
	(json-encode-string): Only escape quotation mark, backslash and
	the control characters U+0000 to U+001F.

2015-03-25  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/checkdoc.el (checkdoc-this-string-valid-engine):
	Don't complain about args starting with _.

2015-03-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/mule-cmds.el (mule--ucs-names-annotation): New func.
	(read-char-by-name): Use it.

	* xt-mouse.el (xterm-mouse--read-number-from-terminal): Fix last commit.

2015-03-25  Nicolas Petton <nicolas@petton.fr>

	* emacs-lisp/seq.el: Documentation improvements.

2015-03-25  Glenn Morris  <rgm@gnu.org>

	* net/browse-url.el (browse-url-browser-function)
	(browse-url-default-browser):
	Remove obsolete items from the explicit listing.
	(browse-url-new-window-flag, browse-url-of-file-hook): Doc fixes.
	(browse-url-netscape-program, browse-url-netscape-arguments)
	(browse-url-netscape-startup-arguments)
	(browse-url-galeon-program, browse-url-galeon-arguments)
	(browse-url-galeon-startup-arguments)
	(browse-url-gnome-moz-program, browse-url-gnome-moz-arguments)
	(browse-url-galeon-new-window-is-tab)
	(browse-url-netscape-new-window-is-tab)
	(browse-url-mosaic-program, browse-url-mosaic-arguments)
	(browse-url-mosaic-pidfile, browse-url-CCI-port)
	(browse-url-CCI-host, browse-url-netscape-version)
	(browse-url-netscape, browse-url-netscape-sentinel)
	(browse-url-netscape-reload, browse-url-netscape-send)
	(browse-url-galeon, browse-url-galeon-sentinel)
	(browse-url-gnome-moz, browse-url-mosaic, browse-url-cci)
	(browse-url-w3-gnudoit): Make obsolete.
	* ffap.el (ffap-url-fetcher): Simplify default and doc.

2015-03-25  Olaf Rogalsky  <olaf.rogalsky@gmail.com>

	* xt-mouse.el: Add mouse-tracking support (bug#19416).
	(xterm-mouse-translate-1): Handle mouse-movement events.
	(xterm-mouse--read-event-sequence-1000)
	(xterm-mouse--read-event-sequence-1006): Delete functions.
	(xterm-mouse--read-event-sequence): New function that handles both at
	the same time.  Handle mouse-movements.
	(xterm-mouse--read-utf8-char, xterm-mouse--read-number-from-terminal):
	New functions.
	(xterm-mouse-event): Simplify.
	(xterm-mouse-tracking-enable-sequence)
	(xterm-mouse-tracking-disable-sequence): Enable mouse tracking.

	* mouse.el (mouse-drag-line): Also ignore `vertical-line' prefix events.

2015-03-24  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-do-file-attributes-with-ls)
	(tramp-do-file-attributes-with-stat): Quote file names in output.
	(tramp-do-directory-files-and-attributes-with-stat): Use "//" as marker.

2015-03-24  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-start-generate-key): Fix typo in "gpg --gen-key"
	invocation; make the PARAMETERS documentation clearer.

2015-03-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	Add cl-struct specific optimizations to pcase.
	* emacs-lisp/cl-macs.el (cl--struct-all-parents)
	(cl--pcase-mutually-exclusive-p): New functions.
	(pcase--mutually-exclusive-p): Advise to optimize cl-struct patterns.

	* emacs-lisp/pcase.el (pcase--split-pred): Handle quoted string.

2015-03-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	Add new `cl-struct' and `eieio' pcase patterns.
	* emacs-lisp/cl-macs.el (cl-struct): New pcase pattern.
	* emacs-lisp/eieio.el (eieio-pcase-slot-index-table)
	(eieio-pcase-slot-index-from-index-table): New functions.
	(eieio): New pcase pattern.
	* emacs-lisp/pcase.el (pcase--make-docstring): New function.
	(pcase): Use it to build the docstring.
	(pcase-defmacro): Make sure the macro is lazy-loaded.
	(\`): Move its docstring from `pcase'.

2015-03-23  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/authors.el (authors-aliases)
	(authors-obsolete-files-regexps): Additions.

2015-03-23  Jan Djärv  <jan.h.d@swipnet.se>

	* simple.el (deactivate-mark): Only modify PRIMARY if we own
	PRIMARY (Bug#18939).

2015-03-23  Martin Rudalics  <rudalics@gmx.at>

	* emacs-lisp/debug.el (debug): Don't try using "previous" window
	when its not live or on an invisible frame (Bug#17170).

2015-03-23  Dmitry Gutov  <dgutov@yandex.ru>

	* json.el (json-decode-char0): Delete this alias as well.
	(json-read-escaped-char): Don't call it (bug#20154).

2015-03-23  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/lisp-mode.el (lisp--el-non-funcall-position-p): New function.
	(lisp--el-match-keyword): Use it.

2015-03-23  Daiki Ueno  <ueno@gnu.org>

	* subr.el (start-process): New function, ported from the C
	implementation.

2015-03-23  Daniel Colascione  <dancol@dancol.org>

	Automatically adjust process window sizes.

	* window.el (window-adjust-process-window-size-function):
	New customizable variable.
	(window-adjust-process-window-size)
	(window-adjust-process-window-size-smallest)
	(window-adjust-process-window-size-largest)
	(window--process-window-list, window--adjust-process-windows):
	New functions.
	(window-configuration-change-hook):
	Add `window--adjust-process-windows'.
	* term.el (term-mode): Observe result of
	`window-adjust-process-window-size-function'.
	(term-check-size): Delete.

2015-03-22  Jackson Ray Hamilton  <jackson@jacksonrayhamilton.com>

	* textmodes/sgml-mode.el (sgml-attribute-offset): New defcustom.
	(sgml-calculate-indent): Use `sgml-attribute-offset' for attribute
	indentation (bug#20161).

2015-03-22  Dmitry Gutov  <dgutov@yandex.ru>

	* json.el (json-encode-char0): Delete this alias.
	(json-encode-string): Rewrite to improve performance (bug#20154).
	(json-encode-char): Fold into `json-encode-string'.

2015-03-22  Artur Malabarba  <bruce.connor.am@gmail.com>

	* menu-bar.el (menu-bar-update-buffers): Count displayed buffers
	for `buffers-menu-max-size', not total buffers.

2015-03-21  Titus von der Malsburg  <malsburg@posteo.de>

	* window.el (window-font-width, window-font-height)
	(window-max-chars-per-line): New functions.

	* simple.el (default-font-height): Doc fix.
	(default-font-width): New function.

2015-03-21  Tassilo Horn  <tsdh@gnu.org>

	* emacs-lisp/lisp-mode.el (lisp-el-font-lock-keywords-1):
	Also recognize (cl-)defmethod with (setf method) name.

2015-03-20  Tassilo Horn  <tsdh@gnu.org>

	* emacs-lisp/lisp-mode.el (lisp-el-font-lock-keywords-1):
	Fix false positive in function name font-locking.
	(lisp-cl-font-lock-keywords-1): Ditto.

2015-03-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl-defsubst): Ignore false-positive
	occurrences of args via &cl-defs (bug#20149).

2015-03-20  Alan Mackenzie  <acm@muc.de>

	Fix Bug#20146

	* font-lock.el (font-lock-extend-jit-lock-region-after-change):
	Return the calculated values, as per spec.

2015-03-20  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Move `at_exit'
	and `callcc' to the "methods with required arguments" section,
	they need a block argument.  Remove a `throw' duplicate.

2015-03-19  Vibhav Pant  <vibhavp@gmail.com>

	* progmodes/cperl-mode.el (cperl-electric-backspace):
	Call delete-backward-space interactively instead of delete-char.

2015-03-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/pcase.el (pcase-lambda): Rewrite.

	* emacs-lisp/eieio.el (object-slots): Return slot names as before
	(bug#20141).

2015-03-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	EIEIO: Change class's representation to unify instance and class slots
	* emacs-lisp/eieio-core.el (eieio--class): Change field names and order
	to match those of cl--class; use cl--slot for both instance slots and
	class slots.
	(eieio--object-num-slots): Use cl-struct-slot-info.
	(eieio--object-class): Rename from eieio--object-class-object.
	(eieio--object-class-name): Remove.
	(eieio-defclass-internal): Adjust to new slot representation.
	Store doc in class rather than in `variable-documentation'.
	(eieio--perform-slot-validation-for-default): Change API to take
	a slot object.
	(eieio--slot-override): New function.
	(eieio--add-new-slot): Rewrite.
	(eieio-copy-parents-into-subclass): Rewrite.
	(eieio--validate-slot-value, eieio--validate-class-slot-value)
	(eieio-oref-default, eieio-oset-default)
	(eieio--class-slot-name-index, eieio-set-defaults): Adjust to new
	slot representation.
	(eieio--c3-merge-lists): Simplify.
	(eieio--class/struct-parents): New function.
	(eieio--class-precedence-bfs): Use it.

	* emacs-lisp/eieio.el (with-slots): Use macroexp-let2.
	(object-class-fast): Change recommend replacement.
	(eieio-object-class): Rewrite.
	(slot-exists-p): Adjust to new slot representation.
	(initialize-instance): Adjust to new slot representation.
	(object-write): Adjust to new slot representation.

	* emacs-lisp/eieio-opt.el (eieio--help-print-slot): New function
	extracted from eieio-help-class-slots.
	(eieio-help-class-slots): Use it.  Adjust to new slot representation.

	* emacs-lisp/eieio-datadebug.el (data-debug/eieio-insert-slots):
	Declare to silence warnings.
	(data-debug-insert-object-button): Avoid `object-slots'.
	(data-debug/eieio-insert-slots): Adjust to new slot representation.

	* emacs-lisp/eieio-custom.el (eieio-object-value-create)
	(eieio-object-value-get): Adjust to new slot representation.

	* emacs-lisp/eieio-compat.el
	(eieio--generic-static-symbol-specializers):
	Extract from eieio--generic-static-symbol-generalizer.
	(eieio--generic-static-symbol-generalizer): Use it.

	* emacs-lisp/eieio-base.el (eieio-persistent-convert-list-to-object):
	Manually map initargs to slot names.
	(eieio-persistent-validate/fix-slot-value): Adjust to new
	slot representation.

	* emacs-lisp/cl-preloaded.el (cl--class): Fix type of `parents'.

2015-03-19  Vibhav Pant  <vibhavp@gmail.com>

	* leim/quail/hangul.el (hangul-delete-backward-char)
	(hangul-to-hanja-conversion):
	* progmodes/cperl-mode.el (cperl-electric-keyword)
	(cperl-electric-backspace): Use delete-char instead of
	delete-backward-char, fixes compilation warnings.

2015-03-18  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-do-directory-files-and-attributes-with-stat):
	Mark apostrophs with ?/ instead of \037.  (Bug#20117)

2015-03-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	Add classes as run-time descriptors of cl-structs.
	* emacs-lisp/cl-preloaded.el (cl--struct-get-class): New function.
	(cl--make-slot-desc): New constructor.
	(cl--plist-remove, cl--struct-register-child): New functions.
	(cl-struct-define): Rewrite.
	(cl-structure-class, cl-structure-object, cl-slot-descriptor)
	(cl--class): New structs.
	(cl--struct-default-parent): Initialize it here.
	* emacs-lisp/cl-macs.el (cl--find-class): New macro.
	(cl-defsubst, cl--defsubst-expand, cl--sublis): Move before first use.
	(cl--struct-default-parent): New var.
	(cl-defstruct): Adjust to new representation of classes; add
	default parent.  In accessors, signal `wrong-type-argument' rather than
	a generic error.
	(cl-struct-sequence-type, cl-struct-slot-info)
	(cl-struct-slot-offset): Rewrite.
	* emacs-lisp/cl-generic.el (cl--generic-struct-specializers)
	(cl-generic-generalizers): Rewrite.

	* emacs-lisp/macroexp.el (macroexp--debug-eager): New var.
	(internal-macroexpand-for-load): Use it.

	* emacs-lisp/debug.el (debug--implement-debug-on-entry):
	Bind inhibit-debug-on-entry here...
	(debug): Instead of here.

2015-03-18  Dima Kogan  <dima@secretsauce.net>

	Have gud-display-line not display source buffer in gud window.
	* progmodes/gud.el (gud-display-line): Make display-buffer
	not reuse selected window.  (Bug#17675, Bug#19901, Bug#20034)

2015-03-17  Tassilo Horn  <tsdh@gnu.org>

	* emacs-lisp/byte-run.el (macro-declarations-alist):
	New declaration no-font-lock-keyword.
	(defmacro): Flush font-lock in existing elisp buffers.

	* emacs-lisp/lisp-mode.el (lisp--el-update-after-load)
	(lisp--el-update-macro-regexp, lisp--el-macro-regexp):
	Delete functions and defconst.
	(lisp--el-match-keyword): Rename from lisp--el-match-macro.
	(lisp--el-font-lock-flush-elisp-buffers): New function.
	(lisp-mode-variables): Remove code for updating
	lisp--el-macro-regexp, and add
	lisp--el-font-lock-flush-elisp-buffers to after-load-functions.

2015-03-17  Simen Heggestøyl  <simenheg@gmail.com>

	* textmodes/css-mode.el (css--font-lock-keywords):
	Discriminate between pseudo-classes and pseudo-elements.
	(css-pseudo-ids): Remove.
	(css-pseudo-class-ids, css-pseudo-element-ids): New variables.
	(css--complete-property): New function for completing CSS properties.
	(css--complete-pseudo-element-or-class): New function
	completing CSS pseudo-elements and pseudo-classes.
	(css--complete-at-rule): New function for completing CSS at-rules.
	(css-completion-at-point): New function.
	(css-mode): Add support for completion.
	(css-extract-keyword-list, css-extract-parse-val-grammar)
	(css-extract-props-and-vals): Remove function in favor of manual
	extraction.
	(css-at-ids): Update list of CSS at-rule ids.
	(css-property-ids): Update list of CSS properties.

2015-03-17  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Font-lock
	more Kernel methods.

2015-03-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-maybe-send-script): Avoid leading tabs in
	shell scripts.  (Bug#20118)

2015-03-17  Eli Zaretskii  <eliz@gnu.org>

	* mouse.el (mouse-appearance-menu): If w32-use-w32-font-dialog is
	nil, construct a menu of fixed fonts.  This resurrects a feature
	lost in Emacs 23.

	* w32-vars.el (w32-use-w32-font-dialog): Add a ':set' function to
	reset mouse-appearance-menu-map, so the font dialog is recomputed
	the next time the menu is requested.
	(w32-fixed-font-alist): Fix to use correct names of Courier fonts.

2015-03-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl--transform-lambda): Refine last change
	(bug#20125).

2015-03-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-ssh-controlmaster-options): Change test
	for ControlPath in order to avoid DNS timeouts.  (Bug#20015)

2015-03-16  Alan Mackenzie  <acm@muc.de>

	Edebug: Allow "S" to work during trace mode.  Fixes Bug#20074.
	Also display the overlay arrow in go and go-nonstop modes.

	* emacs-lisp/edebug.el (edebug--display-1): Move the
	`input-pending' test to after trace mode's `sit-for'.
	(edebug--recursive-edit): Insert "(sit-for 0)" after
	"(edebug-overlay-arrow)".

2015-03-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl--transform-lambda): Rework to avoid
	cl--do-arglist in more cases; add comments to explain what's going on.
	(cl--do-&aux): New function extracted from cl--do-arglist.
	(cl--do-arglist): Use it.

	* emacs-lisp/cl-generic.el: Add Version: header, for ELPA purposes.

	* obsolete/iswitchb.el (iswitchb-read-buffer): Add `predicate' arg.
	* isearchb.el (isearchb-iswitchb): Adjust accordingly.
	* ido.el (ido-read-buffer): Add `predicate' argument.
	* misearch.el (unload-function-defs-list): Declare before use.

2015-03-16  Vibhav Pant  <vibhavp@gmail.com>

	* net/browse-url.el (browse-url-browser-function): Add "Conkeror".
	(browse-url-conkeror-program, browse-url-conkeror-arguments)
	(browse-url-conkeror-new-window-is-buffer): New defcustoms.
	(browse-url-default-browser): Check for `browse-url-conkeror'
	and call `browse-url-conkeror-program'.
	(browse-url-conkeror): New command.
	(bug#19863)

2015-03-16  Vibhav Pant  <vibhavp@gmail.com>

	* eshell/esh-mode.el (eshell/clear): New function.

2015-03-16  Alan Mackenzie  <acm@muc.de>

	Make Edebug work with Follow Mode.

	* emacs-lisp/edebug.el (edebug--display-1): Remove call to
	edebug-adjust-window.
	(edebug--recursive-edit): Don't bind pre/post-command-hooks to nil
	over the recursive edit.
	(edebug-adjust-window): Remove.

2015-03-15  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el:
	* net/tramp-gvfs.el:
	* net/tramp-sh.el:
	* net/tramp-smb.el: Set tramp-autoload cookie for all defcustoms.

	* net/tramp.el (tramp-ssh-controlmaster-options)
	(tramp-use-ssh-controlmaster-options): Move them to tramp-sh.el.
	(tramp-default-method): Do not check for
	`tramp-ssh-controlmaster-options'.

	* net/tramp-sh.el (tramp-use-ssh-controlmaster-options):
	New defcustom, moved from tramp.el.
	(tramp-ssh-controlmaster-options): New defvar, moved from tramp.el
	but with a nil initial value.
	(tramp-ssh-controlmaster-options): New defun.
	(tramp-do-copy-or-rename-file-out-of-band)
	(tramp-maybe-open-connection): Use it.  (Bug#20015)

2015-03-15  Tassilo Horn  <tsdh@gnu.org>

	* emacs-lisp/lisp-mode.el (lisp--el-macro-regexp): New defconst.
	(lisp--el-update-macro-regexp, lisp--el-update-after-load)
	(lisp--el-match-macro): New functions.
	(lisp-mode-variables): Update lisp--el-macro-regexp and add
	lisp--el-update-after-load to after-load-functions.

2015-03-15  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-indent.el
	(lisp-indent-backquote-substitution-mode): New user option.
	(common-lisp-indent-function-1, common-lisp-loop-part-indentation)
	(common-lisp-indent-function): Support normally indenting
	backquote substitutions.
	(extended-loop-p): Rename to `lisp-extended-loop-p'.

2015-03-14  Michael R. Mauger  <michael@mauger.com>

	* progmodes/sql.el: Version 3.5
	(sql-starts-with-prompt-re, sql-ends-with-prompt-re): Match password prompts.
	(sql-interactive-remove-continuation-prompt): Fix regression. (Bug#6686)

2015-03-14  Daniel Colascione  <dancol@dancol.org>

	* widget.el (define-widget): Check that documentation is a string
	or nil; prevent wailing and gnashing of teeth when users forget to
	pass a docstring and wonder why their properties don't work.

	* startup.el (command-line): Process "--no-x-resources".

2015-03-13  Kevin Ryde  <user42_kevin@yahoo.com.au>

	info-look fixes for Texinfo 5
	* info-look.el (c-mode, bison-mode, makefile-mode)
	(makefile-automake-mode, texinfo-mode, autoconf-mode, awk-mode)
	(latex-mode, emacs-lisp-mode, sh-mode, cfengine-mode):
	Match `foo' and 'foo' and ‘foo’ for @item and similar.
	(latex-mode): Match multi-arg \frac{num}{den} or \sqrt[root]{n} in
	suffix regexp.

2015-03-12  Juri Linkov  <juri@linkov.net>

	* simple.el (next-line-or-history-element)
	(previous-line-or-history-element): Remember the goal column of
	possibly multi-line input, and restore it afterwards.  (Bug#19824)

2015-03-12  Rasmus Pank Roulund  <emacs@pank.eu>

	* ido.el (ido-add-virtual-buffers-to-list): Include bookmark-alist
	files (bug#19335).

2015-03-12  Eli Zaretskii  <eliz@gnu.org>

	* international/fontset.el (script-representative-chars): Add a
	representative character for 'vai'.

2015-03-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/quail.el (quail-input-method):
	Use with-silent-modifications.

	* simple.el (goto-history-element): Don't burp on t history.

2015-03-10  Paul Eggert  <eggert@cs.ucla.edu>

	Prefer "initialize" to "initialise"
	* progmodes/js.el (js-indent-first-init):
	Rename from js-indent-first-initialiser, to avoid worrying about
	American vs British spelling.  All uses changed.

2015-03-10  Glenn Morris  <rgm@gnu.org>

	* progmodes/js.el (js-indent-first-initialiser):
	Fix doc, type, version.

2015-03-10  Jackson Ray Hamilton  <jackson@jacksonrayhamilton.com>

	* progmodes/js.el (js-indent-first-initialiser): New option.
	(js--maybe-goto-declaration-keyword-end): New function.
	(js--proper-indentation): Use js--maybe-goto-declaration-keyword-end.

2015-03-10  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el (ldap-attribute-syntaxes-alist): Add LDAP attributes
	from RFC2798 Section 9.1.1.  (Bug#8983)

2015-03-09  Nicolas Petton <nicolas@petton.fr>

	* emacs-lisp/seq.el (seq-into): New function.
	Bump seq.el version to 1.3.

2015-03-09  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Don't consider
	`=' a part of symbol when followed by `>'.  (Bug#18644)
	(ruby-syntax-before-regexp-re): Detect regexps after `!'.
	(Bug#19285)

2015-03-09  Eli Zaretskii  <eliz@gnu.org>

	* dired.el (dired-delete-file): Doc fix.  (Bug#20021)

2015-03-06  Sergio Durigan Junior  <sergiodj@sergiodj.net>
	    Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudcb-bbdb.el (eudc-bbdb-field): New function.
	(eudc-bbdb-filter-non-matching-record): Call eudc-bbdb-field.
	(eudc-bbdb-format-record-as-result): Likewise.

2015-03-08  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Use `font-lock-constant-face' for nil, true and false.
	Highlight `self' as a keyword.  (Bug#17733)

2015-03-08  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* progmodes/ruby-mode.el (ruby-syntax-before-regexp-re):
	Expect beginning of regexp also after open brace or vertical bar.
	(Bug#20026)

2015-03-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* battery.el (battery-echo-area-format): Simplify default.
	(battery-linux-sysfs): Standardize on energy&power.  Accept ADP1
	for AC adapter.

	* emacs-lisp/byte-opt.el (byte-optimize-form-code-walker): Don't try to
	unfold `closure's since byte-compile-unfold-lambda doesn't know how to
	do it.

2015-03-06  Oscar Fuentes  <ofv@wanadoo.es>

	* net/browse-url.el (browse-url-firefox): Remove outdated
	MS-Windows limitations.

2015-03-06  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudcb-ldap.el (eudc-ldap-cleanup-record-simple): Mark as
	obsolete.
	(eudc-ldap-cleanup-record-filtering-addresses): Add docstring.
	Don't clean up postal addresses if ldap-ignore-attribute-codings
	is set.  Combine mail addresses into one field. (Bug#17720)
	(eudc-ldap-simple-query-internal):
	Call eudc-ldap-cleanup-record-filtering-addresses instead of
	eudc-ldap-cleanup-record-simple.
	(eudc-ldap-get-field-list): Likewise.

2015-03-05  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww-html-p): New function (bug#20009).
	(eww-render): Use it.

2015-03-05  Artur Malabarba  <bruce.connor.am@gmail.com>

	* desktop.el (desktop-buffer-info): Write docstring.
	(desktop-buffer-info): Use `pushnew' instead of `add-to-list' and
	unquote lamda.

	* emacs-lisp/package.el (package-refresh-contents): Update doc.

2015-03-05  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/js.el (js-mode-syntax-table): Add an entry for `.

2015-03-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	Replace *-function vars with generic functions in cl-generic.
	* emacs-lisp/cl-generic.el (cl--generic-generalizer): New struct.
	(cl-generic-tagcode-function, cl-generic-tag-types-function): Remove.
	(cl--generic-t-generalizer): New const.
	(cl--generic-make-method): Rename from `cl--generic-method-make'.
	(cl--generic-make): Change calling convention.
	(cl--generic): Add `options' field.
	(cl-generic-function-options): New function.
	(cl-defgeneric): Rewrite handling of options.  Add support for :method
	options and allow the use of a default body.
	(cl-generic-define): Save options in the corresponding new field.
	(cl-defmethod): Fix ordering of qualifiers.
	(cl-generic-define-method): Use cl-generic-generalizers.
	(cl--generic-get-dispatcher): Change calling convention, and change
	calling convention of the returned function as well so as to take the
	list of methods separately from the generic function object, so that it
	can receive the original generic function object.
	(cl--generic-make-next-function): New function, extracted from
	cl--generic-make-function.
	(cl--generic-make-function): Use it.
	(cl-generic-method-combination-function): Remove.
	(cl--generic-cyclic-definition): New error.
	(cl-generic-call-method): Take a generic function object rather than
	its name.
	(cl-method-qualifiers): New alias.
	(cl--generic-build-combined-method): Use cl-generic-combine-methods,
	don't segregate by qualifiers here any more.
	(cl--generic-standard-method-combination): Segregate by qualifiers
	here instead.  Add support for the `:extra' qualifier.
	(cl--generic-cache-miss): Move earlier, adjust to new calling convention.
	(cl-generic-generalizers, cl-generic-combine-methods):
	New generic functions.
	(cl-no-next-method, cl-no-applicable-method, cl-no-primary-method):
	Use the new "default method in defgeneric" functionality, change
	calling convention to receive a generic function object.
	(cl--generic-head-used): New var.
	(cl--generic-head-generalizer, cl--generic-eql-generalizer)
	(cl--generic-struct-generalizer, cl--generic-typeof-generalizer):
	New consts.
	* emacs-lisp/eieio-core.el (eieio--generic-generalizer)
	(eieio--generic-subclass-generalizer): New consts.
	(cl-generic-generalizers): New methods.
	* emacs-lisp/eieio-compat.el (eieio--generic-static-symbol-generalizer)
	(eieio--generic-static-object-generalizer): New consts.
	(cl-generic-generalizers) <(head eieio--static)>: New method.
	* emacs-lisp/byte-opt.el (byte-optimize-form-code-walker):
	Unfold closures like lambdas.

2015-03-04  Filipp Gunbin  <fgunbin@fastmail.fm>

	* autorevert.el (auto-revert-notify-add-watch):
	Fix handler installation.  (Bug#20000)

2015-03-04  Rüdiger Sonderfeld  <ruediger@c-plusplus.net>

	* net/eww.el (eww-search-prefix, eww-open-file, eww-search-words)
	(eww-same-page-p,eww-set-character-encoding): Fix docstring.
	(eww): Do not end error messages with a period.

2015-03-04  Zhongwei Yao  <ashi08104@gmail.com>

	* net/tramp-adb.el (tramp-adb-connect-if-not-connected):
	New user option.
	(tramp-adb-ls-toolbox-regexp): Fix regexp in order to support file
	names starting with a space.
	(tramp-methods): Add `tramp-default-port' for "adb".
	(tramp-adb-parse-device-names): Add traces.  Return device names
	with port, if present.
	(tramp-adb-handle-directory-files-and-attributes): Quote all
	remote file names.
	(tramp-adb-get-device): New defun.
	(tramp-adb-execute-adb-command, tramp-adb-maybe-open-connection):
	Use it.
	(tramp-adb-maybe-open-connection): Set `tramp-current-*'
	variables.  Remove checks for listed devices.

2015-03-04  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp): Add :link property.
	(tramp-login-prompt-regexp): Allow also "user", as required by
	Fritz!Box telnet.
	(tramp-autoload-file-name-handler): Use "/".
	(tramp-handle-unhandled-file-name-directory): Return nil when
	required by the spec.

	* net/tramp-cache.el (tramp-dump-connection-properties):
	Use `with-temp-file'.

	* net/tramp-sh.el (tramp-perl-file-attributes)
	(tramp-perl-directory-files-and-attributes): Escape apostrophes in
	file names.
	(tramp-do-file-attributes-with-stat): Quote file name.
	(tramp-sh-handle-directory-files-and-attributes): Fall back to
	`tramp-handle-directory-files-and-attributes' in case of problems.
	(tramp-do-directory-files-and-attributes-with-stat)
	(tramp-sh-handle-file-name-all-completions)
	(tramp-sh-handle-delete-directory)
	(tramp-sh-handle-expand-file-name, tramp-sh-handle-process-file):
	Normalize use of "cd".
	(tramp-do-directory-files-and-attributes-with-stat): Use the
	`quoting-style' arg of `ls' if possible.  Make it also working for
	file names with apostrophes.
	(tramp-sh-handle-file-name-all-completions): Use arguments of `ls'
	in proper order.
	(tramp-do-copy-or-rename-file-via-buffer)
	(tramp-sh-handle-file-local-copy): Use `with-temp-file'.
	(tramp-get-remote-locale): Accept also \r in output.
	(tramp-get-ls-command-with-quoting-style): New defun.
	(tramp-get-inline-coding): Set `default-directory' to a local
	directory.  Sporadically, `call-process-region' does not handle a
	remote default directory properly.

	* net/trampver.el: Update release number.

2015-03-03  Agustín Martín Domingo  <agustin6martin@gmail.com>

	* textmodes/ispell.el (ispell-aspell-find-dictionary): Make sure
	.dat files for aspell dicts are also searched for in location
	described by `ispell-aspell-dict-dir', matching aspell's dict-dir
	variable.

2015-03-03  Agustín Martín Domingo  <agustin6martin@gmail.com>

	* textmodes/ispell.el (ispell-dicts-name2locale-equivs-alist)
	(ispell-hunspell-fill-dictionary-entry)
	(ispell-find-hunspell-dictionaries)
	(ispell-set-spellchecker-params): New generic name for
	`ispell-hunspell-dictionary-equivs-alist'.
	(ispell-aspell-add-aliases): Also use
	`ispell-dicts-name2locale-equivs-alist' to get aspell aliases for
	standard dict names.

2015-03-03  Glenn Morris  <rgm@gnu.org>

	* net/browse-url.el (browse-url-firefox-startup-arguments):
	Make obsolete.
	(browse-url-firefox): Doc fix.  Remove -remote, which no longer
	exists in Firefox 36.  (Bug#19921)
	(browse-url-firefox-sentinel): Remove function.

2015-03-03  Eli Zaretskii  <eliz@gnu.org>

	* frame.el (blink-cursor-timer-function): Don't increment
	blink-cursor-blinks-done counter when a menu is active on a w32
	frame.  (Bug#19925)

2015-03-03  Juri Linkov  <juri@linkov.net>

	* comint.el (comint-line-beginning-position): Revert searching for
	the prompt when comint-use-prompt-regexp is non-nil because it
	doesn't distinguish input from output.  Check the field property
	`output' for the case when comint-use-prompt-regexp is nil.
	(Bug#19710)

2015-03-03  Jérémy Compostella  <jeremy.compostella@gmail.com>

	* net/tramp-sh.el (tramp-remote-process-environment): Disable paging
	with PAGER=cat.  (Bug#19870)

2015-03-03  Glenn Morris  <rgm@gnu.org>

	* textmodes/flyspell.el (flyspell-duplicate-distance):
	Bump :version.

2015-03-03  Eli Zaretskii  <eliz@gnu.org>

	* textmodes/text-mode.el (text-mode-syntax-table): Make some
	punctuation character behave as word-constituent, for more
	compatibility with Unicode.

	* simple.el (transient-mark-mode): Doc fix.  (Bug#19841)

2015-03-03  Agustín Martín Domingo  <agustin6martin@gmail.com>

	Improve string search in `flyspell-word-search-*`. (Bug#16800)
	* textmodes/flyspell.el (flyspell-duplicate-distance):
	Limit default search distance for duplicated words to 40000.
	(flyspell-word-search-backward, flyspell-word-search-forward):
	Search as full word with defined casechars, not as substring.

2015-03-03  Juri Linkov  <juri@linkov.net>

	Better support for the case of typing RET on the prompt in comint.
	* comint.el (comint-get-old-input-default): Go to the field end
	when comint-use-prompt-regexp is nil.
	(comint-line-beginning-position): Check if point is already
	on the prompt before searching for the prompt when
	comint-use-prompt-regexp is non-nil.  (Bug#19710)

2015-03-03  Eli Zaretskii  <eliz@gnu.org>

	* frame.el (frame-notice-user-settings): Refresh the value of
	frame parameters after calling tty-handle-reverse-video.
	Call face-set-after-frame-default with the actual parameters, to avoid
	resetting colors back to unspecified.
	(set-background-color, set-foreground-color): Pass the foreground
	and background colors to face-set-after-frame-default.  (Bug#19802)

2015-03-03  Wolfgang Jenkner  <wjenkner@inode.at>

	* net/network-stream.el (network-stream-open-tls): Respect the
	:end-of-capability setting.

2015-03-03  Juri Linkov  <juri@linkov.net>

	Revert the previous change of comint-line-beginning-position callers,
	and modify comint-line-beginning-position instead.

	* comint.el (comint-history-isearch-search)
	(comint-history-isearch-message, comint-history-isearch-wrap):
	Use comint-line-beginning-position instead of field-beginning.
	(comint-send-input): Use either end-of-line or field-end
	depending on comint-use-prompt-regexp.
	(comint-line-beginning-position): Search backward
	for comint-prompt-regexp if comint-use-prompt-regexp is non-nil.
	Use field-beginning instead of line-beginning-position
	if comint-use-prompt-regexp is nil.  (Bug#19710)

2015-03-03  Robert Pluim  <rpluim@gmail.com>  (tiny change)

	* calendar/todo-mode.el (todo-item-done): When done items are
	hidden, restore point to its location prior to invoking this
	command.  (Bug#19727)

2015-03-03  Eli Zaretskii  <eliz@gnu.org>

	* textmodes/artist.el (artist-ellipse-compute-fill-info):
	Use mapcar, not mapc, to create the other half of fill-info.
	(Bug#19763)

2015-03-03  Nicolas Petton  <nicolas@petton.fr>

	* emacs-lisp/authors.el (authors-ignored-files)
	(authors-renamed-files-alist): Additions.

2015-03-03  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-ssh-controlmaster-options): Don't use a
	tempfile for ControlPath.  (Bug#19702)

2015-03-03  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-ssh-controlmaster-options): Use "%C" for
	ControlPath if possible.  (Bug#19702)

2015-03-03  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/authors.el (authors-obsolete-files-regexps)
	(authors-valid-file-names, authors-renamed-files-alist): Additions.

2015-03-03  Alan Mackenzie  <acm@muc.de>

	CC Mode: Stop Font Lock forcing fontification from BOL.  (Bug#19669)
	* progmodes/cc-mode.el (c-font-lock-init):
	Set font-lock-extend-region-functions to nil.

2015-03-03  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/generator.el: Make globals conform to elisp
	style throughout.  Use more efficient font-lock patterns.
	(cps-inhibit-atomic-optimization): Rename from
	`cps-disable-atomic-optimization'.
	(cps--gensym): New macro; replaces `cl-gensym' throughout.
	(cps-generate-evaluator): Move the `iter-yield' local macro
	definition here
	(iter-defun, iter-lambda): from here.

	(iter-defun): Use `macroexp-parse-body'.

2015-03-03  Daniel Colascione  <dancol@dancol.org>

2015-03-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/gud.el: Use lexical-binding (bug#19966).

	* emacs-lisp/gv.el (gv-ref): Warn about likely problematic cases.

2015-03-03  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/generator.el: Make globals conform to elisp
	style throughout.  Use more efficient font-lock patterns.
	(cps-inhibit-atomic-optimization): Rename from
	`cps-disable-atomic-optimization'.
	(cps--gensym): New macro; replaces `cl-gensym' throughout.
	(cps-generate-evaluator): Move the `iter-yield' local macro
	definition here...
	(iter-defun, iter-lambda): ...from here.

2015-03-03  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package-autoremove): Fix if logic.

2015-03-03  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--dump-frame): For pixel height return total
	number of frame's lines.

2015-03-03  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-macs.el (cl-iter-defun): Add cl-iter-defun.

	* emacs-lisp/generator.el (iter-defun): Correctly propagate
	docstrings and declarations to underlying function.

2015-03-02  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/generator.el: New file.

	* vc/vc.el (vc-responsible-backend): Add autoload cookie for
	`vc-responsible-backend'.

2015-03-01  Michael Albinus  <michael.albinus@gmx.de>

	* vc/vc-hooks.el (vc-state, vc-working-revision):
	Use `vc-responsible-backend' in order to support unregistered files.

	* vc/vc-rcs.el (vc-rcs-unregister): Support unregistered files.

	* vc/vc-rcs.el (vc-rcs-fetch-master-state):
	* vc/vc-sccs.el (vc-sccs-working-revision): Handle undefined
	master name.

	* vc/vc-src.el (vc-src-working-revision): Do not return an empty string.

2015-03-01  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-insert): Remove soft hyphens.
	(shr-insert): Also remove soft hyphens from non-folded text.

2015-02-28  Eli Zaretskii  <eliz@gnu.org>

	* mail/rmailmm.el (rmail-mime-insert-html): Decode HTML payload
	when the charset is only given by the HTML <head>, and allow to
	specify the encoding with "C-x RET c".

2015-02-27  Mark Laws  <mdl@60hz.org>

	Support daemon mode on MS-Windows (bug#19688)
	* server.el (server-process-filter): Force GUI frames on
	MS-Windows in daemon mode, even if a TTY frame was requested.

	* frameset.el (frameset-keep-original-display-p): Don't assume
	windows-nt cannot be in daemon mode.

	* frame.el (window-system-for-display): Don't assume windows-nt
	cannot be in daemon mode.

2015-02-26  Ivan Shmakov  <ivan@siamics.net>

	* faces.el (face-list-p): Split from face-at-point.
	(face-at-point): Use it.
	* facemenu.el (facemenu-add-face): Likewise.  (Bug#19912)

2015-02-26  Oscar Fuentes  <ofv@wanadoo.es>

	* vc/vc.el (vc-annotate-switches): New defcustom.
	* vc/vc-bzr.el (vc-bzr-annotate-switches): New defcustom.
	(vc-bzr-annotate-command): Use vc-switches.
	* vc/vc-cvs.el (vc-cvs-annotate-switches): New defcustom.
	(vc-cvs-annotate-command): Use vc-switches.
	* vc/vc-git.el (vc-git-annotate-switches): New defcustom.
	(vc-git-annotate-command): Use vc-switches.
	* vc/vc-hg.el (vc-hg-annotate-switches): New defcustom.
	(vc-hg-annotate-command): Use vc-switches.
	* vc/vc-mtn.el (vc-mtn-annotate-switches): New defcustom.
	(vc-mtn-annotate-command): Use vc-switches.
	* vc/vc-svn.el (vc-svn-annotate-switches): New defcustom.
	(vc-svn-annotate-command): Use vc-switches.

2015-02-26  Alan Mackenzie  <acm@muc.de>

	Handle "#" operator properly inside macro.  Fix coding bug.

	* progmodes/cc-mode.el (c-neutralize-syntax-in-and-mark-CPP):
	On finding a "#" which looks like the start of a macro, check it
	isn't already inside a macro.

	* progmodes/cc-engine.el (c-state-safe-place): Don't record a new
	"safe" position into the list of them when this is beyond our
	current position.

2015-02-26  Martin Rudalics  <rudalics@gmx.at>

	* menu-bar.el (menu-bar-non-minibuffer-window-p): Return nil when
	the menu frame is dead.  (Bug#19728)

2015-02-26  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Handle tabs in python-indent-dedent-line.
	* progmodes/python.el (python-indent-dedent-line): Fixes for
	indentation with tabs.  Thanks to <dale@codefu.org> (Bug#19730).

2015-02-26  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-context): Respect user
	indentation after comment.

2015-02-26  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (featurep): Conditionalize value of
	reftex-label-regexps in order to stay compatible with XEmacs 21.5
	which has no explicitly numbered groups in regexps (bug#19714).

2015-02-26  Daiki Ueno  <ueno@gnu.org>

	* net/dbus.el (dbus-register-signal): Convert "N" of ":argN" to
	integer before comparison.

2015-02-25  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* progmodes/elisp-mode.el (elisp--eval-last-sexp): Document argument.

2015-02-25  Oleh Krehel  <ohwoeowho@gmail.com>

	* emacs-lisp/check-declare.el (check-declare-warn):
	Use compilation-style warnings.
	(check-declare-files): Make sure that
	`check-declare-warning-buffer' is in `compilation-mode'.

2015-02-25  Oleh Krehel  <ohwoeowho@gmail.com>

	* emacs-lisp/check-declare.el (check-declare-ext-errors):
	New defcustom.
	(check-declare): New defgroup.
	(check-declare-verify): When `check-declare-ext-errors' is
	non-nil, warn about an unfound function, instead of saying
	"skipping external file".

2015-02-25  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (reftex-include-file-commands):
	Call reftex-set-dirty on changes.

2015-02-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug--display): Save-excursion (bug#19611).
	* emacs-lisp/debug.el (debugger-env-macro): Remove redundant
	save-excursion.

2015-02-24  Glenn Morris  <rgm@gnu.org>

	* mail/rmailsum.el (rmail-summary-previous-all)
	(rmail-summary-previous-msg): Simplify.

2015-02-25  Artur Malabarba  <bruce.connor.am@gmail.com>

	* simple.el (region-active-p): Fix doc to say non-nil.

2015-02-24  Samer Masterson  <nosefrog@gmail.com>

	* eshell/em-hist.el (eshell-hist-parse-word-designator):
	Return args joined with " ".
	* eshell/em-pred.el (eshell-parse-modifiers): Correct docstring.
	(eshell-hist-parse-modifier): Pass mod a list instead of a string
	(bug#18960).

2015-02-24  Karl Fogel  <kfogel@red-bean.com>  (tiny change)

	* comint.el (comint-mode-map): Fix obvious typo.

2015-02-24  Johan Claesson  <johanclaesson@bredband.net>  (tiny change)

	* filecache.el (file-cache-filter-regexps):
	Add lock files.  (Bug#19516)

2015-02-24  Glenn Morris  <rgm@gnu.org>

	* mail/rmailsum.el (rmail-summary-next-all)
	(rmail-summary-previous-all, rmail-summary-next-msg):
	Fix handling of optional argument.  (Bug#19916)

	* progmodes/f90.el (f90-beginning-of-subprogram)
	(f90-end-of-subprogram, f90-match-end):
	Handle continued strings where the continuation does not start
	with "&" and happens to match our regexp.  (Bug#19809)

2015-02-24  Bozhidar Batsov  <bozhidar@batsov.com>

	* comint.el (comint-clear-buffer): New command.
	(comint-mode-map): Bind `comint-clear-buffer' to 'C-c M-o'.

2015-02-23  Pete Williamson  <petewil0@googlemail.com>  (tiny change)

	Use ${EXEEXT} more uniformly in makefiles
	* Makefile.in (EMACS): Append ${EXEEXT}.

2015-02-23  Sam Steingold  <sds@gnu.org>

	* files.el (recover-session): Handle `auto-save-list-file-prefix'
	being a directory (empty non-directory part).

2015-02-23  Magnus Henoch  <magnus.henoch@gmail.com>

	* net/sasl.el (sasl-mechanism-alist): Refer to sasl-scram-rfc
	instead of sasl-scram-sha-1, as the former is the name that can be
	required.

	* net/sasl-scram-rfc.el (sasl-scram-sha-1-steps)
	(sasl-scram-sha-1-client-final-message)
	(sasl-scram-sha-1-authenticate-server): Move to end of file.

2015-02-23  Paul Eggert  <eggert@cs.ucla.edu>

	* bindings.el (ctl-x-map): Use [?\C-\;] to get the desired binding.
	(Bug#19826)

2015-02-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/macroexp.el (macroexp-parse-body): Handle cl-declare
	and :documentation.  Change return value format accordingly.
	* emacs-lisp/cl-generic.el (cl--generic-lambda):
	* emacs-lisp/pcase.el (pcase-lambda): Adjust accordingly.
	* emacs-lisp/cl-macs.el (cl--transform-lambda): Use macroexp-parse-body.

2015-02-23  Dmitry Gutov  <dgutov@yandex.ru>

	Introduce `xref-etags-mode'.
	* progmodes/xref.el (xref-etags-mode--saved): New variable.
	(xref-etags-mode): New minor mode.  (Bug#19466)

2015-02-22  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* dom.el (dom-previous-sibling): New function.

2015-02-21  Paul Eggert  <eggert@cs.ucla.edu>

	* bindings.el (ctl-x-map): There is no 'C-;'.
	For now, make do with 'M-;'; this allows 'make bootstrap' to work.
	Perhaps some other binding should be chosen.  (Bug#19826)

2015-02-21  Artur Malabarba  <bruce.connor.am@gmail.com>

	* bindings.el (ctl-x-map): Fix `comment-line' binding.  (Bug#19826)

2015-02-21  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-notify-add-watch)
	(auto-revert-notify-handler, auto-revert-buffers): Handle also
	buffers without an associated file, like dired buffers.  (Bug#16112)

2015-02-21  Dima Kogan  <dima@secretsauce.net>

	* autorevert.el (auto-revert-mode, auto-revert-tail-mode)
	(global-auto-revert-mode): Remove (let (auto-revert-use-notify) ... )
	wrappers.  Call (auto-revert-buffers) consequently in order to
	install handlers.

2015-02-21  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode revision 0d6420b.
	* progmodes/verilog-mode.el (verilog-mode-version): Update.
	(vector-skip-list): Remove.
	(verilog-auto-inst-port, verilog-auto-inst-port-list)
	(verilog-auto-inst, verilog-auto-inst-param):
	Use arguments rather than vector-skip.
	(verilog-auto-inst-port): Fix AUTOINST interfaces to not show
	modport if signal attachment is itself a modport.
	Reported by Matthew Lovell.

2015-02-21  Reto Zimmermann  <reto@gnu.org>

	Sync with upstream vhdl mode v3.37.1.  Add VHDL'08 support.
	* progmodes/vhdl-mode.el (vhdl-version, vhdl-time-stamp)
	(vhdl-doc-release-notes): Update.
	(vhdl-standard): Add VHDL'08 option.
	(vhdl-sensitivity-list-all): New option.
	(vhdl-directive-keywords): Add psl.
	(vhdl-offsets-alist-default, vhdl-mode-abbrev-table-init)
	(vhdl-template-construct-alist-init, vhdl-create-mode-menu):
	(vhdl-imenu-generic-expression): Add context, directive.
	(vhdl-offsets-alist, vhdl-mode, vhdl-doc-keywords): Doc fixes.
	(vhdl-template-map-init): Add vhdl-template-context.
	(vhdl-mode-syntax-table): Support VHDL'08 block comments.
	(vhdl-create-mode-menu): Add some entries.
	(vhdl-08-keywords, vhdl-08-types, vhdl-08-attributes)
	(vhdl-08-functions, vhdl-08-packages, vhdl-08-directives):
	New constants.
	(vhdl-directives): New variable.
	(vhdl-words-init, vhdl-template-process)
	(vhdl-template-replace-header-keywords): Support VHDL'08.
	(vhdl-abbrev-list-init): Add vhdl-directives.
	(vhdl-in-comment-p, vhdl-in-literal, vhdl-win-il)
	(vhdl-forward-syntactic-ws, vhdl-get-syntactic-context)
	(vhdl-lineup-comment): Handle block comments and directives.
	(vhdl-beginning-of-directive, vhdl-template-context)
	(vhdl-template-context-hook): New functions.
	(vhdl-libunit-re, vhdl-defun-re, vhdl-begin-p)
	(vhdl-corresponding-begin, vhdl-get-library-unit, vhdl-regress-line)
	(vhdl-align-declarations, vhdl-beginning-of-block, vhdl-end-of-block)
	(vhdl-font-lock-keywords-2, vhdl-get-end-of-unit)
	(vhdl-scan-context-clause): Add context.

2015-02-20  Glenn Morris  <rgm@gnu.org>

	* calendar/solar.el (solar-sunrise-sunset-string):
	Shorten message a little.
	(sunrise-sunset): Use message rather than a window.  (Bug#19859)

	* progmodes/f90.el (f90-keywords-re, f90-procedures-re)
	(f90-font-lock-keywords-2): Some F2008 additions.

2015-02-19  Dima Kogan  <dima@secretsauce.net>

	* autorevert.el (auto-revert-buffers-counter)
	(auto-revert-buffers-counter-lockedout): New variables.
	(auto-revert-buffers): Increase `auto-revert-buffers-counter'.
	(auto-revert-notify-handler): Apply `auto-revert-handler' if not
	suppressed by lockout.  (Bug#18958)

2015-02-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-opt.el (eieio-help-class): `eieio-class-parents'
	returns classes, not class names (bug#19891).

	* emacs-lisp/cl-macs.el (cl-struct-slot-value): Handle a nil type.

	* emacs-lisp/smie.el (smie-prec2->grammar): Fix corner case problem.

2015-02-18  Kelly Dean  <kelly@prtime.org>

	* register.el (jump-to-register):
	* emacs-lisp/lisp.el (check-parens):
	Push mark before goto-char so user doesn't lose his previous place.

2015-02-18  Kelly Dean  <kelly@prtime.org>

	* rect.el (rectangle-mark-mode):
	Suppress superfluous "Mark set" message from push-mark.

2015-02-18  Kelly Dean  <kelly@prtime.org>

	* help-mode.el (help-go-back, help-go-forward, help-follow):
	* simple.el (yank-pop, pop-to-mark-command, exchange-point-and-mark):
	* winner.el (winner-redo):
	* windmove.el (windmove-do-window-select):
	* register.el (jump-to-register, increment-register, insert-register)
	(append-to-register, prepend-to-register):
	* files.el (find-alternate-file, abort-if-file-too-large, write-file)
	(set-visited-file-name):
	* emacs-lisp/lisp.el (kill-backward-up-list):
	Use user-error instead of error.  (Bug#14480)

2015-02-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/checkdoc.el (checkdoc-show-diagnostics): Don't make bogus
	assumptions about window ordering.

2015-02-16  Kelly Dean  <kelly@prtime.org>

	* files.el (insert-file-contents-literally): Fix docstring typo.

2015-02-16  Kelly Dean  <kelly@prtime.org>

	* emacs-lisp/easy-mmode.el (define-minor-mode): Process macro
	arguments correctly. (Bug#19685)
	(define-minor-mode): Clarify docstring.
	Clarify mode switch messages for minor modes.  (Bug#19690)

2015-02-16  Kelly Dean  <kelly@prtime.org>

	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Create valid tar files.  (Bug#19536)

2015-02-16  Kelly Dean  <kelly@prtime.org>

	* desktop.el (desktop-read): Conditionally re-enable desktop autosave.
	(Bug#19059)

2015-02-16  Kelly Dean  <kelly@prtime.org>

	* help-mode.el (help-do-xref): Prevent duplicated display of Info
	buffer, and prevent interference with existing buffer.  (Bug#13190)

2015-02-16  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Do not deactivate mark on shell fontification.  (Bug#19871)

	* progmodes/python.el (python-shell-font-lock-post-command-hook):
	Do not deactivate mark on fontification.

2015-02-16  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el: Fix desktop support.  (Bug#19226)
	(eww-mode): Add autoload cookie.
	(eww-restore-desktop): Use inhibit-read-only.

	* net/eww.el (eww-suggest-uris): Add autoload cookie, so that
	add-hook works correctly even if the file is not yet loaded.

2015-02-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (defclass): Use make-instance rather than
	eieio-constructor.
	(set-slot-value): Mark as obsolete.
	(eieio-object-class-name): Improve call to eieio-class-name.
	(eieio-slot-descriptor-name, eieio-class-slots): New functions.
	(object-slots): Use it.  Declare obsolete.
	(eieio-constructor): Merge it with `make-instance'.
	(initialize-instance): Use `dolist'.
	(eieio-override-prin1, eieio-edebug-prin1-to-string):
	Use eieio--class-print-name.

	* emacs-lisp/eieio-core.el (eieio--class-print-name): New function.
	(eieio-class-name): Make it do what the docstring claims.
	(eieio-defclass-internal): Simplify since `prots' isn't used any more.
	(eieio--slot-name-index): Simplify accordingly.
	(eieio-barf-if-slot-unbound): Pass the class object rather than its
	name to `slot-unbound'.

	* emacs-lisp/eieio-base.el (make-instance): Add a method here rather
	than on eieio-constructor.

2015-02-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl-defstruct): Keep type=nil by default.
	* emacs-lisp/cl-preloaded.el (cl-struct-define): Add sanity checks
	about relationship between `type', `named', and `slots'.
	* emacs-lisp/cl-generic.el (cl--generic-struct-tagcode): Adjust to new
	value of `cl-struct-type' property.

2015-02-15  Jérémy Compostella  <jeremy.compostella@gmail.com>

	* net/tramp-sh.el (tramp-remote-process-environment): Disable paging
	with PAGER=cat.  (Bug#19870)

2015-02-14  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package-read-all-archive-contents):
	Don't build the compatibility table.
	(package-refresh-contents, package-initialize): Do build the
	compatibility table.
	(package--build-compatibility-table): New function.
	(describe-package-1): Describe why a package is incompatible.

2015-02-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-preloaded.el (cl-struct-define): Register as children
	of the parent.
	(cl--assertion-failed): New function.
	(cl-assertion-failed): Move in from cl-lib.el.

	* emacs-lisp/cl-macs.el (cl-defstruct): Don't generate code to register
	as children of its parents.
	(cl--make-type-test, cl--compiler-macro-typep): Remove functions.
	(cl-typep): Reimplement using define-inline.
	(cl-assert): Use cl--assertion-failed.
	(cl-struct-slot-value): Use define-inline.

	* emacs-lisp/cl-lib.el: Move autoloaded code to cl-preload.

	* textmodes/flyspell.el (flyspell-word): Defvar (bug#19844).
	(flyspell-generic-check-word-p): Mark as obsolete.

2015-02-13  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--compatibility-table): New var.
	(package--add-to-compatibility-table): New function.
	(package-read-all-archive-contents): Populate compatibility table.
	(package--incompatible-p): Also look in dependencies.
	(describe-package-1): Fix "incompat" handling.

2015-02-13  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/rfc2104.el: Moved here from lisp/gnus.

2015-02-13  Magnus Henoch  <magnus.henoch@gmail.com>

	* net/sasl-scram-rfc.el: New file.

	* net/sasl.el (sasl-mechanisms): Remove SCRAM-MD5.
	Add SCRAM-SHA-1 first.
	(sasl-mechanism-alist): Remove SCRAM-MD5 entry.  Add SCRAM-SHA-1
	entry (bug#17636).

2015-02-13  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-tag-li): Speed up rendering pages with lots of
	<ul>.

2015-02-12  Oleh Krehel  <ohwoeowho@gmail.com>

	* progmodes/gdb-mi.el (gdb-display-io-nopopup): New defcustom.
	(gdb-inferior-filter): Don't pop up the buried output buffer when
	`gdb-display-io-nopopup' is non-nil.

2015-02-12  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Allow killing shell buffer if process is dead.  (Bug#19823)

	* progmodes/python.el (python-shell-font-lock-kill-buffer):
	Don't require a running process.
	(python-shell-font-lock-post-command-hook): Fontify only if the
	shell process is running.

2015-02-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* hi-lock.el (hi-lock-unface-buffer): Don't call
	font-lock-remove-keywords if not needed (bug#19796).

2015-02-11  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package-install): Invert the second
	argument, for better backwards compatibility.
	(package-install-button-action, package-reinstall)
	(package-menu-execute): Account for the change.

2015-02-11  Nicolas Petton  <nicolas@petton.fr>

	* emacs-lisp/seq.el (seq-reverse): Add a backward-compatible
	version of seq-reverse that works on sequences in Emacs 24.
	Bump seq.el version to 1.2.

2015-02-11  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--incompatible-p): New function.
	Return non-nil if PKG has no chance of being installable.
	(package--emacs-version-list): New variable.
	(describe-package-1, package-desc-status)
	(package-menu--print-info, package-menu--status-predicate):
	Account for the "incompat" status.

2015-02-11  Martin Rudalics  <rudalics@gmx.at>

	* frame.el (toggle-frame-maximized, toggle-frame-fullscreen):
	Rename frame parameter `maximized' to `fullscreen-restore'.
	Restore fullwidth/-height after fullboth state.  Update doc-strings.

2015-02-11  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-insert): Make sure the space inserted has the
	right font (for width).
	(shr-fill-line): Preserve background colors when indenting/folding.
	(shr-ensure-paragraph): Don't insert a new paragraph as the first
	item in a <li>.

2015-02-10  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-use-fonts): New variable.
	(shr-fill-text): Rename from "fold".
	(shr-pixel-column, shr-pixel-region, shr-string-pixel-width):
	New functions.
	(shr-insert): Just insert, don't fill the text.  Filling is now
	done afterwards per display unit.
	(shr-fill-lines, shr-fill-line): New functions to fill text on a
	per-unit base.
	(shr-find-fill-point): Take a "beginning" parameter.
	(shr-indent): Indent using the :width display parameter when using
	fonts.
	(shr-parse-style): Ignore "inherit" values, since we already do that.
	(shr-tag-img): Remove the insertion states.
	(shr-tag-blockquote): New-style filling.
	(shr-tag-dd): Ditto.
	(shr-tag-li): Ditto.
	(shr-mark-fill): New function to mark lines that need filling.
	(shr-tag-h1): Use a larger font.
	(shr-tag-table-1): Get the natural and suggested widths in one
	rendering.
	(shr-tag-table): Create the "fixed" version of the table only once
	so that we can cache data in the table.
	(shr-insert-table): Get colspan calculations right by having
	zero-width columns after colspan ones.
	(shr-expand-alignments): New function to make :align-to specs work
	right when rendered in one buffer and displayed in another one.
	(shr-insert-table-ruler): Use :align-to to get the widths right.
	(shr-make-table): Cache more.
	(shr-make-table-1): Use the new <td> data layout.
	(shr-pixel-buffer-width): New function.
	(shr-render-td): Add a caching layer.
	(shr-dom-max-natural-width): New function.
	(shr-tag-h1): Don't use variable-pitch fonts on fontless rendering.
	(shr-tag-tt): New function.
	(shr-tag-hr): Compute the right length when using fonts.
	(shr-table-widths): Off-by-one error in width computation.
	(shr-expand-newlines): Remove dead code.
	(shr-insert-table): Extend background colors to the end of the column.
	(shr-insert-table): Only copy the background, not underline and
	the like.
	(shr-face-background): New function.

2015-02-10  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Improved shell font lock respecting markers.  (Bug#19650)

	* progmodes/python.el
	(python-shell-font-lock-get-or-create-buffer): Use special buffer name.
	(python-shell-font-lock-with-font-lock-buffer): Enable font lock.
	(python-shell-font-lock-post-command-hook): Fontify by copying text
	properties from fontified buffer to shell, keeping markers unchanged.
	(python-shell-font-lock-turn-off): Fix typo.
	(python-util-text-properties-replace-name): Delete function.

2015-02-09  Nicolas Petton  <nicolas@petton.fr>

	* emacs-lisp/seq.el (seq-group-by): Improves seq-group-by to
	return sequence elements in correct order.

2015-02-09  Simen Heggestøyl  <simenheg@gmail.com>  (tiny change)

	* textmodes/css-mode.el (css-smie-rules): Fix paren indent (bug#19815).

2015-02-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-generic.el (cl--generic-lambda): Use macroexp-parse-body.

	* emacs-lisp/eieio-core.el (eieio-oset-default): Catch the unexpected
	case where the default value would be re-interpreted as a form!

2015-02-09  Christopher Genovese  <genovese@cmu.edu>  (tiny change)

	* help-fns.el (help-fns--signature): Keep doc for keymap.

2015-02-09  Kelly Dean  <kelly@prtime.org>

	* desktop.el: Save mark-ring less verbosely.
	(desktop-var-serdes-funs): New var.
	(desktop-buffer-info, desktop-create-buffer): Use it.
	(desktop-file-version): Update to 208.

2015-02-09  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/pcase.el (pcase-lambda): New Macro.  (Bug#19814)

	* emacs-lisp/lisp-mode.el (el-kws-re): Include `pcase-lambda'.

	* emacs-lisp/macroexp.el (macroexp-parse-body): New function.

2015-02-08  Paul Eggert  <eggert@cs.ucla.edu>

	Port to platforms lacking test -a and -o
	* Makefile.in (compile-clean):
	* net/tramp-sh.el (tramp-find-executable):
	Prefer '&&' and '||' to 'test -a' and 'test -o'.

2015-02-08  Artur Malabarba  <bruce.connor.am@gmail.com>

	* newcomment.el (comment-line): Fix missing paren.

2015-02-08  Ulrich Müller  <ulm@gentoo.org>

	* play/gamegrid.el: Update comment to reflect that the
	'update-game-score' helper program is now setgid by default.

2015-02-08  David Kastrup  <dak@gnu.org>

	* subr.el (apply-partially): Use lexical binding here.

2015-02-08  Artur Malabarba  <bruce.connor.am@gmail.com>

	* newcomment.el (comment-line): New command.

	* bindings.el (ctl-x-map): Bind to `C-x C-;'.

2015-02-08  Oleh Krehel  <ohwoeowho@gmail.com>

	* outline.el (outline-show-entry): Fix one invisible char for the
	file's last outline.  (Bug#19493)

2015-02-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (indirect-function): Change advertised calling convention.

2015-02-08  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Fix completion-at-point.  (Bug#19667)

	* progmodes/python.el
	(python-shell-completion-native-get-completions): Force process buffer.
	(python-shell-completion-at-point): Handle case where call is not
	in a shell buffer.

2015-02-08  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Fix shell font-lock multiline input.  (Bug#19744)

	* progmodes/python.el
	(python-shell-font-lock-post-command-hook): Handle multiline input.

2015-02-08  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Make shell font-lock respect markers.  (Bug#19650)

	* progmodes/python.el (python-shell-font-lock-cleanup-buffer):
	Use `erase-buffer`.
	(python-shell-font-lock-comint-output-filter-function):
	Handle newlines.
	(python-shell-font-lock-post-command-hook): Respect markers on
	text fontification.

2015-02-07  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Keep eldoc visible while typing args.  (Bug#19637)
	* progmodes/python.el (python-eldoc--get-symbol-at-point):
	New function based on Carlos Pita <carlosjosepita@gmail.com> patch.
	(python-eldoc--get-doc-at-point, python-eldoc-at-point): Use it.

2015-02-07  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Fix hideshow integration.  (Bug#19761)
	* progmodes/python.el
	(python-hideshow-forward-sexp-function): New function based on
	Carlos Pita <carlosjosepita@gmail.com> patch.
	(python-mode): Make `hs-special-modes-alist` use it and initialize
	the end regexp with the empty string to avoid skipping parens.

2015-02-07  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-check-custom-command): Do not use
	defvar-local for compat with Emacs<24.3.

2015-02-07  Martin Rudalics  <rudalics@gmx.at>

	* frame.el (frame-notice-user-settings):
	Update `frame-size-history'.
	(make-frame): Update `frame-size-history'.
	Call `frame-after-make-frame'.
	* faces.el (face-set-after-frame-default): Remove call to
	frame-can-run-window-configuration-change-hook.

2015-02-06  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-cvs.el (vc-cvs-dir-status-files): Don't pass DIR to
	`vc-cvs-command' (bug#19732).

2015-02-06  Nicolas Petton  <nicolas@petton.fr>

	* emacs-lisp/seq.el (seq-mapcat, seq-partition, seq-group-by):
	New functions.
	* emacs-lisp/seq.el (seq-drop-while, seq-take-while, seq-count)
	(seq--drop-list, seq--take-list, seq--take-while-list):
	Better docstring.

2015-02-06  Artur Malabarba  <bruce.connor.am@gmail.com>

	* doc-view.el (doc-view-kill-proc-and-buffer): Obsolete. Use
	`image-kill-buffer' instead.

2015-02-06  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el (ldap-search-internal): Fix docstring.

2015-02-06  Lars Ingebrigtsen  <larsi@gnus.org>

	* subr.el (define-error): The error conditions may be constant
	lists, so use `append' to concatenate them.

2015-02-06  Wolfgang Jenkner  <wjenkner@inode.at>

	* net/network-stream.el (network-stream-open-tls): Respect the
	:end-of-capability setting.

2015-02-05  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--sort-by-dependence):
	New function.  Return PACKAGE-LIST sorted by dependencies.
	(package-menu-execute): Use it to delete packages in order.
	(package--sort-deps-in-alist): New function.
	(package-menu-mark-install): Can mark dependencies.
	(package--newest-p): New function.
	(package-delete): Don't deselect when deleting an older version of
	an upgraded package.

	* emacs-lisp/package.el: Add missing (require 'subr-x)

2015-02-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/css-mode.el (scss-smie--not-interpolation-p): Vars can be
	hyphenated (bug#19263).

	* textmodes/css-mode.el (css-fill-paragraph): Fix filling in presence
	of variable interpolation (bug#19751).

2015-02-05  Era Eriksson  <era+emacs@iki.fi>

	* json.el (json-end-of-file): New error (bug#19768).
	(json-pop, json-read): Use it.

2015-02-05  Kelly Dean  <kelly@prtime.org>

	* help-mode.el (help-xref-interned): Pass BUFFER and FRAME to
	`describe-variable'.

	* help-fns.el (describe-function-or-variable): New function.

	* help.el (help-map): Bind `describe-function-or-variable' to o.
	(help-for-help-internal): Document o key.

2015-02-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-compat.el (eieio--defmethod): Use new
	special (:documentation ...) feature.
	* emacs-lisp/eieio-core.el (eieio-make-class-predicate)
	(eieio-make-child-predicate): Same.
	(eieio-copy-parents-into-subclass): Remove unused arg.
	(eieio-defclass-internal): Adjust call accordingly and remove redundant
	`pname' var.
	(eieio--slot-name-index): Remove unused arg `obj' and adjust all
	callers accordingly.

	* emacs-lisp/cconv.el (cconv--convert-function):
	Add `docstring' argument.
	(cconv-convert): Use it to handle the new (:documentation ...) form.
	(cconv-analyze-form): Handle the new (:documentation ...) form.

	* emacs-lisp/bytecomp.el:
	(byte-compile-initial-macro-environment): Use macroexp-progn.
	(byte-compile-cl-warn): Don't silence use of cl-macroexpand-all.
	(byte-compile-file-form-defvar-function): Rename from
	byte-compile-file-form-define-abbrev-table.
	(defvaralias, byte-compile-file-form-custom-declare-variable): Use it.
	(byte-compile): Use byte-compile-top-level rather than
	byte-compile-lambda so we can compile non-values.
	(byte-compile-form): Add warnings for failed uses of lexical vars via
	quoted symbols.
	(byte-compile-unfold-bcf): Improve message for failed inlining.
	(byte-compile-make-closure): Handle new format of internal-make-closure
	for dynamically-generated docstrings.

	* delsel.el: Deprecate the `kill' option.  Use lexical-binding.
	(open-line): Delete like all other commands, instead of killing.
	(delete-active-region): Don't define any return any value.

	* progmodes/python.el: Try to preserve compatibility with Emacs-24.
	(python-mode): Don't assume eldoc-documentation-function has a non-nil
	default.

2015-02-04  Sam Steingold  <sds@gnu.org>

	* progmodes/python.el (python-indent-calculate-indentation):
	Avoid the error when computing top-level indentation.

2015-02-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-generic.el (cl--generic-member-method): Fix paren typo.

	* textmodes/flyspell.el: Use lexical-binding and cl-lib.
	(mail-mode-flyspell-verify): Fix last change.
	(flyspell-external-point-words, flyspell-large-region):
	Avoid add-to-list on local vars.

2015-02-04  Tassilo Horn  <tsdh@gnu.org>

	* emacs-lisp/package.el (package-installed-p): Fix typo causing
	void-variable error.

2015-02-04  Artur Malabarba  <bruce.connor.am@gmail.com>

	* image-mode.el (image-kill-buffer): New command.
	(image-mode-map): Bind it to k.

	* emacs-lisp/package.el (package-delete): Remove package from
	`package-selected-packages' even if it can't be deleted.
	(package-installed-p): Accept package-desc objects.
	(package-install): Can be used to mark dependencies as
	selected. When given a package-desc object which is already
	installed, the package is not downloaded again, but it is marked
	as selected (if it wasn't already).
	(package-reinstall): Accept package-desc objects.

2015-02-03  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package-delete): Document NOSAVE.
	(package--get-deps): delete-dups when ONLY is nil.
	(package-autoremove): Warn the user if `package-selected-packages'
	is empty.

	(package--user-selected-p): New function.
	(package-delete, package-install, package-install-from-buffer):
	Use it
	(package-selected-packages): Mention it.

	(package-initialize): Don't populate `package-selected-packages'.
	(package-install-user-selected-packages, package-autoremove):
	Special handling for empty `package-selected-packages'.
	(package-install): Fix when PKG is a package-desc.

	(package-desc-status): Add "dependency" status to the Package
	Menu.
	(package-menu--status-predicate, package-menu--print-info)
	(package-menu-mark-delete, package-menu--find-upgrades)
	(package-menu--status-predicate, describe-package-1): Use it

	(package--removable-packages): New function.
	(package-autoremove): Use it.
	(package-menu-execute): Offer to remove unneeded packages.

	(package--read-pkg-desc, package-tar-file-info): Fix reference to
	tar-desc.

2015-02-03  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* emacs-lisp/package.el (package-reinstall): Don't change package's selected status.
	(package-delete): New NOSAVE argument.

2015-02-03  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-histfile-override): Fix docstring.
	(tramp-open-shell, tramp-maybe-open-connection): Set also
	HISTFILESIZE and HISTSIZE when needed.  (Bug#19731)

2015-02-02  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--find-non-dependencies):
	New function.
	(package-initialize): Use it to populate `package-selected-packages'.
	(package-menu-execute): Clean unnecessary `and'.
	(package--get-deps): Fix returning duplicates.

2015-02-02  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-histfile-override): Add another choice t.
	Use it as default.
	(tramp-open-shell, tramp-maybe-open-connection): Support it.
	(Bug#19731)

2015-02-02  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* emacs-lisp/package.el (package-delete): Remove package from
	package-selected-packages.
	(package-autoremove): Remove unneeded variable.

2015-02-01  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package-selected-packages): Fix :type
	(package-install): Rename ARG to MARK-SELECTED.
	(package--get-deps): Fix for indirect dependencies.
	(package-used-elsewhere-p): Rename to
	(package--used-elsewhere-p): New function.
	(package-reinstall, package-user-selected-packages-install)
	(package-autoremove): Use sharp-quote.
	(package-user-selected-packages-install): Reindent and rename to
	(package-install-user-selected-packages): New function.

2015-02-01  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* emacs-lisp/package.el: Don't allow deleting dependencies.

	(package-used-elsewhere-p): New function.
	(package-delete): Use it, return now an error when trying to
	delete a package used as dependency by another package.

	Add a reinstall package command.
	(package-reinstall): New function.

	Add a package-autoremove command.
	(package-selected-packages): New user var.
	(package-install): Add an optional arg to notify interactive use.
	Fix docstring. Save installed package to
	packages-installed-directly.
	(package-install-from-buffer): Same.
	(package-user-selected-packages-install): Allow installing all
	packages in packages-installed-directly at once.
	(package--get-deps): New function.
	(package-autoremove): New function.
	(package-install-button-action): Call package-install with
	interactive arg.
	(package-menu-execute): Same but only for only for not installed
	packages.

2015-01-31  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (defclass): Use new eieio-make-class-predicate
	and eieio-make-child-predicate.
	(eieio-class-parents): Use eieio--class-object.
	(slot-boundp, find-class, eieio-override-prin1): Avoid class-p.
	(slot-exists-p): Use find-class.

	* emacs-lisp/eieio-opt.el (eieio-help-class, eieio-help-constructor):
	Use find-lisp-object-file-name, help-fns-short-filename and new calling
	convention for eieio-class-def.
	(eieio-build-class-list): Remove function, unused.
	(eieio-method-def): Remove button type, unused.
	(eieio-class-def): Inherit from help-function-def.
	(eieio--defclass-regexp): New constant.
	(find-function-regexp-alist): Use it.
	(eieio--specializers-apply-to-class-p): Handle eieio--static as well.
	(eieio-help-find-method-definition, eieio-help-find-class-definition):
	Remove functions.

	* emacs-lisp/eieio-core.el (eieio--check-type): Remove.
	Use cl-check-type everywhere instead.
	(eieio-class-object): Remove, use find-class instead when needed.
	(class-p): Don't inline.
	(eieio-object-p): Check more thoroughly, so we don't treat cl-structs,
	such as eieio classes, as objects.  Don't inline.
	(object-p): Mark as obsolete.
	(eieio-defclass-autoload, eieio-defclass-internal, eieio-oref)
	(eieio--generic-tagcode): Avoid `class-p'.
	(eieio-make-class-predicate, eieio-make-child-predicate): New functions.
	(eieio-defclass-internal): Use current-load-list rather than
	`class-location'.

	* emacs-lisp/cl-generic.el (cl--generic-search-method): Fix regexp.

2015-01-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/backquote.el (backquote-delay-process): Don't reuse `s'
	since it may be "equivalent" in some sense, yet different (bug#19734).

2015-01-30  Oleh Krehel  <ohwoeowho@gmail.com>

	* outline.el (outline-font-lock-face): Add docstring.
	(outline-invisible-p): Improve docstring.
	(outline-invent-heading): Add docstring.
	(outline-promote): Improve docstring.
	(outline-demote): Improve docstring.
	(outline-head-from-level): Improve docstring.
	(outline-end-of-heading): Add docstring.
	(outline-next-visible-heading): Improve docstring.
	(outline-previous-visible-heading): Improve docstring.
	(outline-hide-region-body): Improve docstring.
	(outline-flag-subtree): Add docstring.
	(outline-end-of-subtree): Add docstring.
	(outline-headers-as-kill): Improve docstring.

2015-01-30  Oleh Krehel  <ohwoeowho@gmail.com>

	* outline.el (outline-hide-entry): Rename from `hide-entry'.
	(hide-entry): Declare as obsolete.
	(outline-show-entry): Rename from `show-entry'.
	(show-entry): Declare as obsolete.
	(outline-hide-body): Rename from `hide-body'.
	(hide-body): Declare as obsolete.
	(outline-hide-region-body): Rename from `hide-region-body'.
	(hide-region-body): Declare as obsolete.
	(outline-show-all): Rename from `show-all'.
	(show-all): Declare as obsolete.
	(outline-hide-subtree): Rename from `hide-subtree'.
	(hide-subtree): Declare as obsolete.
	(outline-hide-leaves): Rename from `hide-leaves'.
	(hide-leaves): Declare as obsolete.
	(outline-show-subtree): Rename from `show-subtree'.
	(show-subtree): Declare as obsolete.
	(outline-hide-sublevels): Rename from `hide-sublevels'.
	(hide-sublevels): Declare as obsolete.
	(outline-hide-other): Rename from `hide-other'.
	(hide-other): Declare as obsolete.
	(outline-show-children): Rename from `show-children'.
	(show-children): Declare as obsolete.
	(outline-show-branches): Rename from `show-branches'.
	(show-branches): Declare as obsolete.

2015-01-30  Oleh Krehel  <ohwoeowho@gmail.com>

	* outline.el (outline-mode): Clean up docstring.
	(font-lock-warning-face): Remove obsolete declaration.
	(outline-font-lock-face): Remove obsolete comment.

2015-01-30  Oleh Krehel  <ohwoeowho@gmail.com>

	* custom.el (defface): Set `indent' to 1.

2015-01-30  Oleh Krehel  <ohwoeowho@gmail.com>

	* emacs-lisp/easy-mmode.el (define-minor-mode): Set `indent' to 1.

2015-01-30  Michal Nazarewicz  <mina86@mina86.com>

	* files.el (save-buffers-kill-emacs): If `confirm-kill-emacs'
	is set, but user has just been asked whether they really want to
	kill Emacs (for example with a ‘Modified buffers exist; exit
	anyway?’ prompt), do not ask them for another confirmation.

2015-01-29  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-units.el (calc-convert-exact-units): New function.
	(calc-convert-units): Check for missing units.
	(math-consistent-units-p): Strengthen the test for consistent units.

	* calc/calc-ext.el (calc-init-extensions):  Autoload
	`calc-convert-exact-units' and assign it a keybinding.

	* calc/calc-help.el (calc-u-prefix-help): Add help for the
	"un" keybinding.

2015-01-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl.el (cl--function-convert): Simplify.

2015-01-28  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex.el (reftex-syntax-table-for-bib): Give ( and )
	punctuation syntax since to allow bibtex fields with values such
	as {Test 1) and 2)} (bug#19205, bug#19707).
	(reftex--prepare-syntax-tables): New function.
	(reftex-mode): Use it.

2015-01-28  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: New non-global state dependent indentation engine.
	(Bug#18319, Bug#19595)
	* progmodes/python.el (python-syntax-comment-or-string-p):
	Accept PPSS as argument.
	(python-syntax-closing-paren-p): New function.
	(python-indent-current-level)
	(python-indent-levels): Mark obsolete.
	(python-indent-context): Return more context cases.
	(python-indent--calculate-indentation)
	(python-indent--calculate-levels): New functions.
	(python-indent-calculate-levels): Use them.
	(python-indent-calculate-indentation, python-indent-line):
	(python-indent-line-function): Rewritten to use new API.
	(python-indent-dedent-line): Simplify logic.
	(python-indent-dedent-line-backspace): Use `unless`.
	(python-indent-toggle-levels): Delete function.

2015-01-28  Daniel Koning  <dk@danielkoning.com>  (tiny change)

	* subr.el (posnp): Correct docstring of `posnp'.
	(posn-col-row): Make it work with all mouse position objects.
	* textmodes/artist.el (artist-mouse-draw-continously):
	Cancel timers if an error occurs during continuous drawing.  (Bug#6130)

2015-01-28  Eli Zaretskii  <eliz@gnu.org>

	* button.el (button-activate, push-button): Doc fix.  (Bug#19628)

2015-01-28  Michael Albinus  <michael.albinus@gmx.de>

	* filenotify.el (file-notify-descriptors, file-notify-handle-event):
	Adapt docstring.
	(file-notify--descriptor): New defun.
	(file-notify-callback, file-notify-add-watch, file-notify-rm-watch):
	Adapt docstring.  Handle multiple values for
	`file-notify-descriptors' entries.  (Bug#18880)

	* net/tramp.el (tramp-handle-file-notify-rm-watch): Do not check
	`file-notify-descriptors', the implementation has been changed.

2015-01-28  Eli Zaretskii  <eliz@gnu.org>

	* net/net-utils.el (net-utils-run-program, net-utils-run-simple):
	On MS-Windows, bind coding-system-for-read to the console output
	codepage.  (Bug#19458)

2015-01-28  Dmitry Gutov  <dgutov@yandex.ru>

	Unbreak `mouse-action' property in text buttons.
	* button.el (push-button): Fix regression from 2012-12-06.

2015-01-28  Glenn Morris  <rgm@gnu.org>

	* progmodes/sh-script.el (sh-mode): Doc fix.
	(sh-basic-indent-line): Handle electric newline.  (Bug#18756)

2015-01-28  Paul Eggert  <eggert@cs.ucla.edu>

	Fix dired quoting bug with "Hit`N`Hide".
	* files.el (shell-quote-wildcard-pattern): Also quote "`".  (Bug#19498)

2015-01-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	Tighten up the tagcode used for eieio and cl-struct objects.
	* loadup.el: Load cl-preloaded.
	* emacs-lisp/eieio-core.el (eieio-defclass-internal): Set the function
	slot of the tag symbol to :quick-object-witness-check.
	(eieio-object-p): Use :quick-object-witness-check.
	(eieio--generic-tagcode): Use cl--generic-struct-tag.
	* emacs-lisp/cl-preloaded.el: New file.
	* emacs-lisp/cl-macs.el (cl--bind-inits): Remove, unused.
	(cl--transform-lambda, cl-destructuring-bind): Remove cl--bind-inits.
	(cl--make-usage-args): Strip away &aux args.
	(cl-case, cl-typecase, cl--parse-loop-clause): Use macroexp-let2.
	(cl-the, cl-check-type): Use macroexp-let2 and cl-typep.
	(cl-defstruct): Use `declare' and cl-struct-define.
	* emacs-lisp/cl-generic.el (cl--generic-struct-tag): New function.
	(cl--generic-struct-tagcode): Use it to tighten the tagcode.

2015-01-27  Katsumi Yamaoka  <yamaoka@jpl.org>

	* emacs-lisp/cl.el (cl--function-convert):
	Merge cache that cl--labels-convert adds (bug#19699).

2015-01-27  Ivan Shmakov  <ivan@siamics.net>

	* tar-mode.el: Allow for adding new archive members.  (Bug#19274)
	(tar-new-regular-file-header, tar--pad-to, tar--put-at)
	(tar-header-serialize): New functions.
	(tar-current-position): Split from tar-current-descriptor.
	(tar-current-descriptor): Use it.
	(tar-new-entry): New command.
	(tar-mode-map): Bind it.

2015-01-27  Sam Steingold  <sds@gnu.org>

	* progmodes/python.el (python-check-custom-command): Buffer local
	because it usually includes the buffer name.
	(python-check-command): Set to epylint when pyflakes is not available.

2015-01-27  Artur Malabarba  <bruce.connor.am@gmail.com>

	* isearch.el (isearch-process-search-char): Add docstring.

2015-01-27  Oleh Krehel  <ohwoeowho@gmail.com>

	* emacs-lisp/derived.el (define-derived-mode): Declare indent 3.

2015-01-27  Katsumi Yamaoka  <yamaoka@jpl.org>

	* emacs-lisp/cl.el (cl--function-convert): Run cl--labels-convert
	for the case cl-flet or cl-labels form is wrapped with lexical-let
	(bug#19613).

2015-01-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-generic.el (cl--generic-method): New struct.
	(cl--generic): The method-table is now a (list-of cl--generic-method).
	(cl--generic-member-method): New function.
	(cl-generic-define-method): Use it.
	(cl--generic-build-combined-method, cl--generic-cache-miss):
	Adapt to new method-table.
	(cl--generic-no-next-method-function): Add `method' argument.
	(cl-generic-call-method): Adapt to new method representation.
	(cl--generic-cnm-sample, cl--generic-nnm-sample): Adjust.
	(cl-find-method, cl-method-qualifiers): New functions.
	(cl--generic-method-info): Adapt to new method representation.
	Return a string for the qualifiers.
	(cl--generic-describe):
	* emacs-lisp/eieio-opt.el (eieio-help-class): Adjust accordingly.
	(eieio-all-generic-functions, eieio-method-documentation):
	Adjust to new method representation.

	* emacs-lisp/eieio-compat.el (eieio--defmethod): Use cl-find-method.

2015-01-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-generic.el: Add a method-combination hook.
	(cl-generic-method-combination-function): New var.
	(cl--generic-lambda): Remove `with-cnm' arg.
	(cl-defmethod): Change accordingly.
	(cl-generic-define-method): Don't check qualifiers validity.
	Preserve all qualifiers in `method-table'.
	(cl-generic-call-method): New function.
	(cl--generic-nest): Remove (morph into cl-generic-call-method).
	(cl--generic-build-combined-method): Adjust to new format of method-table
	and use cl-generic-method-combination-function.
	(cl--generic-standard-method-combination): New function, extracted from
	cl--generic-build-combined-method.
	(cl--generic-cnm-sample): Adjust to new format of method-table.

	* emacs-lisp/eieio-compat.el (eieio--defmethod): Use () qualifiers
	instead of :primary.

	* emacs-lisp/eieio-datadebug.el (eieio-debug-methodinvoke):
	Remove obsolete function.

2015-01-26  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-make-table-1): Fix colspan typo.
	(shr-make-table-1): Add comments.
	(shr-make-table-1): Make colspan display more sensibly.

	* net/eww.el (eww-add-bookmark): Fix prompt and clean up the code
	slightly.

2015-01-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-generic.el (cl--generic-no-next-method-function): New fun.
	(cl--generic-build-combined-method, cl--generic-nnm-sample): Use it
	(bug#19672).
	(cl--generic-typeof-types): Add support for `sequence'.
	(cl-defmethod): Add non-keywords in the qualifiers.

2015-01-25  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/find-func.el (find-function-regexp): Don't match
	`defgroup' (regression from the previous change here).

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el (ldap-search-internal): Mention binddn in invalid
	credentials error message.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el (ldap-password-read): Validate password before
	caching it.
	(ldap-search-internal): Handle ldapsearch error conditions.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el (ldap-password-read): Handle password-cache being nil.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudc.el (eudc-expand-inline): Always restore former server
	and protocol.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudcb-ldap.el: Don't nag the user in case a default base is
	provided by the LDAP system configuration file.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudc.el (eudc-format-query): Preserve the
	eudc-inline-query-format ordering of attributes in the returned list.
	* net/eudcb-ldap.el (eudc-ldap-format-query-as-rfc1558):
	Append the LDAP wildcard character to the last attribute value.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudcb-ldap.el (eudc-ldap-cleanup-record-simple):
	Downcase field names of LDAP results.
	(eudc-ldap-cleanup-record-filtering-addresses): Likewise.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el (ldap-ldapsearch-password-prompt): New defcustom.
	(ldap-search-internal): Send password to ldapsearch through a pipe
	instead of via the command line.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el: Require password-cache.
	(ldap-password-read): New function.
	(ldap-search-internal): Call ldap-password-read when it is
	configured to be called.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudc-vars.el (eudc-expansion-overwrites-query):
	Change default to nil.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudc.el (eudc-expand-inline): Ignore text properties of
	string-to-expand.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudc-vars.el (eudc-inline-expansion-format): Default to a
	format that includes first name and surname.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudc-vars.el (eudc-inline-query-format): Change default to
	query email and first name instead of surname.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ldap.el (ldap-search-internal): Support new-style LDAP URIs.

2015-01-23  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/eudc-vars.el (eudc-server): Adjust docstring to mention
	eudc-server-hotlist.
	(eudc-server-hotlist): Move from eudc.el and make defcustom.
	* net/eudc.el (eudc-server-hotlist): Move to eudc-vars.el.
	(eudc-set-server): Allow setting protocol to nil.
	(eudc-expand-inline): Support hotlist-only expansions when server
	is not set.

2015-01-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-generic.el (cl-no-primary-method): New fun and error.
	(cl--generic-build-combined-method): Use it.

2015-01-22  Paul Eggert  <eggert@cs.ucla.edu>

	Don't downcase system diagnostics' first letters
	* emacs-lisp/bytecomp.el (byte-compile-file):
	* ffap.el (find-file-at-point):
	* files.el (insert-file-1):
	* net/ange-ftp.el (ange-ftp-barf-if-not-directory)
	(ange-ftp-copy-file-internal):
	* progmodes/etags.el (visit-tags-table):
	Keep diagnostics consistent with system's.
	* ffap.el (ffap-machine-p):
	Ignore case while comparing diagnostics.

2015-01-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help.el (help-make-usage): Don't turn a "_" arg into an empty-string
	arg (bug#19645).
	* emacs-lisp/cl-generic.el (cl--generic-lambda): Don't confuse a string
	body with a docstring.

2015-01-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref-location-marker, xref-location-group):
	Use `cl-defgeneric' and `cl-defmethod' instead of the EIEIO
	counterparts.

	* progmodes/etags.el (xref-location-marker): Same.

	* progmodes/xref.el (xref--current): Rename from `xref--selected'.
	(xref--inhibit-mark-current): Rename from
	`xref--inhibit-mark-selected'.  Update the usages.
	(xref-quit): Reword the docstring.  Kill buffers after quitting
	windows instead of before.
	(xref--insert-xrefs): Tweak help-echo.
	(xref--read-identifier-history, xref--read-pattern-history):
	New variables.
	(xref--read-identifier, xref-find-apropos): Use them.

2015-01-21  Ulrich Müller  <ulm@gentoo.org>

	* play/gamegrid.el (gamegrid-add-score-with-update-game-score):
	Allow the 'update-game-score' helper program to run suid or sgid.

2015-01-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el: Use cl-defmethod.
	(defclass): Generate cl-defmethod calls; use setf methods for :accessor.
	(eieio-object-name-string): Declare as obsolete.

	* emacs-lisp/eieio-opt.el: Adapt to cl-generic.
	(eieio--specializers-apply-to-class-p):	New function.
	(eieio-all-generic-functions): Use it.
	(eieio-method-documentation): Use it as well as cl--generic-method-info.
	Change format of return value.
	(eieio-help-class): Adapt accordingly.

	* emacs-lisp/eieio-compat.el (eieio--defmethod): Avoid no-next-method
	errors when there's a `before' but no `primary' (bug#19645).
	(next-method-p): Return nil rather than signal an error.
	(eieio-defgeneric): Remove bogus (fboundp 'method).

	* emacs-lisp/eieio-speedbar.el:
	* emacs-lisp/eieio-datadebug.el:
	* emacs-lisp/eieio-custom.el:
	* emacs-lisp/eieio-base.el: Use cl-defmethod.

	* emacs-lisp/cl-generic.el (cl-defgeneric): Add support for `declare'.
	(cl--generic-setf-rewrite): Setup the setf expander right away.
	(cl-defmethod): Make sure the setf expander is setup before we expand
	the body.
	(cl-defmethod): Silence byte-compiler warnings.
	(cl-generic-define-method): Shuffle code to change return value.
	(cl--generic-method-info): New function, extracted from
	cl--generic-describe.
	(cl--generic-describe): Use it.

2015-01-21  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref--xref-buffer-mode-map): Define before
	the major mode.  Remap `quit-window' to `xref-quit'.
	(xref--xref-buffer-mode): Inherit from special-mode.

	xref: Keep track of temporary buffers  (bug#19466).
	* progmodes/xref.el (xref--temporary-buffers, xref--selected)
	(xref--inhibit-mark-selected): New variables.
	(xref--mark-selected): New function.
	(xref--show-location): Maybe add the buffer to
	`xref--temporary-buffers', add `xref--mark-selected' to
	`buffer-list-update-hook' there.
	(xref--window): Add docstring.
	(xref-quit): Rename from `xref--quit'.  Update both references.
	Add KILL argument.  When it's non-nil, kill the temporary buffers
	that haven't been selected by the user.
	(xref--show-xref-buffer): Change the second argument to alist,
	extract the values for `xref--window' and
	`xref--temporary-buffers' from it.  Add `xref--mark-selected' to
	`buffer-list-update-hook' to each buffer in the list.
	(xref--show-xrefs): Move the logic of calling `xref-find-function'
	here.  Save the difference between buffer lists before and after
	it's called as "temporary buffers", and `pass it to
	`xref-show-xrefs-function'.
	(xref--find-definitions, xref-find-references)
	(xref-find-apropos): Update accordingly.

2015-01-20  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package-dir-info): Fix `while' logic.

2015-01-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-generic.el: Remove.
	(defgeneric, defmethod): Move to eieio-compat.el.  Mark obsolete.
	* emacs-lisp/eieio-compat.el: New file.
	* emacs-lisp/eieio.el: Don't require eieio-generic any more.
	* emacs-lisp/eieio-core.el (eieio--slot-originating-class-p):
	Remove unused function.
	(eieio-defclass): Move to eieio-compat.el.
	* emacs-lisp/macroexp.el (macroexp-macroexpand): New function.
	(macroexp--expand-all): Use it.
	* emacs-lisp/bytecomp.el (byte-compile-recurse-toplevel): Here too.

2015-01-20  Michal Nazarewicz  <mina86@mina86.com>

	* emacs-lisp/eldoc.el (eldoc-documentation-function): Describe how
	major modes should use `add-function' to alter value of the variable.
	* hexl.el (hexl-mode):
	* ielm.el (inferior-emacs-lisp-mode):
	* progmodes/cfengine.el (cfengine3-mode):
	* progmodes/elisp-mode.el (emacs-lisp-mode):
	* progmodes/octave.el (octave-mode):
	* progmodes/python.el (python-mode):
	* simple.el (read--expression): Set `eldoc-documentation-function'
	using `add-function' so the default value is always used.

	* descr-text.el (describe-char-eldoc): New function returning
	basic Unicode codepoint information (e.g. name) about character
	at point.  It is meant to be used as a default value of the
	`eldoc-documentation-function' variable.
	(describe-char-eldoc--format, describe-char-eldoc--truncate):
	New helper functions for `describe-char-eldoc' function.

2015-01-20  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/paragraphs.el (sentence-end-base): Include an
	ellipsis (…) and interrobang (‽) characters as end of a sentence,
	and a closing single quote (’) as an end of a quote.

2015-01-20  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/tildify.el (tildify-double-space-undos): A new
	variable specifying whether pressing space in `tildify-mode' after
	a space has been replaced with hard space undos the substitution.
	(tildify-space): Add code branch for handling `tildify-doule-space'.

	* textmodes/tildify.el (tildify-space): A new function
	which can be used as a `post-self-insert-hook' to automatically
	convert spaces into hard spaces.
	(tildify-space-pattern): A new variable specifying pattern where
	`tildify-space' should take effect.
	(tildify-space-predicates): A new variable specifying list of
	predicate functions that all must return non-nil for
	`tildify-space' to take effect.
	(tildify-space-region-predicate): A new functions meant to be
	used as a predicate in `tildify-space-predicates' list.
	(tildify-mode): A new minor mode enabling `tildify-space' as a
	`post-self-insert-hook'

2015-01-20  Daniel Colascione  <dancol@dancol.org>

	* vc/vc-dir.el (vc-dir): Default to repository root, not
	default-directory.

2015-01-20  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/etags.el (xref-etags-location): New class.
	(xref-make-etags-location): New function.
	(etags--xref-find-definitions): Use it.
	(xref-location-marker): New method implementation.

	* progmodes/xref.el: Mention that xref-location is an EIEIO class.
	(xref--insert-xrefs): Expand help-echo string.

2015-01-19  Dmitry Gutov  <dgutov@yandex.ru>

	* ido.el: Update Customization instructions.

2015-01-19  Jonas Bernoulli  <jonas@bernoul.li>

	Define Ido keymaps once (bug#17000).
	* ido.el (ido-common-completion-map)
	(ido-file-dir-completion-map)
	(ido-file-completion-map, ido-buffer-completion-map): Set up key
	bindings when each variable is defined.
	(ido-completion-map): Move definition.
	(ido-init-completion-maps): Noop.
	(ido-common-initialization): Don't call it.
	(ido-setup-completion-map): Improve doc-string, cleanup.

2015-01-19  Ivan Shmakov  <ivan@siamics.net>

	* cus-dep.el (custom-make-dependencies): Ensure that
	default-directory is interpreted as a directory (see bug#19140.)

2015-01-19  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref--display-position):
	Set `other-window-scroll-buffer'.
	(xref-goto-xref): Use `user-error'.

2015-01-19  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref--display-history): New variable.
	(xref--window-configuration): Remove.
	(xref--save-to-history): New function.
	(xref--display-position): Use it.  Add new argument.
	(xref--restore-window-configuration): Remove.
	(xref--show-location, xref-show-location-at-point):
	Update accordingly.
	(xref--xref-buffer-mode): Don't use `pre-command-hook'.
	(xref--quit): New command.
	(xref-goto-xref): Use it.
	(xref--xref-buffer-mode-map): Bind `q' to it.

2015-01-18  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref-goto-xref): Perform the jump even inside
	indentation or at eol.

2015-01-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-core.el: Add `subclass' specializer for cl-generic.
	(eieio--generic-subclass-tagcode, eieio--generic-subclass-tag-types):
	New functions.
	(cl-generic-tagcode-function, cl-generic-tag-types-function): Use them.

	* emacs-lisp/eieio.el (defclass): Add obsolescence warning for the
	`newname' argument.

	* emacs-lisp/cl-generic.el (cl-generic-define-method): Correctly handle
	introduction of a new dispatch argument.
	(cl--generic-cache-miss): Handle dispatch on an argument which was not
	considered as dispatchable for this method.
	(cl-defmethod): Warn when adding a method to an obsolete generic function.
	(cl--generic-lambda): Make sure it works if cl-lib is not yet loaded.

	* emacs-lisp/eieio-generic.el (eieio--defgeneric-init-form): Use autoloadp.

2015-01-18  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--append-to-alist): Rename from
	`package--add-to-alist'
	Updated docstring due to new name.

2015-01-18  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/cl-extra.el (cl-subseq): Use seq-subseq and fix
	multiple evaluation.  (Bug#19519)

	* emacs-lisp/seq.el (seq-subseq): Throw bad bounding indices
	error.  (Bug#19434)

2015-01-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-core.el: Add `subclass' specializer for cl-generic.
	(eieio--generic-subclass-tagcode, eieio--generic-subclass-tag-types):
	New functions.
	(cl-generic-tagcode-function, cl-generic-tag-types-function): Use them.

	* emacs-lisp/cl-macs.el (cl-defstruct): Minor optimization when include
	or print is nil.
	(cl-struct-type-p): New function.

	* emacs-lisp/cl-generic.el: Add support for cl-next-method-p.
	(cl-defmethod): Add edebug spec.
	(cl--generic-build-combined-method): Fix call to
	cl-no-applicable-method.
	(cl--generic-nnm-sample, cl--generic-cnm-sample): New constant.
	(cl--generic-isnot-nnm-p): New function.
	(cl--generic-lambda): Use it to add support for cl-next-method-p.
	(cl-no-next-method, cl-no-applicable-method): Simplify arg list.
	(cl-next-method-p): New function.

2015-01-17  Ulrich Müller  <ulm@gentoo.org>

	* version.el (emacs-repository-get-version): Update docstring.

2015-01-17  Ivan Shmakov  <ivan@siamics.net>

	* files.el (find-file-other-window, find-file-other-frame):
	Use mapc instead of mapcar.  (Bug#18175)

	* files.el (dir-locals-collect-variables): Use default-directory
	in place of the file name while working on non-file buffers, just
	like hack-dir-local-variables already does.  (Bug#19140)

	* textmodes/enriched.el (enriched-encode):
	Use inhibit-point-motion-hooks in addition to inhibit-read-only.
	(Bug#18246)

	* desktop.el (desktop-read): Do not call desktop-clear when no
	desktop file is found.  (Bug#18371)

	* misearch.el (multi-isearch-unload-function): New function.
	(misearch-unload-function): New alias.  (Bug#19566)

2015-01-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-core.el (eieio--class-constructor): Rename from
	class-constructor, and make it an alias for `identity'.
	Update all callers.

	* emacs-lisp/eieio.el (eieio-constructor): Handle obsolete object name
	argument here (bug#19620)...
	(defclass): ...instead of in the constructor here.

2015-01-16  Jorgen Schaefer  <contact@jorgenschaefer.de>

	* emacs-lisp/package.el (package-archive-priorities):
	Specify correct type.

2015-01-17  Ulrich Müller  <ulm@gentoo.org>

	* version.el (emacs-bzr-version-dirstate, emacs-bzr-version-bzr):
	Remove.
	(emacs-repository-get-version): Discard the Bazaar case.
	* vc/vc-bzr.el (vc-bzr-version-dirstate): Rename from
	emacs-bzr-version-dirstate and move from version.el to here.
	(vc-bzr-working-revision): Use it.

2015-01-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-generic.el (call-next-method): Don't bother checking
	eieio--scoped-class any more.

	* emacs-lisp/eieio-core.el (eieio--scoped-class-stack): Remove var.
	(eieio--scoped-class): Remove function.
	(eieio--with-scoped-class): Remove macro.  Replace uses with `progn'.
	(eieio--slot-name-index): Don't check the :protection anymore.
	(eieio-initializing-object): Remove var.
	(eieio-set-defaults): Don't let-bind eieio-initializing-object.

2015-01-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	Improve handling of doc-strings and describe-function for cl-generic.

	* help-mode.el (help-function-def): Add optional arg `type'.

	* help-fns.el (find-lisp-object-file-name): Accept any `type' as long
	as it's a symbol.
	(help-fns-short-filename): New function.
	(describe-function-1): Use it.  Use autoload-do-load.

	* emacs-lisp/find-func.el: Use lexical-binding.
	(find-function-regexp): Don't rule out `defgeneric'.
	(find-function-regexp-alist): Document new possibility of including
	a function instead of a regexp.
	(find-function-search-for-symbol): Implement that new possibility.
	(find-function-library): Don't assume that `function' is a symbol.
	(find-function-do-it): Remove unused var `orig-buf'.

	* emacs-lisp/eieio-generic.el (eieio--defalias): Move from eieio-core.
	(eieio--defgeneric-init-form): Don't throw away a previous docstring.
	(eieio--method-optimize-primary): Don't mess with the docstring.
	(defgeneric): Keep the `args' in the docstring.
	(defmethod): Don't use the method's docstring for the generic
	function's docstring.

	* emacs-lisp/eieio-core.el (eieio--defalias): Move to eieio-generic.el.
	(eieio-defclass-autoload): Don't record the superclasses any more.
	(eieio-defclass-internal): Reuse the old class object if it was just an
	autoload stub.
	(eieio--class-precedence-list): Load the class if it's autoloaded.

	* emacs-lisp/cl-generic.el (cl-generic-ensure-function): It's OK to
	override an autoload.
	(cl-generic-current-method-specializers): Replace dyn-bind variable
	with a lexically-scoped macro.
	(cl--generic-lambda): Update accordingly.
	(cl-generic-define-method): Record manually in the load-history with
	type `cl-defmethod'.
	(cl--generic-get-dispatcher): Minor optimization.
	(cl--generic-search-method): New function.
	(find-function-regexp-alist): Add entry for `cl-defmethod' type.
	(cl--generic-search-method): Add hyperlinks for methods.  Merge the
	specializers and the function's arguments.

2015-01-16  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--read-pkg-desc):
	New function. Read a `define-package' form in current buffer.
	Return the pkg-desc, with desc-kind set to KIND.
	(package-dir-info): New function. Find package information for a
	directory. The return result is a `package-desc'.
	(package-install-from-buffer): Install packages from dired buffer.
	(package-install-file): Install packages from directory.
	(package-desc-suffix)
	(package-install-from-archive)
	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Ensure all remaining instances of `package-desc-kind' handle the 'dir
	value.

2015-01-16  Jorgen Schaefer  <contact@jorgenschaefer.de>

	* emacs-lisp/package.el: Provide repository priorities.
	(package-archive-priorities): New variable.
	(package--add-to-alist): New function.
	(package--add-to-archive-contents): Use it.
	(package-menu--find-upgrades): Use it as well. Small clean up to
	make the use of the package name here explicit.
	(package-archive-priority): New function.
	(package-desc-priority-version): New function.

2015-01-16  Daniel Colascione  <dancol@dancol.org>

	* cus-start.el (all): Make `ring-bell-function' customizable.

2015-01-16  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-svn.el (vc-svn-dir-status-files): Pass t as
	vc-svn-after-dir-status's second argument.  (Bug#19429)

2015-01-16  Samer Masterson  <samer@samertm.com>

	* pcomplete.el (pcomplete-parse-arguments): Parse arguments
	regardless of pcomplete-cycle-completions's value.  (Bug#18950)

2015-01-16  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* dom.el (dom-strings): New function.

	* files.el (directory-files-recursively): Don't use the word
	"path" for a file name.

2015-01-15  Wolfgang Jenkner  <wjenkner@inode.at>

	* calc/calc-units.el (math-units-in-expr-p)
	(math-single-units-in-expr-p, math-find-compatible-unit-rec)
	(math-extract-units): Handle the `neg' operator.  (Bug#19582)

2015-01-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl--labels-magic): New constant.
	(cl--labels-convert): Use it to ask the macro what is its replacement
	in the #'f case.

	* emacs-lisp/cl-generic.el (cl--generic-build-combined-method):
	Return the value of the primary rather than the after method.

	* emacs-lisp/eieio-core.el: Provide support for cl-generic.
	(eieio--generic-tagcode): New function.
	(cl-generic-tagcode-function): Use it.
	(eieio--generic-tag-types): New function.
	(cl-generic-tag-types-function): Use it.
	(eieio-object-p): Tighten up the test.

	* emacs-lisp/cl-generic.el (cl-generic-define-method): Fix paren typo.

2015-01-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-generic.el: New file.

	* emacs-lisp/cl-macs.el (cl-flet): Allow (FUN EXP) forms.
	(cl-load-time-value, cl-labels): Use closures rather than
	backquoted lambdas.
	(cl-macrolet): Use `eval' to create the function value, and support CL
	style arguments in for the defined macros.

2015-01-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* net/eww.el: Use lexical-binding.
	(eww-links-at-point): Remove unused arg.
	(eww-mode-map): Inherit from special-mode-map.
	(eww-mode): Derive from special-mode.  Don't use `setq' on a hook.

2015-01-13  Alan Mackenzie  <acm@muc.de>

	Allow compilation during loading of CC Mode-derived modes (bug#19206).
	* progmodes/cc-bytecomp.el (cc-bytecomp-compiling-or-loading):
	New function which walks the stack to discover whether we're compiling
	or loading.
	(cc-bytecomp-is-compiling): Reformulate, and move towards beginning.
	(cc-bytecomp-is-loading): New defsubst.
	(cc-bytecomp-setup-environment, cc-bytecomp-restore-environment):
	Use the above defsubsts.
	(cc-require-when-compile, cc-bytecomp-defvar)
	(cc-bytecomp-defun): Simplify conditionals.
	* progmodes/cc-defs.el (cc-bytecomp-compiling-or-loading):
	"Borrow" this function from cc-bytecomp.el.
	(c-get-current-file): Reformulate using the above.
	(c-lang-defconst): Prevent duplicate entries of file names in a
	symbol's 'source property.
	(c-lang-const): Use cc-bytecomp-is-compiling.
	* progmodes/cc-langs.el (c-make-init-lang-vars-fun):
	Use cc-bytecomp-is-compiling.

2015-01-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-core.el (eieio-defclass): Fix call to `defclass'
	(bug#19552).

2015-01-13  Dmitry Gutov  <dgutov@yandex.ru>

	* menu-bar.el (menu-bar-goto-menu): Before calling
	`xref-marker-stack-empty-p', first check that `xref' is loaded.
	(Bug#19554)

2015-01-12  Martin Rudalics  <rudalics@gmx.at>

	* progmodes/xref.el (xref-marker-stack-empty-p): Add autoload
	cookie (Bug#19554).

	* frame.el (frame-notice-user-settings): Remove code dealing with
	frame-initial-frame-tool-bar-height.  Turn off `tool-bar-mode'
	only if `window-system-frame-alist' or `default-frame-alist' ask
	for it.
	(make-frame): Update frame-adjust-size-history if needed.

2015-01-12  Paul Eggert  <eggert@cs.ucla.edu>

	Have 'make' output better GEN names
	* Makefile.in (PHONY_EXTRAS): New macro.
	(.PHONY): Depend on it, and on $(lisp)/loaddefs.el, so that the
	relevant files' time stamps are ignored.
	(custom-deps, $(lisp)/cus-load.el, finder-data)
	($(lisp)/finder-inf.el): Use PHONY_EXTRAS.
	(custom-deps, $(lisp)/cus-load.el, finder-data)
	($(lisp)/finder-inf.el, autoloads, $(lisp)/loaddefs.el)
	($(lisp)/subdirs.el, update-subdirs):
	Output more-accurate destination names with GEN.

	Say "ELC foo.elc" instead of "GEN foo.elc"
	* Makefile.in (AM_V_ELC, am__v_ELC_, am__v_ELC_0, am__v_ELC_1):
	New macros.
	($(THEFILE)c, .el.elc): Use them.

2015-01-11  Michael Albinus  <michael.albinus@gmx.de>

	* files.el (directory-files-recursively): Do not include
	superfluous remote file names.

2015-01-11  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww): Interpret anything that looks like a protocol
	designator as a full URL.

2015-01-10  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-urlify): Don't bother the user about
	invalidly-encoded display strings.

2015-01-10  Ivan Shmakov  <ivan@siamics.net>

	* net/shr.el (shr-urlify): Decode URLs before using them as titles
	(bug#19555).

2015-01-10  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww): Always interpret URLs that start with https?:
	as plain URLs, even if they have spaces in them (bug#19556).
	(eww): Also interpret things like "en.wikipedia.org/wiki/Free
	software" as an URL.
	(eww): Don't interpret "org/foo" as an URL.
	(eww): Clear the title when loading so that we don't display
	misleading information.

2015-01-10  Daniel Colascione  <dancol@dancol.org>

	* vc/vc-hooks.el (vc-prefix-map): Bind vc-delete-file to C-x v x,
	by analogy with dired.

2015-01-09  Daniel Colascione  <dancol@dancol.org>

	* progmodes/js.el (js--function-heading-1-re)
	(js--function-prologue-beginning): Parse ES6 generator function
	declarations.  (That is, "function* name()").

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (defclass): Move from eieio-defclass all the code
	that creates functions, and most of the sanity checks.
	Mark as obsolete the <class>-child-p function.
	* emacs-lisp/eieio-core.el (eieio--define-field-accessors): Remove.
	(eieio--class, eieio--object): Use cl-defstruct.
	(eieio--object-num-slots): Define manually.
	(eieio-defclass-autoload): Use eieio--class-make.
	(eieio-defclass-internal): Rename from eieio-defclass.  Move all the
	`(lambda...) definitions and most of the sanity checks to `defclass'.
	Mark as obsolete the <class>-list-p function, the <class> variable and
	the <initarg> variables.  Use pcase-dolist.
	(eieio-defclass): New compatibility function.
	* emacs-lisp/eieio-opt.el (eieio-build-class-alist)
	(eieio-class-speedbar): Don't use eieio-default-superclass var.

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-generic.el: New file.
	* emacs-lisp/eieio-core.el: Move all generic function code to
	eieio-generic.el.
	(eieio--defmethod): Declare.

	* emacs-lisp/eieio.el: Require eieio-generic.  Move all generic
	function code to eieio-generic.el.
	* emacs-lisp/eieio-opt.el (eieio-help-generic): Move to
	eieio-generic.el.
	* emacs-lisp/eieio-datadebug.el (eieio-debug-methodinvoke): Update call
	to eieio--generic-call.
	* emacs-lisp/eieio-base.el (eieio-instance-inheritor): Don't use
	<class>-child type.

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/chart.el (chart-add-sequence, chart-bar-quickie):
	Don't use <class> as a variable.

	* emacs-lisp/eieio.el (same-class-p): Accept class object as well.
	(call-next-method): Simplify.
	(clone): Obey eieio-backward-compatibility.

	* emacs-lisp/eieio-opt.el (eieio-read-generic-p): Remove.
	(eieio-read-generic): Use `generic-p' instead.

	* emacs-lisp/eieio-core.el (eieio-backward-compatibility): New var.
	(eieio-defclass-autoload): Obey it.
	(eieio--class-object): Improve error behavior.
	(eieio-class-children-fast, same-class-fast-p): Remove.  Inline at
	every use site.
	(eieio--defgeneric-form-primary-only): Rename from
	eieio-defgeneric-form-primary-only; update all callers.
	(eieio--defgeneric-form-primary-only-one): Rename from
	eieio-defgeneric-form-primary-only-one; update all callers.
	(eieio-defgeneric-reset-generic-form)
	(eieio-defgeneric-reset-generic-form-primary-only)
	(eieio-defgeneric-reset-generic-form-primary-only-one): Remove.
	(eieio--method-optimize-primary): New function to replace them.
	(eieio--defmethod, eieio-defmethod): Use it.
	(eieio--perform-slot-validation): Rename from
	eieio-perform-slot-validation; update all callers.
	(eieio--validate-slot-value): Rename from eieio-validate-slot-value.
	Change `class' to be a class object.  Update all callers.
	(eieio--validate-class-slot-value): Rename from
	eieio-validate-class-slot-value.  Change `class' to be a class object.
	Update all callers.
	(eieio-oset-default): Accept class object as well.
	(eieio--generic-call-primary-only): Rename from
	eieio-generic-call-primary-only.  Update all callers.

	* emacs-lisp/eieio-base.el (eieio-persistent-validate/fix-slot-value):
	Improve error messages.
	(eieio-persistent-slot-type-is-class-p): Handle `list-of' types, as
	well as user-defined types.  Emit errors for legacy types like
	<class>-child and <class>-list, if not eieio-backward-compatibility.

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (eieio-class-parents): Accept class objects.
	(eieio--class-slot-initarg): Rename from class-slot-initarg.
	Change `class' arg to be a class object.  Update all callers.
	(call-next-method): Adjust to new return value of `eieio-generic-form'.
	(eieio-default-superclass): Set var to the class object.
	(eieio-edebug-prin1-to-string): Fix recursive call for lists.
	Change print behavior to affect class objects rather than
	class symbols.

	* emacs-lisp/eieio-core.el (eieio-class-object): New function.
	(eieio-class-parents-fast): Remove macro.
	(eieio--class-option-assoc): Rename from class-option-assoc.
	Update all callers.
	(eieio--class-option): Rename from class-option.  Change `class' arg to
	be a class object.  Update all callers.
	(eieio--class-method-invocation-order): Rename from
	class-method-invocation-order.  Change `class' arg to be a class
	object.  Update all callers.
	(eieio-defclass-autoload, eieio-defclass): Set the `parent' field to
	a list of class objects rather than names.
	(eieio-defclass): Remove redundant quotes.  Use `eieio-oref-default'
	for accessors to class allocated slots.
	(eieio--perform-slot-validation-for-default): Rename from
	eieio-perform-slot-validation-for-default.  Update all callers.
	(eieio--add-new-slot): Rename from eieio-add-new-slot.
	Update all callers.  Use push.
	(eieio-copy-parents-into-subclass): Adjust to new content of
	`parent' field.  Use dolist.
	(eieio-oref): Remove support for providing a class rather than
	an object.
	(eieio-oref-default): Prefer class objects over class names.
	(eieio--slot-originating-class-p): Rename from
	eieio-slot-originating-class-p.  Update all callers.  Use `or'.
	(eieio--slot-name-index): Turn check into assertion.
	(eieio--class-slot-name-index): Rename from
	eieio-class-slot-name-index.  Change `class' arg to be a class object.
	Update all callers.
	(eieio-attribute-to-initarg): Move to eieio-test-persist.el.
	(eieio--c3-candidate): Rename from eieio-c3-candidate.
	Update all callers.
	(eieio--c3-merge-lists): Rename from eieio-c3-merge-lists.
	Update all callers.
	(eieio--class-precedence-c3): Rename from eieio-class-precedence-c3.
	Update all callers.
	(eieio--class-precedence-dfs): Rename from eieio-class-precedence-dfs.
	Update all callers.
	(eieio--class-precedence-bfs): Rename from eieio-class-precedence-bfs.
	Update all callers.  Adjust to new `parent' content.
	(eieio--class-precedence-list): Rename from -class-precedence-list.
	Update all callers.
	(eieio-generic-call): Use autoloadp and autoload-do-load.
	Slight simplification.
	(eieio-generic-call, eieio-generic-call-primary-only): Adjust to new
	return value of `eieio-generic-form'.
	(eieiomt-add): Index the hashtable with class objects rather than
	class names.
	(eieio-generic-form): Accept class objects as well.

	* emacs-lisp/eieio-base.el (eieio-persistent-convert-list-to-object):
	Adjust to new convention for eieio-persistent-validate/fix-slot-value.
	(eieio-persistent-validate/fix-slot-value):
	Change `class' arg to be a class object.  Update all callers.

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (child-of-class-p): Make it accept class objects
	additionally to class names.

	* emacs-lisp/eieio-core.el (eieio--with-scoped-class): Use let-binding.
	(object): Remove first (constant) slot; rename second to `class-tag'.
	(eieio--object-class-object, eieio--object-class-name): New funs
	to replace eieio--object-class.
	(eieio--class-object, eieio--class-p): New functions.
	(same-class-fast-p): Make it a defsubst, change its implementation
	to check the class objects rather than their names.
	(eieio-object-p): Rewrite.
	(eieio-defclass): Adjust the object initialization according to the new
	object layout.
	(eieio--scoped-class): Declare it returns a class object (not a class
	name any more).  Adjust calls accordingly (along with calls to
	eieio--with-scoped-class).
	(eieio--slot-name-index): Rename from eieio-slot-name-index and change
	its class arg to be a class object.  Adjust callers accordingly.
	(eieio-slot-originating-class-p): Make its start-class arg a class
	object.  Adjust all callers.
	(eieio--initarg-to-attribute): Rename from eieio-initarg-to-attribute.
	Make its `class' arg a class object.  Adjust all callers.

	* emacs-lisp/eieio-base.el (eieio-persistent-validate/fix-slot-value):
	Use eieio--slot-name-index rather than eieio-slot-name-index.

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (make-instance): Simplify by not adding an object
	name argument.
	(eieio-object-name): Use eieio-object-name-string.
	(eieio--object-names): New const.
	(eieio-object-name-string, eieio-object-set-name-string): Re-implement
	using a hashtable rather than a built-in slot.
	(eieio-constructor): Rename from `constructor'.  Remove `newname' arg.
	(clone): Don't mess with the object's "name".

	* emacs-lisp/eieio-custom.el (eieio-widget-test): Remove dummy arg.
	(eieio-object-value-get): Use eieio-object-set-name-string.

	* emacs-lisp/eieio-core.el (eieio--defalias): Follow aliases.
	(eieio--object): Remove `name' field.
	(eieio-defclass): Adjust to new convention where constructors don't
	take an "object name" any more.
	(eieio--defgeneric-init-form, eieio--defmethod): Follow aliases.
	(eieio-validate-slot-value, eieio-oset-default)
	(eieio-slot-name-index): Don't hardcode eieio--object-num-slots.
	(eieio-generic-call-primary-only): Simplify.

	* emacs-lisp/eieio-base.el (clone) <eieio-instance-inheritor>:
	Use call-next-method.
	(eieio-constructor): Rename from `constructor'.
	(eieio-persistent-convert-list-to-object): Drop objname.
	(eieio-persistent-validate/fix-slot-value): Don't hardcode
	eieio--object-num-slots.
	(eieio-named): Use a normal slot.
	(slot-missing) <eieio-named>: Remove.
	(eieio-object-name-string, eieio-object-set-name-string, clone)
	<eieio-named>: New methods.

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-core.el (eieio--class-v): Rename from class-v.
	(method-*): Add a "eieio--" prefix to those constants.

	* emacs-lisp/eieio.el: Move edebug specs to the corresponding macro.

	* emacs-lisp/eieio-speedbar.el: Use lexical-binding.

2015-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el (child-of-class-p): Fix case where `class' is
	`eieio-default-superclass'.

	* emacs-lisp/eieio-datadebug.el: Use lexical-binding.

	* emacs-lisp/eieio-custom.el: Use lexical-binding.
	(eieio-object-value-to-abstract): Simplify.

	* emacs-lisp/eieio-opt.el (eieio-build-class-list): Use cl-mapcan.
	(eieio-build-class-alist): Use dolist.
	(eieio-all-generic-functions): Adjust to use of hashtables.

	* emacs-lisp/eieio-core.el (class): Rename field symbol-obarray to
	symbol-hashtable.  It contains a hashtable instead of an obarray.
	(generic-p): Use symbol property `eieio-method-hashtable' instead of
	`eieio-method-obarray'.
	(generic-primary-only-p, generic-primary-only-one-p):
	Slight optimization.
	(eieio-defclass-autoload-map): Use a hashtable instead of an obarray.
	(eieio-defclass-autoload, eieio-defclass): Adjust/simplify accordingly.
	(eieio-class-un-autoload): Use autoload-do-load.
	(eieio-defclass): Use dolist, cl-pushnew, cl-callf.
	Use new cl-deftype-satisfies.  Adjust to use of hashtables.
	Don't hardcode the value of eieio--object-num-slots.
	(eieio-defgeneric-form-primary-only-one): Remove `doc-string' arg.
	Use a closure rather than a backquoted lambda.
	(eieio--defmethod): Adjust call accordingly.  Set doc-string via the
	function-documentation property.
	(eieio-slot-originating-class-p, eieio-slot-name-index)
	(eieiomt--optimizing-hashtable, eieiomt-install, eieiomt-add)
	(eieio-generic-form): Adjust to use of hashtables.
	(eieiomt--sym-optimize): Rename from eieiomt-sym-optimize; take
	additional class argument.
	(eieio-generic-call-methodname): Remove, unused.

	* emacs-lisp/eieio-base.el (eieio-persistent-slot-type-is-class-p):
	Prefer \' to $.

2015-01-08  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-visual): When converting X pixel coordinate
	to temporary-goal-column, adjust the value for right-to-left
	screen lines.  This fixes vertical-motion, next/prev-line, etc.

2015-01-08  Glenn Morris  <rgm@gnu.org>

	* files.el (file-tree-walk): Remove; of unknown authorship.  (Bug#19325)

2015-01-07  K. Handa  <handa@gnu.org>

	* international/ccl.el (define-ccl-program): Improve the docstring.

2015-01-06  Sam Steingold  <sds@gnu.org>

	* shell.el (shell-display-buffer-actions): Remove,
	use `display-buffer-alist' instead.

2015-01-05  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref--insert-xrefs): Add `help-echo' property
	to the references.

2015-01-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (completion-category-defaults): New var.
	Set unicode-name to use substring completion.
	(completion-category-defaults): Set it to nil.

2015-01-04  Dmitry Gutov  <dgutov@yandex.ru>

	Add mouse interaction to xref.
	* progmodes/xref.el (xref--button-map): New variable.
	(xref--mouse-2): New command.
	(xref--insert-xrefs): Add `mouse-face' and `keymap' properties to
	the inserted references.

2015-01-04  Paul Eggert  <eggert@cs.ucla.edu>

	Less 'make' chatter for lisp dir
	* Makefile.in (THEFILE): Define to be 'no-such-file' by default,
	to make it clearer that the caller must specify it.
	(compile-onefile): Remove, replacing by ...
	($(THEFILE)c): ... new rule.  This lets us use AM_V_GEN here.
	($(THEFILE)c, .el.elc, $(MH_E_DIR)/mh-loaddefs.el)
	($(TRAMP_DIR)/tramp-loaddefs.el, $(CAL_DIR)/cal-loaddefs.el)
	($(CAL_DIR)/diary-loaddefs.el, $(CAL_DIR)/hol-loaddefs.el):
	Use AM_V_GEN to lessen 'make' chatter.
	(.el.elc): Omit duplicate comment.

	Less 'make' chatter in batch mode
	* emacs-lisp/autoload.el (autoload-generate-file-autoloads):
	* emacs-lisp/bytecomp.el (byte-compile-file):
	* files.el (save-buffer, basic-save-buffer):
	* international/quail.el (quail-update-leim-list-file):
	Don't output messages like "Generating ..." in batch mode.

2015-01-04  Dmitry Gutov  <dgutov@yandex.ru>

	Unbreak `mouse-action' property in text buttons.
	* button.el (push-button): Fix regression from 2012-12-06.

2015-01-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref-marker-stack-empty-p): New function.

	* menu-bar.el (menu-bar-goto-menu): Use it.

2015-01-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref--window-configuration): New variable.
	(xref-show-location-at-point): New command.
	(xref--restore-window-configuration): New function.
	(xref-next-line, xref-prev-line): Delegate to
	`xref-show-location-at-point'.
	(xref--location-at-point): Don't signal the error.
	(xref-goto-xref): Do that here instead.
	(xref--xref-buffer-mode): Add `xref--restore-window-configuration'
	to `pre-command-hook'.
	(xref--xref-buffer-mode-map): Don't remap `next-line' and
	`previous-line'.  Additionally bind `xref-next-line' and
	`xref-prev-line' to `n' and `p' respectively.
	Bind `xref-show-location-at-point' to `C-o'.

2015-01-01  Eli Zaretskii  <eliz@gnu.org>

	* tool-bar.el (tool-bar-local-item)
	(tool-bar-local-item-from-menu): Call force-mode-line-update to
	make sure the tool-bar changes show on display.

2015-01-01  Michael Albinus  <michael.albinus@gmx.de>

	Sync with Tramp 2.2.11.

	* net/tramp-compat.el (top): Require cl-macs for Emacs 22.
	Make an alias for `default-toplevel-value' if it doesn't exist.

	* net/tramp-smb.el (tramp-smb-handle-copy-directory):
	Use `tramp-compat-delete-directory'.

	* net/trampver.el: Update release number.

2015-01-01  Filipp Gunbin  <fgunbin@fastmail.fm>

	* autorevert.el (auto-revert-handler): Fix auto-revert-tail-mode
	for remote files.  (Bug#19449)

2015-01-01  Simen Heggestøyl  <simenheg@gmail.com>  (tiny change)

	* textmodes/css-mode.el (scss-mode): Fix typo (bug#19446).

2014-12-31  Paul Eggert  <eggert@cs.ucla.edu>

	Less 'make' chatter in lisp directory
	* Makefile.in (AM_DEFAULT_VERBOSITY, AM_V_GEN, am__v_GEN_)
	(am__v_GEN_0, am__v_GEN_1): New macros, from ../src/Makefile.in.
	(custom-deps, finder-data, autoloads, update-subdirs): Use them.

2014-12-31  Filipp Gunbin  <fgunbin@fastmail.fm>

	* info.el (info-display-manual): Limit the completion alternatives
	to currently visited manuals if prefix argument is non-nil.

2014-12-30  Paul Eggert  <eggert@cs.ucla.edu>

	* Makefile.in (semantic): Simplify.

2014-12-30  Juri Linkov  <juri@linkov.net>

	* net/eww.el (eww-isearch-next-buffer): New function.
	(eww-mode): Set multi-isearch-next-buffer-function to it.

2014-12-30  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/xref.el (xref-find-definitions): Mention "no
	identifier at point" case in the docstring.

	* menu-bar.el (menu-bar-goto-uses-etags-p): New function.
	(menu-bar-goto-menu): Use it to show or hide the `set-tags-name'
	and `separator-tag-file' items.

2014-12-29  Paul Eggert  <eggert@cs.ucla.edu>

	* obsolete/pc-select.el (pc-selection-mode): Use system-type.
	This is instead of system-name, which is both wrong here and obsolete.
	* desktop.el (desktop-save-frameset):
	* dnd.el (dnd-get-local-file-uri):
	* nxml/rng-uri.el (rng-uri-file-name-1):
	Prefer (system-name) to system-name, and avoid naming
	locals 'system-name'.
	* startup.el (system-name): Now an obsolete variable.  (Bug#19438)

2014-12-29  Dmitry Gutov  <dgutov@yandex.ru>

	* menu-bar.el (menu-bar-next-tag-other-window)
	(menu-bar-next-tag): Remove.

2014-12-29  K. Handa  <handa@gnu.org>

	* international/mule.el (make-translation-table-from-alist):
	Accept nil or zero-length vector for FROM and TO.

2014-12-29  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-mode): Truncate overlong lines for prettier
	display when resizing.

	* net/shr.el (shr-width): Default to using the window width when
	rendering.

2014-12-29  Dmitry Gutov  <dgutov@yandex.ru>

	Unbreak jumping to an alias's definition.
	* emacs-lisp/find-func.el (find-function-library): Return a pair
	(ORIG-FUNCTION . LIBRARY) instead of just its second element.
	(find-function-noselect): Use it.
	* progmodes/elisp-mode.el (elisp--xref-identifier-file): Rename to
	`elisp--xref-identifier-location', incorporate logic from
	`elisp--xref-find-definitions', use the changed
	`find-function-library' return value.

2014-12-29  Juri Linkov  <juri@linkov.net>

	* comint.el (comint-history-isearch-message): Use field-beginning
	instead of comint-line-beginning-position - that's more fixes for
	https://lists.gnu.org/archive/html/emacs-devel/2014-12/msg00305.html
	(comint-history-isearch-message): Fix args of isearch-message-prefix.

2014-12-29  Juri Linkov  <juri@linkov.net>

	* vc/vc-dir.el (vc-dir-display-file): New command (bug#19450).
	(vc-dir-mode-map): Bind it to "\C-o".
	(vc-dir-menu-map): Add it to menu.

2014-12-29  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/etags.el (find-tag-other-window)
	(find-tag-other-frame, find-tag-regexp, tags-loop-continue)
	(tags-apropos): Declare obsolete.

	* menu-bar.el (menu-bar-goto-menu): Replace all but one etags item
	with xref ones.

2014-12-28  Eli Zaretskii  <eliz@gnu.org>

	* international/mule.el (define-coding-system): Fix typos in the
	doc string.

2014-12-28  Kenichi Handa  <handa@gnu.org>

	* international/mule.el (define-coding-system): Improve the doc
	string.

2014-12-28  Ivan Shmakov  <ivan@siamics.net>

	* net/shr.el (shr-tag-table): Fix handling of tbody/header/footer
	elements in tables (bug#19444).

	* net/eww.el (eww-handle-link): Fix typo in "up" rel handling
	(bug#19445).

2014-12-28  Juri Linkov  <juri@linkov.net>

	* vc/compare-w.el: Require diff-mode for diff faces.
	(compare-windows-removed, compare-windows-added): New faces
	inheriting from diff faces.
	(compare-windows): Define obsolete face alias.
	(compare-windows-highlight): Replace face `compare-windows' with
	new faces `compare-windows-added' and `compare-windows-removed'
	(bug#19451).
	(compare-windows-get-recent-window): Signal an error when
	no other window is found (bug#19170).

2014-12-27  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/elisp-mode.el (elisp--xref-identifier-file):
	Skip features that have no sources.

	* simple.el (execute-extended-command):
	When `suggest-key-bindings' is nil, don't.

2014-12-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Native readline completion.
	* progmodes/python.el (python-shell-completion-native-disabled-interpreters)
	(python-shell-completion-native-enable)
	(python-shell-completion-native-output-timeout): New defcustoms.
	(python-shell-completion-native-interpreter-disabled-p)
	(python-shell-completion-native-try)
	(python-shell-completion-native-setup)
	(python-shell-completion-native-turn-off)
	(python-shell-completion-native-turn-on)
	(python-shell-completion-native-turn-on-maybe)
	(python-shell-completion-native-turn-on-maybe-with-msg)
	(python-shell-completion-native-toggle): New functions.
	(python-shell-completion-native-get-completions): New function.
	(python-shell-completion-at-point): Use it.

2014-12-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Enhance shell user interaction and deprecate
	python-shell-get-or-create-process.
	* progmodes/python.el (python-shell-get-process-or-error):
	New function.
	(python-shell-with-shell-buffer): Use it.
	(python-shell-send-string, python-shell-send-region)
	(python-shell-send-buffer, python-shell-send-defun)
	(python-shell-send-file, python-shell-switch-to-shell): Use it.
	Add argument MSG to display user-friendly message when no process
	is running.
	(python-shell-switch-to-shell): Call pop-to-buffer with NORECORD.
	(python-shell-make-comint): Rename argument SHOW from POP.
	Use display-buffer instead of pop-to-buffer.
	(run-python): Doc fix.  Return process.
	(python-shell-get-or-create-process): Make obsolete.

2014-12-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-buffer-substring):
	Handle cornercase when region sent starts at point-min.

2014-12-27  Eli Zaretskii  <eliz@gnu.org>

	* language/misc-lang.el (composition-function-table): Add Syriac
	characters and also ZWJ/ZWNJ.
	See https://lists.gnu.org/archive/html/help-gnu-emacs/2014-12/msg00248.html
	for the details.

2014-12-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Fix message when sending region.
	* progmodes/python.el (python-shell-send-region): Rename argument
	send-main from nomain.  Fix message.
	(python-shell-send-buffer): Rename argument send-main from arg.

	python.el: Cleanup temp files even with eval errors.
	* progmodes/python.el (python-shell-send-file): Make file-name
	mandatory.  Fix temp file removal in the majority of cases.

	python.el: Handle file encoding for shell.
	* progmodes/python.el (python-rx-constituents): Add coding-cookie.
	(python-shell--save-temp-file): Write file with proper encoding.
	(python-shell-buffer-substring): Add coding cookie for detected
	encoding to generated content.  Fix blank lines when removing
	if-name-main block.
	(python-shell-send-file): Handle file encoding.
	(python-info-encoding-from-cookie)
	(python-info-encoding): New functions.

2014-12-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-out-of-band):
	Use `tramp-rsh-end-of-line', it ought to be more robust.

2014-12-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/js.el (js-syntax-propertize): "return" can't be divided
	(bug#19397).

2014-12-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-read-passwd): Ignore errors from `auth-source-*'.

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-out-of-band): Use "\n"
	as end-of-line delimiter for passwords, when running on MS Windows.

2014-12-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-set-shell): Don't change the global value
	of indent-line-function (bug#19433).

2014-12-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Fix line numbers on Python shell.
	* progmodes/python.el (python-shell--save-temp-file): Do not
	append coding cookie.
	(python-shell-send-string): Generalize for
	python-shell-send-region.
	(python--use-fake-loc): Delete var.
	(python-shell-buffer-substring): Cleanup fake-loc logic.
	(python-shell-send-region): Remove fake-loc logic, simplify.

2014-12-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-post-self-insert-function):
	Make colon to re-indent only for dedenters, handling
	multiline-statements gracefully.

2014-12-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-handle-insert-file-contents):
	Set `find-file-not-found-functions' in case of errors.  (Bug#18623)

2014-12-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-send-command-and-read): New optional
	arg MARKER.
	(tramp-get-remote-path): Use it.

2014-12-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (redisplay-dont-pause): Mark as obsolete.

2014-12-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-error-with-buffer): Call `message' properly.
	(tramp-accept-process-output): Use nil as argument for
	`accept-process-output', when there is a gateway prepended.

	* net/tramp-gw.el (tramp-gw-open-connection): Suppress traces in
	wrong debug buffer.
	(tramp-gw-open-connection): Set process coding system 'binary.
	(tramp-gw-open-network-stream): Handle HTTP error 403.

	* net/tramp-sh.el (tramp-compute-multi-hops): Suppress traces in
	wrong debug buffer.
	(tramp-maybe-open-connection): Set connection property "gateway".

2014-12-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (sit-for): Tweak docstring (bug#19381).

2014-12-27  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-git.el (vc-git-after-dir-status-stage): Move `up-to-date'
	stage to after `diff-index' (bug#19386).

2014-12-27  João Távora  <joaotavora@gmail.com>

	* textmodes/tex-mode.el (tex-insert-quote): Consider and respect
	`electric-pair-mode' (bug#19356).

2014-12-27  Dmitry Gutov  <dgutov@yandex.ru>

	elisp-xref-find: Don't create buffers eagerly.

	* progmodes/elisp-mode.el (elisp--identifier-location): Fold back
	into `elisp--company-location'.
	(elisp--identifier-completion-table): Rename to
	`elisp--identifier-completion-table', and do not include just any
	symbols with a property list.
	(elisp-completion-at-point): Revert the 2014-12-25 change.
	(elisp--xref-identifier-file): New function.
	(elisp--xref-find-definitions): Use it.

	* emacs-lisp/find-func.el (find-function-library): New function,
	extracted from `find-function-noselect'.

	* progmodes/xref.el (xref-elisp-location): New class.
	(xref-make-elisp-location): New function.
	(xref-location-marker): New implementation.

2014-12-27  Juri Linkov  <juri@linkov.net>

	* minibuffer.el (minibuffer-completion-help):
	Use shrink-window-if-larger-than-buffer in window-height
	when temp-buffer-resize-mode is nil.

	* window.el (with-displayed-buffer-window): Remove window-height
	from the action alist in the temp-buffer-window-show call
	when window-height is handled explicitly afterwards (bug#19355).

2014-12-27  Juri Linkov  <juri@linkov.net>

	Support subdirectories when saving places in dired.
	* saveplace.el (toggle-save-place, save-place-to-alist)
	(save-places-to-alist, save-place-dired-hook):
	Use dired-current-directory instead of dired-directory (bug#19436).
	(save-place-dired-hook): Add check for alist to make the new
	format future-proof to allow other possible formats.

2014-12-26  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	python.el: Generate clearer shell buffer names.
	* progmodes/python.el (python-shell-get-process-name)
	(python-shell-internal-get-process-name): Use `buffer-name`.
	(python-shell-internal-get-or-create-process): Simplify.

2014-12-26  Dmitry Gutov  <dgutov@yandex.ru>

	Add basic xref apropos implementation to elisp-mode.

	* progmodes/elisp-mode.el (elisp--xref-find-definitions):
	Filter out nil results.
	(elisp--xref-find-apropos): New function.
	(elisp-xref-find): Use it.

	* progmodes/xref.el (xref--show-xrefs): Use `user-error'.

2014-12-25  Filipp Gunbin  <fgunbin@fastmail.fm>

	* dired-aux.el (dired-maybe-insert-subdir):
	Make dired-maybe-insert-subdir always skip trivial files.

2014-12-25  Helmut Eller  <eller.helmut@gmail.com>
            Dmitry Gutov  <dgutov@yandex.ru>

	Consolidate cross-referencing commands.

	Move autoloaded bindings for `M-.', `M-,', `C-x 4 .' and
	`C-x 5 .' from etags.el to xref.el.

	* progmodes/xref.el: New file.

	* progmodes/elisp-mode.el (elisp--identifier-types): New variable.
	(elisp--identifier-location): New function, extracted from
	`elisp--company-location'.
	(elisp--company-location): Use it.
	(elisp--identifier-completion-table): New variable.
	(elisp-completion-at-point): Use it.
	(emacs-lisp-mode): Set the local values of `xref-find-function'
	and `xref-identifier-completion-table-function'.
	(elisp-xref-find, elisp--xref-find-definitions)
	(elisp--xref-identifier-completion-table): New functions.

	* progmodes/etags.el (find-tag-marker-ring): Mark obsolete in
	favor of `xref--marker-ring'.
	(tags-lazy-completion-table): Autoload.
	(tags-reset-tags-tables): Use `xref-clear-marker-stack'.
	(find-tag-noselect): Use `xref-push-marker-stack'.
	(pop-tag-mark): Make an alias for `xref-pop-marker-stack'.
	(etags--xref-limit): New constant.
	(etags-xref-find, etags--xref-find-definitions): New functions.

2014-12-25  Martin Rudalics  <rudalics@gmx.at>

	* cus-start.el (resize-mini-windows): Make it customizable.

2014-12-24  Stephen Leake  <stephen_leake@stephe-leake.org>

	* startup.el (fancy-about-text): Change buttons for etc/CONTRIBUTE
	to (info "(emacs)Contributing").  (Bug#19299)

2014-12-24  Martin Rudalics  <rudalics@gmx.at>

	* window.el (mouse-autoselect-window-position-1): New variable.
	(mouse-autoselect-window-cancel)
	(mouse-autoselect-window-select, handle-select-window):
	With delayed autoselection select window only if mouse moves after
	selecting its frame.

2014-12-24  Michael Albinus  <michael.albinus@gmx.de>

	* eshell/esh-ext.el (eshell-find-interpreter): Expand relative
	remote file names.  (Bug#18782)

2014-12-23  Sam Steingold  <sds@gnu.org>

	* shell.el (shell-display-buffer-actions): New user option.
	(shell): Pass it to `pop-to-buffer' instead of hard-coding
	`pop-to-buffer-same-window'.

2014-12-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/js.el (js--syntax-propertize-regexp-syntax-table): New var.
	(js-syntax-propertize-regexp): Use it to recognize "slash in
	a character class" (bug#19397).

2014-12-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* completion.el: Use post-self-insert-hook (bug#19400).
	(completion-separator-self-insert-command)
	(completion-separator-self-insert-autofilling): Remove.
	(completion-separator-chars): New var.
	(completion-c-mode-hook, completion-setup-fortran-mode): Use it instead
	of changing the keymap.
	(completion--post-self-insert): New function.
	(dynamic-completion-mode): Use it instead of rebinding keys.
	(cmpl--completion-string): Rename from completion-string.
	(add-completion-to-head, delete-completion): Let-bind it explicitly.

2014-12-22  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby--string-region): Simplify code
	by leveraging `syntax-ppss'.

2014-12-22  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/let-alist.el (let-alist): Use `make-symbol'
	instead of `gensym'.

2014-12-20  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-histfile-override): Add :version.

2014-12-20  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/tramp-sh.el (tramp-histfile-override): Clarify docstring.

2014-12-19  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/let-alist.el (let-alist): Enable access to deeper alists by
	using dots inside the dotted symbols.

2014-12-19  Alan Mackenzie  <acm@muc.de>

	Make C++11 uniform init syntax work.
	New keywords "final" and "override".
	* progmodes/cc-engine.el (c-back-over-member-initializer-braces):
	New function.
	(c-guess-basic-syntax): Set `containing-sex' and `lim' using the
	new function.
	* progmodes/cc-fonts.el (c-font-lock-declarations): Check more
	carefully for "are we at a declarator?" using
	c-back-over-member-initializers.
	* progmodes/cc-langs.el (c-type-modifier-kwds): Include "final"
	and "override" in the C++ value.

2014-12-19  Martin Rudalics  <rudalics@gmx.at>

	* textmodes/ispell.el (ispell-command-loop): Don't use `next-window'.

2014-12-21  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/nsm.el (nsm-save-host): Don't save the host name twice
	(bug#19269).

2014-12-18  Sam Steingold  <sds@gnu.org>

	Keyboard interface (C-f10) to `mouse-buffer-menu' (C-down-mouse-1).
	* mouse.el (mouse-buffer-menu-map): Extract from `mouse-buffer-menu'.
	(mouse-buffer-menu): Use `mouse-buffer-menu-map'.
	* menu-bar.el (menu-bar-buffer-vector): Extract from
	`menu-bar-update-buffers'.
	(menu-bar-update-buffers): Use `menu-bar-buffer-vector'.
	(buffer-menu-open): New user command, bound globally to C-f10,
	provides a keyboard interface to `mouse-buffer-menu' (C-down-mouse-1).
	(mouse-buffer-menu-keymap): Use `menu-bar-buffer-vector' to
	convert the value returned by `mouse-buffer-menu-map' to a list
	acceptable to `popup-menu' for `buffer-menu-open'.

2014-12-18  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/let-alist.el (let-alist): Evaluate the `alist' argument only once.

2014-12-18  Sam Steingold  <sds@gnu.org>

	* emacs-lisp/package.el: Avoid compilation warning by declaring
	the `find-library-name' function.
	(package-activate-1): Fix the `with-demoted-errors' calls:
	the first argument must be a string literal.

2014-12-18  Martin Rudalics  <rudalics@gmx.at>

	Add code for "preserving" window sizes.
	* dired.el (dired-pop-to-buffer): Call fit-window-to-buffer with
	`preserve-size' t.
	(dired-mark-pop-up): Preserve size of window showing marked files.
	* electric.el (Electric-pop-up-window):
	* help.el (resize-temp-buffer-window): Call fit-window-to-buffer
	with `preserve-size' t.
	* minibuffer.el (minibuffer-completion-help):
	Use `resize-temp-buffer-window' instead of `fit-window-to-buffer'
	(Bug#19355).  Preserve size of completions window.
	* register.el (register-preview): Preserve size of register
	preview window.
	* tmm.el (tmm-add-prompt): Call fit-window-to-buffer
	with `preserve-size' t (Bug#1291).
	* window.el (with-displayed-buffer-window): Add calls to
	`window-preserve-size'.
	(window-min-pixel-size, window--preservable-size)
	(window-preserve-size, window-preserved-size)
	(window--preserve-size, window--min-size-ignore-p): New functions.
	(window-min-size, window-min-delta, window--resizable)
	(window--resize-this-window, split-window-below)
	(split-window-right): Amend doc-string.
	(window--min-size-1, window-sizable, window--size-fixed-1)
	(window-size-fixed-p, window--min-delta-1)
	(frame-windows-min-size, window--max-delta-1, window-resize)
	(window--resize-child-windows, window--resize-siblings)
	(enlarge-window, shrink-window, split-window): Handle preserving
	window sizes.
	(adjust-window-trailing-edge): Handle preserving window
	sizes.  Signal user-error instead of an error when there's no
	window above or below.
	(window--state-put-2): Handle horizontal scroll bars.
	(window--display-buffer): Call `preserve-size' if asked for.
	(display-buffer): Mention `preserve-size' alist member in doc-string.
	(fit-window-to-buffer): New argument PRESERVE-SIZE.
	* textmodes/ispell.el (ispell-command-loop): Suppress horizontal
	scroll bar on ispell's windows.  Don't count window lines and
	don't deal with dedicated windows.
	(ispell-show-choices, ispell-help): Let `ispell-display-buffer'
	do the window handling.
	(ispell-adjusted-window-height, ispell-overlay-window): Remove.
	(ispell-display-buffer): New function to reuse, create and fit
	window to ispell's buffers.  (Bug#3413)

2014-12-18  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-activate): Do not re-activate or
	reload the dependencies (bug#19390).

2014-12-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/cc-cmds.el (c-subword-mode): Alias to subword-mode.
	(c-update-modeline):
	* progmodes/cc-langs.el (c-mode-menu): Use c-subword-mode.
	* progmodes/cc-mode.el (subword-mode): Move autoload to cc-cmds.el.
	(c-mode-base-map): Use c-subword-mode.

2014-12-18  Eli Zaretskii  <eliz@gnu.org>

	* international/mule-diag.el (describe-font-internal):
	Display additional info returned by font-info.

	* linum.el (linum--face-width): Rename from linum--face-height,
	and use the new functionality of font-info.
	(linum-update-window): Use linum--face-width and frame-char-width,
	instead of approximating with height.

2014-12-18  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-svn.el (vc-svn-dir-status-files): Revert the 2014-12-02
	change (bug#19387).  Use `apply' on `vc-dir-command'  (bug#19405).

	* emacs-lisp/package.el (package-activate-1): Add RELOAD argument
	and a docstring.
	(package-activate): Call itself on dependencies on PACKAGE with
	the same FORCE argument.  Pass FORCE as RELOAD into
	`package-activate-1'  (bug#19390).

2014-12-17  Sam Steingold  <sds@gnu.org>

	* emacs-lisp/package.el (package--list-loaded-files):
	Handle `(nil ...)' elements in `load-history'.

2014-12-17  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/tramp-sh.el (tramp-histfile-override): New variable.
	(tramp-open-shell, tramp-maybe-open-connection): Use it.

2014-12-17  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc.el: Improve `dir-status-files' description.

	* emacs-lisp/package.el (package--list-loaded-files): Don't call
	file-truename on load-history elements (bug#19390).

2014-12-16  Nicolas Petton  <petton.nicolas@gmail.com>

	* emacs-lisp/seq.el: New file.

2014-12-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* jit-lock.el (jit-lock-function): Don't defer if jit-lock-defer-time
	is 0 and there is no input pending.

2014-12-15  Juri Linkov  <juri@linkov.net>

	* replace.el (query-replace-read-from): Use query-replace-compile-replacement
	only on the return value (bug#19383).

2014-12-15  Juri Linkov  <juri@linkov.net>

	* isearch.el (isearch-lazy-highlight-search): Extend the bound of
	the wrapped search by the length of the search string to be able
	to lazy-highlight the whole search string at point (bug#19353).

2014-12-15  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-fold-text): Don't bug out on zero-length text.

2014-12-14  Alan Mackenzie  <acm@muc.de>

	* cus-start.el (all): Add fast-but-imprecise-scrolling.

2014-12-14  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/let-alist.el: Add lexical binding.

2014-12-14  Steve Purcell  <steve@sanityinc.com>  (tiny change)

	* emacs-lisp/package.el (package-menu-mode): Use an extra column
	for the "Version" column, to accommodate date-and-time-based versions.

2014-12-14  Cameron Desautels  <camdez@gmail.com>

	* cus-edit.el (custom-unsaved-options): New function, extracted
	from `customize-unsaved'.
	(custom-unsaved): Use it.
	(custom-prompt-customize-unsaved-options): New function.
	(Bug#19328)

2014-12-14  Dmitry Gutov  <dgutov@yandex.ru>

	* fringe.el (fringe-bitmap-p): Fix 2014-12-05 breakage.

2014-12-14  Dmitry Gutov  <dgutov@yandex.ru>

	Move ASYNC argument to the `diff' VC command to the fifth
	position, for better compatibility with existing third-party code,
	and document it.

	* vc/vc.el (vc-diff-internal): Pass `async' argument to the
	backend `diff' command in the last position.

	* vc/vc-svn.el (vc-svn-diff):
	* vc/vc-src.el (vc-src-diff):
	* vc/vc-sccs.el (vc-sccs-diff):
	* vc/vc-rcs.el (vc-rcs-diff):
	* vc/vc-mtn.el (vc-mtn-diff):
	* vc/vc-hg.el (vc-hg-diff):
	* vc/vc-git.el (vc-git-diff):
	* vc/vc-dav.el (vc-dav-diff):
	* vc/vc-cvs.el (vc-cvs-diff):
	* vc/vc-bzr.el (vc-bzr-diff):
	* obsolete/vc-arch.el (vc-arch-diff): Move ASYNC argument to the end.

2014-12-14  Paul Eggert  <eggert@cs.ucla.edu>

	* emacs-lisp/cconv.el (cconv--analyze-use):
	Rename from cconv--analyse-use.
	(cconv--analyze-function): Rename from cconv--analyse-function.
	(cconv-analyze-form): Rename from cconv-analyse-form.

2014-12-13  Andreas Schwab  <schwab@linux-m68k.org>

	* net/shr.el (shr-next-link): Don't error out at eob.

2014-12-05  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* isearch.el (isearch-open-necessary-overlays): Open overlay
	ending at point (bug#19333).

2014-12-13  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-fold-text): New function.
	(shr-show-alt-text, shr-urlify, shr-tag-img): Use it to fold long
	alt/title texts.
	(shr-fold-text): Inhibit state from being altered.

	* files.el (directory-files-recursively): Really check whether
	files are symlinks.
	(directory-name-p): New function.
	(directory-files-recursively): Use it.

2014-12-13  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/package.el (package--list-loaded-files): New function
	to list files in a given directory which correspond to already
	loaded files.
	(package-activate-1): Reload files given by `package--list-loaded-files'.
	Fix bug#10125, bug#18443, and bug#18448.

2014-12-13  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc-svn.el (vc-svn-diff): Fix bug #19312.

2014-12-13  Michael Albinus  <michael.albinus@gmx.de>

	* simple.el (password-word-equivalents): Add "passcode", used for
	numeric secrets like PINs or RSA tokens.

2014-12-13  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-get-remote-path): Use a login shell in
	order to determine `tramp-own-remote-path'.

2014-12-13  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-parse-command):
	Quote `python-shell-interpreter`.  (Bug#19289)

2014-12-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/python.el (python-indent-line): Use `noindent' in strings.
	(python-indent-levels): Document extra value.
	(python-indent-calculate-indentation): Return `noindent' in strings.
	(python-indent-post-self-insert-function)
	(python-indent-calculate-levels): Handle new value.

2014-12-12  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/network-stream.el (network-stream-open-starttls): No need to
	check for the availability of `gnutls-available-p'.

	* files.el (directory-files-recursively): Don't follow symlinks to
	other directories.

2014-12-12  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc-dav.el, vc/vc-git.el, vc/vc-hg.el, vc/vc-src.el:
	* vc/vc.el: latest-on-branch-p is no longer a public method.

	* vc/vc.el, vc/vc-hg.el, vc/vc-git.el, vc/vc-hooks.el:
	* vc/vc-mtn.el, vc/vc-rcs.el, vc/vc-sccs.el, vc/vc-src.el:
	Remove `rollback' method, to be replaced in the future by uncommit.

2014-12-11  Michael Albinus  <michael.albinus@gmx.de>

	* vc/vc-hg.el (vc-hg-state): Make FILE absolute.  Handle the case
	that there is empty output.

2014-12-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eldoc.el (eldoc-documentation-function): Change default.
	(eldoc-mode, eldoc-schedule-timer): Adjust to new default.

2014-12-10  Artur Malabarba  <bruce.connor.am@gmail.com>

	* emacs-lisp/let-alist.el: Add new package and macro.

2014-12-10  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc-dispatcher.el, vc/vc-hooks.el, vc/vc-rcs.el:
	* vc/vc-sccs.el, vc/vc.el: Righteous featurectomy of vc-keep-workfiles,
	it's a shoot-self-in-foot archaism.  Workfiles are always kept.

2014-12-10  Rasmus Pank Roulund  <emacs@pank.eu>

	* net/ange-ftp.el (ange-ftp-switches-ok): Disallow flags causing
	trouble with ls over ftp.  These flags result in ls returning no
	output, causing Tramp-breakage.  (bug#19192)

2014-12-10  Andreas Schwab  <schwab@suse.de>

	* files.el (file-tree-walk): Use file-name-as-directory unconditionally.

2014-12-10  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* files.el (directory-files-recursively):
	Use `file-name-all-completions' instead of `directory-files' for
	greater speed.

	* net/shr.el (shr-tag-object): Don't bug out on text elements in
	<object>.

2014-12-09  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (auto-mode-alist): Add .rabl, Berksfile
	and Puppetfile.
	(ruby-toggle-string-quotes): New command that allows you to quickly
	toggle between single-quoted and double-quoted string literals.

2014-12-09  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc-src.el (vc-src-do-comand): Prepend -- to file argument
	list, avoids problems witt names containing hyphens.

2014-12-09  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode revision aa4b777.
	* progmodes/verilog-mode.el (verilog-mode-version): Update.
	(verilog-auto-end-comment-lines-re, verilog-end-block-ordered-re)
	(verilog-set-auto-endcomments): Automatically comment property/
	endproperty blocks to match other similar blocks like sequence/
	endsequence, function/endfunction, etc.  Reported by Alex Reed.
	(verilog-set-auto-endcomments): Fix end comments for functions of
	type void, etc.  Detect the function- or task-name when
	auto-commenting blocks that lack an explicit portlist.
	Reported by Alex Reed.
	(verilog-nameable-item-re): Fix nameable items that can have an
	end-identifier to include endchecker, endgroup, endprogram,
	endproperty, and endsequence.  Reported by Alex Reed.
	(verilog-preprocessor-re, verilog-beg-of-statement):
	Fix indentation of property/endproperty around pre-processor
	directives.  Reported by Alex Reed.
	(verilog-label-be): When auto-commenting a buffer, consider
	auto-comments on all known keywords (not just a subset thereof).
	Reported by Alex Reed.
	(verilog-beg-of-statement): Fix labeling do-while blocks, bug842.
	Reported by Alex Reed.
	(verilog-beg-of-statement-1, verilog-at-constraint-p):
	Fix hanging with many curly-bracket pairs, bug663.
	(verilog-do-indent): Fix electric tab deleting form-feeds.
	Note caused by indent-line-to deleting tabls pre 24.5.
	(verilog-auto-output, verilog-auto-input, verilog-auto-inout)
	(verilog-auto-inout-module, verilog-auto-inout-in): Doc fixes.
	(verilog-read-always-signals, verilog-auto-sense-sigs)
	(verilog-auto-reset): Fix AUTORESET with always_comb and always_latch,
	bug844.  Reported by Greg Hilton.

2014-12-09  Alex Reed  <acreed4@gmail.com>  (tiny change)

	* progmodes/verilog-mode.el (verilog-no-indent-begin-re):
	Fix `verilog-indent-begin-after-if' nil not honoring 'forever',
	'foreach', and 'do' keywords.
	(verilog-endcomment-reason-re, verilog-beg-of-statement):
	Fix labeling do-while blocks, bug842.
	(verilog-backward-token): Fix indenting sensitivity lists with
	named events, bug840.

2014-12-09  Reto Zimmermann  <reto@gnu.org>

	Sync with upstream vhdl mode v3.36.1.
	* progmodes/vhdl-mode.el (vhdl-version, vhdl-time-stamp): Update.
	(vhdl-compiler-alist): Anchor all error regexps.
	(vhdl-compile-use-local-error-regexp): Change default to nil.
	(vhdl-asort, vhdl-anot-head-p): Remove.
	(vhdl-aput, vhdl-adelete, vhdl-aget): Simplify.
	Remove optional argument of vhdl-aget and update all callers.
	(vhdl-import-project): Also set `vhdl-compiler'.

2014-12-09  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* files.el (find-files): New function.

	* net/shr.el (shr-dom-print): Don't print comments.
	(shr-tag-svg): Give inline SVG images the right type.

	* net/eww.el (eww-update-header-line-format): Mark valid/invalid
	certificates in the header line.
	(eww-invalid-certificate, eww-valid-certificate): New faces.

2014-12-09  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (inferior-python-mode):
	Set `comint-prompt-read-only` to `t` only locally.

2014-12-08  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/nsm.el (nsm-check-protocol): Test for RC4 on `high'.
	(nsm-format-certificate): Include more data about the connection.
	(nsm-query): Fill the text to that it looks nicer.
	(nsm-check-protocol): Also warn if using SSL3 or older.

2014-12-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/gud.el (gud-gdb-completions): Remove unused var `start'.

	* obsolete/gulp.el (gulp-create-m-p-alist): Remove unused var `mnt-tm'.

	* net/tramp.el (tramp-handle-make-symbolic-link): Mark unused arg.

	* info.el (Info-mode-map): Remove left-over binding.

	* emacs-lisp/avl-tree.el: Use lexical-binding and cl-lib.
	(avl-tree--root): Remove redundant defsetf.

2014-12-08  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/nsm.el (network-security-level): Remove the detailed
	description, which was already outdated, and refer the users to
	the manual.
	(nsm-check-protocol): Check for weak Diffie-Hellman prime bits
	(bug#19153).

2014-12-06  Andrey Kotlarski  <m00naticus@gmail.com>

	* net/eww.el (eww-buffers-mode): New major mode.
	(eww-list-buffers, eww-buffer-select, eww-buffer-show-next)
	(eww-buffer-show-previous, eww-buffer-kill, eww-buffer-show):
	New commands/functions (bug#19131).

2014-12-08  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/gnutls.el (gnutls-negotiate): Ignore files found via
	'file-name-handler-alist' since the gnutls library can't use those
	(bug#15866).

2014-12-08  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-hg.el (vc-hg-dir-status-files): Only include ignores files
	when FILES is non-nil (bug#19304).

2014-12-08  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc-arch.el: Move to obsolete directory so a test framework
	won't trip over bit-rot in it.  There has been no Arch snapshot
	for nine years.

2014-12-07  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-follow-link): Revert prefix behavior to
	previous behavior.
	(eww-copy-page-url): Add doc string.

2014-12-07  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww): Move history recording here...
	(eww-browse-url): ... from here (bug#19253).

	* net/eww.el (eww-browse-url): Use generate-new-buffer (was:
	iterating over possible buffer names.)

2014-12-07  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-reload): Take a prefix to work locally (bug#19086).
	(eww-current-buffer): Compilation fix for bug#18550 patch.

2014-12-07  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww-list-histories): Restore the history in the
	correct buffer (bug#18550).

2014-12-07  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-bookmark-prepare): Display URLs in first by
	displaying shortened titles first (bug#16398).

2014-12-07  Tom Willemse  <tom@ryuslash.org>  (tiny change)

	* progmodes/python.el: Recognize docstrings.
	(python-docstring-at-p, python-font-lock-syntactic-face-function):
	New functions.
	(python-mode): Use them.

2014-12-06  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-treeview.el (newsticker--treeview-list-add-item)
	(newsticker--treeview-propertize-tag): Bind tree menu to mouse-3.
	(newsticker--treeview-create-groups-menu)
	(newsticker--treeview-create-tree-menu): Remove.
	(newsticker--treeview-tree-open-menu): New.
	(newsticker-treeview-tree-click): Pass event to
	`newsticker-treeview-tree-do-click'.
	(newsticker-treeview-tree-do-click): Open treemenu on mouse-3.

2014-12-05  Juri Linkov  <juri@linkov.net>

	* comint.el (comint-history-isearch-search)
	(comint-history-isearch-wrap): Use field-beginning instead of
	comint-line-beginning-position.
	(comint-send-input): Go to the end of the field instead of the end
	of the line to accept whole multi-line input.
	https://lists.gnu.org/archive/html/emacs-devel/2014-12/msg00305.html

2014-12-05  Juri Linkov  <juri@linkov.net>

	* minibuffer.el (minibuffer-completion-help):
	Compare selected-window with minibuffer-window to check whether
	completions should be displayed near the minibuffer.  (Bug#17809)
	https://lists.gnu.org/archive/html/emacs-devel/2014-12/msg00311.html

2014-12-05  Michael Albinus  <michael.albinus@gmx.de>

	* vc/vc-mtn.el (vc-mtn-root):
	* vc/vc-svn.el (vc-svn-registered): Make FILE absolute.

2014-12-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-smie-sh-rules): Go back to the beginning
	of the whole pipe when indenting an opening keyword after a |.
	Generalize this treatment to opening keywords like "while" (bug#18031).

2014-12-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (newline): Place the hook buffer-locally,
	to make sure it's first.

	* progmodes/prog-mode.el (prettify-symbols--compose-symbol):
	Fix handling of symbols with different syntax at beginning/end or with
	symbol rather than word syntax.

2014-12-05  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move): If noninteractive, call line-move-1, not
	forward-line, since the former is compatible with line-move-visual
	both in terms of the column to which it moves and the return
	value.  (Bug#19211)

2014-12-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/ediff-init.el (ediff-odd-p): Remove.
	(ediff-background-face): Use cl-oddp instead.
	(ediff-buffer-live-p): Make it a defsubst.

	* tooltip.el (tooltip-region-active-p): Remove.

	* net/shr.el (shr-char-breakable-p, shr-char-kinsoku-bol-p)
	(shr-char-kinsoku-eol-p, shr-char-nospace-p): Use define-inline.

	* fringe.el (fringe-bitmap-p): Make it a plain function.

	* emacs-lisp/eieio-core.el: Prefer inlinable functions over macros.
	(class-p, generic-p, eieio-object-p, class-abstract-p):
	Make them defsubst, so as to avoid corner case problems where
	the arg might be evaluated in the condition-case, or it can't be passed
	to higher-order functions like `cl-some'.

2014-12-05  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* wid-edit.el (widget-choose): Let numeric keypad work (bug#19268)
	and remove old menu-related code.

2014-12-05  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-display-pdf): Let mailcap determine how to
	display PDF files (bug#19270).

2014-12-05  Juri Linkov  <juri@linkov.net>

	Compare with the most recent window by default.
	* vc/compare-w.el (compare-windows-get-window-function): New defcustom.
	(compare-windows-get-recent-window)
	(compare-windows-get-next-window): New functions.
	(compare-windows, compare-windows-sync-default-function):
	Use `compare-windows-get-window-function' instead of `next-window'.
	(compare-windows): Add diff/match messages with region boundaries.
	(Bug#19170)

2014-12-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (filter): Remove.  Use `cl-remove-if-not' or `seq-filter'.

2014-12-04  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr--extract-best-source): Ignore non-text children.

2014-12-04  Eli Zaretskii  <eliz@gnu.org>

	Implement copying of a buffer portion while preserving visual order.
	* simple.el (bidi-directional-controls-chars)
	(bidi-directional-non-controls-chars): New variables.
	(squeeze-bidi-context-1, squeeze-bidi-context)
	(line-substring-with-bidi-context)
	(buffer-substring-with-bidi-context): New functions.

	* files.el (file-tree-walk): Doc fix.

2014-12-04  Rupert Swarbrick  <ruperts@broadcom.com> (tiny change)
	    Rüdiger Sonderfeld  <ruediger@c-plusplus.net>

	* autoinsert.el (auto-insert-alist): Update C/C++ header and
	program support to match more extensions.  Replace non-alnum
	characters when generating include guards (headers) and check for
	more extensions when generating includes (programs)
	(bug#19254).

2014-12-03  Eric S. Raymond  <esr@snark.thyrsus.com>

	* files.el (file-tree-walk): Fix docstring.

2014-12-03  Karl Fogel  <kfogel@red-bean.com>

	Fix bug whereby saving files hung in VC hook.

	Saving a buffer visiting a file under SVN control would hang if
	the remote repository were unreachable, because the VC hooks tried
	to run "svn status -u" on the file, where the "-u" tells svn to
	get update information from the remote repository.
	https://lists.gnu.org/archive/html/emacs-devel/2014-12/msg00174.html

	* vc/vc-svn.el (vc-svn-state): Remove optional `localp'
	argument and always pass "-v" to "svn status", never "-u".

2014-12-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/inline.el: Fix up copyright header.
	(inline-quote, inline-const-p, inline-const-val, inline-error):
	Silence compiler warnings.
	(inline-letevals): Fix edebug spec.
	(inline--testconst-p): Consider lambda expressions as const-p.
	(inline--getconst-val): Use inline--testconst-p.

	* minibuffer.el (completion-table-dynamic): Add arg `switch-buffer'
	and change default to stay in the minibuffer when called from
	the minibuffer (bug#19250).
	(lazy-completion-table): Use this new argument to preserve the
	old behavior.

	* progmodes/elisp-mode.el (elisp--local-variables): Don't burp on
	incorrect lexical elements (bug#19250).

2014-12-03  A. N. Other  <none@example.com>

	* files.el (file-tree-walk): Lisp translation of ANSI ftw(3).

2014-12-02  Glenn Morris  <rgm@gnu.org>

	* whitespace.el (whitespace-big-indent-regexp): Add :version.

2014-12-02  Eric S. Raymond  <esr@snark.thyrsus.com>

	* subr.el (filter): New macro.  Because it's just silly for a Lisp
	not to have this in 2014.  And VC needs it.

	* vc.el: All backends: API simplification: Abolish dir-status.
	It's replaced by dir-status-files.

	* vc.el: All backends: API simplification: Remove 4th
	'default-state' argument from vc-dir-status files and its backend
	methods - no backend method ever set it.  It was used only in the
	fallback method to to set a default of 'up-to-date, though a
	convoluted call chain obscured this.

	* vc-hooks.el: Bind vc-delete-file to Ctrl-x v delete.

	* vc.el (vc-expand-dirs): Now takes a second BACKEND argument,
	improving behavior on directories using multiple file-oriented VCSes.

	* vc/vc.el: All backends: API simplification; clear-headers
	is no longer a public method.  It is now local to the one place
	it's used, in the RCS steal-lock method.

2014-12-01  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc.el: In all backends: API simplification; could-register
	is no longer a public method.  (vc-cvs.el still has a private
	implementation.)

	* vc/vc.el: In all backends: API cleanup; the backend diff method
	takes an explicit async flag.  This eliminates a particularly ugly
	global.

	* vc-bzr.el: Restore vc-bzr-state-heuristic as a private method.
	VC randomly/unpredictably fails without it; cause not yet established.

2014-12-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	Merge some of the differences from the standalone CC-mode.
	The main change is to only use the `category' text-property only when
	available.  For that many calls are changed to use c-get-char-property,
	c-next-single-property-change, c-sc-scan-lists,
	c-sc-parse-partial-sexp, c-unmark-<->-as-paren.

	* progmodes/cc-mode.el (c-just-done-before-change): New var.
	(c-basic-common-init): Initialize it.
	(c-common-init): Only use mode-require-final-newline when available.
	(c-before-change): Check and set c-just-done-before-change.
	(c-after-change): Re-set c-just-done-before-change.
	(c-advise-fl-for-region): New macro.
	(lazy-lock-defer-rest-after-change, lazy-lock-defer-line-after-change)
	(font-lock-after-change-function, jit-lock-after-change):
	Advise if needed.

	* progmodes/cc-langs.el (c-modified-constant): New lang var.
	(c-known-type-key): Don't make a list just to throw it away.

	* progmodes/cc-engine.el (c-invalidate-state-cache, c-parse-state):
	Handle the case where categories are not available.
	(c-record-parse-state-state, c-replay-parse-state-state):
	Handle marker values.
	(c-before-change-check-<>-operators): Look for the `syntax-table'
	property rather than for the corresponding `category'.
	(c-looking-at-decl-block): Remove unused var
	`c-disallow-comma-in-<>-arglists'.
	(c-forward-<>-arglist-recur): Remove unused var
	`orig-record-found-types'.

	* progmodes/cc-defs.el (c-version): Bump up to 5.33.
	(c-use-category): New const.
	(c-next-single-property-change): New macro.
	(c-region-is-active-p): Prefer region-active-p when available.
	(c-search-backward-char-property): Fix old min/max typo; probably
	a copy/paste error.
	(c-mark-<-as-paren, c-mark->-as-paren, c-unmark-<->-as-paren):
	Turn them into macros that obey c-use-category.
	(c-sc-scan-lists-no-category+1+1, c-sc-scan-lists-no-category+1-1)
	(c-sc-scan-lists-no-category-1+1, c-sc-scan-lists-no-category-1-1)
	(c-sc-scan-lists, c-sc-parse-partial-sexp)
	(c-looking-at-non-alphnumspace): New macros.
	(c-sc-parse-partial-sexp-no-category): New function.
	(c-emacs-features): Add `category-properties' element.

	* progmodes/cc-cmds.el (c-forward-into-nomenclature)
	(c-backward-into-nomenclature): Use cc-subword if subword-mode is
	not available.
	(c-beginning-of-defun, c-end-of-defun, c-mark-function)
	(c-indent-line-or-region): Use c-region-is-active-p.

	* progmodes/cc-bytecomp.el (cc-bytecomp-unbound-variables)
	(cc-bytecomp-original-functions, cc-bytecomp-original-properties)
	(cc-bytecomp-loaded-files): Re-set each time the file is loaded.
	(cc-bytecomp-obsolete-var, cc-bytecomp-ignore-obsolete)
	(cc-bytecomp-obsolete-fun): Delete unused functions.

	* progmodes/cc-align.el (c-lineup-respect-col-0): New function.

2014-12-01  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-dom-print): Fix up `shr-dom-print' after the
	dom.el changes.

2014-12-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc.el (vc-find-conflicted-file): Look for conflicted files in the
	current "project" rather than just the current directory.
	* vc/vc-git.el (vc-git-conflicted-files): Clarify in which directory
	the file names make sense.

	* vc/smerge-mode.el (smerge-swap): New command.

	* vc/diff-mode.el (diff-kill-applied-hunks): New command.

2014-12-01  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-treeview.el (newsticker--treeview-item-show):
	Check window liveliness before measuring its width.

	* net/newst-backend.el (newsticker--get-news-by-url-callback):
	Pass correct status to `newsticker--sentinel-work'.
	(newsticker--sentinel-work): Use "newsticker--download-error" as
	guid in order to prevent multiple "Could not download..."
	messages.  (Bug#19166)

2014-12-01  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww-render): Call `eww-after-render-hook' in the
	correct buffer (bug#19225).

2014-12-01  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/nsm.el (network-security-level): Change the default to `medium'.

	* net/eww.el (eww): Leave point in a place that doesn't cause
	scrolling when displaying "Loading...".

2014-12-01  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc.el, vc/vc-cvs.el, vc/vc-rcs.el, vc/vc-svn.el: The 'merge'
	backend method of RCS/CVS/SVN is now 'merge-file', to contrast with
	'merge-branch'.  Prompting for merge revisions is pushed down to
	the back ends; this fixes a layering violation that caused bad
	behavior with SVN.

	* vc/vc.el, vc-hooks.el: All backends: API simplification;
	vc-stay-local-p and repository-hostname are no longer public
	methods.  Only the CVS and SVN backends used these, and the SVN
	support was conditioned out because svn status -v is too slow.
	The CVS back end retains this machinery and the vc-stay-local
	configuration variable now only affects it.

2014-12-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/inline.el: New file.

2014-12-01  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc.el, vc-hooks.el: All backends: API simplification;
	vc-state-heuristic is no longer a public method, having been
	removed where it is redundant, unnecessary, or known buggy.
	This eliminated all backends except CVS.  Eliminates bug#7850.

	* vc/vc-cvs.el, vc/vc-hooks.el, vc/vc-rcs.el, vc/vc-sccs.el:
	Eliminate vc-mistrust-permissions.  It was only relevant to the
	RCS and SCCS back ends and defaulted to t.  Code now always
	mistrusts permissions - by actual measurement the effect on
	performance is negligible.  As a side effect bug#11490 is now
	irrelevant.

	* vc/vc.el, vc-hooks.el: All backends: API simplification;
	vc-workfile-unchanged-p is no longer a public method (but the RCS
	and SCCS back ends retain it as a private method used in state
	computation).  This method was redundant with vc-state and usually
	implemented as a trivial call to same.  Fixes the failure mode
	described in bug#694.

	* vc/vc.el: All backends: API simplification; init-revision is
	gone, and vc-registered functions no longer take an
	initial-revision argument.

2014-11-29  Glenn Morris  <rgm@gnu.org>

	* vc/vc-src.el (vc-src, vc-src-diff-switches)
	(vc-src-master-templates): Fix :version tags.

2014-11-29  Paul Rankin  <paul@tilk.co>  (tiny change)

	* outline.el (outline-move-subtree-down): Refactor and improve code.

2014-11-29  Stephen Berman  <stephen.berman@gmx.net>
	    Stefan Monnier  <monnier@iro.umontreal.ca>

	* outline.el (outline-move-subtree-down): Make sure we can move
	forward to find the end of the subtree and the insertion point
	(bug#19102).

2014-11-29  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-completion-setup-code):
	Use __builtin__ module (or builtins in Python 3) and catch all errors
	when importing readline and rlcompleter.

2014-11-29  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Handle calling revert-buffer (bug#19187).
	(todo-revert-buffer): New function.
	(todo-modes-set-1): Use it as the buffer-local value of
	revert-buffer-function.

2014-11-29  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-mode): If called interactively, just
	display a message saying to call todo-show to enter Todo mode
	(Bug#19112).

2014-11-29  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-hg.el (vc-hg-dir-status-files): Include ignored files.
	(Bug#18579)

	* vc/vc-bzr.el (vc-bzr-after-dir-status): Don't skip ignored
	files.  (Bug#18579)

2014-11-29  Michael Albinus  <michael.albinus@gmx.de>

	* textmodes/makeinfo.el (makeinfo-buffer): Make it work also for
	remote `buffer-file-name'.

2014-11-29  Leo Liu  <sdl.web@gmail.com>

	* calendar/diary-lib.el (calendar-mark-1): Fix thinko.

2014-11-29  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Set PYTHONUNBUFFERED on shell startup.

	* progmodes/python.el (python-shell-unbuffered): New var.
	(python-shell-calculate-process-environment): Use it.

2014-11-29  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-action-password): Clean password on subsequent
	attempts even if there was no wrong password indication.  (Bug#19047)

	* net/tramp-sh.el (tramp-get-remote-locale): Return "LC_ALL=C" as
	fallback.
	(tramp-open-connection-setup-interactive-shell): No need to check
	for nil as `tramp-get-remote-locale' return value.

2014-11-29  Eli Zaretskii  <eliz@gnu.org>

	* vc/vc-git.el (vc-git-command, vc-git--call):
	Bind coding-system-for-read and coding-system-for-write to
	vc-git-commits-coding-system.
	(vc-git-previous-revision): Use "~1" instead of "^", since the
	latter is a special character for MS-Windows system shells.

2014-11-29  Michael Albinus  <michael.albinus@gmx.de>

	Improve XEmacs compatibility.

	* net/tramp.el (tramp-autoload-file-name-handler):
	Wrap `temporary-file-directory' by `symbol-value', it doesn't
	exist in XEmacs.
	(tramp-read-passwd): Don't use `with-timeout-suspend' and
	`with-timeout-unsuspend' if they don't exist, like in XEmacs.
	(tramp-time-less-p, tramp-time-subtract): Remove functions.
	(tramp-handle-file-newer-than-file-p, tramp-time-diff):
	* net/tramp-adb.el (tramp-adb-ls-output-time-less-p):
	* net/tramp-cache.el (tramp-get-file-property):
	* net/tramp-smb.el (tramp-smb-handle-insert-directory):
	Use `time-less-p' and `time-subtract, respectively.

	* net/tramp-adb.el (top): Do not require time-date.el.

	* net/tramp-compat.el (top): Require time-date.el for XEmacs.

	* net/tramp-sh.el (tramp-open-connection-setup-interactive-shell):
	Check, whether `utf-8' is a valid coding system.

2014-11-29  Eli Zaretskii  <eliz@gnu.org>

	* vc/vc.el (vc-retrieve-tag): Doc fix.

2014-11-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (execute-extended-command--shorter): Fix the "M-p" case
	(bug#19152).

2014-11-28  Martin Rudalics  <rudalics@gmx.at>

	Fix two issues around help-window-select.  (Bug#11039) (Bug#19012)
	* help.el (help-window-old-frame): New variable.
	(help-window-select): Default to nil (Bug#11039).
	Rewrite doc-string.
	(help-window-setup): When the help window appears on another
	frame and `help-window-select' is non-nil, give that frame input
	focus too (Bug#19012).
	(with-help-window): Store selected frame in
	help-window-old-frame.

2014-11-28  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-treeview.el (newsticker--treeview-load): Take care of
	nil value for `newsticker-groups-filename'.

2014-11-28  Daiki Ueno  <ueno@gnu.org>

	* epa.el (epa-sign-file, epa-encrypt-file, epa-decrypt-region)
	(epa-sign-region, epa-encrypt-region):
	Use `epg-context-set-{passphrase,progress}-callback', instead of
	`setf'.  This partially reverts commit 9e48a95c (bug#19150).
	Reported by José A. Romero L.

2014-11-27  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-restore-history):
	Bind `inhibit-modification-hooks' instead of `after-change-functions'.

2014-11-27  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-backend.el (newsticker--parse-atom-1.0):
	Handle embedded (x)html in summary node.

2014-11-27  Sam Steingold  <sds@gnu.org>

	* menu-bar.el (menu-bar-open): When everything else fails,
	use (mouse-menu-bar-map).

2014-11-27  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-treeview.el (newsticker-groups-filename):
	Change default value to nil.  Point out that variable is obsolete in doc
	string.
	(newsticker--treeview-load): Change wording of the questions the
	user is asked when `newsticker-groups-filename' is found to be
	used and we offer to read and remove the groups file.  (Bug#19165)

2014-11-27  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww): Record the new URL immediately, so that if the
	HTTP fetch fails, we have the right URL in the buffer.
	(eww-process-text-input): Don't shorten the input field if
	deleting at the last character (bug#19085).
	(eww-restore-history): Inhibit change functions while restoring
	the history.
	(eww-process-text-input): Fix deletion at the start of the field, too.
	(eww-mode): Revert mistanken removal of `buffer-disable-undo'.
	(eww-process-text-input): Try to keep track of the size more reliably.

	* dom.el (dom-pp): New function.

2014-11-27  Eli Zaretskii  <eliz@gnu.org>

	* vc/vc-bzr.el (vc-bzr-print-log, vc-bzr-expanded-log-entry):
	Don't assume --long is the default for "bzr log", always specify
	it explicitly, in case the user defined an alias for 'log' that
	uses some other format.

2014-11-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-eldoc--get-doc-at-point):
	Strip shell output before returning.  (bug#18794)

2014-11-27  Dmitry Gutov  <dgutov@yandex.ru>

	Fix indentation before `!=' and after `+='.  Originally reported
	in https://github.com/mooz/js2-mode/issues/174.
	* progmodes/js.el (js--indent-operator-re): Make assignments and
	(in)equality operator a separate case.
	(js--continued-expression-p): Escape the second `+' in the regexp.

2014-11-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* window.el (handle-select-window): Deactivate shift-region (bug#19003).

2014-11-26  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/nsm.el (nsm-new-fingerprint-ok-p): Display the certificate
	when querying about new certificates.

	* net/shr.el (shr-make-table-1): dom.el changes for table rendering.

	* dom.el (dom-by-tag): Use `equal' for comparisons so that tags
	can be strings.
	(dom-elements): Protect against non-text nodes.
	(dom-non-text-children): New function.

	* net/eww.el (eww-tag-title): Use `dom-text'.

2014-11-26  Sam Steingold  <sds@gnu.org>

	* textmodes/sgml-mode.el (sgml-validate-command): Pass -utf8 to tidy.

2014-11-26  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-highest-readability): More dom.el fixes.

2014-11-26  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-backend.el (newsticker--parse-generic-items):
	Take care of UIDs when adding elements to cache.

2014-11-26  Alan Mackenzie  <acm@muc.de>

	Remove spurious reference to symbol category_properties.
	* progmodes/cc-engine.el (c-state-pp-to-literal): Fix here.

2014-11-26  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el: Use the new dom.el accessors throughout.

	* net/shr.el: Ditto.

	* dom.el: New file.

2014-11-26  Glenn Morris  <rgm@gnu.org>

	* arc-mode.el (archive-visit-single-files): Add :version.

2014-11-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/nsm.el (nsm-format-certificate): Don't bug out on missing
	elements.
	(nsm-warnings-ok-p): The new version of this function always
	returned nil when everything was OK.

2014-11-25  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/gnutls.el (gnutls): Set :group to 'comm so it's near NSM.

	* net/nsm.el (nsm-check-tls-connection, nsm-save-host)
	(nsm-warnings-ok-p): Use `gnutls-peer-status-warning-describe'.

2014-11-20  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* emacs-lisp/byte-run.el (function-put): Match argument names to
	docstring.

2014-11-24  Sam Steingold  <sds@gnu.org>

	* vc/vc-hooks.el (vc-directory-exclusion-list):
	Fix a trivial typo (bug#19171).

2014-11-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-hooks.el (vc-state-base-face): Don't override
	mode-line-inactive.

2014-11-24  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-set-character-encoding): Use `read-coding-system'.
	(eww-process-text-input): Inhibit read only so that input fields
	don't get shortened (bug#19085).

2014-11-24  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/macroexp.el (macroexp-let2*): New macro.

	* window.el (with-temp-buffer-window)
	(with-current-buffer-window, with-displayed-buffer-window):
	* emacs-lisp/cl-macs.el (cl--compiler-macro-adjoin):
	* emacs-lisp/cl-lib.el (substring):
	* emacs-lisp/cl-extra.el (cl-getf): Use it.

2014-11-24  Eli Zaretskii  <eliz@gnu.org>

	* isearch.el (isearch-update): Don't assume
	pos-visible-in-window-p will return nil when point is hscrolled
	out of view.  (Bug#19157)

2014-11-20  Andrey Kotlarski  <m00naticus@gmail.com>

	* net/eww.el (eww-browse-url): Optionally create new eww buffer.
	(eww-follow-link): Follow in new buffer in case of prefix
	argument, open externally with double prefix (bug#19130).

2014-11-23  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-display-html): Decode the document-defined charset.
	(eww): Pop to the *eww* buffer immediately after executing the
	`M-x eww' command to avoid having buffers pop up later.
	(eww-display-html): Don't pop the *eww* buffer.
	(eww-display-raw): Ditto.
	(eww-display-image): Ditto.
	(eww-follow-link): Make going to #targets in the page work again.

2014-11-23  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww-suggest-uris): New variable.
	(eww-suggested-uris): New function.
	(eww): Default to URL under point.
	(eww-links-at-point): New function.

2014-11-20  Mark Oteiza  <mvoteiza@udel.edu>  (tiny change)

	* net/eww.el (eww-add-bookmark): Fix bookmark titles.

2014-11-17  Mark Oteiza  <mvoteiza@udel.edu>  (tiny change)

	* net/eww.el (eww-mode-map): Bind backtab to shr-previous-link.

2014-11-23  Kenjiro Nakayama  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-set-character-encoding): New command and keystroke.
	(eww-display-raw): Use it (bug#16225).

2014-11-23  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/nsm.el (network-security-level): Rename from
	`nsm-security-level' and documented.

	* mail/smtpmail.el (smtpmail-via-smtp): Warn unless encrypted and
	we're sending a password.

	* net/nsm.el: New file that implements a Network Security Manager.

	* net/network-stream.el (open-network-stream): Add a new
	:warn-unless-encrypted parameter.
	(network-stream-open-plain): Allow warning unless encrypted.
	(network-stream-open-starttls): Call the Network Security Manager.
	(network-stream-open-tls): Ditto.

2014-11-23  Leo Liu  <sdl.web@gmail.com>

	* calendar/cal-china.el (calendar-chinese-from-absolute-for-diary)
	(calendar-chinese-to-absolute-for-diary)
	(calendar-chinese-mark-date-pattern, diary-chinese-anniversary):
	Handle leap months in Chinese calendar.  (Bug#18953)

2014-11-22  Alan Mackenzie  <acm@muc.de>

	Fix error with `mark-defun' and "protected:" in C++ Mode.
	* progmodes/cc-cmds.el (c-where-wrt-brace-construct): Handle a
	return code of (label) from c-beginning-of-decl-1.  (Bug#19134)

2014-11-22  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-backend.el (newsticker--sentinel-work):
	Tell `libxml-parse-xml-region' to discard comments.  (Bug#18787)

2014-11-22  Michael Albinus  <michael.albinus@gmx.de>

        * net/tramp-sh.el (tramp-sh-handle-start-file-process)
	(tramp-sh-handle-process-file): Propagate `process-environment'.

	* vc/vc-hg.el (vc-hg-state): No special handling for remote files;
	Tramp propagates environment variables now.

2014-11-22  Eric S. Raymond  <esr@snark>

	* vc/vc-filewise.el: New file to isolate code used only by the
	file-oriented back ends (SCCS/RCS/CVS/SRC) which should not
	live in vc.el and certainly not in vc-hooks.el.

	* vc/vc-hooks.el, vc-rcs.el, vc-sccs.el: vc-name  -> vc-master-name.
	This is preparatory to isolating all the 'master' functions
	used only by the file-oriented back ends.  With this done first,
	the substantive diffs will be easier to read.

2014-11-21  Rüdiger Sonderfeld  <ruediger@c-plusplus.net>

	* play/morse.el (nato-alphabet): Mark URL in docstring in a way
	that is recognized by `help-mode'.

2014-11-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* desktop.el (desktop-create-buffer): Use activate-mark to set
	`mark-active' (bug#19058).

2014-11-21  Eric S. Raymond  <esr@snark>

	* vc/vc-src.el (vc-src-state): Fix bug that produced spurious
	nil state.

2014-11-21  Eli Zaretskii  <eliz@gnu.org>

	* vc/vc.el (vc-deduce-fileset): Support invocation from
	*vc-change-log* buffer.  (Bug#19084)

2014-11-13  Matthew Leach  <matthew@mattleach.net>

	* arc-mode.el (archive-visit-single-files): New.
	(archive-mode): Visit file if archive contains a single file.
	(Bug#1702)

2014-11-21  Ulrich Müller  <ulm@gentoo.org>

	* vc/vc.el: Fix a typo in the commentary.

2014-11-20  Eric S. Raymond  <esr@snark.thyrsus.com>

	* vc/vc-src.el, vc/vc.el: Added support for SRC.  Needs more
	testing and a real log-view mode.

	* vc/vc-bzr.el, vc/vc-cvs.el, vc/vc-dav.el, vc/vc-git.el:
	* vc/vc-hg.el, vc/vc-mtn.el, vc/vc-rcs.el, vc/vc-sccs.el:
	* vc/vc-svn.el, vc/vc.el: Remove editable argument from the backend
	checkout methods; where it matters (which is only in SCCS and RCS)
	files are always checked out editable.  This may actually have
	been dynamically true already - it looks like the vc-next-action
	code evolved past visiting the other case.  Tested with RCS.

	* vc/vc-arch.el, vc/vc-bzr.el, vc/vc-cvs.el, vc/vc-dav.el:
	* vc/vc-git.el, vc/vc-hg.el, vc/vc-mtn.el, vc/vc-rcs.el:
	* vc/vc-sccs.el, vc/vc-svn.el, vc/vc.el: Remove never-used rev
	argument from the backend checkin methods.  Only the RCS, SCCS,
	and CVS back ends tried to do anything with it, and that code was
	never exercised.  Chiseling away the cruft of decades...

2014-11-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-render): Remove a no-op :title setting.

2014-11-19  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww-history-limit): New variable.
	(eww-save-history): Use it (bug#19105).
	(eww-reload): Reload the page in the right buffer.

2014-11-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-desktop-misc-data): Use `cl-remove-duplicates'.

2014-11-19  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww-desktop-remove-duplicates)
	(eww-restore-desktop, eww-restore-reload-prompt): New variables.
	(eww-mode): Set up desktop mode (bug#18010).
	(eww-desktop-data-save, eww-desktop-data-1)
	(eww-desktop-history-duplicate, eww-desktop-misc-data)
	(eww-restore-desktop): New functions.

2014-11-19  Eli Zaretskii  <eliz@gnu.org>

	* vc/vc.el (vc-log-internal-common): Turn on log-view-mode in the
	correct buffer.  (Bug#19101)

2014-11-19  Rüdiger Sonderfeld  <ruediger@c-plusplus.net>

	* vc/vc-git.el (vc-git-diff): Use "difftool -x diff" with
	`diff-switches' if `vc-git-diff-switches' is nil.  (Bug#19099)

2014-11-19  Artur Malabarba  <bruce.connor.am@gmail.com>

	* ido.el (ido-bury-buffer-at-head): New command.
	(ido-buffer-completion-map): Bind it to C-S-b.

2014-11-18  Juri Linkov  <juri@linkov.net>

	* simple.el (next-line-or-history-element): Wrap next-line
	in with-no-warnings.
	(previous-line-or-history-element): Wrap previous-line
	in with-no-warnings.

2014-11-18  Juri Linkov  <juri@linkov.net>

	* progmodes/grep.el (grep-compute-defaults):
	Compute grep-highlight-matches before its use.

2014-11-18  Juri Linkov  <juri@linkov.net>

	* replace.el (query-replace-from-to-separator): Turn defvar into
	defcustom.  Wrap char-displayable-p in ignore-errors because an
	attempt to autoload char-displayable-p fails during pre-loading.
	Move (propertize "\0" ... 'separator t) out of customizable part
	to query-replace-read-from.
	(query-replace-read-from): Call custom-reevaluate-setting on
	query-replace-from-to-separator to reevaluate the separator
	depending on the return value of char-displayable-p.
	https://lists.gnu.org/archive/html/emacs-devel/2014-11/msg00466.html

2014-11-18  Juri Linkov  <juri@linkov.net>

	* bindings.el (minibuffer-local-map): Rebind [down] from
	next-history-element to next-line-or-history-element, and [up]
	from previous-history-element to previous-line-or-history-element.

	* simple.el (next-line-or-history-element)
	(previous-line-or-history-element): New commands.
	https://lists.gnu.org/archive/html/emacs-devel/2014-11/msg00822.html

2014-11-18  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/nadvice.el (define-advice): New macro.
	* emacs-lisp/lisp-mode.el (lisp-imenu-generic-expression):
	Add define-advice.
	(lisp-font-lock-keywords-1): Add define-advice.

2014-11-18  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-context): New slot EDIT-CALLBACK.
	(epg--process-filter): Call EDIT-CALLBACK when editing a key.
	(epg-reset): Reset EDIT-CALLBACK of the context.
	(epg-start-edit-key): New function.
	(epg-edit-key): New function.

2014-11-18  Paul Eggert  <eggert@cs.ucla.edu>

	Port new time stamp handling to Emacs 23.2.
	This fix is for Gnus.  Reported by Katsumi Yamaoka.
	* calendar/time-date.el (time-add, time-subtract, time-less-p):
	Use eval-and-compile, not eval-when-compile.

2014-11-18  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-context-set-passphrase-callback)
	(epg-context-set-progress-callback): Check if the CALLBACK
	argument is a function, instead of a cons.

2014-11-18  Daiki Ueno  <ueno@gnu.org>

	* epa-file.el (epa-file-insert-file-contents)
	(epa-file-write-region): Remove redundant check of
	epa-pinentry-mode.
	* epa.el (epa-sign-file, epa-encrypt-file, epa-decrypt-region)
	(epa-sign-region, epa-encrypt-region): Remove redundant check of
	epa-pinentry-mode.

2014-11-18  Daiki Ueno  <ueno@gnu.org>

	* epa-file.el (epa-file-insert-file-contents): Don't show
	"*Error*" buffer if input file does not exist.
	Reported by Herbert J. Skuhra.

2014-11-18  Paul Pogonyshev  <pogonyshev@gmail.com>
	    Rüdiger Sonderfeld  <ruediger@c-plusplus.net>

	* progmodes/cc-langs.el: Support some of the new keywords in C++11.
	An alternative version of the patch from bug#13871.
	(c-operators): Add "alignof".
	(c-primitive-type-kwds): Add "char16_t", "char32_t".
	(c-type-modifier-kwds): Add "constexpr", "noexcept".
	(c-modifier-kwds): Add "thread_local".
	(c-constant-kwds): Add "nullptr".

2014-11-17  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/tildify.el (tildify-pattern, tildify-space-string):
	New variables for specifying tildify pattern and representation of
	a hard space -- a no-break space by default -- respectively.
	Being buffer-local they are much easier to handle than
	`tildify-string-alist' and `tildify-pattern-alist' respectively
	that have been used so far.  They also works better with derived
	modes.
	(tildify-foreach-region-function): New variable specifying
	a function determining portions of buffer that should be
	tildified.  It allows major modes to create a filtering function
	more elaborate than a set of regular expressions.  Initialized to
	`tildify--deprecated-ignore-evironments' by default to handle now
	deprecated `tildify-ignored-environments-alist' variable.
	(tildify--foreach-region): A new function that takes
	`tildify-foreach-region-function' into account and calls callback
	for regions of the buffer that should be tildified.
	(tildify-foreach-ignore-environments): A new function which can be
	partially applied and used as `tildify-foreach-region-function'.
	(tildify-ignored-environments-alist, tildify-pattern)
	(tildify-string-alist, tildify--pick-alist-entry): Mark as obsolete.
	(tildify--find-env): Rename from `tildify-find-env' and mark as
	obsolete.
	(tildify--deprecated-ignore-evironments): New function,
	immediately marked as obsolete, used to handle deprecated
	`tildify-ignored-environments-alist'.

	* textmodes/tex-mode.el (tex-common-initialization):
	Set `tildify-space-string' and `tildify-foreach-region-function'
	variables in all variants of TeX mode since `tildify-string-alist'
	and `tildify-ignored-environments-alist' are now empty by default.

	* nxml/nxml-mode.el (nxml-mode): Ditto in `nxml-mode'.
	If encoding supports it use no-break space instead of character
	entity; this changes previous default which used a numeric
	reference.

	* textmodes/sgml-mode.el (sgml-mode): ditto in `sgml-mode'.
	If encoding does not support no-break space, use numeric reference;
	this changes previous default which used named entity (“&nbsp;”)
	in HTML mode.

2014-11-17  Ulf Jasper  <ulf.jasper@web.de>

	* calendar/icalendar.el (icalendar-export-alarms):
	New customizable variable.  (Bug#5433)
	(icalendar-export-region): Export alarms as specified in
	`icalendar-export-alarms'.
	(icalendar--create-ical-alarm, icalendar--do-create-ical-alarm):
	New functions for exporting alarms.

2014-11-17  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* bindings.el (search-map): Move `eww-search-words' to `M-s M-w'.

2014-11-17  Paul Eggert  <eggert@cs.ucla.edu>

	Port new time stamp handling to old Emacs and to XEmacs.
	This is needed for Gnus, which copies time-date.el and which
	runs on older Emacs implementations.
	* calendar/time-date.el (with-decoded-time-value):
	Handle 'nil' and floating-point arg more compatibly with new Emacs.
	(encode-time-value, with-decoded-time-value):
	Obsolete only if new Emacs.
	(time-add, time-subtract, time-less-p): Define if not new Emacs.

	Improve time stamp handling, and be more consistent about it.
	This implements a suggestion made in:
	https://lists.gnu.org/archive/html/emacs-devel/2014-10/msg00587.html
	Among other things, this means timer.el no longer needs to
	autoload the time-date module.
	* allout-widgets.el (allout-elapsed-time-seconds): Doc fix.
	* arc-mode.el (archive-ar-summarize):
	* calendar/time-date.el (seconds-to-time, days-to-time, time-since):
	* emacs-lisp/timer.el (timer-relative-time, timer-event-handler)
	(run-at-time, with-timeout-suspend, with-timeout-unsuspend):
	* net/tramp.el (tramp-time-less-p, tramp-time-subtract):
	* proced.el (proced-time-lessp):
	* timezone.el (timezone-time-from-absolute):
	* type-break.el (type-break-schedule, type-break-time-sum):
	Simplify by using new functionality.
	* calendar/cal-dst.el (calendar-next-time-zone-transition):
	Do not return time values in obsolete and undocumented (HI . LO)
	format; use (HI LO) instead.
	* calendar/time-date.el (with-decoded-time-value):
	Treat 'nil' as current time.  This is mostly for XEmacs.
	(encode-time-value, with-decoded-time-value): Obsolete.
	(time-add, time-subtract, time-less-p): Use no-op autoloads, for
	XEmacs.  Define only if XEmacs, as they're now C builtins in Emacs.
	* ldefs-boot.el: Update to match new time-date.el
	* proced.el: Do not require time-date.

2014-11-16  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-mode): Make the buffer read-only.
	(eww-form-text): Inhibit read-only-ness in text input fields
	(bug#16476).

2014-11-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (execute-extended-command--shorter): Cut search here.
	(execute-extended-command): Instead of here.

2014-11-16  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-mode): Avoid use of set-local to
	keep Emacs 24.x compatibility.

2014-11-16  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr): Move to the new defgroup `web'.

	* net/eww.el (eww): Ditto.

	* simple.el (execute-extended-command): Don't show the help
	message if the binding isn't significantly shorter than the
	M-x command the user typed (bug#19013).

2014-11-16  Ulf Jasper  <ulf.jasper@web.de>

	* calendar/icalendar.el (icalendar--convert-tz-offset):
	Return complete cons when offsets of standard time and daylight saving
	time are equal.
	(icalendar-export-region): Fix unbound variable warning.

2014-11-16  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (run-python): Allow CMD to be optional and
	default it to a safe command, even for Windows.  (bug#18596)

2014-11-16  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-calculate-command):
	Rename from python-shell-parse-command.  Cleanup.
	(run-python, run-python-internal): Use it.
	(python-shell-calculate-pythonpath): Rename from
	python-new-pythonpath.
	(python-shell-calculate-process-environment): Use it.
	(python-shell-calculate-exec-path): Add comment.

2014-11-16  Thierry Banel  <tbanelwebmin@free.fr>  (tiny change)

	* calc/calc-arith.el (math-max-list, math-min-list): Fix bug
	for date handling.

2014-11-16  Andreas Schwab  <schwab@linux-m68k.org>

	* version.el (emacs-repository-get-version): Use git rev-parse
	instead of git log.

2014-11-16  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-calculate-levels):
	Fix indentation behavior multiline dedenter statement.  (Bug#18432)

2014-11-16  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-region):
	Use python-indent-line and skip special cases.  (Bug#18843)

2014-11-16  Peder O. Klingenberg  <peder@klingenberg.no>

	* mail/emacsbug.el (report-emacs-bug): Make a better guess at
	  envelope-from when reporting through sendmail (bug#19054).

2014-11-16  Oscar Fuentes  <ofv@wanadoo.es>

	Add faces for the VC modeline state indicator.
	* vc/vc-hooks.el:
	(vc-state-faces, vc-state-base-face)
	(vc-up-to-date-state, vc-needs-update-state)
	(vc-locked-state, vc-locally-added-state)
	(vc-conflict-state, vc-removed-state)
	(vc-missing-state, vc-edited-state):
	New faces.
	(vc-default-mode-line-string): Use them

2014-11-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/backquote.el (backquote-process): Optimize away ",'".

2014-11-15  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-search-words): Mention `eww-search-prefix'.

2014-11-15  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-eldoc-setup-code): Enhance string
	type checks, simplify printing.  (Bug#18962)

2014-11-14  Ivan Andrus  <darthandrus@gmail.com>

	* progmodes/python.el (python-shell-font-lock-kill-buffer):
	(python-shell-font-lock-with-font-lock-buffer)
	(python-shell-get-buffer, python-ffap-module-path):
	Use `derived-mode-p' instead of equality test on `major-mode'.

2014-11-14  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-virtualenv-root): Rename from
	python-shell-virtualenv-path.
	(python-shell-internal-get-process-name)
	(python-shell-calculate-process-environment)
	(python-shell-calculate-exec-path): Use it.

2014-11-14  Eli Zaretskii  <eliz@gnu.org>

	* bindings.el (search-map): Fix last change: don't use 'kbd' in
	bindings.el, since it is not yet loaded when bindings.el is
	preloaded.

2014-11-14  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-completion-get-completions):
	Fix previous merge.

2014-11-14  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-render): Don't set the title to the URL.

2014-11-13  Ulrich Müller  <ulm@gentoo.org>

	* version.el (emacs-repository-get-version): Call `git log'
	command with proper format argument (bug#19049).

2014-11-14  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* bindings.el (search-map): Bind M-s M-s to `eww-search-words'.

2014-11-14  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-search-words): New command (bug#16258).

2014-11-13  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-inhibit-images): Add a doc string.

	* net/eww.el (eww-after-render-hook): New variable.
	(eww-render): Use it.

	* net/shr.el (shr-descend): Don't descend further than
	`max-specpdl-size' allows (bug#16587).
	(shr-depth): New variable.
	(shr-warning): New variable.

2014-11-13  Ivan Shmakov  <ivan@siamics.net>

	* net/shr.el (shr-parse-base): Handle <base href=""> correctly.
	(shr-expand-url): Expand absolute URLs correctly (bug#17958).

2014-11-13  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww): Add comment to clarify.

	* net/shr.el (shr-parse-image-data): Remove blocked bits from
	external SVG images.
	(shr-tag-object): Display images in <object> forms (bug#16244).
	(shr-tag-table): Also insert <objects> after the tables.

2014-11-13  Michael Albinus  <michael.albinus@gmx.de>

	* vc/vc-hg.el (vc-hg-state): Disable pager.  (Bug#18940)

2014-11-13  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-form-file): Fix version number.

2014-11-10  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-form-file): :type isn't a valid `defface' keyword.

2014-11-10  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el(eww-form-file(defface)): New defface of file upload form.
	(eww-submit-file): New key map of file upload.
	(eww-form-file): New file upload button and file name context.
	(eww-select-file): Select file and display selected file name.
	(eww-tag-input): Handle input tag of file type.
	(eww-update-field): Add point offset.
	(eww-submit): Add submit with multipart/form-data.

2014-11-10  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-render, eww-display-html, eww-setup-buffer):
	Allow taking a buffer to render data in.  This allows using several
	eww buffers (bug#16211).

2014-11-10  Charles Rendleman  <carendle@gmail.com>  (tiny change)

	* net/eww.el (eww-download-callback): Save only the file contents,
	not the headers.

2014-11-10  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-data): New plist to store all the data relevant
	to a single page, used throughout the file instead of the
	variables `eww-current-url', `eww-current-dom',
	`eww-current-source', and `eww-current-title'.
	(eww-readable): Copy over pertinent data from the parent page.
	(eww-save-history): Don't let the history grow infinitely.

	* net/eww.el: Remove `eww-next-url', `eww-previous-url',
	`eww-up-url', `eww-home-url', `eww-start-url' and
	`eww-contents-url' and put the data into the `eww-data' plist.
	This allow restoring these values after going back in the history.

2014-11-10  Sylvain Chouleur  <sylvain.chouleur@gmail.com>  (tiny change)

	Allow VTIMEZONE where daylight and standard time zones are equal.
	See: https://lists.gnu.org/archive/html/emacs-devel/2014-11/msg00494.html
	* calendar/icalendar.el (icalendar--convert-tz-offset):
	Support timezone without daylight saving time.

2014-11-10  Glenn Morris  <rgm@gnu.org>

	* startup.el (command-line): Handle nil elements in load-path.

2014-11-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help.el (view-lossage): Include the actual commands run.

2014-11-10  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-dir.el (vc-dir-hide-state): Also hide `ignored' items when
	no state is specified.  (Bug#18964)

2014-11-09  Eric Ludlam  <zappo@gnu.org>

	* emacs-lisp/eieio-custom.el (eieio-customize-object):
	Set eieio-cog (current group) to g, which is an improved form of input
	group.

2014-11-09  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-message-prefix): Show "Multi-file" and
	"Multi-buffer" instead of "Multi".  (Bug#13592)

	* misearch.el (multi-isearch-file-list):
	Autoload multi-isearch-buffer-list and multi-isearch-file-list.
	(multi-isearch-end): Reset multi-isearch-buffer-list and
	multi-isearch-file-list to nil.

2014-11-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/bytecomp.el (byte-compile-initial-macro-environment):
	Don't call byte-compile-preprocess since the result will go through
	cconv.
	(byte-compile-output-docform): Handle uninterned `name' correctly.
	* emacs-lisp/cl-macs.el (cl-define-compiler-macro): Use interned name
	to circumvent byte-compiler bug.

	* emacs-lisp/macroexp.el (macroexp--expand-all): Fix typo.
	(macroexp--compiler-macro): Remove left-over debug code.

	* emacs-lisp/cl-extra.el (cl-get): Silence compiler warning.

2014-11-08  Juri Linkov  <juri@jurta.org>

	* simple.el (shell-command): Use buffer-name when output-buffer is
	a buffer.  (Bug#18096)

2014-11-08  Juri Linkov  <juri@jurta.org>

	* minibuffer.el (minibuffer-completion-help): Compare this-command
	with completion-at-point.  (Bug#17809)

2014-11-08  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-report-error):
	Allow the argument to be a string.  Due to the vague doc,
	it was already being used this way.

2014-11-08  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-check-cached-permissions): Include hop in
	the constructed Tramp file name.  (Bug#18943)

2014-11-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emulation/cua-base.el (cua--select-keymaps): Use region-active-p
	(bug#18952).
	(cua-set-mark, cua--post-command-handler-1):
	* emulation/cua-gmrk.el (cua-cancel-global-mark): Same.

2014-11-08  Michael Albinus  <michael.albinus@gmx.de>

	* files.el (file-name-non-special): Wrap the call of
	`insert-file-contents' by `unwind-protect', in order to set the
	buffer's file name anyway.  (Bug#18891)

2014-11-08  Alan Mackenzie  <acm@muc.de>

	Fix wrong bound to c-font-lock-declarators.
	* progmodes/cc-fonts.el (c-font-lock-declarations):
	Pass "(point-max)" as bound to c-font-lock-declarators, not "limit", as
	the buffer is sometimes narrowed to less than "limit" (e.g., in
	the presence of macros).  (Bug#18948)

2014-11-08  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-error-with-buffer): Show connection buffer
	only when message appeared in minibuffer.  (Bug#18891)

	* net/tramp-adb.el (tramp-adb-handle-file-attributes):
	* net/tramp-gvfs.el (tramp-gvfs-handle-file-attributes):
	* net/tramp-sh.el (tramp-sh-handle-file-attributes): Return nil in
	case of errors.

2014-11-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/bytecomp.el (byte-compile-initial-macro-environment):
	Don't compile before eval in `eval-and-compile'.
	(byte-compile-arglist-warn): Add check for defining macros after their
	first use.  Check call use even if the function is fboundp.

2014-11-08  Richard Stallman  <rms@gnu.org>

	* mail/rmail.el (rmail-epa-decrypt): Detect armor with line prefixes.
	Check more carefully for mime-part specified character set.
	Check for mime-part Content Transfer Encoding.
	Notify if no armor found.

2014-11-08  Martin Rudalics  <rudalics@gmx.at>

	* faces.el (face-set-after-frame-default): Enable running
	`window-configuration-change-hook'.

2014-11-07  Juri Linkov  <juri@jurta.org>

	* replace.el: History for query replace pairs.
	(query-replace-defaults): Promote to a list of cons cell.  Doc fix.
	(query-replace-from-to-separator): New variable.
	(query-replace-read-from): Let-bind query-replace-from-to-history
	to a list of FROM-TO strings created from query-replace-defaults
	and separated by query-replace-from-to-separator.  Use it as
	the history while reading from the minibuffer.  Split the returned
	string by the separator to get FROM and TO parts, and add them
	to the history variables.
	(query-replace-read-to): Add FROM-TO pairs to query-replace-defaults.
	(query-replace-regexp-eval): Let-bind query-replace-defaults to nil.
	https://lists.gnu.org/archive/html/emacs-devel/2014-11/msg00253.html

	* isearch.el (isearch-text-char-description): Keep characters
	intact and put formatted strings with the `display' property.

2014-11-07  Martin Rudalics  <rudalics@gmx.at>

	* cus-start.el (frame-resize-pixelwise): Fix group.
	(frame-inhibit-implied-resize): Add entry.

2014-11-07  Daiki Ueno  <ueno@gnu.org>

	* epa.el (epa-pinentry-mode): New user option.
	(epa-sign-file, epa-encrypt-file, epa-decrypt-region)
	(epa-sign-region, epa-encrypt-region): Respect epa-pinentry-mode.
	* epa-file.el (epa-file-insert-file-contents)
	(epa-file-write-region): Respect epa-pinentry-mode.

2014-11-07  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg--list-keys-1): Ignore fields after the 15th field
	(bug#18979).  Reported by Hideki Saito.

2014-11-06  Daiki Ueno  <ueno@gnu.org>

	* emacs-lisp/package.el (package--display-verify-error): New function.
	(package--check-signature): Use it to display output sent to stderr.

2014-11-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (pop): Don't call the getter twice (bug#18968).

	* emacs-lisp/macroexp.el (macroexp--expand-all): Optimize away trivial
	uses of `funcall'.

2014-11-06  Daiki Ueno  <ueno@gnu.org>

	* epa.el (epa-error-buffer): New variable.
	(epa-display-error): New function.
	(epa-decrypt-file, epa-verify-file, epa-verify-region)
	(epa-delete-keys, epa-import-keys): Display output sent to stderr.
	(epa-sign-file, epa-sign-region, epa-encrypt-region)
	(epa-export-keys, epa-insert-keys): Display output sent to stderr.
	Use setf instead of epg-context-set-*.
	* epa-file.el (epa-file-insert-file-contents):
	Use epa-display-error instead of epa-display-info.  Mimic the behavior
	of jka-compr when decryption program is not found.
	(epa-file-write-region): Use epa-display-error instead of
	epa-display-info.

2014-11-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc.el (vc-region-history): New command.
	(vc-print-log-internal): Use cl-some.

	* vc/vc-git.el (vc-git-region-history): New function.
	(vc-git-region-history-mode-map)
	(vc-git--log-view-long-font-lock-keywords)
	(vc-git-region-history-font-lock-keywords): New vars.
	(vc-git-region-history-font-lock): New function.
	(vc-git-region-history-mode): New major mode.

2014-11-05  Tassilo Horn  <tsdh@gnu.org>

	* net/eww.el (subr-x): Require subr-x at compile-time because eww
	uses string-trim.

2014-11-05  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-context): Add new slot ERROR-OUTPUT.
	(epg-error-output): New buffer-local variable.
	(epg--start): Initialize epg-error-output.
	(epg--process-filter): Record output lines sent to stderr, in
	epg-error-output.
	(epg-wait-for-completion): Copy epg-error-output to ERROR-OUTPUT
	slot of context.
	* epa-file.el (epa-file-insert-file-contents): On error, display
	output sent to stderr.
	(epa-file-write-region): Likewise.

2014-11-05  Eli Zaretskii  <eliz@gnu.org>

	* jit-lock.el (jit-lock-stealth-fontify): Be tolerant to nil being
	returned by load-average.

2014-11-05  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-via-buffer): Don't use
	a local copy; setting `inhibit-file-name-handlers' proper might be
	more performant.  (Bug#18751)

2014-11-05  Glenn Morris  <rgm@gnu.org>

	* mail/emacsbug.el (report-emacs-bug): No longer include
	recent-keys in the report.  (Bug#18900)

2014-11-04  Paul Eggert  <eggert@cs.ucla.edu>

	* mouse.el (mouse-drag-line): Fix misspelling of "right-fringe".

2014-11-04  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/eww.el (eww): Trim URL with `string-trim'.
	Suggested by Vibhav Pant <vibhavp@gmail.com>.

2014-11-03  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-score-readability): Don't count comments positively.

	* net/shr.el (shr-retransform-dom): Typo fix.

	* net/eww.el (eww-score-readability): Parse SVC images correctly.
	(eww-display-html): Don't leave point inside forms.

	* net/shr.el: Ditto.

2014-11-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-safe-prin1-to-string): Assume that
	edebug-prin1-to-string already handles circularity.

	* emacs-lisp/byte-run.el (defun-declarations-alist): Fix compiler-macro
	autoloading when specified as a lambda.

	* simple.el (execute-extended-command--last-typed): New var.
	(read-extended-command): Set it.
	Don't complete obsolete commands.
	(execute-extended-command--shorter-1)
	(execute-extended-command--shorter): New functions.
	(execute-extended-command): Use them to suggest shorter names.
	(indicate-copied-region, deactivate-mark): Use region-active-p.

2014-11-03  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-via-buffer): Use a
	local copy of FILENAME, when it is remote.  (Bug#18751)

	* net/tramp-adb.el (tramp-adb-handle-process-file): Do not raise
	an error when the command fails; the return code must indicate.
	(tramp-adb-send-command-and-check): Fix docstring.

2014-11-03  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-retransform-dom): Don't ignore elements that
	have no children like <br />.

	* net/eww.el (eww-display-html): Clear `url-queue'.
	(eww-display-pdf): New function.
	(eww-render): Display PDFs with `doc-view'.
	(url-queue): Require `url-queue' to avoid compilation warning.
	(eww-colorize-region): Remove duplicate function.
	(eww-tag-body): Use `shr-colorize-region'.

2014-11-03  Yoni Rabkin <yrk@gnu.org>

	* net/eww.el (eww-list-bookmarks): Autoload.

2014-11-03  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-retransform-dom): Allow several text sub-nodes.

	* net/eww.el (eww-display-html): The charset is called `utf-8',
	not `utf8'.
	(eww-readable): Decode the saved text correctly.
	(eww-readable): Save the history before displaying so that we can
	go back to the non-readable version.
	(eww-display-html): Don't try to decode the text if we've been
	passed in a pre-parsed DOM.
	(eww-tag-title): Remove newlines and extra whitespace from the
	displayed title.

2014-11-02  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-readable): New command and keystroke.

	* net/shr.el (shr-retransform-dom): New function.

	* net/eww.el (eww-display-html): Set `eww-current-source' in the
	correct buffer.
	(eww-view-source): Use it.

2014-11-02  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww): Recognize colon-delimited IPv6 addresses.
	(Bug#18603).

2014-11-02  Brian McKenna  <brian@brianmckenna.org>  (tiny change)

	* net/eww.el (eww-submit): Encode empty form values as "".  (Bug#17785).

2014-11-02  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww): Allow "file:/file/name" URLs.  (Bug#18825).

2014-11-02  Ivan Shmakov  <ivan@siamics.net>

	* net/eww.el (eww-mode-map): Remove mentions of `eww-quit'.
	(Bug#18834).

2014-11-02  Eric Abrahamsen  <eric@ericabrahamsen.net>

	* emacs-lisp/eieio.el (eieio-edebug-prin1-to-string): Adjust for
	use as advice.
	(edebug-setup-hook): Advise `edebug-prin1-to-string'.  (Bug#18897)

2014-11-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/pp.el (pp-macroexpand-expression): Use macroexpand-1
	(bug#18821).
	* progmodes/elisp-mode.el (emacs-lisp-macroexpand): Idem.

2014-11-01  Michael R. Mauger  <michael@mauger.com>

	* progmodes/sql.el (sql-mode-oracle-font-lock-keywords): Correct regexp
	syntax, add new keywords, and parse longer keywords first.
	(sql-redirect-one): Protect against empty command.
	(sql-mode, sql-interactive-mode): Set `custom-mode-group' property
	to SQL.  (Bug#14759)

2014-11-01  Michael R. Mauger  <michael@mauger.com>

	* progmodes/sql.el (sql-interactive-mode, sql-stop): Correct fix for
	Bug#16814 with let-bind of comint-input-ring variables around read
	and save functions.

2014-11-01  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cache.el (tramp-get-file-property)
	(tramp-set-file-property): Check that `tramp-cache-get-count-*'
	and `tramp-cache-set-count-*' are bound.  Otherwise, there might
	be compiler warnings.

	* net/tramp-sh.el (tramp-get-remote-uid, tramp-get-remote-gid):
	Return -1 respective "UNKNOWN", if uid or gid cannot be determined.

2014-11-01  Eli Zaretskii  <eliz@gnu.org>

	* progmodes/compile.el (compilation-mode): Turn off deferred
	fontifications locally.  (Bug#18856)

2014-11-01  Wolfgang Jenkner  <wjenkner@inode.at>

	* net/tramp-sh.el (tramp-send-command): Fix the case where the
	remote-echo connection property is non-nil (bug#18858).

2014-11-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (newline): Add assertions to try and help catch bug#18913.

	* emulation/cua-base.el (cua-delete-region): Use delete-active-region
	(bug#18886).
	(cua--last-deleted-region-pos, cua--last-deleted-region-text): Remove.

2014-11-01  Kim F. Storm  <storm@cua.dk>

	Restore cua-delete-copy-to-register-0 and M-v command (bug#18886).
	* delsel.el (delete-selection-save-to-register)
	(delsel--replace-text-or-position): New vars.
	(delete-active-region): Use them.
	(delete-selection-repeat-replace-region): New command, moved from
	cua-base.el.
	* emulation/cua-base.el (cua--repeat-replace-text): Remove var.
	(cua-repeat-replace-region): Move command to delsel.el.
	(cua--init-keymaps): Update binding accordingly.
	(cua-mode): Set delete-selection-save-to-register.

2014-11-01  Alan Mackenzie  <acm@muc.de>

	Make blink-parens work with a closing template delimiter.
	* progmodes/cc-cmds.el (c-electric-lt-gt): Cause a redisplay
	before calling blink-paren-function, so as to apply syntax-table
	properties to the ">".

2014-11-01  Jan Djärv  <jan.h.d@swipnet.se>

	* select.el (gui-get-selection): Comment: data-type ignored on NS.

2014-10-31  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/macroexp.el (macroexpand-1): New function (bug#18821).
	(macroexp--expand-all): Unrelated tweaks.

	* emacs-lisp/gv.el (gv-get): Use macroexpand-1.

2014-10-30  Glenn Morris  <rgm@gnu.org>

	* startup.el (command-line): Remove pointless attempt to avoid
	statting the file-system (which expand-file-name doesn't do).

2014-10-30  Daniel Colascione  <dancol@dancol.org>

	Add "enum class" support to C++ mode.
	* progmodes/cc-langs.el (c-after-brace-list-decl-kwds)
	(c-after-brace-list-key): New language consts/variables.
	* progmodes/cc-engine.el (c-looking-at-decl-block):
	Exclude spurious match of "enum struct" from decl-block recognition.
	(c-backward-colon-prefixed-type): New function.
	(c-backward-over-enum-header): Call above function to extend
	recognition of enum structure.

2014-10-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/cc-defs.el (c--macroexpand-all): New function (bug#18845).
	(c-lang-defconst):
	* progmodes/cc-langs.el (c-make-init-lang-vars-fun): Use it.

2014-10-30  Eli Zaretskii  <eliz@gnu.org>

	* progmodes/compile.el (compilation-start):
	If compilation-scroll-output is non-nil, don't force window-start of
	the compilation buffer to be at beginning of buffer.  (Bug#18874)

	* startup.el (fancy-about-text): Read the entire tutorial, not
	just its first 256 bytes.  (Bug#18760)

2014-10-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/bytecomp.el: Require cl-extra (bug#18804).
	* emacs-lisp/cl-extra.el: Add missing provide.

	* emacs-lisp/bytecomp.el (byte-compile-and-folded): Optimize case where
	all args are copyable (bug#18767).
	(=, <, >, <=, >=): Re-enable the optimization.

2014-10-29  Glenn Morris  <rgm@gnu.org>

	* net/rcirc.el (rcirc-fill-column): Unbump :version.  Mark :risky.

	* version.el (emacs-bzr-version, emacs-bzr-get-version):
	Revert 2014-10-26 change.

2014-10-29  Paul Eggert  <eggert@cs.ucla.edu>

	Simplify use of current-time and friends.
	* allout-widgets.el (allout-widgets-hook-error-handler):
	* calendar/appt.el (appt-display-message):
	* calendar/icalendar.el (icalendar--convert-float-to-ical):
	* calendar/timeclock.el (timeclock-in, timeclock-when-to-leave)
	(timeclock-last-period, timeclock-day-base):
	* eshell/em-ls.el (eshell-ls-file):
	* eshell/esh-util.el (eshell-parse-ange-ls):
	* generic-x.el (named-database-print-serial):
	* net/newst-backend.el (newsticker--get-news-by-url-callback)
	(newsticker-get-news, newsticker--sentinel-work)
	(newsticker--image-get, newsticker--image-sentinel):
	* net/tramp-sh.el (tramp-get-remote-touch):
	* progmodes/opascal.el (opascal-debug-log):
	* textmodes/remember.el (remember-mail-date)
	(remember-store-in-files):
	* vc/vc-annotate.el (vc-annotate-display-autoscale)
	(vc-default-annotate-current-time):
	* vc/vc-bzr.el (vc-bzr-shelve-snapshot):
	* vc/vc-cvs.el (vc-cvs-annotate-current-time):
	* vc/vc-rcs.el (vc-rcs-annotate-current-time):
	Omit unnecessary call to current-time.
	* calendar/time-date.el (time-to-seconds) [!float-time]:
	* vc/vc-annotate.el (vc-annotate-convert-time):
	Use current time if arg is nil, to be compatible with float-time.
	(time-date--day-in-year): New function, with most of the guts of
	the old time-to-day-in-year.
	(time-to-day-in-year): Use it.
	(time-to-days): Use it, to avoid decoding the same time stamp twice.
	* calendar/timeclock.el (timeclock-time-to-date):
	Arg is now optional, like current-time-string.
	(timeclock-update-mode-line):
	Don't call current-time twice to get the current time stamp,
	as this can lead to inconsistent results.
	* completion.el (cmpl-hours-since-origin):
	* ido.el (ido-time-stamp):
	* vc/vc-annotate.el (vc-annotate-convert-time):
	Simplify by using float-time.
	* completion.el (save-completions-to-file):
	Rename local var to avoid confusion.
	* net/rcirc.el (rcirc-float-time): Simplify to an alias because
	time-to-seconds now behaves like float-time with respect to nil arg.
	* subr.el (progress-reporter-do-update):
	Don't call float-time unless needed.

2014-10-29  Leo Liu  <sdl.web@gmail.com>

	* net/rcirc.el (rcirc-fill-column): Use function.
	(rcirc-markup-fill): Remove adjustment.

2014-10-28  Christopher Schmidt  <ch@ristopher.com>

	* calc/calc.el (quick-calc):
	* calc/calc-aent.el (calc-do-quick-calc): New argument INSERT.

2014-10-28  Sam Steingold  <sds@gnu.org>

	* net/rcirc.el (rcirc-fill-column): Allow any symbolic value for
	the sake of `window-body-width' (in addition to `frame-width').

2014-10-26  Eric S. Raymond  <esr@thyrsus.com>

	* version.el: Fix some fallback values to conform to the actual
	release number.

2014-10-25  Eric S. Raymond  <esr@thyrsus.com>

	* Makefile.in: Change some production names so they're neutral
	about the repository type.

2014-10-25  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-gvfs.el (tramp-gvfs-methods-mounttracker)
	(tramp-gvfs-mountlocation-signature): Check `tramp-gvfs-enabled'
	during initialization.  (Bug#18774)

2014-10-25  Vincent Belaïche  <vincentb1@users.sourceforge.net>

	* ses.el (macroexp): Add require for this package, so that
	function `ses--cell' gets macroexp-quote --- this change was
	supposed to be in my previous commit, but left out by mistake.
	(ses--cell): Do not make formula a macroexp-quote of value when
	value, not formula, is *skip*.

2014-10-24  Vincent Belaïche  <vincentb1@users.sourceforge.net>

	* ses.el (macroexp): Add require for this package, so that function
	`ses--cell gets macroexp-quote.
	(ses--cell): Makes formula a macroexp-quote of value when formula
	is nil.  The rationale of this changr is to allow in the future
	shorter SES files, e.g. we could have only `(ses-cell A1 1.0)'
	instead of `(ses-cell A1 1.0 1.0 nil REFLIST)'.  In such a case
	reference list REFLIST would be re-computed after load --- thus
	trading off load time against file size.

	* emacs-lisp/package.el (package--alist-to-plist-args):
	Use macroexp-quote instead of a lambda expression which has the same
	content as macroexp-quote.
	(macroexp): Add require for this package, so that function
	`package--alist-to-plist-args' gets macroexp-quote.

	* emacs-lisp/macroexp.el (macroexp-quote): New defun.

2014-10-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* term/ns-win.el (ns-store-cut-buffer-internal)
	(ns-copy-including-secondary): Use gui-set-selection (bug#18816).

2014-10-24  Martin Rudalics  <rudalics@gmx.at>

	* mouse.el (mouse-drag-line): Don't use mouse-pixel-position.
	Calculate increment from last position instead of window edge.
	Add right- and bottom-divider bindings to transient map.

2014-10-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl-defstruct): Define an internal predicate
	even if :predicate was nil, for the benefit of typep.
	Record the name of the predicate for typep's use.
	(cl--make-type-test): Use pcase.  Obey new
	cl-deftype-satisfies property.

	* epg.el: Use cl-defstruct.
	(epg-make-data-from-file, epg-make-data-from-string, epg-data-file)
	(epg-data-string): Define via cl-defstruct.
	(epg--gv-nreverse): New macro.
	(epg-context--make): New constructor (provided vi cl-defstruct).
	(epg-make-context): Rewrite using it.
	(epg-context-protocol, epg-context-program)
	(epg-context-home-directory, epg-context-armor, epg-context-textmode)
	(epg-context-include-certs, epg-context-cipher-algorithm)
	(epg-context-digest-algorithm, epg-context-compress-algorithm)
	(epg-context-passphrase-callback, epg-context-progress-callback)
	(epg-context-signers, epg-context-sig-notations, epg-context-process)
	(epg-context-output-file, epg-context-result, epg-context-operation)
	(epg-context-pinentry-mode): Define using cl-defstruct.
	(epg-context-set-protocol, epg-context-set-program)
	(epg-context-set-include-certs, epg-context-set-cipher-algorithm)
	(epg-context-set-digest-algorithm)
	(epg-context-set-sig-notations, epg-context-set-process)
	(epg-context-set-output-file, epg-context-set-result)
	(epg-context-set-operation, epg-context-set-pinentry-mode)
	(epg-context-set-compress-algorithm): Remove.  Use setf instead.
	(epg-context-set-armor, epg-context-set-textmode)
	(epg-context-set-signers): Redefine using setf
	and declare as obsolete.
	(epg-context-set-passphrase-callback)
	(epg-context-set-progress-callback): Use setf.
	(epg-signature-notations): Rename from epg-sig-notations.
	(epg-make-signature, epg-signature-status, epg-signature-key-id)
	(epg-signature-validity, epg-signature-fingerprint)
	(epg-signature-creation-time, epg-signature-expiration-time)
	(epg-signature-pubkey-algorithm, epg-signature-digest-algorithm)
	(epg-signature-class, epg-signature-version): Define vi cl-defstruct.
	(epg-signature-set-status, epg-signature-set-key-id)
	(epg-signature-set-validity, epg-signature-set-fingerprint)
	(epg-signature-set-creation-time, epg-signature-set-expiration-time)
	(epg-signature-set-pubkey-algorithm)
	(epg-signature-set-digest-algorithm, epg-signature-set-class)
	(epg-signature-set-version, epg-signature-set-notations): Remove.
	Use setf instead.
	(epg-make-new-signature, epg-new-signature-type)
	(epg-new-signature-pubkey-algorithm)
	(epg-new-signature-digest-algorithm, epg-new-signature-class)
	(epg-new-signature-creation-time, epg-new-signature-fingerprint):
	Define using cl-defstruct.
	(epg-make-key, epg-key-owner-trust, epg-key-sub-key-list)
	(epg-key-user-id-list): Define using cl-defstruct.
	(epg-key-set-sub-key-list, epg-key-set-user-id-list): Remove.
	Use setf instead.
	(epg-make-sub-key, epg-sub-key-validity, epg-sub-key-capability)
	(epg-sub-key-secret-p, epg-sub-key-algorithm, epg-sub-key-length)
	(epg-sub-key-id, epg-sub-key-creation-time)
	(epg-sub-key-expiration-time, epg-sub-key-fingerprint): Define using
	cl-defstruct.
	(epg-sub-key-set-fingerprint): Remove.  Use setf instead.
	(epg-make-user-id, epg-user-id-validity, epg-user-id-string)
	(epg-user-id-signature-list): Define using cl-defstruct.
	(epg-user-id-set-signature-list): Remove.  Use setf instead.
	(epg-make-key-signature, epg-key-signature-validity)
	(epg-key-signature-pubkey-algorithm, epg-key-signature-key-id)
	(epg-key-signature-creation-time, epg-key-signature-expiration-time)
	(epg-key-signature-user-id, epg-key-signature-class)
	(epg-key-signature-exportable-p): Define using cl-defstruct.
	(epg-make-sig-notation, epg-sig-notation-name)
	(epg-sig-notation-value, epg-sig-notation-human-readable)
	(epg-sig-notation-critical): Define using cl-defstruct.
	(epg-sig-notation-set-value): Remove.  Use setf instead.
	(epg-make-import-status, epg-import-status-fingerprint)
	(epg-import-status-reason, epg-import-status-new)
	(epg-import-status-user-id, epg-import-status-signature)
	(epg-import-status-sub-key, epg-import-status-secret): Define using
	cl-defstruct.
	(epg-make-import-result, epg-import-result-considered)
	(epg-import-result-no-user-id, epg-import-result-imported)
	(epg-import-result-imported-rsa, epg-import-result-unchanged)
	(epg-import-result-new-user-ids, epg-import-result-new-sub-keys)
	(epg-import-result-new-signatures, epg-import-result-new-revocations)
	(epg-import-result-secret-read, epg-import-result-secret-imported)
	(epg-import-result-secret-unchanged, epg-import-result-not-imported)
	(epg-import-result-imports): Define using cl-defstruct.

	* emacs-lisp/package.el: Require EPG during macroexpansion.
	(package--check-signature, package-import-keyring): Use setf instead of
	epg-context-set-home-directory.

2014-10-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/bytecomp.el (byte-compile--use-old-handlers): Change default.

2014-10-23  Leo Liu  <sdl.web@gmail.com>

	* progmodes/cfengine.el (cfengine3-defun-full-re): New var.
	(cfengine3-create-imenu-index): Use it and use ` ' for separation.
	(cfengine3-current-defun): New function.
	(cfengine3-mode): Set add-log-current-defun-function.

2014-10-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* select.el: Use lexical-binding.
	(gui-set-selection): Provide an implementation for non-GUI frames
	(bug#18791).
	* term/x-win.el: Use lexical-binding.
	(x-clipboard-yank): Fix up missed renamings.
	* term/w32-win.el (libgif-version, libjpeg-version): Silence compiler.
	(w32--set-selection): Fix up var names.
	* term/pc-win.el: Use lexical-binding.
	(w16-selection-exists-p): Silence compiler warning.
	(w16-selection-owner-p): Fix up missed renamings.

	* emacs-lisp/bytecomp.el (byte-compile-form): Remove left-over debug.

	* frame.el (frame-notice-user-settings): Fix excessive quoting.

2014-10-22  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el (doc-view-open-text): View the document's plain text
	in the current buffer instead of a new one.
	(doc-view-toggle-display): Handle the case where the current
	buffer contains the plain text contents of the document.
	(doc-view-initiate-display): Don't switch to fallback mode if the
	user wants to view the doc's plain text.
	(doc-view-set-doc-type): Use assoc-string instead of
	assoc-ignore-case.

2014-10-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (read-key): Fix clicks on the mode-line.
	(set-transient-map): Return exit function.

	* mouse.el (mouse-drag-line): Use set-transient-map (bug#18015).
	(mouse--down-1-maybe-follows-link): Remove unused var `this-event'.
	(mouse-yank-secondary): Use gui-get-selection.
	(mouse--down-1-maybe-follows-link): Use read-key.

	* xt-mouse.el: Add `event-kind' property on the fly from
	xterm-mouse-translate-1 rather than statically at the outset.

2014-10-21  Daniel Colascione  <dancol@dancol.org>

	* vc/vc-dispatcher.el (vc-resynch-window): Tell view-mode not to
	change window configuration when we turn it off.

2014-10-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	Get rid of backend-dependent selection-handling functions for kill/yank
	and make it generic instead by relying on the lower-level selection
	management functions.

	* select.el (select-enable-clipboard): Rename from
	gui-select-enable-clipboard.
	(select-enable-primary): Move from x-win.el and rename from
	x-select-enable-primary.
	(gui-last-selected-text): Remove.
	(gui--last-selected-text-clipboard, gui--last-selected-text-primary):
	New vars.
	(gui-select-text): Rewrite, based on x-win.el's old x-select-text.
	(gui-select-text-alist, gui-selection-value-alist): Remove.
	(x-select-request-type): Move from x-win.el.
	(gui--selection-value-internal): New function, taken from x-win's
	x-selection-value-internal.
	(gui-selection-value): Rewrite, based on x-win.el's old x-selection-value.
	(gui-set-selection-alist): Rename from gui-own-selection-alist and
	extend it to handle a nil value as a "disown" request.
	(gui-disown-selection-alist): Remove.
	(xselect-convert-to-delete): Adjust accordingly.
	(gui-set-selection): Simplify accordingly as well.  Use dotimes.

	* term/x-win.el (x-last-selected-text-primary)
	(x-select-enable-primary): Remove (moved to select.el).
	(x-select-request-type): Move to select.el.
	(x-selection-value-internal, x--selection-value): Remove functions.
	(gui-selection-value, gui-select-text): Remove moethods.
	(gui-set-selection): Merge own and disown methods.

	* term/w32-win.el (w32--select-text, w32--get-selection-value):
	Delete function (move functionality into w32--set-selection and
	w32--get-selection).
	(gui-select-text, gui-selection-value): Don't define methods.
	(w32--set-selection, w32--get-selection, w32--selection-owner-p):
	New functions.
	(gui-get-selection, gui-selection-owner-p, gui-selection-exists-p):
	Use them.
	(gui-selection-exists-p): Adjust to new name of C primitive.

	* term/pc-win.el (w16-get-selection-value): Add dummy argument and drop
	test of gui-select-enable-clipboard, to make it usable as
	a gui-get-selection method.
	(gui-selection-exists-p): Adjust to new name of C primitive.
	(gui-set-selection): Merge own and disown methods.
	(gui-select-text, gui-selection-value): Delete methods.
	(w16--select-text): Delete function.

	* term/ns-win.el (ns-get-pasteboard, ns-set-pasteboard)
	(ns-selection-value): Remove functions.
	(gui-select-text, gui-selection-value): Don't define method any more.
	(gui-set-selection): Merge the old own and disown methods.
	(gui-selection-exists-p, gui-get-selection): Adjust to new name of
	underlying C primitive.

	* startup.el (command-line): Adjust now that `gui-method' expects nil
	for ttys.

	* frame.el (gui-method): Use window-system rather than framep.
	(gui-method-declare): The tty case is now nil rather than t.
	(make-frame): Adjust accordingly.

2014-10-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* net/newst-reader.el (newsticker--image-read): Simplify.
	(newsticker--icon-read): Use dolist and fix free var error.

	* imenu.el (imenu--menubar-keymap): New var.
	(imenu-add-to-menubar): Set it to remember the keymap we used.
	(imenu-update-menubar): Use it instead of asking lookup-key.

	* obsolete/cc-compat.el: Make obsolete (bug#18561).

	* epg-config.el (epg-gpg-program): Don't use absolute names by default.

	* emacs-lisp/bytecomp.el (=, <, >, <=, >=): Don't optimize multi-arg
	case (bug#18767).

2014-10-21  Glenn Morris  <rgm@gnu.org>

	* Merge in all changes up to version 24.4 release.

2014-10-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/bytecomp.el (=, <, >, <=, >=): Don't optimize multi-arg
	case (bug#18767).

2014-10-20  Glenn Morris  <rgm@gnu.org>

	* Merge in all changes up to 24.4 release.

2014-10-20  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-backend.el
	(newsticker--image-download-by-url-callback): Make this function
	actually work: Check status properly, then save image.

2014-10-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el (mouse--down-1-maybe-follows-link): Remove unused var
	`this-event'.
	(mouse-drag-line): Unless there's no actual mouse, use the event's
	position info.

2014-10-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/css-mode.el (scss-mode): New major-mode.
	(css-mode-syntax-table): Use d style comment, to ease the scss case.
	(css-ident-re): Allow things like @-moz-keyframes.
	(scss--hash-re): New const.
	(css--font-lock-keywords): New function, extracted from
	css-font-lock-keywords.

2014-10-19  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-backend.el: Require url-parse.
	(newsticker--get-news-by-wget): Store feed name as process property.
	(newsticker--sentinel): Read feed name from process property.
	(newsticker--sentinel-work): Rename argument name to feed-name.
	Rename variable imageurl to image-url.  Pick icon url from Atom
	1.0 data.  Launch download of feed icon.
	(newsticker--get-icon-url-atom-1.0): New.
	(newsticker--unxml)
	(newsticker--unxml-node)
	(newsticker--unxml-attribute): Documentation.
	(newsticker--icons-dir): New.
	(newsticker--image-get): New arguments FILENAME and DIRECTORY.
	Use `url-retrieve' if `newsticker-retrieval-method' is 'intern.
	(newsticker--image-download-by-wget): New.  Use process properties
	for storing informations.
	(newsticker--image-sentinel): Read informations from process properties.
	(newsticker--image-save)
	(newsticker--image-remove)
	(newsticker--image-download-by-url)
	(newsticker--image-download-by-url-callback): New.
	(newsticker-opml-export): Handle url list entries containing a
	function instead of an url string.

	* net/newst-reader.el (newsticker-html-renderer): Whitespace.
	(newsticker--print-extra-elements)
	(newsticker--do-print-extra-element):
	Documentation (newsticker--image-read): Optionally limit image height.
	Use imagemagick if possible.
	(newsticker--icon-read): New.

	* net/newst-treeview.el (newsticker--treeview-item-show): Limit height of feed logo.
	(newsticker--treeview-tree-expand): Use feed icons in treeview.
	(newsticker--tree-widget-icon-create): New.  Set the tree widget icon.
	(newsticker--tree-widget-leaf-icon): Use feed icon.

2014-10-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-opt.el (eieio-lambda-arglist): Remove.
	Use help-function-arglist instead.

	* emacs-lisp/eieio-core.el (eieio-compiled-function-arglist): Remove.
	(eieio--with-scoped-class): Use `declare'.
	(eieio-defclass): Remove compatibility code.
	(no-method-definition, no-next-method, inconsistent-class-hierarchy)
	(invalid-slot-type, unbound-slot, invalid-slot-name): Use define-error.

2014-10-18  Jan Djärv  <jan.h.d@swipnet.se>

	* cus-start.el (x-gtk-whole-detached-tool-bar): Remove.

	* term/x-win.el (x-gtk-stock-map): Add icon names suggested as
	replacements to stock names before stock names in a list.
	Cdr may be a list, each name is tried in turn until one is found.

2014-10-18  Alan Mackenzie  <acm@muc.de>

	Check that a "macro" found near point-min isn't a ## operator.
	* progmodes/cc-engine.el (c-macro-is-genuine-p): New function.
	(c-beginning-of-macro): Use the above new function.  (Bug#18749)

2014-10-18  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/gnutls.el (gnutls-negotiate): Don't use cl-mapcan; pass
	correct data to `gnutls-boot' (Bug#18664).
	Reported by Toke Høiland-Jørgensen <toke@toke.dk>.

2014-10-18  Michal Nazarewicz  <mina86@mina86.com>

	* whitespace.el (whitespace-style, whitespace-big-indent)
	(whitespace-big-indent-regexp, whitespace-style-value-list)
	(whitespace-toggle-option-alist, whitespace-interactive-char)
	(whitespace-toggle-options)
	(global-whitespace-toggle-options, whitespace-help-text)
	(whitespace-style-face-p, whitespace-color-on): Add a 'big-indent
	style to `whitespace-mode' to indicate that the line indentation
	is too deep.  By default, 32 SPACEs or four TABs are considered
	too many but `whitespace-big-indent-regexp' can be configured.

2014-10-17  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/tildify.el (tildify--pick-alist-entry): Rename from
	tildify-mode-alist.

2014-10-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio.el: Use lexical-binding drop non-GV fallback.
	(defclass, defgeneric, defmethod): Add doc-string position.
	(with-slots): Require cl-lib.

	* emacs-lisp/eieio-core.el: Use lexical-binding and cl-lib.
	(list-of): New type.
	(eieio--typep): Remove.
	(eieio-perform-slot-validation): Use cl-typep instead.

	* emacs-lisp/eieio-base.el: Use lexical-binding and cl-lib.

	* emacs-lisp/cl-macs.el (cl--make-type-test): Avoid ((lambda ..) ..).

2014-10-16  Alan Mackenzie  <acm@muc.de>

	Trigger showing when point is in the "periphery" of a line or just
	inside a paren.
	* paren.el (show-paren-style, show-paren-delay)
	(show-paren-priority, show-paren-ring-bell-on-mismatch):
	Remove superfluous :group specifications.
	(show-paren-when-point-inside-paren)
	(show-paren-when-point-in-periphery): New customizable variables.
	(show-paren-highlight-openparen): Make into a defcustom.
	(show-paren--unescaped-p, show-paren--categorize-paren)
	(show-paren--locate-near-paren): New defuns.
	(show-paren--default): Refaactor and trigger on more paren
	positions.
	(show-paren-function): Small consequential changes.

2014-10-16  Tom Tromey  <tom@tromey.com>

	* files.el (auto-mode-alist): Use javascript-mode for .jsm
	(bug #18719).

2014-10-16  Eli Zaretskii  <eliz@gnu.org>

	* international/characters.el (bracket-type): Force pre-loading of
	uni-brackets.el.

2014-10-16  Alan Mackenzie  <acm@muc.de>

	* cus-edit.el (custom-command-apply): Specify the return value in
	the doc string.
	(Custom-reset-standard): Save custom-file (e.g. .emacs) only when
	custom-command-apply has returned non-nil.

2014-10-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eldoc.el (global-eldoc-mode): Enable by default.
	Remove incorrect handling of eldoc-print-after-edit.
	(eldoc-message-commands, eldoc-last-data): Use defvar.
	* loadup.el (emacs-lisp/eldoc): Load it.

	* progmodes/m4-mode.el (m4-syntax-propertize): New var.
	(m4-mode): Use it.
	(m4--quoted-p): New function.
	(m4-font-lock-keywords): Don't handle #..\n comments any more.
	(m4-mode-syntax-table): Use punctuation syntax (according to m4 manual)
	for most special characters.

	* progmodes/compile.el (compilation--previous-directory): Simplify.
	(compilation-next-error): Ensure the parse before we look at
	compilation-message property.

2014-10-15  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (what-cursor-position):
	* descr-text.el (describe-char): Update to support the new bidi
	characters.

	* emacs-lisp/tabulated-list.el (tabulated-list-mode):
	Force bidi-paragraph-direction to 'left-to-right'.  This fixes
	buffer-menu display when the first buffer happens to start with
	R2L letter.

2014-10-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/elisp-mode.el (elisp--local-variables-1):
	Handle quoted expressions (bug#18688).

2014-10-14  Jérémy Compostella  <jeremy.compostella@intel.com>
	    Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-open-connection-setup-interactive-shell):
	Reduce the amount of set environment variable commands.

2014-10-12  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Fix import completion.  (Bug#18582)
	* progmodes/python.el (python-shell-completion-get-completions):
	Fix import case regexp.

2014-10-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/bat-mode.el (bat-font-lock-keywords): Fix \\<_ typo
	(bug#18622).  Reported by Arni Magnusson <arnima@hafro.is>.
	* progmodes/prolog.el (prolog-electric--underscore): Same.

2014-10-12  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-get-remote-id): Check also for "gid".

2014-10-11  Jan Djärv  <jan.h.d@swipnet.se>

	* cus-start.el (all): Add missing ns and boolean to
	ns-use-fullscreen-animation.

2014-10-11  Leo Liu  <sdl.web@gmail.com>

	* progmodes/cfengine.el (cfengine3-defuns, cfengine3-vartypes):
	Use strings.
	(cfengine3-create-imenu-index): New function.
	(cfengine3-mode): Use it for `imenu-create-index-function'.
	(cfengine-auto-mode): Improve and prefer cfengine3-mode when
	buffer is empty.

2014-10-11  Jan Djärv  <jan.h.d@swipnet.se>

	* cus-start.el (all): Add ns-use-fullscreen-animation.

2014-10-11  Glenn Morris  <rgm@gnu.org>

	* calendar/diary-lib.el (diary-display-function):
	Drop support for deprecated nil and list forms.
	(diary-list-entries): Update for the above.
	* calendar/cal-x.el (calendar-dedicate-diary): Simplify accordingly.

2014-10-10  Leo Liu  <sdl.web@gmail.com>

	* window.el (temp-buffer-window-show): Make BUFFER a required arg.
	(Bug#18656)

2014-10-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* select.el (gui-selection-exists-p-alist): New method.
	* menu-bar.el (menu-bar-edit-menu, clipboard-yank):
	* simple.el (deactivate-mark): Use it.
	* term/x-win.el (gui-selection-exists-p):
	* term/w32-win.el (gui-selection-exists-p):
	* term/pc-win.el (gui-selection-exists-p):
	* term/ns-win.el (gui-selection-exists-p): Provide a backend instance.

2014-10-10  Glenn Morris  <rgm@gnu.org>

	* info.el (Info-fontify-maximum-menu-size): Bump to 400k.  (Bug#16227)
	Fix :type.  Allow t to mean no limit.
	(Info-fontify-node): Handle Info-fontify-maximum-menu-size = t.

2014-10-09  Glenn Morris  <rgm@gnu.org>

	* frame.el (display-monitor-attributes-list): Doc tweaks.

2014-10-09  Eli Zaretskii  <eliz@gnu.org>

	* faces.el (display-grayscale-p): Mention in the doc string that
	the argument can be either a display name or a frame.

	* frame.el (display-pixel-height, display-pixel-width)
	(display-mm-height, display-mm-width, display-backing-store)
	(display-save-under, display-planes, display-color-cells)
	(display-visual-class, display-monitor-attributes-list)
	(display-screens): Mention in the doc string that the argument can
	be either a display name or a frame.  Improve the docs of the
	monitor attributes.  (Bug#18636)

2014-10-09  Martin Rudalics  <rudalics@gmx.at>

	* term.el (term-window-width): Subtract 1 from the width when
	any fringe has zero width, not just the right fringe.  (Bug#18601)

2014-10-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* frame.el (make-frame): Use t rather than nil for `w' (bug#18653).

2014-10-08  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/cl-extra.el (cl-fresh-line): New function.

2014-10-08  Glenn Morris  <rgm@gnu.org>

	* calendar/cal-x.el (calendar-dedicate-diary):
	Drop support for recently deleted aliases.

2014-10-08  Leo Liu  <sdl.web@gmail.com>

	* progmodes/cfengine.el (cfengine3-make-syntax-cache):
	Always return a syntax.  Replace call-process-shell-command with
	process-file.  Ensure cfengine-mode-syntax-functions-regex is
	always set.  Ensure cache when cfengine-cf-promises fails.
	(Bug#18620)

2014-10-07  Glenn Morris  <rgm@gnu.org>

	* font-lock.el (font-lock-fontify-buffer): Fix interactive-only markup.

2014-10-07  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode revision c075a492.
	* progmodes/verilog-mode.el (verilog-mode-version): Bump.
	(verilog-menu): Add AUTOINSERTLAST.
	(verilog-no-indent-begin-re): When `verilog-indent-begin-after-if'
	is nil, fix indenting initial/final to match always statements, bug825.
	Reported by Tim Clapp.
	(verilog-extended-complete-re): Fix indentation of DPI-C imports,
	bug557.  Reported by ZeDong Mao and Jason Forkey.
	(verilog-read-decls): Fix parsing typed interfaces.
	Fix AUTOINOUTMODPORT missing types.  Reported by Stephan Bourduas.
	(verilog-auto-arg-ports): Fix verilog-auto-arg-format single.
	(verilog-auto-output-every): Add regexp to AUTOOUTPUTEVERY, bug793.
	Reported by Pierre-David Pfister.
	(verilog-auto-insert-lisp): Doc fix.
	(verilog-auto-insert-last, verilog-auto): Add AUTOINSERTLAST to
	allow post-AUTO user fixups, bug826.  Reported by Dennis Muhlestein.
	(verilog-sk-ovm-class, verilog-sk-uvm-object)
	(verilog-sk-uvm-component): Fix missing string keyword in class
	skeletons, bug824.  Reported by eldad faruhi.

2014-10-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* term/w32-win.el: Move all code from 32-common-fns.el here.
	(gui-select-text, gui-selection-value): Use w32 handlers in the w32
	console as well (bug#18629).
	* w32-common-fns.el: Remove.
	* loadup.el: Don't load w32-common-fns.el.
	* w32-fns.el: Don't require w32-common-fns.

	* icomplete.el: Move Iswitchb autoload here.  Much simpler.
	* obsolete/iswitchb.el (iswitchb-mode): Use normal autoload cookie.
	Remove redundant obsolescence thingy.
	* loadup.el: Don't load obsolete/loaddefs.el.
	* Makefile.in (obsolete-autoloads): Remove.
	(AUTOGENEL): Remove obsolete/loaddefs.el.

2014-10-06  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (obsolete-autoloads): Write to a separate file,
	to workaround autoloads bug.  (Bug#17407)
	(AUTOGENEL): Add obsolete/loaddefs.el.
	* loadup.el: Load obsolete/loaddefs.el if present.
	* subr.el (do-after-load-evaluation):
	Don't warn about obsolete/loaddefs.el.

	* menu-bar.el (menu-bar-games-menu): Remove landmark.
	It has zero relationship to a game.

2014-10-06  Leo Liu  <sdl.web@gmail.com>

	* imenu.el (imenu): Re-write for clarity.

2014-10-06  Glenn Morris  <rgm@gnu.org>

	Remove calendar code obsolete since at least version 23.1.
	* calendar/cal-bahai.el (calendar-absolute-from-bahai)
	(calendar-print-bahai-date, calendar-bahai-prompt-for-date)
	(calendar-goto-bahai-date, list-bahai-diary-entries)
	(mark-bahai-calendar-date-pattern, mark-bahai-diary-entries)
	(insert-bahai-diary-entry, insert-monthly-bahai-diary-entry)
	(insert-yearly-bahai-diary-entry):
	* calendar/cal-china.el (chinese-calendar-time-zone)
	(chinese-calendar-location-name)
	(chinese-calendar-daylight-time-offset)
	(chinese-calendar-standard-time-zone-name)
	(chinese-calendar-daylight-time-zone-name)
	(chinese-calendar-daylight-savings-starts)
	(chinese-calendar-daylight-savings-ends)
	(chinese-calendar-daylight-savings-starts-time)
	(chinese-calendar-daylight-savings-ends-time)
	(chinese-calendar-celestial-stem)
	(chinese-calendar-terrestrial-branch)
	(calendar-absolute-from-chinese, calendar-print-chinese-date)
	(calendar-goto-chinese-date):
	* calendar/cal-coptic.el (calendar-absolute-from-coptic)
	(calendar-print-coptic-date, coptic-prompt-for-date)
	(calendar-goto-coptic-date, calendar-absolute-from-ethiopic)
	(calendar-print-ethiopic-date, calendar-goto-ethiopic-date):
	* calendar/cal-french.el (calendar-absolute-from-french)
	(calendar-print-french-date, calendar-goto-french-date):
	* calendar/cal-hebrew.el (diary-sabbath-candles-minutes)
	(calendar-absolute-from-hebrew, calendar-print-hebrew-date)
	(hebrew-calendar-yahrzeit, calendar-goto-hebrew-date)
	(holiday-rosh-hashanah-etc, holiday-hanukkah)
	(holiday-passover-etc, holiday-tisha-b-av-etc)
	(list-hebrew-diary-entries, mark-hebrew-calendar-date-pattern)
	(mark-hebrew-diary-entries, insert-hebrew-diary-entry)
	(insert-monthly-hebrew-diary-entry)
	(insert-yearly-hebrew-diary-entry, list-yahrzeit-dates)
	(diary-omer, diary-yahrzeit, diary-rosh-hodesh, diary-parasha)
	(diary-sabbath-candles):
	* calendar/cal-islam.el (calendar-absolute-from-islamic)
	(calendar-print-islamic-date, calendar-goto-islamic-date)
	(list-islamic-diary-entries, mark-islamic-calendar-date-pattern)
	(mark-islamic-diary-entries, insert-islamic-diary-entry)
	(insert-monthly-islamic-diary-entry)
	(insert-yearly-islamic-diary-entry):
	* calendar/cal-iso.el (calendar-absolute-from-iso)
	(calendar-print-iso-date, calendar-iso-read-args)
	(calendar-goto-iso-date, calendar-goto-iso-week):
	* calendar/cal-julian.el (calendar-absolute-from-julian)
	(calendar-print-julian-date, calendar-goto-julian-date)
	(calendar-absolute-from-astro, calendar-print-astro-day-number)
	(calendar-goto-astro-day-number):
	* calendar/cal-mayan.el (calendar-print-mayan-date)
	(calendar-next-haab-date, calendar-previous-haab-date)
	(calendar-next-tzolkin-date, calendar-previous-tzolkin-date)
	(calendar-next-calendar-round-date)
	(calendar-previous-calendar-round-date)
	(calendar-absolute-from-mayan-long-count)
	(calendar-goto-mayan-long-count-date):
	* calendar/cal-move.el (scroll-calendar-left)
	(scroll-calendar-right, scroll-calendar-left-three-months)
	(scroll-calendar-right-three-months):
	* calendar/cal-persia.el (calendar-absolute-from-persian)
	(calendar-print-persian-date, persian-prompt-for-date)
	(calendar-goto-persian-date):
	* calendar/cal-x.el (calendar-after-frame-setup-hooks):
	* calendar/calendar.el (view-diary-entries-initially)
	(mark-diary-entries-in-calendar, calendar-today-face)
	(diary-face, holiday-face, view-calendar-holidays-initially)
	(mark-holidays-in-calendar, initial-calendar-window-hook)
	(today-visible-calendar-hook, today-invisible-calendar-hook)
	(hebrew-diary-entry-symbol, islamic-diary-entry-symbol)
	(bahai-diary-entry-symbol, american-date-diary-pattern)
	(european-date-diary-pattern, european-calendar-display-form)
	(american-calendar-display-form, holidays-in-diary-buffer)
	(all-hebrew-calendar-holidays, all-christian-calendar-holidays)
	(all-islamic-calendar-holidays, all-bahai-calendar-holidays)
	(fancy-diary-buffer, increment-calendar-month)
	(extract-calendar-month, extract-calendar-day)
	(extract-calendar-year, exit-calendar, calendar-date-is-legal-p)
	(mark-visible-calendar-date, calendar-version):
	* calendar/diary-lib.el (diary-button-face, sexp-diary-entry-symbol)
	(diary-display-hook, list-diary-entries-hook)
	(mark-diary-entries-hook, nongregorian-diary-listing-hook)
	(nongregorian-diary-marking-hook, print-diary-entries-hook)
	(abbreviated-calendar-year, number-of-diary-entries)
	(view-other-diary-entries, add-to-diary-list)
	(include-other-diary-files, simple-diary-display)
	(fancy-diary-display, print-diary-entries, mark-diary-entries)
	(mark-sexp-diary-entries, mark-included-diary-files)
	(mark-calendar-days-named, mark-calendar-month)
	(mark-calendar-date-pattern, sort-diary-entries)
	(list-sexp-diary-entries, make-diary-entry, insert-diary-entry)
	(insert-weekly-diary-entry, insert-monthly-diary-entry)
	(insert-yearly-diary-entry, insert-anniversary-diary-entry)
	(insert-block-diary-entry, insert-cyclic-diary-entry)
	(fancy-diary-font-lock-keywords, fancy-diary-display-mode):
	* calendar/holidays.el (general-holidays, oriental-holidays)
	(local-holidays, other-holidays, hebrew-holidays)
	(christian-holidays, islamic-holidays, bahai-holidays)
	(solar-holidays, list-calendar-holidays)
	(check-calendar-holidays, mark-calendar-holidays)
	(filter-visible-calendar-holidays):
	* calendar/lunar.el (calendar-phases-of-moon, phases-of-moon)
	(diary-phases-of-moon): Remove obsolete aliases.
	* calendar/cal-menu.el (cal-menu-load-hook): Remove obsolete hook.
	* calendar/cal-x.el (calendar-one-frame-setup)
	(calendar-only-one-frame-setup, calendar-two-frame-setup):
	Remove obsolete functions.
	(cal-x-load-hook): Remove obsolete hook.
	* calendar/calendar.el (european-calendar-style):
	Remove obsolete variable.
	(calendar-date-style): No longer consult european-calendar-style.
	* calendar/calendar.el (european-calendar, american-calendar):
	Remove obsolete commands.
	* calendar/calendar.el (calendar-for-loop): Remove obsolete macro.
	* calendar/diary-lib.el (diary-face): Remove obsolete variable.
	(diary-font-lock-date-forms, diary-fancy-font-lock-keywords):
	Use the face `diary' instead of the variable `diary-face'.
	* calendar/holidays.el (hebrew-holidays-1, hebrew-holidays-2)
	(hebrew-holidays-3, hebrew-holidays-4): Remove obsolete variables.
	* calendar/icalendar.el (icalendar--date-style): Remove function.
	Replace all uses with calendar-date-style.
	* textmodes/remember.el (calendar-date-style): Declare.
	(remember-diary-convert-entry):
	No longer consult european-calendar-style.

2014-10-05  Leo Liu  <sdl.web@gmail.com>

	* imenu.el (imenu-default-goto-function): Fix typo.

2014-10-04  Thomas Fitzsimmons  <fitzsim@fitzsim.org>

	* net/ntlm.el (ntlm-build-auth-request):
	Add NTLM2 Session support.  (Bug#15603)

2014-10-04  Glenn Morris  <rgm@gnu.org>

	* apropos.el (apropos-symbols-internal):
	Avoid error with non-symbol properties.  (Bug#18337#16)

	* startup.el (command-line):
	Handle altered user-emacs-directory in load-path warning.  (Bug#18512)

2014-10-04  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-full-height-p): Make it behave correctly for
	minibuffer window.
	(window-current-scroll-bars): Fix code.
	(fit-frame-to-buffer): Use window-scroll-bar-height instead of
	window-scroll-bars.
	* frame.el (frame-current-scroll-bars): Fix doc-string.
	* scroll-bar.el (toggle-horizontal-scroll-bar): New command.

2014-10-04  Mark Oteiza  <mvoteiza@udel.edu>  (tiny change)

	* files.el (auto-mode-alist): Use sh-mode for .zsh files.  (Bug#18488)

2014-10-04  Glenn Morris  <rgm@gnu.org>

	* frame.el (frame-monitor-attributes)
	(display-monitor-attributes-list): Doc fixes.

2014-10-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	Merge trivially safe differences from standalone CC-mode.
	* progmodes/cc-mode.el (c-initialize-cc-mode): Don't quote a symbol
	just to then pass it to `symbol-value'.
	(prog-mode): Provide fallback definition, if needed.
	* progmodes/cc-langs.el: Always load `cl'.  Don't load `cl-lib'.
	Remove "cl-" prefix accordingly.
	* progmodes/cc-fonts.el (c-font-lock-invalid-string): Use integerp or
	characterp depending on the type of characters.
	(c-font-lock-enum-tail): Remove unused var `start'.
	* progmodes/cc-engine.el: Load CL at compile-time.
	(c-declare-lang-variables): Use mapcan.
	(c-append-to-state-cache): Remove unused var `ce+1'.
	(c-parse-state-state): Make buffer-local.
	(c-ssb-lit-begin): Remove unused var `pps-end-pos'.
	(c-just-after-func-arglist-p): Remove unused var `end'.
	* progmodes/cc-defs.el: Load cc-fix if delete-dups is undefined.
	(c-<-as-paren-syntax, c->-as-paren-syntax): Move definition earlier.
	(c-make-keywords-re): Use delete-dups.
	(c-get-current-file): Avoid file-name-base.
	* progmodes/cc-cmds.el (c-electric-lt-gt): Remove unused var
	`close-paren-inserted'.
	* progmodes/cc-awk.el (c-forward-sws): Remove unused declaration.

	* progmodes/python.el: Avoid building unneeded markers.
	(python-font-lock-keywords, python-indent-dedent-line)
	(python-fill-paren, python-shell-completion-complete-or-indent):
	Prefer point over point-marker.
	(inferior-python-mode): Remove redundant completion settings.

2014-10-03  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-svn.el (vc-svn-ignore-completion-table): Implement.
	(vc-svn-ignore): Use it.  (Bug#18619)

2014-10-03  Martin Rudalics  <rudalics@gmx.at>

	* frame.el (toggle-frame-maximized, toggle-frame-fullscreen):
	In doc-string mention need to set `frame-resize-pixelwise'.

2014-10-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-svn.el (vc-svn-after-dir-status): Fix the non-remote regexp,
	similarly to Rogers's 2010-06-16 change for the remote case
	(bug#18605).

2014-10-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	New gui-selection-value consolidating x-selection-value.
	* select.el (gui-selection-value-alist): New method.
	(gui-selection-value): New function.
	(x-selection-value): Make it an obsolete alias.
	* simple.el (interprogram-paste-function): Default to
	gui-selection-value.
	* w32-common-fns.el (w32-get-selection-value): Simplify.
	(x-selection-value): Remove alias.
	(interprogram-paste-function): Don't set.
	(gui-selection-value): Define for w32.
	* term/x-win.el (gui-selection-value): Define for x.
	(x--selection-value): Rename from x--selection-value.
	(interprogram-paste-function): Don't set.
	* term/pc-win.el (w16-get-selection-value): Simplify.
	(msdos-initialize-window-system): Don't set
	interprogram-paste-function.
	(gui-selection-value): Define for pc.
	* term/ns-win.el (x-selection-value): Remove.
	(gui-selection-value): Define for ns, instead.
	* term/common-win.el (x-setup-function-keys): Don't set
	interprogram-paste-function.
	* obsolete/mouse-sel.el (mouse-sel-get-selection-function):
	Use gui-selection-value.

2014-10-02  David Raynes  <rayners@gmail.com>  (tiny change)

	* term/ns-win.el: Add functions to ns frame, not x frame (bug#18614).

2014-10-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* obsolete/lucid.el (read-number): Remove, redundant.
	* obsolete/cl-compat.el (cl-floor, cl-ceiling, cl-round, cl-truncate):
	Remove, broken.

2014-10-02  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/package.el (package-import-keyring):
	Create gnupg directory private.  (Bug#17625#155)

2014-10-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/python.el (python-shell-completion-get-completions):
	Use python-shell--prompt-calculated-input-regexp from the
	process buffer (bug#18582).
	Don't assume that `line' comes from the process buffer.

2014-10-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* frame.el: Use lexical-binding (bug#18598).
	(make-frame): Use t rather than nil for tty's window-system.
	* startup.el (command-line): Use gui-method.

	Consolidate management/ownership of selections.
	* select.el (gui-get-selection-alist): New method.
	(gui-get-selection): Use it.  Rename from x-get-selection.
	(x-get-selection): Define as obsolete alias.
	(x-get-clipboard): Mark obsolete.
	(gui-get-primary-selection): New function.
	(x-get-selection-value): Mark obsolete.
	(gui-own-selection-alist, gui-disown-selection-alist)
	(gui-selection-owner-p-alist): New methods.
	(gui-set-selection): Use them.  Rename from x-set-selection.
	(x-set-selection): Define as obsolete alias.
	(gui--valid-simple-selection-p): Rename from
	x-valid-simple-selection-p.
	* w32-common-fns.el (gui-own-selection, gui-disown-selection)
	(gui-selection-owner-p, gui-get-selection): Define for w32.
	(w32-get-selection-value): Rename from x-get-selection-value.
	Use the new gui-last-selected-text.
	* term/x-win.el (x-get-selection-value): Remove.
	(x-clipboard-yank): Declare obsolete.
	(gui-own-selection, gui-disown-selection, gui-get-selection)
	(gui-selection-owner-p): Define for x.
	* term/w32-win.el (w32-win-suspend-error): Rename from
	x-win-suspend-error.
	* term/pc-win.el (w16-get-selection-value): Rename from
	x-get-selection-value.
	(w16-selection-owner-p): Rename from x-selection-owner-p.
	(gui-own-selection, gui-disown-selection, gui-get-selection)
	(gui-selection-owner-p): Define for pc.
	(w16--select-text): New function.
	* term/ns-win.el (gui-own-selection, gui-disown-selection)
	(gui-get-selection, gui-selection-owner-p): Define for ns.
	* term.el (term-mouse-paste):
	* mouse.el (mouse-yank-primary): Use gui-get-primary-selection.

2014-10-02  H. Dieter Wilhelm  <dieter@duenenhof-wilhelm.de>

	* calc/calc-help.el (calc-describe-thing): Quote strings
	which could look like regexps.

2014-10-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	Consolidate x-select-text.
	* frame.el (gui-method, gui-method-define, gui-method-declare)
	(gui-call): New macros.
	(gui-method--name): New function.
	(frame-creation-function-alist): Use gui-method-declare.
	(make-frame): Use gui-method.
	* select.el (gui-select-enable-clipboard): Rename from
	x-select-enable-clipboard and move here.
	(x-select-enable-clipboard): Define as obsolete alias.
	(gui-last-selected-text): New var, to replace x-last-selected-text.
	(gui-select-text): New GUI method.
	(gui-select-text): New function.
	(x-select-text): Define as obsolete alias.
	* term/common-win.el (x-select-enable-clipboard, x-select-text):
	Move to select.el.
	* simple.el (interprogram-cut-function): Change default to
	x-select-text.
	(interprogram-paste-function): Change default to `ignore'.
	* w32-common-fns.el (interprogram-cut-function): Don't modify.
	* term/x-win.el (interprogram-cut-function): Don't modify.
	(gui-select-text): Add method for x.
	* term/w32-win.el (gui-select-text): Add method for w32.
	* term/pc-win.el (x-last-selected-text): Remove, use
	gui-last-selected-text instead.
	(msdos-initialize-window-system): Don't set interprogram-cut-function.
	(gui-select-text): Add method for pc.
	* term/ns-win.el (ns-last-selected-text): Remove, use
	gui-last-selected-text instead.
	(gui-select-text): Add method for ns.
	(x-setup-function-keys): Don't change interprogram-cut-function.
	* loadup.el ("startup"): Load after "frame".
	* subr.el (package--builtin-versions, package--description-file):
	Move from startup.el.
	* startup.el (package--builtin-versions, package--description-file):
	Move to subr.el.
	(handle-args-function-alist, window-system-initialization-alist):
	Use gui-method-declare.
	(command-line): Use gui-method.

2014-10-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (alist-get): New accessor.
	* emacs-lisp/gv.el (alist-get): Provide expander.
	* winner.el (winner-remember):
	* tempo.el (tempo-use-tag-list):
	* progmodes/gud.el (minor-mode-map-alist):
	* international/mule-cmds.el (define-char-code-property):
	* frameset.el (frameset-filter-params):
	* files.el (dir-locals-set-class-variables):
	* register.el (get-register, set-register):
	* calc/calc-yank.el (calc-set-register): Use it.
	* ps-print.el (ps-get, ps-put, ps-del): Mark as obsolete.
	* tooltip.el (tooltip-set-param): Mark as obsolete.
	(tooltip-show): Use alist-get instead.
	* ses.el (ses--alist-get): Remove.  Use alist-get instead.

2014-10-01  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-backend.el: Remove Time-stamp.  Rename variable
	`newsticker--download-logos' to `newsticker-download-logos' and
	make it customizable.
	(newsticker--sentinel-work): Move xml-workarounds to function
	`newsticker--do-xml-workarounds', call unless libxml-parser is
	used.  Allow single quote in regexp for encoding.
	Use libxml-parser if available, else fall back to `xml-parse-region'.
	Take care of possibly missing namespace prefixes (like "RDF"
	instead of "rdf:RDF") when checking xml nodes and attributes (as
	libxml correctly removes the prefixes).  Always use Atom 1.0 as
	fallback feed type.  Rename `newsticker--download-logos' to
	`newsticker-download-logos'
	(newsticker--unxml, newsticker--unxml-node)
	(newsticker--unxml-attribute): New.
	(newsticker--parse-atom-1.0): Call `unxml' in case that embedded
	HTML code has become part of the xml parse tree.
	(newsticker--parse-rss-1.0, newsticker--parse-rss-2.0): Take care
	of possibly missing namespace prefixes.
	(newsticker--parse-generic-items): Code formatting.  Typo.
	(newsticker--images-dir): Add trailing slash.
	(newsticker--image-get): Fix error message.

	* net/newst-plainview.el: Remove Time-stamp.

	* net/newst-reader.el: Remove Time-stamp.
	(newsticker-download-logos): Rename variable
	`newsticker--download-logos' to `newsticker-download-logos' and
	make it customizable.
	(newsticker--print-extra-elements): Add optional parameter
	'htmlish for using html markup.  Amend list of ignored elements.
	(newsticker--do-print-extra-element): Add parameter 'htmlish for
	using html markup.

	* net/newst-ticker.el: Remove Time-stamp.

	* net/newst-treeview.el (newsticker--treeview-item-show): Use html
	for formatting extra elements.

	* net/newsticker.el:  Remove Time-stamp, Version.
	(newsticker-version): Make obsolete.

2014-09-30  Leonardo Nobrega  <leonobr@gmail.com>  (tiny change)

	* progmodes/python.el (python-fill-paren): Don't inf-loop at EOB
	(bug#18462).

2014-09-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-check-signature): Default to nil if
	GPG is not available.
	(package-refresh-contents): Don't mess with the keyring if we won't
	check the signatures anyway.

2014-09-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ses.el (ses--row, ses--col): New dyn-scoped vars, to replace row&col.
	(ses-center, ses-center-span): Use them.
	(ses-print-cell): Bind them while calling the printer.
	(row, col, maxrow, maxcol): Don't declare as dynamically scoped.
	(ses-dorange): Revert last change.
	(ses-calculate-cell): Don't bind row&col dynamically while evaluating
	the formula.
	(ses-set-cell): Avoid `eval'.
	(ses--time-check): Rename it from ses-time-check and turn it into
	a macro.

	* ses.el (ses-setup): Don't assume modifying the iteration var of
	dotimes affects the iteration (bug#18191).

2014-09-30  Vincent Belaïche  <vincentb1@users.sourceforge.net>

	* ses.el (ses-calculate-cell): Bind row and col dynamically to
	their values with 'cl-progv'.
	(ses-dorange): Bind row, col, maxrow and maxcol dynamically to
	their values with 'cl-progv', also use non-interned symbols for
	row, minrow, maxrow, mincol and maxcol.
	(maxrow maxcol): New defvar, to make the compiler happy.

2014-09-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (completion-at-point): Emit warning for ill-behaved
	completion functions.

2014-09-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ses.el (ses--letref): Quote value before it gets re-evaluated.

2014-09-28  Thien-Thi Nguyen  <ttn@gnu.org>

	Font-lock `cl-flet*', too.
	* emacs-lisp/lisp-mode.el (lisp-cl-font-lock-keywords-2):
	Add "flet*" to intermediate var `cl-lib-kw'.

2014-09-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* epg-config.el (epg-gpg-program): Use the plain program names rather
	than their absolute file name.

	* subr.el (track-mouse): New macro.
	* emacs-lisp/cconv.el (cconv-convert, cconv-analyse-form):
	Remove track-mouse case.
	* emacs-lisp/bytecomp.el (byte-compile-track-mouse): Remove.

2014-09-27  Leo Liu  <sdl.web@gmail.com>

	* progmodes/elisp-mode.el (elisp--eldoc-last-data): Use defvar.

	* emacs-lisp/eldoc.el (eldoc-mode): Fix thinko.

2014-09-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/pcase.el (pcase--split-match, pcase--app-subst-match):
	Handle the case where `match' is :pcase--succeed or :pcase--fail
	(bug#18554).

	Introduce global-eldoc-mode.  Move Elisp-specific code to elisp-mode.el.
	* emacs-lisp/eldoc.el (global-eldoc-mode): New minor mode.
	(eldoc-schedule-timer): Obey it.
	(eldoc-documentation-function): Default to nil.
	(eldoc-mode): Don't enable if eldoc-documentation-function is not set.
	(eldoc-documentation-function-default, eldoc-get-fnsym-args-string)
	(eldoc-highlight-function-argument, eldoc-get-var-docstring)
	(eldoc-last-data-store, eldoc-docstring-first-line)
	(eldoc-docstring-format-sym-doc, eldoc-fnsym-in-current-sexp)
	(eldoc-beginning-of-sexp, eldoc-current-symbol)
	(eldoc-function-argstring): Move to elisp-mode.el.
	(eldoc-symbol-function): Remove, unused.
	* progmodes/elisp-mode.el: New file.  Rename all "eldoc-*" to "elisp--*".
	(elisp-completion-at-point): Rename from lisp-completion-at-point.
	(elisp--preceding-sexp): Rename from preceding-sexp.
	* loadup.el: Load new file progmodes/elisp-mode.
	* ielm.el (inferior-emacs-lisp-mode): Set eldoc-documentation-function.
	* emacs-lisp/lisp.el (lisp--local-variables-1, lisp--local-variables)
	(lisp--local-variables-completion-table, lisp--expect-function-p)
	(lisp--form-quoted-p, lisp--company-doc-buffer)
	(lisp--company-doc-string, lisp--company-location)
	(lisp-completion-at-point): Move to elisp-mode.el.
	* emacs-lisp/lisp-mode.el (lisp--mode-syntax-table): New syntax-table,
	extracted from emacs-lisp-mode-syntax-table.
	(emacs-lisp-mode-abbrev-table, emacs-lisp-mode-syntax-table): Move to
	elisp-mode.el.
	(lisp-imenu-generic-expression): Add comments to document what comes
	from which Lisp dialect.
	(emacs-lisp-mode-map, emacs-lisp-byte-compile)
	(emacs-lisp-byte-compile-and-load, emacs-lisp-mode-hook)
	(emacs-lisp-mode, emacs-list-byte-code-comment-re)
	(emacs-lisp-byte-code-comment)
	(emacs-lisp-byte-code-syntax-propertize, emacs-lisp-byte-code-mode)
	(lisp-interaction-mode-map, lisp-interaction-mode)
	(eval-print-last-sexp, last-sexp-setup-props)
	(last-sexp-toggle-display, prin1-char, preceding-sexp)
	(eval-last-sexp-1, eval-last-sexp-print-value)
	(eval-last-sexp-fake-value, eval-sexp-add-defvars, eval-last-sexp)
	(eval-defun-1, eval-defun-2, eval-defun): Move to elisp-mode.el.

2014-09-26  Paul Eggert  <eggert@cs.ucla.edu>

	* progmodes/grep.el (grep-regexp-alist): Use more-accurate regexp.
	Do not match file names that end in '/', as they cannot be 'grep'
	hits nowadays.  This prevents confusion when 'grep -r' reports a
	match in a file whose basename is ':12345:'.  Conversely, do not
	require exactly the same sequence of spaces and tabs after both
	colons, and allow spaces or tabs before the second colon, as per
	the POSIX spec for 'grep' output.

2014-09-26  Leo Liu  <sdl.web@gmail.com>

	Add cl-parse-integer based on parse-integer (Bug#18557)
	* calendar/parse-time.el (parse-time-digits): Remove.
	(digit-char-p, parse-integer) Moved to cl-lib.el.
	(parse-time-tokenize, parse-time-rules, parse-time-string):
	Use cl-parse-integer.

	* emacs-lisp/cl-extra.el (cl-parse-integer): New function.

	* emacs-lisp/cl-lib.el (cl-digit-char-table): New var.
	(cl-digit-char-p): New function.

2014-09-25  Juri Linkov  <juri@jurta.org>

	* vc/add-log.el (change-log-next-buffer): Don't create an empty
	buffer "ChangeLog" when the current buffer doesn't match ChangeLog.[0-9].
	Return the current buffer if no files match the default pattern
	ChangeLog.[0-9].  Signal "end of multi" when file is nil.  (Bug#18547)

2014-09-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* net/tramp-sh.el (tramp-sh-handle-vc-registered): Don't modify
	the global vc-handled-backends (bug#18535).

2014-09-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* find-cmd.el (find-cmd): Use grep's `find-program' (bug#18518).
	Suggested by <lompik@voila.fr>.

2014-09-24  Ulf Jasper  <ulf.jasper@web.de>

	* net/newst-treeview.el (newsticker--treeview-do-get-node-by-id):
	Rename from `newsticker--treeview-do-get-node'.
	(newsticker--treeview-get-node-by-id):
	Rename from `newsticker--treeview-get-node'.
	(newsticker--treeview-buffer-init)
	(newsticker--treeview-buffer-init): Disable buffer undo.
	(newsticker--treeview-unfold-node): Adapt to modified
	`newsticker--group-find-parent-group'.
	(newsticker--group-do-find-group):
	Rename from `newsticker--group-do-find-group-for-feed'.
	Now works for both, groups and feeds.
	(newsticker--group-find-parent-group):
	Rename from `newsticker--group-find-group-for-feed'.
	Now works for both, groups and feeds.
	(newsticker--group-do-get-parent-group)
	(newsticker--group-get-parent-group): Remove.
	(newsticker-group-add-group): Change interactive prompts.
	(newsticker-group-add-group): Finally jump to added group.
	(newsticker-group-delete-group): Finally jump to current feed.
	(newsticker--group-do-rename-group, newsticker-group-rename-group)
	(newsticker--get-group-names, newsticker--group-names): New.
	(newsticker-group-move-feed): Finally jump to moved feed.
	(newsticker-group-shift-feed-down, newsticker-group-shift-feed-up)
	(newsticker-group-shift-group-down)
	(newsticker-group-shift-group-up, newsticker--group-shift): New.
	(newsticker-treeview-mode-map): New keybindings for new shift commands.

	* net/newst-backend.el (newsticker--item-list)
	(newsticker--item-position, newsticker--prev-message)
	(newsticker--scrollable-text): Move to newst-ticker.el.

	* net/newst-ticker.el (newsticker--item-list)
	(newsticker--item-position, newsticker--prev-message)
	(newsticker--scrollable-text): Move from newst-backend.el.

2014-09-22  Kan-Ru Chen  <kanru@kanru.info>

	* window.el (fit-window-to-buffer): When counting buffer width,
	count the whole visible buffer.  Correctly convert the body-height
	to pixel size for window-text-pixel-size (Bug#18498).

2014-09-22  Sam Steingold  <sds@gnu.org>

	* progmodes/sql.el (sql-product-alist): Improve the Vertica entry.
	(sql-execute): Use `special-mode'.

2014-09-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	Add pcase-defmacro, as well as `quote' and `app' patterns.
	* loadup.el: Increase max-lisp-eval-depth when macroexpanding macroexp.
	* emacs-lisp/pcase.el: Allow (F . ARGS) in `app' patterns.
	(pcase--funcall, pcase--eval): New functions.
	(pcase--u1): Use them for guard, pred, let, and app.
	(\`): Use the new feature to generate better code for vector patterns.
	* emacs-lisp/pcase.el: Use pcase-defmacro to handle backquote.
	(pcase--upat): Remove.
	(pcase--macroexpand): Don't hardcode handling of `.
	(pcase--split-consp, pcase--split-vector): Remove.
	(pcase--split-equal): Disregard ` since it's expanded away.
	(pcase--split-member): Optimize for quote rather than for `.
	(pcase--split-pred): Optimize for quote rather than for `.
	(pcase--u1): Remove handling of ` (and of `or' and `and').
	Quote non-selfquoting values when passing them to `eq'.
	Drop `app's let-binding if the variable is not used.
	(pcase--q1): Remove.
	(`): Define as a pattern macro.
	* emacs-lisp/pcase.el (pcase--match): New smart-constructor function.
	(pcase--expand pcase--q1, pcase--app-subst-match): Use it.
	(pcase--macroexpand): Handle self-quoting patterns here, expand them to
	quote patterns.
	(pcase--split-match): Don't hoist or/and here any more.
	(pcase--split-equal): Optimize quote patterns as well as ` patterns.
	(pcase--flip): New helper macro.
	(pcase--u1): Optimize the memq case directly.
	Don't handle neither self-quoting nor and/or patterns any more.
	* emacs-lisp/pcase.el (pcase-defmacro): New macro.
	(pcase--macroexpand): New function.
	(pcase--expand): Use it.
	* emacs-lisp/pcase.el (pcase--app-subst-match, pcase--app-subst-rest):
	New optimization functions.
	(pcase--u1): Add support for `quote' and `app'.
	(pcase): Document them in the docstring.

2014-09-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	Use lexical-bindin in Ibuffer.
	* ibuffer.el (ibuffer-do-toggle-read-only): `arg' is unused.
	(ibuffer-compile-format): Simplify.
	(ibuffer-clear-summary-columns): Simplify.
	* ibuf-ext.el (ibuffer-generate-filter-groups): Don't use the third
	elem of dotimes when we don't refer to the iteration var from it.
	(ibuffer-toggle-sorting-mode): Avoid add-to-list.
	* ibuf-macs.el (define-ibuffer-column, define-ibuffer-op):
	Silence byte-compiler.

2014-09-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* font-lock.el (font-lock-compile-keyword): Don't confuse a lambda
	expression for a list.

	* emacs-lisp/bytecomp.el (byte-compile-lambda): Don't add fundoc usage
	for functions with no arguments.

	* mpc.el (mpc-data-directory): Use locate-user-emacs-file.
	(mpc-volume-refresh): Make sure the corresponding header-line is updated.

2014-09-17  Tom Willemse  <tom@ryuslash.org>  (tiny change)

	* simple.el (clone-indirect-buffer): Mention the return value
	(bug#18478).

	* progmodes/prog-mode.el (prog-mode-hook): Replace reference to
	Text mode in docstring (bug#18464).

2014-09-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/perl-mode.el (perl-syntax-propertize-function):
	Accept underscores in identifiers after "sub" (bug#18502).

2014-09-21  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-sel.el (reftex-select-label-mode)
	(reftex-select-bib-mode, reftex-insert-docstruct): Derive modes
	from special-mode (instead of fundamental-mode) and propertize
	with font-lock-face instead of just face.  (Bug#18496)

	* textmodes/reftex-toc.el (reftex-toc-mode, reftex-toc): Ditto.

2014-09-19  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/lisp.el (lisp-completion-at-point): Only calculate
	`table-etc' when `end' is non-nil.
	(lisp-completion-at-point): Move `end' back if it's after quote.
	If in comment or string, only complete when after backquote.
	(Bug#18265)
	(lisp-completion-at-point): Don't use
	`lisp--local-variables-completion-table' in the
	`lisp--form-quoted-p' case.

2014-09-19  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/lisp.el (lisp--expect-function-p)
	(lisp--form-quoted-p): New functions.
	(lisp-completion-at-point): Use them to see if we're completing a
	variable reference, a function name, or just any symbol.
	https://lists.gnu.org/archive/html/emacs-devel/2014-02/msg00229.html

2014-09-18  Ivan Kanis  <ivan@kanis.fr>

	* net/shr.el, net/eww.el: Don't override `shr-width', but
	introduce a new variable `shr-internal-width'.  This allows users
	to specify a width themselves.

2014-09-18  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* image-mode.el (image-toggle-display-image): If we have a
	`fit-width' or a `fit-height', don't limit the size of the image
	to the window size, because that doesn't preserve the aspect ratio.
	* image-mode.el: Move defvars earlier to avoid a byte-compilation
	warning.

2014-09-17  Reuben Thomas  <rrt@sc3d.org>

	* progmodes/js.el: Add interpreter-mode-alist support for various
	JavaScript interpreters.

2014-09-17  Paul Eggert  <eggert@cs.ucla.edu>

	Don't assume 'grep' supports GREP_OPTIONS.
	The GREP_OPTIONS environment variable is planned to be marked
	obsolescent in GNU grep, due to problems in its use, so stop
	relying on it.
	* progmodes/grep.el (grep-highlight-matches): Document this.
	(grep-process-setup): Do not set GREP_OPTIONS.
	(grep-compute-defaults): Use an explicit --color option if supported.

2014-09-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* msb.el (msb--make-keymap-menu, msb-menu-bar-update-buffers):
	Don't add outdated key-shortcut cache (bug#18482).

2014-09-15  Glenn Morris  <rgm@gnu.org>

	* image.el (image-multi-frame-p): Fix thinko - do not force
	a delay if none was specified.  (Bug#18334)

2014-09-15  Kan-Ru Chen  <kanru@kanru.info>

	* window.el (fit-window-to-buffer): Doc fix.

2014-09-15  Ivan Shmakov  <ivan@siamics.net>

	* desktop.el (desktop-create-buffer): Check that buffers are still live
	before burying them (bug#18373).

2014-09-15  Glenn Morris  <rgm@gnu.org>

	* calendar/diary-lib.el (diary-list-entries):
	Restore 24.3 display behavior.  (Bug#18381)

2014-09-15  Eli Zaretskii  <eliz@gnu.org>

	* mouse.el (mouse-drag-line): On text-mode frames, count the mode
	line and header line as 1 pixel.  This fixes the 1-"pixel" (row)
	discrepancy between window-pixel-edges and mouse events, and
	avoids moving mode line up when the mouse click is on the modeline
	and no drag is attempted.

2014-09-14  Daniel Colascione  <dancol@dancol.org>

	* register.el (insert-register): Change default interactive
	insertion mode.

2014-09-14  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cache.el (tramp-flush-file-function): Simplify check.
	Suppress debug messages.

	* net/tramp.el (tramp-file-name-handler):
	* net/tramp-gvfs.el (tramp-gvfs-url-file-name): Apply `cons' where
	appropriate.

2014-09-13  Christopher Schmidt  <ch@ristopher.com>

	* calendar/calendar.el (calendar-update-mode-line):
	Do not overwrite mode-line-format if calendar-mode-line-format is
	nil.  (Bug#18467)

2014-09-13  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/pcase.el (pcase--dontwarn-upats): New var.
	(pcase--expand): Use it.
	(pcase-exhaustive): New macro.  (Bug#16567)

	* emacs-lisp/lisp-mode.el (lisp-el-font-lock-keywords-2):
	Add pcase-exhaustive.

2014-09-13  Eli Zaretskii  <eliz@gnu.org>

	* mail/rmailmm.el (rmail-mime-insert-html): Decode the HTML part
	using the specified transfer-encoding, if any, or 'undecided'.
	(rmail-mime-render-html-shr): Bind shr-width to nil, so lines are
	broken at the window margin.

2013-12-27  Ken Olum  <kdo@cosmos.phy.tufts.edu>

	Support rendering of HTML parts in Rmail (bug#4258).
	* mail/rmailmm.el (rmail-mime-process): Handle text/html
	separately from other text/ types.  Suppress tagline for
	multipart body.
	(rmail-mime-parse): Don't change visibility of tagline here.
	(rmail-mime-set-bulk-data, rmail-mime-insert-bulk):
	Handle text/html specially.
	(rmail-mime-render-html-function,rmail-mime-prefer-html): New variables.
	(rmail-mime-insert-html, rmail-mime-render-html-shr)
	(rmail-mime-render-html-lynx): New functions.
	(rmail-mime-fix-inserted-faces): New function.
	(rmail-mime-process-multipart): Find the best part to show
	following rmail-mime-prefer-html if set.
	(rmail-mime-searching): New variable.
	(rmail-search-mime-message): Bind rmail-mime-searching to
	suppress rendering while searching.

2014-09-12  Sam Steingold  <sds@gnu.org>

	* progmodes/sql.el (sql-product-alist): Add vertica.
	(sql-vertica-program, sql-vertica-options)
	(sql-vertica-login-params, sql-comint-vertica, sql-vertica):
	New functions and variables to support Vertica.
	Inspired by code by Roman Scherer <roman@burningswell.com>.

2014-09-11  Paul Eggert  <eggert@cs.ucla.edu>

	* ses.el (ses-file-format-extend-parameter-list): Rename from
	ses-file-format-extend-paramter-list, to correct a misspelling.
	All uses changed.

2014-09-10  Alan Mackenzie  <acm@muc.de>

	CC Mode: revert recent changes and fix bug 17463 (cc-langs.elc
	gets loaded at run-time).
	* progmodes/cc-langs.el (c-no-parens-syntax-table): Rename the
	c-lang-const to c-make-no-parens-syntax-table and correct the
	logic.
	(c-no-parens-syntax-table): Correct the logic of the
	c-lang-defvar.

2014-09-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	CC-mode: Set open-paren-in-column-0-is-defun-start to nil;
	plus misc cleanup.
	* progmodes/cc-mode.el (c-basic-common-init):
	Set open-paren-in-column-0-is-defun-start.
	(adaptive-fill-first-line-regexp, font-lock-syntactic-keywords):
	Remove declarations, unused.
	(run-mode-hooks): Remove declaration.
	(font-lock-defaults): Use plain `defvar' to declare.
	(c-run-mode-hooks): Test existence of run-mode-hooks with fboundp.
	* progmodes/cc-langs.el (c-filter-ops): Avoid `setq'.
	(c-make-mode-syntax-table): Don't micro-optimize.
	(c-keywords, c-keyword-member-alist): Simplify.
	(c-kwds-lang-consts): Don't eval at compile-time.
	(c-primary-expr-regexp): Comment out unused vars.
	* progmodes/cc-fonts.el (c-font-lock-context): Declare at top-level.
	(c-font-byte-compile): New var.
	(c--compile): New function.  Use it instead of `byte-compile'.
	(c-cpp-matchers): Quote the value returned by
	`c-make-syntactic-matcher' in case it's not self-evaluating.
	(c-basic-matchers-before): Avoid a plain MATCHER as keyword, wrap it in
	parentheses instead (in case MATCHER happens to be a list).
	(c-font-lock-enum-tail): Remove unused var `start'.
	(c-font-lock-objc-methods): Silence byte-compiler warnings.
	* progmodes/cc-engine.el (c-syntactic-re-search-forward): Sink an `if'
	test into an argument.
	* progmodes/cc-defs.el (c-point, c-major-mode-is, c-put-char-property)
	(c-get-char-property): Don't use `eval' just to unquote a constant.
	(c-use-extents): Remove.  Use (featurep 'xemacs), compiled
	more efficiently.
	(c-put-char-property-fun): Don't call `byte-compile' by hand.
	(c-clear-char-property, c-clear-char-properties): Check that `property'
	is a quoted constant.
	(c-emacs-features): Remove `infodock', `syntax-properties', and
	`pps-extended-state' (never used), `8-bit' and `1-bit' (use (featurep
	'xemacs) instead).  Use `with-temp-buffer' and let-bind vars after
	changing buffer, so we don't have to setq them again afterwards.
	(c-lang-const): Remove redundant symbolp assertions.
	(c-find-assignment-for-mode): Use `or'.
	* Makefile.in (compile-one-process): Remove cc-mode dependency.

2014-09-09  Sam Steingold  <sds@gnu.org>

	* progmodes/sql.el (sql-default-directory): Fix type annotation.

2014-09-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/cc-awk.el: Remove unneeded cc-bytecomp use.
	Change doc comments into docstrings.
	* Makefile.in: Remove cc-awk dependency.

2014-09-08  Sam Steingold  <sds@gnu.org>

	* progmodes/sql.el (sql-send-line-and-next): New command,
	bound to C-c C-n.
	(sql-show-sqli-buffer): Display the buffer instead of its name and
	bind the command to C-c C-z.
	(sql-default-directory): New user option.
	(sql-product-interactive): Bind `default-directory' to it to
	enable remote connections using Tramp.
	(sql-set-sqli-buffer): Call `sql-product-interactive' when no
	suitable buffer is available.

2014-09-08  Glenn Morris  <rgm@gnu.org>

	* calendar/calendar.el (calendar-basic-setup):
	Fix calendar-view-holidays-initially-flag and fancy display.
	* calendar/diary-lib.el (diary-live-p): Doc fix.

	* calendar/calendar.el (calendar-basic-setup):
	Avoid clobbering calendar with diary.  (Bug#18381)

2014-09-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-dir.el (vc-dir-update): Don't burp in corner case.

2014-09-08  Lars Ljung  <lars@matholka.se>  (tiny change)

	* isearch.el (isearch-yank-word-or-char): Obey superword-mode
	as well (bug#18400).

2014-09-08  Eli Zaretskii  <eliz@gnu.org>

	* subr.el (posn-actual-col-row): Doc fix.  (Bug#18385)

2014-09-06  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/pcase.el (pcase): Doc fix.
	(pcase--split-vector): New function.
	(pcase--q1): Support vector qpattern.  (Bug#18327)

2014-09-05  Sam Steingold  <sds@gnu.org>

	* textmodes/tex-mode.el (tex-print-file-extension): New user
	option.
	(tex-print): Use it instead of the hard-coded string.

2014-09-05  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-start-file-process):
	Expand `default-directory'.

2014-09-05  Martin Rudalics  <rudalics@gmx.at>

	* scroll-bar.el (horizontal-scroll-bars-available-p):
	New function.
	(horizontal-scroll-bar-mode): Rewrite using
	horizontal-scroll-bars-available-p.
	* menu-bar.el (menu-bar-showhide-scroll-bar-menu): Rewrite using
	horizontal-scroll-bars-available-p.

2014-09-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (call-process-shell-command, process-file-shell-command):
	Make the `args' obsolete (bug#18409).
	(start-process-shell-command, start-file-process-shell-command):
	Use `declare'.

2014-09-05  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-forms.el (math-normalize-hms): Do a better check for
	"negative" hms forms.

2014-09-04  Rasmus Pank Roulund  <emacs@pank.eu>

	* vc/vc-git.el (vc-git-conflicted-files): Fix bug when git status
	returns nil (bug#18391).

2014-09-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eldoc.el (eldoc-function-argstring): Don't strip
	terminating paren (bug#18352).
	(eldoc-last-data-store): Return cached data.
	(eldoc-get-var-docstring): Avoid setq.
	(eldoc-get-fnsym-args-string): Clarify data flow.

2014-09-04  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* emacs-lisp/eldoc.el (eldoc-highlight-function-argument): Handle the
	case where we're currently providing part of the &rest arg after some
	&key args, as in define-ibuffer-op (bug#18048).

2014-09-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/which-func.el (which-func-ff-hook): Obey pre-existing
	buffer-local setting of which-func-mode.
	(which-func-mode): Use defvar-local.
	(which-function-mode): Don't reset which-func-mode in each buffer since
	it might have been set by someone else.
	(which-func-update-ediff-windows): Check which-function-mode.

2014-09-03  Martin Rudalics  <rudalics@gmx.at>

	* frame.el (frame-initialize): Remove horizontal-scroll-bars
	from frame-initial-frame-alist.
	* scroll-bar.el (previous-horizontal-scroll-bar-mode)
	(horizontal-scroll-bar-mode-explicit)
	(set-horizontal-scroll-bar-mode, get-horizontal-scroll-bar-mode)
	(toggle-horizontal-scroll-bar): Remove.
	(horizontal-scroll-bar-mode): Remove defcustom.
	(horizontal-scroll-bar-mode): Fix doc-string.
	(scroll-bar-toolkit-scroll)
	(scroll-bar-toolkit-horizontal-scroll): Add doc-strings stubs.

2014-09-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-generate-description-file):
	Properly quote the arguments (bug#18332).  Change second arg.
	(package--alist-to-plist-args): Rename from package--alist-to-plist and
	quote the elements.
	(package--make-autoloads-and-stuff): Fix the test for pre-existence of
	the *-pkg.el file.  Adjust to new calling convention of
	package-generate-description-file.

	* progmodes/gud.el (gud-gdb-completion-at-point): Add hack (bug#18282).
	(gud-gdb-completions): Remove obsolete workaround.

2014-09-03  Eli Zaretskii  <eliz@gnu.org>

	* subr.el (posn-col-row): Revert the change from commit
	2010-11-13T21:07:58Z!eliz@gnu.org, which
	was inadvertently merged from emacs-23 release branch in 2010-11-18T03:54:14Z!monnier@iro.umontreal.ca
	monnier@iro.umontreal.ca-20101118035414-yvlg7k7dk4k4l3q, and
	introduced an off-by-one error in the reported row when there is a
	header line.  (Bug#18384)

2014-09-03  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-post-self-insert-function):
	Avoid electric colon at beginning-of-defun.  (Bug#18228)

2014-09-03  Glenn Morris  <rgm@gnu.org>

	* tutorial.el (tutorial--display-changes):
	Fix 2014-08-01 change.  (Bug#18382)

2014-09-03  Ken Brown  <kbrown@cornell.edu>

	* startup.el (fancy-splash-frame): Extend the fix for Bug#16014 to
	the Cygwin-w32 build.  (Bug#18347)

2014-09-03  Glenn Morris  <rgm@gnu.org>

	* tar-mode.el (tar--extract, tar-extract):
	Avoid permanently disabling undo in extracted buffers.  (Bug#18344)

2014-09-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-font-lock-quoted-subshell): Try to better
	handle multiline elements (bug#18380).

2014-09-01  Eli Zaretskii  <eliz@gnu.org>

	* ls-lisp.el (ls-lisp-use-string-collate)
	(ls-lisp-UCA-like-collation): New defcustoms.
	(ls-lisp-string-lessp): Use them to control sorting by file
	names.  (Bug#18051)
	(ls-lisp-version-lessp): New function.
	(ls-lisp-handle-switches): Use it to implement the -v switch of
	GNU ls.
	(ls-lisp--insert-directory): Mention the -v switch in the doc string.

2014-08-31  Christoph Scholtes  <cschol2112@gmail.com>

	* ibuffer.el: Replace mode-specific quit function with
	`quit-window' via `special-mode'.
	(ibuffer-mode-map): Use keybindings from special-mode-map instead
	of local overrides.
	(ibuffer): Don't store previous windows configuration.
	Let `quit-window' handle restoring.
	(ibuffer-quit): Remove function.  Use `quit-window' instead.
	(ibuffer-restore-window-config-on-quit): Remove variable.
	(ibuffer-prev-window-config): Remove variable.

2014-08-29  Michael Heerdegen  <michael_heerdegen@web.de>

	* emacs-lisp/easy-mmode.el (define-minor-mode): Use mode function
	name instead of variable name in hook docstring.  (Bug#18349)

2014-08-29  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-at-bottom): Prefer bottom-left
	window to other bottom windows.  Reuse a bottom window if it
	shows the buffer already.  Suggested by Juri Linkov
	<juri@jurta.org> in discussion of (Bug#18181).

2014-08-29  Leo Liu  <sdl.web@gmail.com>

	* files.el (minibuffer-with-setup-hook): Allow (:append FUN) to
	append to minibuffer-setup-hook.  (Bug#18341)

2014-08-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/cc-defs.el: Expose c-lanf-defconst's expressions to the
	byte-compiler.
	(lookup-syntax-properties): Silence byte-compiler.
	(c-lang-defconst): Quote the code with `lambda' rather than with
	`quote'.
	(c-lang-const): Avoid unneeded setq.
	(c-lang-constants-under-evaluation): Add docstring.
	(c-lang--novalue): New constant.
	(c-find-assignment-for-mode): Use it instead of c-lang-constants.
	(c-get-lang-constant): Same here.
	Get the mode's value using `funcall' now that the code is quoted
	with `lambda'.

2014-08-28  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-handle-shell-command): Use `display-buffer'.
	(Bug#18326)

2014-08-28  Martin Rudalics  <rudalics@gmx.at>

	* scroll-bar.el (scroll-bar-horizontal-drag-1): Handle new
	interpretation of `portion-whole'.

2014-08-28  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el: Spell author name correctly.

2014-08-28  João Távora  <joaotavora@gmail.com>

	* net/shr.el (shr-expand-url): Plain expand-file-name is not enough;
	use url-expand-file-name.  (Bug#18310)

2014-08-28  Glenn Morris  <rgm@gnu.org>

	* emulation/cua-rect.el (cua--highlight-rectangle):
	Avoid error at point-min.  (Bug#18309)

2014-08-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/python.el (python-shell-prompt-detect): Remove redundant
	executable-find (bug#18244).

	* simple.el (self-insert-uses-region-functions): Defvar.

2014-08-28  Glenn Morris  <rgm@gnu.org>

	* subr.el (remq): Revert 2014-08-25 doc change (not always true).

2014-08-27  Dmitry Antipov  <dmantipov@yandex.ru>

	* startup.el (normal-top-level): Now use internal--top-level-message.

2014-08-26  Dmitry Antipov  <dmantipov@yandex.ru>

	* startup.el (normal-top-level): Use top-level-message.

2014-08-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-copy-url): Encode copied URL to avoid getting
	URLs containing spaces and the like.

2014-08-25  Christoph Scholtes  <cschol2112@gmail.com>

	* subr.el (remq): Fix docstring (Bug#18253).

2014-08-25  Christoph Scholtes  <cschol2112@gmail.com>

	* replace.el (query-replace): Fix typo in docstring (Bug#18320).

2014-08-24  Alan Mackenzie  <acm@muc.de>

	Handle C++11's "auto" and "decltype" constructions.
	* progmodes/cc-engine.el (c-forward-type): Enhance to recognize
	and return 'decltype.
	(c-forward-decl-or-cast-1): New let variables backup-kwd-sym,
	prev-kwd-sym, new-style-auto.  Enhance to handle the new "auto"
	keyword.
	* progmodes/cc-fonts.el (c-font-lock-declarations): Handle the
	"decltype" keyword.
	(c-font-lock-c++-new): Handle "decltype" constructions.
	* progmodes/cc-langs.el (c-auto-ops, c-auto-ops-re):
	New c-lang-defconsts/defvars.
	(c-haskell-op, c-haskell-op-re): New c-lang-defconsts/defvars.
	(c-typeof-kwds, c-typeof-key): New c-lang-defconsts/defvars.
	(c-typeless-decl-kwds): Append "auto" onto the C++ value.
	(c-not-decl-init-keywords): Also exclude c-typeof-kwds from value.

	Make ">>" act as double template ender in C++ Mode.  (Bug#11386)
	* progmodes/cc-langs.el (c->-op-cont-tokens): New lang-const split
	off from c->-op-cont-re.
	(c->-op-cont-tokens): Change to use the above.
	(c->-op-without->-cont-regexp): New lang-const.
	* progmodes/cc-engine.el (c-forward-<>-arglist-recur):
	Use c->-op-without->-cont-regexp in place of c->-op-cont-tokens.


2014-08-23  Alan Mackenzie  <acm@muc.de>

	* progmodes/cc-fonts.el (c-font-lock-declarators): Fix infinite
	loop, bug #18306.  The bug was introduced on 2014-08-02.

2014-08-21  Eli Zaretskii  <eliz@gnu.org>

	* textmodes/texnfo-upd.el (texinfo-specific-section-type):
	Don't recognize a Top node if there are other sectioning commands
	earlier in the Texinfo file.  This fixes a bug in
	texinfo-make-menu and avoids inflooping in
	texinfo-all-menus-update when they are invoked on texinfo.texi.

2014-08-21  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--side-window-p): New function.
	(split-window, window-splittable-p): Use window--side-window-p to
	determine whether WINDOW can be split (Bug#18304).
	* calendar/calendar.el (calendar-basic-setup): Fix one call of
	`window-splittable-p' and add another (Bug#18304).

2014-08-20  Sam Steingold  <sds@gnu.org>

	* progmodes/python.el (python-new-pythonpath): Extract from
	`python-shell-calculate-process-environment'.

2014-08-18  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* emacs-lisp/eldoc.el (eldoc-highlight-function-argument): Add support
	for &key args (bug#18048).

2014-08-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eldoc.el (eldoc-argument-case): Obsolete and change default.
	(eldoc-function-argstring-format): Remove.
	(eldoc-function-argstring): Always return upcase args.
	Use help-make-usage.  Don't add parens.
	(eldoc-get-fnsym-args-string): Don't obey eldoc-argument-case since
	it's too late to do it right (bug#18048).

2014-08-18  Eli Zaretskii  <eliz@gnu.org>

	* scroll-bar.el (scroll-bar-horizontal-drag-1)
	(scroll-bar-toolkit-horizontal-scroll): When determining the
	paragraph direction, use the buffer of the window designated in
	the event.

2014-08-16  Andreas Schwab  <schwab@linux-m68k.org>

	* vc/diff-mode.el (diff-fixup-modifs): Handle empty line in
	context of unified diff.

2014-08-16  Paul Eggert  <eggert@cs.ucla.edu>

	Add dependencies to fix loaddefs race during parallel builds.
	Without this, for example, 'make -j bootstrap' can fail and report
	"Opening input file: no such file or directory,
	.../lisp/calendar/diary-loaddefs.el ... recipe for target
	'calendar/hol-loaddefs.el' failed", where the hol-loaddefs.el rule
	got confused because diary-loaddefs.el was being built in parallel.
	* Makefile.in ($(CAL_DIR)/diary-loaddefs.el):
	Depend on $(CAL_DIR)/cal-loaddefs.el.
	($(CAL_DIR)/hol-loaddefs.el): Depend on $(CAL_DIR)/diary-loaddefs.el.

2014-08-16  Martin Rudalics  <rudalics@gmx.at>

	* scroll-bar.el (scroll-bar-horizontal-drag-1): Use cdr of
	portion-whole for scrolling right-to-left text.

2014-08-15  Leo Liu  <sdl.web@gmail.com>

	* speedbar.el (speedbar-generic-list-tag-p): Allow special
	elements from imenu.

2014-08-15  Glenn Morris  <rgm@gnu.org>

	* subr.el (with-output-to-temp-buffer): Doc fix; from elisp manual.

2014-08-13  Jan Nieuwenhuizen  <janneke@gnu.org>

	* progmodes/compile.el (compilation-error-regexp-alist-alist):
	Add Guile regexpses.

2014-08-13  Jan Nieuwenhuizen  <janneke@gnu.org>

	* progmodes/gud.el (guiler): New function.  Starts the Guile REPL;
	add Guile debugger support for GUD.

2014-08-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* obsolete/mouse-sel.el (mouse-sel-mode): Use add/remove-function.
	(mouse-sel--ignore): New function.
	(mouse-sel-has-been-enabled, mouse-sel-original-bindings)
	(mouse-sel-original-interprogram-cut-function)
	(mouse-sel-original-interprogram-paste-function): Remove.

2014-08-13  Eric S. Raymond  <esr@thyrsus.com>

	* vc/vc-git.el (vc-git-resolve-when-done): New function.
	Call "git add" when there are no longer conflict markers.

2014-08-13  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* vc/vc-git.el (vc-git-find-file-hook): New function.
	Adds support for calling smerge (and resolve) on a conflicted file.
	(vc-git-conflicted-files): New function.
	Useful in itself and a step towards better smerge support.

2014-08-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mpc.el (mpc-reorder): Don't bother splitting the "active" elements
	to the first part if they're the same as the selection.

2014-08-12  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* image-mode.el (image-transform-reset): New command and menu item.
	(image-mode-map): Rearrange the menu items to put presumably more
	obscure items at the end.

2014-08-12  Juri Linkov  <juri@jurta.org>

	* vc/vc-annotate.el (vc-annotate-background-mode):
	Use `with-demoted-errors' instead of `ignore-errors'.  (Bug#18189)

2014-08-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files.el (out-of-memory-warning-percentage): Turn it off by default.

2014-08-11  Sam Steingold  <sds@gnu.org>

	* textmodes/sgml-mode.el (sgml-validate-command): Set depending on
	the presence of known validators (tidy, (o)nsgmls).

2014-08-11  Ulf Jasper  <ulf.jasper@web.de>

	Newsticker: introduce `newsticker-treeview-date-format'.  (Bug#17227)
	* net/newst-treeview.el (newsticker-treeview-date-format): New.
	(newsticker--treeview-list-add-item):
	Use `newsticker-treeview-date-format'.

2014-08-11  Glenn Morris  <rgm@gnu.org>

	* files.el (basic-save-buffer-2): Revert 2013-01-31 change, which
	chose coding system for writing before backing up, since it causes
	a more serious problem than the one it solves.  (Closes Bug#18141,
	reopens Bug#13522.)

2014-08-11  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-total-size): Make doc-string more self-contained.

	* window.el (display-buffer-below-selected): Restore original
	behavior if buffer is already displayed in the window below the
	selected one (Bug#18181).

2014-08-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el (mouse--down-1-maybe-follows-link): Don't convert the down
	event (bug#18212).

2014-08-11  Eli Zaretskii  <eliz@gnu.org>

	* info.el (info): Doc fix.

2014-08-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* info.el (Info-mode-map): Override a global down-mouse-2 binding
	(bug#18212).

2014-08-11  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (default-line-height): A floating-point value of
	line-spacing means a fraction of the default frame font's height,
	not of the font currently used by the 'default' face.
	Truncate the pixel value, like the display engine does.
	(window-screen-lines): Use window-inside-pixel-edges for
	determining the window height in pixels.  (Bug#18195)

2014-08-11  Grégoire Jadi  <daimrod@gmail.com>

	* leim/quail/latin-post.el: Transform " __" into " _".  (Bug#18023)

2014-08-10  Ulf Jasper  <ulf.jasper@web.de>

	Enumerate evaluated sexp diary entries (Bug#7911).
	* calendar/icalendar.el (icalendar-export-sexp-enumerate-all)
	(icalendar-export-sexp-enumeration-days): New.
	(icalendar-export-region): Now `icalendar--convert-to-ical'
	returns a cons cell or a list of cons cells.
	(icalendar--convert-to-ical): Take care of
	`icalendar-export-sexp-enumerate-all'.  Return (a list of) cons cells.
	(icalendar--convert-ordinary-to-ical)
	(icalendar--convert-weekly-to-ical, icalendar--convert-yearly-to-ical)
	(icalendar--convert-block-to-ical, icalendar--convert-block-to-ical)
	(icalendar--convert-float-to-ical, icalendar--convert-cyclic-to-ical)
	(icalendar--convert-anniversary-to-ical): Return cons cell.
	(icalendar--convert-sexp-to-ical): Enumerate evaluated sexp
	entries.  Return (list of) cons cells.

2014-08-09  Juri Linkov  <juri@jurta.org>

	* vc/vc-annotate.el (vc-annotate-background-mode): Add :set
	to reevaluate `vc-annotate-color-map'.  (Bug#18189)

2014-08-09  Alan Mackenzie  <acm@muc.de>

	* progmodes/cc-fonts.el (c-font-lock-declarators): Remove check
	for top-level that can cause unacceptable slow-down in scrolling.
	See email Subject: Huge {...} blocks in C/C++ again, from Dmitry
	Antipov from 2013-10-14 in emacs-devel.

2014-08-08  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* ibuffer.el (ibuffer-mode-map): Use toggle button for
	`ibuffer-auto-mode' menu entry.
	(ibuffer-mode-hook): Add `ibuffer-auto-mode' customization option.

2014-08-08  Matthias Meulien  <orontee@gmail.com>

	* progmodes/prog-mode.el (prog-mode-hook): Make customizable.
	(Bug#16394)

2014-08-07  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--min-size-1): Explicitly set WINDOW arg in
	calls of window-min-pixel-height and window-min-pixel-width.

2014-08-07  Reuben Thomas  <rrt@sc3d.org>

	* progmodes/ada-mode.el:
	* net/tramp.el (tramp-handle-file-symlink-p):
	* net/tramp-ftp.el (tramp-ftp-file-name-handler): Remove a comment
	about VMS, which we no longer support.
	* progmodes/ada-xref.el (ada-xref-current): Remove mention of VMS,
	and fix a FIXME, using convert-standard-filename in place of
	removed ada-convert-file-name.

2014-08-07  Eli Zaretskii  <eliz@gnu.org>

	* files.el (auto-mode-alist): Remove support for VMS from a pattern.

2014-08-07  Reuben Thomas  <rrt@sc3d.org>

	Refer to MS-DOS using the same name everywhere.
	* arc-mode.el, files.el, frame.el: ``MS-DOG'', ``MSDOG'' and
	``msdog'' become ``MS-DOS''.

2014-08-07  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-out-of-band):
	Use cached "remote-copy-args" value, if available.  (Bug#18199)

2014-08-07  Leo Liu  <sdl.web@gmail.com>

	* help.el (temp-buffer-setup-hook,temp-buffer-show-hook):
	Revert change on 2014-03-22.

2014-08-06  Ulf Jasper  <ulf.jasper@web.de>

	* calendar/icalendar.el (icalendar--diarytime-to-isotime)
	(icalendar--convert-ordinary-to-ical): Allow for missing minutes
	(Bug#13750).


2014-08-05  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* image-mode.el (image-toggle-display-image): Always rescale images
	to not be bigger than the current window.

2014-08-05  Eric Brown  <brown@fastmail.fm>  (tiny change)

	* net/eww.el (eww-bookmarks-directory): New variable.
	(eww-write-bookmarks): Use it.
	(eww-read-bookmarks): Ditto.

2014-08-05  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-copy-url): Also copy the image URL.

2014-08-05  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cache.el (tramp-flush-file-function): Suppress function
	also for Tramp working buffers.

2014-08-04  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el: Fix completions inside (i)pdb.
	(python-shell-completion-pdb-string-code): Make obsolete.
	(python-shell-completion-get-completions):
	Use python-shell-completion-string-code resending setup code
	continuously for (i)pdb.

2014-08-04  Paul Eggert  <eggert@cs.ucla.edu>

	* rect.el (rectangle--default-line-number-format): Rename
	from misspelled rectange--default-line-number-format (Bug#18045).
	All uses changed.

2014-08-03  Paul Eggert  <eggert@cs.ucla.edu>

	Don't mishandle year-9999 dates (Bug#18176).
	* calendar/parse-time.el (parse-time-rules):
	Allow years up to most-positive-fixnum.
	* calendar/time-date.el (date-to-time):
	Pass "Specified time is not representable" errors through.

2014-08-02  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el: Completion code cleanups.
	(python-shell-completion-get-completions): Detect and send import
	statements directly to completion function.
	(python-shell-completion-at-point): Simplify prompt calculation
	and import vs input completion logic.

2014-08-02  Alan Mackenzie  <acm@muc.de>

	Fix confusion in C++ file caused by comma in "= {1,2},".
	Bug #17756.
	* progmodes/cc-engine.el (c-beginning-of-statement-1): In checking
	for a statement boundary marked by "}", check there's no "="
	before the "{".
	(c-guess-basic-syntax CASE 9B): Call c-beginning-of-statement with
	non-nil `comma-delim' argument.
	* progmodes/cc-fonts.el (c-font-lock-declarators): Parse an
	initializer expression more accurately.

	Correct loop termination condition in c-syntactic-skip-backward.
	* progmodes/cc-engine.el (c-syntactic-skip-backward): Correct for
	the situation where, after moving back out of a literal,
	skip-chars-backward doesn't move further, yet checks have still to
	be done.

2014-08-01  Eli Zaretskii  <eliz@gnu.org>

	* tutorial.el (tutorial--display-changes): Accept punctuation
	characters before the key binding.  (Bug#18146)

2014-07-31  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el: Shell output capture enhancements.
	(python-shell-accept-process-output): New function.
	(inferior-python-mode)
	(python-shell-send-setup-code): Use it.

2014-07-30  Christophe Deleuze  <christophe.deleuze@free.fr>  (tiny change)

	* calendar/icalendar.el (icalendar--decode-isodatetime):
	Use actual current-time-zone when converting to local time.  (Bug#15408)

2014-07-29  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--state-put-2): Handle horizontal scroll
	bars, if present.

2014-07-29  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* menu-bar.el (menu-bar-update-buffers): Update item list format
	in `buffers-menu' to confirm with changes to `get_keyelt'
	(r117463).  (Bug#18016)

2014-07-28  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (inferior-python-mode): Make input prompts
	read-only.

2014-07-28  Emilio C. Lopes  <eclig@gmx.net>

	* net/tramp-sh.el (tramp-get-remote-python): Also search for
	executables named "python2" or "python3".
	(tramp-get-remote-uid-with-python): Use parentheses around
	arguments to `print' to make it compatible with Python 3.
	(tramp-get-remote-gid-with-python): Ditto.  (Bug#18118)

2014-07-28  Eli Zaretskii  <eliz@gnu.org>

	* window.el (window--pixel-to-total): Use FRAME's root window, not
	that of the selected frame.  (Bug#18112, Bug#16674)

2014-07-28  Andreas Schwab  <schwab@linux-m68k.org>

	* textmodes/tex-mode.el (tex-font-lock-verb): Doc fix.
	(Bug#18117)

2014-07-28  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (inferior-python-mode): Doc fix.

2014-07-28  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-edit-item--next-key): If next key is
	not a character, ignore it instead of raising an error.

	* calendar/todo-mode.el: Fix handling of marked items and make
	minor code improvements.
	(todo-edit-item): If there are marked items, ensure user can only
	invoke editing commands that work with marked items.
	(todo-edit-item--text): When there are marked items, make it a
	noop if invoked with point not on an item; otherwise, ensure it
	applies only to item at point.
	(todo-item-undone): If there are marked not-done items, return
	point to its original position before signaling user error.
	(todo--user-error-if-marked-done-item): New function.
	(todo-edit-item--header, todo-edit-item--diary-inclusion)
	(todo-item-done): Use it.

2014-07-28  Glenn Morris  <rgm@gnu.org>

	* files.el (toggle-read-only): Re-add basic doc-string.
	* vc/vc-hooks.el (vc-toggle-read-only): Tweak obsolescence mesage.

	* progmodes/prolog.el (prolog-mode-keybindings-edit):
	Replace missing `switch-to-prolog' with `run-prolog'.
	(switch-to-prolog): Define as (obsolete) alias, as in 23.4.

2014-07-28  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-set-top-priorities): Fix overwriting
	of file-wide setting when changing category-wide setting.

2014-07-28  Stephen Berman  <stephen.berman@gmx.net>

	* doc-view.el (doc-view-open-text): Don't require that the
	document is saved in a file (e.g., email attachment).

2014-07-28  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Parse completion input in a iPython friendly way.  (Bug#18084)
	* progmodes/python.el
	(python-shell-completion-at-point): Rename from
	python-shell-completion-complete-at-point.
	(inferior-python-mode): Use it.
	(python-completion-at-point): Rename from
	python-completion-complete-at-point.  Parse input up to first
	backward occurrence of whitespace, open-paren, close-paren or
	string delimiter.
	(python-mode): Use it.

2014-07-28  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el
	(python-shell-with-shell-buffer): New macro.
	(python-shell-font-lock-get-or-create-buffer)
	(python-shell-font-lock-kill-buffer)
	(python-shell-font-lock-with-font-lock-buffer)
	(python-shell-font-lock-cleanup-buffer)
	(python-shell-font-lock-toggle): Use it.
	(python-shell-font-lock-turn-on)
	(python-shell-font-lock-turn-off): Use it.  Make command.

2014-07-28  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Grab all Python process output before inferior-python-mode hooks.
	* progmodes/python.el (inferior-python-mode):
	Call accept-process-output and sit-for to ensure all output for process
	has been received before running hooks.
	(python-shell-internal-get-or-create-process):
	Cleanup accept-process-output and sit-for calls.

2014-07-28  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	More robust shell startup and code setup.
	* progmodes/python.el (python-shell-make-comint):
	Remove accept-process-output call.
	(python-shell-get-buffer): Return current buffer if major-mode is
	inferior-python-mode.
	(python-shell-get-or-create-process): Use it.
	(python-shell-send-setup-code): Send all setup code in one string,
	output success message and accept-process-output.

2014-07-27  Eli Zaretskii  <eliz@gnu.org>

	* scroll-bar.el (scroll-bar-toolkit-horizontal-scroll):
	Add rudimentary support for bidirectional text.

2014-07-27  Martin Rudalics  <rudalics@gmx.at>

	* frame.el (frame-notice-user-settings): Rewrite using
	frame-initial-frame-tool-bar-height.
	* menu-bar.el (menu-bar-horizontal-scroll-bar)
	(menu-bar-no-horizontal-scroll-bar): New functions.
	(menu-bar-showhide-scroll-bar-menu): Add bindings for horizontal
	scroll bars.
	* scroll-bar.el (scroll-bar-lines)
	(set-horizontal-scroll-bar-mode)
	(get-horizontal-scroll-bar-mode, horizontal-scroll-bar-mode)
	(scroll-bar-horizontal-drag-1, scroll-bar-horizontal-drag)
	(scroll-bar-toolkit-horizontal-scroll): New functions.
	(horizontal-scroll-bar-mode)
	(previous-horizontal-scroll-bar-mode)
	(horizontal-scroll-bar-mode-explicit): New variables.
	(horizontal-scroll-bar-mode): New option.
	(toggle-horizontal-scroll-bar): Do something.
	(top-level): Bind horizontal-scroll-bar mouse-1.
	* startup.el (tool-bar-originally-present): Remove variable.
	(command-line): Don't set tool-bar-originally-present.
	* window.el (window-min-height): Update doc-string.
	(window--dump-frame): Dump horizontal scroll bar values.
	(window--min-size-1): Handle minibuffer window separately.
	Count in margins and horizontal scroll bar.  Return safe value
	iff IGNORE equals 'safe.
	(frame-windows-min-size): New function (used by frame resizing
	routines).
	(fit-frame-to-buffer, fit-window-to-buffer): Count in horizontal
	scroll bars.
	(window--sanitize-window-sizes): New function.
	(window-split-min-size): Remove.
	(split-window): Count divider-width.  Don't use
	`window-split-min-size' any more.  Reword error messages.
	Sanitize windows sizes after splitting.

2014-07-27  Thien-Thi Nguyen  <ttn@gnu.org>

	Use `defvar-local' more.
	* progmodes/hideshow.el
	(hs-c-start-regexp, hs-block-start-regexp)
	(hs-block-start-mdata-select, hs-block-end-regexp)
	(hs-forward-sexp-func, hs-adjust-block-beginning): ...here;
	remove corresponding `make-variable-buffer-local' top-level calls.

2014-07-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Cleanup error signals.  (Bug#18067)
	* progmodes/python.el
	(python-indent-shift-left): Use user-error instead.
	(python-shell-prompt-detect): Use lwarn with python group.
	(python-completion-complete-at-point)
	(python-eldoc--get-doc-at-point): Don't signal error.

2014-07-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Support for packages in Python shell.  (Bug#13570)
	* progmodes/python.el (python-shell--package-depth): New var.
	(python-shell-package-enable): New command.
	(python-util-list-directories, python-util-list-files)
	(python-util-list-packages): New functions.

2014-07-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Faster comint output.  (Bug#16875)
	* progmodes/python.el:
	(python-comint-output-filter-function): Make obsolete.
	(python-comint-postoutput-scroll-to-bottom): New function.
	(inferior-python-mode): Set comint-output-filter-functions to a
	minimum.

2014-07-27  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-font-lock-post-command-hook):
	Safeguard current point and undo history.

2014-07-26  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Robust shell syntax highlighting.  (Bug#18084, Bug#16875)
	* progmodes/python.el:
	(python-shell-prompt-input-regexps): Add iPython block prompt.
	(python-shell-output-syntax-table): Delete var.
	(python-shell-font-lock-with-font-lock-buffer): New macro.
	(python-shell-font-lock-get-or-create-buffer)
	(python-shell-font-lock-kill-buffer)
	(python-shell-font-lock-cleanup-buffer)
	(python-shell-font-lock-post-command-hook)
	(python-shell-font-lock-turn-off): New functions.
	(python-shell-font-lock-turn-on): New function.
	(inferior-python-mode): Use it.
	(python-shell-font-lock-toggle): New command.
	(python-shell-font-lock-enable): Rename from
	python-shell-enable-font-lock.
	(run-python-internal): Use it.
	(python-shell-font-lock-comint-output-filter-function): New function.
	(python-shell-comint-end-of-output-p): New function.
	(python-shell-output-filter): Use it.
	(python-util-comint-last-prompt): New function.
	(python-util-text-properties-replace-name): New function.

2014-07-25  Glenn Morris  <rgm@gnu.org>

	* vc/ediff-init.el (ediff-toggle-read-only-function):
	* vc/ediff-util.el (ediff-toggle-read-only):
	Replace obsolete toggle-read-only with read-only-mode.

2014-07-24  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cache.el (tramp-flush-file-function): Wrap the code
	with `save-match-data'.  (Bug#18095)

2014-07-21  Vincent Belaïche  <vincentb1@users.sourceforge.net>

	* ses.el (ses-truncate-cell): Use cl-progv instead of eval in
	order to ensure that row and col are lexically bound inside the
	evaluated sexp.

2014-07-21  Glenn Morris  <rgm@gnu.org>

	* progmodes/hideif.el (hide-ifdef-mode-submap):
	Also substitute read-only-mode.
	* bindings.el (mode-line-toggle-read-only):
	* bs.el (bs-toggle-readonly):
	* buff-menu.el (Buffer-menu-toggle-read-only):
	* dired.el (dired-toggle-read-only):
	* files.el (view-read-only, find-file-read-only)
	(find-file-read-only-other-window)
	(find-file-read-only-other-frame):
	* progmodes/hideif.el (hide-ifdef-toggle-outside-read-only):
	Doc fixes re toggle-read-only.

2014-07-21  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el: Add comment about pipe buffering and
	solutions for missing/delayed output in inferior Python shells.
	(Bug#17304)

	* progmodes/python.el (python-mode): Don't set
	mode-require-final-newline.  (Bug#17990)

	Make python.el work with IPython automatically.  (Bug#15510)
	* progmodes/python.el:
	(python-shell-completion-setup-code): New value supporting iPython.
	(python-shell-completion-string-code): New value supporting iPython.
	(python-shell-completion-get-completions): Use them.
	(python-shell-completion-module-string-code): Make obsolete.
	(python-shell-prompt-input-regexps)
	(python-shell-prompt-output-regexps): Add safeguard for ipdb.
	(python-shell-output-filter): Fix comment typo.

	Fix Python shell prompts detection for remote hosts.
	* progmodes/python.el (python-shell-prompt-detect):
	Replace call-process with process-file and make it more robust.

	Autodetect Python shell prompts.  (Bug#17370)
	* progmodes/python.el:
	(python-shell-interpreter-interactive-arg)
	(python-shell-prompt-detect-enabled)
	(python-shell-prompt-detect-failure-warning)
	(python-shell-prompt-input-regexps)
	(python-shell-prompt-output-regexps): New vars.
	(python-shell-prompt-calculated-input-regexp)
	(python-shell-prompt-calculated-output-regexp): New vars.
	(python-shell-get-process-name)
	(python-shell-internal-get-process-name)
	(python-shell-output-filter)
	(python-shell-completion-get-completions): Use them.
	(python-shell-prompt-detect)
	(python-shell-prompt-validate-regexps): New functions.
	(python-shell-prompt-set-calculated-regexps): New function.
	(inferior-python-mode): Use it.  Also honor overridden
	python-shell-interpreter and python-shell-interpreter-args.
	(python-shell-make-comint): Honor overridden
	python-shell-interpreter and python-shell-interpreter-args.
	(python-shell-get-or-create-process): Make it testable by allowing
	to call run-python non-interactively.
	(python-util-valid-regexp-p): New function.
	(python-shell-prompt-regexp, python-shell-prompt-block-regexp)
	(python-shell-prompt-output-regexp)
	(python-shell-prompt-pdb-regexp): Use it as defcustom :safe.

2014-07-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-config--guess-1): Split from
	smie-config--guess.
	(smie-config--guess): Use it.

	* emacs-lisp/edebug.el: Use nadvice.
	(edebug-original-read): Remove.
	(edebug--read): Rename from edebug-read and add `orig' arg.
	(edebug-uninstall-read-eval-functions)
	(edebug-install-read-eval-functions): Use nadvice.
	(edebug-read-sexp, edebug-read-storing-offsets, edebug-read-symbol)
	(edebug-read-and-maybe-wrap-form1, edebug-instrument-callee)
	(edebug-read-string, edebug-read-function): Use just `read'.
	(edebug-original-debug-on-entry): Remove.
	(edebug--debug-on-entry): Rename from edebug-debug-on-entry and add
	`orig' arg.
	(debug-on-entry): Override with nadvice.

	* mouse.el (tear-off-window): Rename from mouse-tear-off-window since
	it also makes sense to bind it to a non-mouse event.

	* vc/vc-bzr.el (vc-bzr-shelve): Make it operate on fileset.

2014-07-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* xt-mouse.el (xterm-mouse-event): Don't assume last-click is non-nil
	(bug#18015).

	* rect.el (rectangle--string-preview): Don't assume there
	a non-nil default (bug#17984).

2014-07-16  Glenn Morris  <rgm@gnu.org>

	* desktop.el (after-init-hook): Disable startup frame restoration
	in non-graphical situations.  (Bug#17693)

	* vc/vc-dispatcher.el (vc-log-edit): Do set up the log buffer
	if it was "empty", or used for a different set of files.  (Bug#17884)

2014-07-16  Eli Zaretskii  <eliz@gnu.org>

	* bindings.el (mode-line-remote): If default-directory is not a
	string, don't call file-remote-p on it; instead state in the
	help-echo that it is nil.  (Bug#17986)

2014-07-14  Daniel Colascione  <dancol@dancol.org>

	* progmodes/cc-langs.el: Change comments from `cl-macroexpand-all'
	to `macroexpand-all'

	* progmodes/cc-defs.el (c-lang-defconst-eval-immediately):
	Use `macroexpand-all' instead of `cl-macroexpand-all'.

2014-07-12  Paul Eggert  <eggert@cs.ucla.edu>

	Fix bug: C-x v v discarded existing log message (Bug#17884).
	* vc/vc-dispatcher.el (vc-log-edit):
	Don't clobber an already-existing log message.

2014-07-12  Glenn Morris  <rgm@gnu.org>

	* vc/log-edit.el (log-edit-changelog-entries):
	Check for a visited-but-never-saved ChangeLog.

2014-07-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/log-edit.el (log-edit-changelog-entries): Don't both visiting
	a non-existing file (bug#17970).

	* faces.el (face-name): Undo last change.
	(x-resolve-font-name): Don't call face-name (bug#17956).

2014-07-12  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Fix dedenters and electric colon handling.  (Bug#15163)
	* progmodes/python.el
	(python-rx-constituents): Add dedenter and block-ender.
	(python-indent-dedenters, python-indent-block-enders): Delete.
	(python-indent-context): Return new case for dedenter-statement.
	(python-indent-calculate-indentation): Handle new case.
	(python-indent-calculate-levels): Fix levels calculation for
	dedenter statements.
	(python-indent-post-self-insert-function): Fix colon handling.
	(python-info-dedenter-opening-block-message): New function.
	(python-indent-line): Use it.
	(python-info-closing-block)
	(python-info-closing-block-message): Remove.
	(python-info-dedenter-opening-block-position)
	(python-info-dedenter-opening-block-positions)
	(python-info-dedenter-statement-p): New functions.

2014-07-11  Dmitry Antipov  <dmantipov@yandex.ru>

	* files.el (out-of-memory-warning-percentage): New defcustom.
	(warn-maybe-out-of-memory): Use it.

2014-07-11  Michael Albinus  <michael.albinus@gmx.de>

	* subr.el (read-passwd): Use `read-hide-char' if non-nil.  Bind it
	when calling `read-string'.  (Bug#17839)

2014-07-10  Eli Zaretskii  <eliz@gnu.org>

	* files.el (warn-maybe-out-of-memory): Fix the wording of the
	warning.

2014-07-10  Dmitry Antipov  <dmantipov@yandex.ru>

	* files.el (warn-maybe-out-of-memory): New function.
	(find-file-noselect): Use it.

2014-07-09  Sam Steingold  <sds@gnu.org>

	* progmodes/cperl-mode.el (cperl-block-p): Treat the perl keyword
	`constant' like `bless', `return' &c

2014-07-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* rect.el (apply-on-rectangle): Check forward-line really moved to the
	next line.

2014-07-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-smie-sh-rules): Don't align with a && in
	the middle of a line (bug#17896).

2014-07-09  Juri Linkov  <juri@jurta.org>

	* startup.el (command-line): Append displaying the warning about
	the errors in the init file to the end of `after-init-hook'.
	(Bug#17927)

	* faces.el (face-name): Return input arg `face' as-is
	when it's not a symbol.
	(x-resolve-font-name): Don't check if the face is a symbol.
	(Bug#17956)

	* facemenu.el (list-colors-print): In help-echo format use %.2f
	instead of %d because now HSV values are floating-point components
	between 0.0 and 1.0.

2014-07-09  Glenn Morris  <rgm@gnu.org>

	* emulation/cua-rect.el (cua--activate-rectangle):
	Avoid setting cua--rectangle to nil.  (Bug#17877)

2014-07-09  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Fix wrong-type-argument error when
	marking multiple consecutive items.
	(todo-toggle-mark-item): Don't try to mark the empty lines at the
	end of the todo and done items sections.  Note in doc string that
	items marked by passing a numeric prefix argument can include the
	last todo and first done items.
	(todo-mark-category): Don't try to mark the empty line between the
	todo and done items sections.

2014-07-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-eval-defun): Print result using
	proper Lisp quoting (bug#17934).

	* progmodes/ruby-mode.el (ruby-mode-variables): Don't meddle with
	require-final-newline since prog-mode already took care of it (bug#17947).

2014-07-09  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Fix two bugs.  Shorten Commentary and
	refer to the Todo mode Info manual.  Update the comment on
	requiring cl-lib.
	(todo-find-filtered-items-file): Add todo-prefix overlays.
	(todo-filter-items): Reorder a let-bound variable to avoid a
	wrong-type-argument error on canceling the file choice dialog.

2014-07-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/octave.el (inferior-octave-mode):
	Set comint-input-ring-size to a number (bug#17912).

2014-07-09  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-minor-mode-table): Add `defining-kbd-macro'
	and `isearch-mode' associated with nil.  (Bug#17849)

2014-07-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* linum.el (linum--face-height): New function (bug#17813).
	(linum-update-window): Use it to adjust margin to linum's width.

	* leim/quail/sisheng.el (sisheng-list): Don't bother with-case-table.
	* eshell/em-smart.el (eshell-smart-scroll-window):
	Use with-selected-window.

	* xt-mouse.el (xterm-mouse-translate-1): Intern drag event (bug#17894).
	Remove also pointless window&mark manipulation.

	* progmodes/perl-mode.el: Use syntax-ppss; fix one indentation case.
	(perl-indent-line): Use syntax-ppss to detect we're in a doc-section.
	(perl-continuation-line-p): Don't skip over anything else than labels.
	Return the previous char.
	(perl-calculate-indent): Use syntax-ppss instead of parse-start
	and update callers accordingly.  For continuation lines, check the
	the case of array hashes.
	(perl-backward-to-noncomment): Make it non-interactive.
	(perl-backward-to-start-of-continued-exp): Rewrite.

2014-07-08  Sam Steingold  <sds@gnu.org>

	* progmodes/inf-lisp.el (lisp-eval-paragraph, lisp-eval-form-and-next):
	New user commands.

2014-07-08  Juri Linkov  <juri@jurta.org>

	* vc/vc-annotate.el (vc-annotate-background-mode): New defcustom.
	(vc-annotate-color-map): Use less saturated colors (20%) for
	background-mode.
	(vc-annotate-very-old-color): Add default value for background-mode.
	(vc-annotate-background): Set default value to nil since now text on
	the default backgrounds should be legible in light and dark modes.
	(vc-annotate-lines): Use `vc-annotate-background-mode'.  Doc fix.
	(Bug#17808)

2014-07-08  Juri Linkov  <juri@jurta.org>

	* simple.el (transpose-chars): Don't move point into read-only area.
	(Bug#17829)

2014-07-08  Juri Linkov  <juri@jurta.org>

	* window.el (with-displayed-buffer-window): New macro.
	(with-temp-buffer-window, with-current-buffer-window):
	Use `macroexp-let2' to evaluate and bind variables
	in the same order as macro arguments.
	(display-buffer--action-function-custom-type):
	Add `display-buffer-below-selected' and `display-buffer-at-bottom'.

	* minibuffer.el (minibuffer-completion-help): Replace
	`with-output-to-temp-buffer' with `with-displayed-buffer-window'
	with actions that display *Completions* at-bottom when called
	from the minibuffer, or below-selected in a normal buffer.
	Associate `window-height' with `fit-window-to-buffer'.
	Let-bind `pop-up-windows' to nil.

	* dired.el (dired-mark-pop-up): Use `with-displayed-buffer-window'
	instead of `with-current-buffer-window'.  (Bug#17809)

2014-07-07  Luke Lee  <luke.yx.lee@gmail.com>

	* progmodes/hideif.el (hide-ifdef-env): Change to global.
	(hide-ifdef-env-backup): New variable.
	(hide-ifdef-expand-reinclusion-protection, hide-ifdef-header-regexp):
	New customizable variables.
	(hif-clear-all-ifdef-defined): New defun.
	(hif-merge-ifdef-region, hide-ifdef-region-internal, hide-ifdef-region)
	(hif-show-ifdef-region): Merge hidden regions to prevent continuous "...".
	(hif-tokenize): Fix for MS-DOS/Win EOL style.
	(hif-endif-to-ifdef, hif-make-range, hif-find-range, hif-possibly-hide):
	Fix bug to hide the correct #elif region(s).
	(hif-range-elif): New defun.
	(hif-recurse-level): New var.
	(hif-evaluate-region, hif-evaluate-macro): New defun.
	(hide-ifdef-guts): Prevent reinclusion protected C/C++ headers from
	fully hidden.
	(hide-ifdef-define, hide-ifdefs, hide-ifdef-block, show-ifdef-block):
	Better interaction.

2014-07-04  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus-peer-handler): New defun.
	(dbus-register-service): Register it.  (Bug#17858)
	(dbus-managed-objects-handler): Fix docstring.

2014-07-04  Phil Sainty  <psainty@orcon.net.nz>

	* emacs-lisp/lisp.el (narrow-to-defun-include-comments): New var.
	(narrow-to-defun): New arg include-comments, defaulting to it
	(bug#16328).

2014-07-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* rect.el (rectangle--highlight-for-redisplay): Don't pass `orig' with
	different calling convention to rectangle--unhighlight-for-redisplay.

2014-07-03  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-call-process): Handle error strings.

	* net/tramp-adb.el (tramp-adb-sh-fix-ls-output): Use `bolp'.

	* net/tramp-sh.el (tramp-sh-handle-set-visited-file-modtime)
	(tramp-sh-handle-verify-visited-file-modtime): Use `point-at-eol'.

	* net/trampver.el: Update release number.

2014-07-03  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-save): Rename arg `auto-save' to
	`only-if-changed'.  Doc fix.  (Bug#17873)

2014-07-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el (mouse-yank-primary, mouse-yank-secondary):
	Use insert-for-yank (bug#17271).

2014-07-03  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/pp.el (pp-eval-expression, pp-eval-last-sexp):
	Support lexical-binding.

2014-07-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/log-edit.el (log-edit-goto-eoh): New function.
	(log-edit--match-first-line): Use it (bug#17861).

2014-07-03  Glenn Morris  <rgm@gnu.org>

	* vc/log-edit.el (log-edit-hook): Add missing :version.

2014-07-03  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-post-self-insert-function):
	Enhancements to electric indentation behavior inside
	parens.  (Bug#17658)

2014-07-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ps-def.el (ps-generate-postscript-with-faces1): Don't mess with
	buffer-invisibility-spec (bug#17867).

2014-07-03  Andreas Schwab  <schwab@linux-m68k.org>

	* vc/vc-git.el (vc-git-checkin): When operating on the whole tree
	pass "-a".

2014-07-03  Glenn Morris  <rgm@gnu.org>

	* cus-edit.el (help):
	* finder.el (finder-known-keywords):
	* help.el (help-for-help-internal):
	* vc/ediff-mult.el (ediff-meta-buffer-verbose-message)
	(ediff-redraw-registry-buffer):
	* vc/ediff-ptch.el (ediff-patch-file-internal):
	Doc fixes re "online" help.  (Bug#17803)

	* progmodes/idlwave.el (idlwave): Update url-link for custom group.
	(idlwave-mode): Doc URL update.

2014-07-01  Juri Linkov  <juri@jurta.org>

	* man.el: Display man pages immediately and use process-filter
	to format them asynchronously.
	(Man-width): Doc fix.
	(man): Doc fix.
	(Man-start-calling): Use `with-selected-window' to get
	`frame-width' and `window-width'.
	(Man-getpage-in-background): Call `Man-notify-when-ready'
	immediately after creating a new buffer.  Call `Man-mode' and set
	`mode-line-process' in the created buffer.  Set process-filter to
	`Man-bgproc-filter' in start-process branch.  In call-process branch
	call either `Man-fontify-manpage' or `Man-cleanup-manpage'.
	Use `Man-start-calling' inside `with-current-buffer'.
	(Man-fontify-manpage): Don't print messages.  Fix boundary condition.
	(Man-cleanup-manpage): Don't print messages.
	(Man-bgproc-filter): New function.
	(Man-bgproc-sentinel): Add `save-excursion' to keep point when
	user moved it during asynchronous formatting.  Move calls of
	`Man-fontify-manpage' and `Man-cleanup-manpage' to
	`Man-bgproc-filter'.  Move the call of `Man-mode' to
	`Man-getpage-in-background'.  Use `quit-restore-window'
	instead of `kill-buffer'.  Use `message' instead of `error'
	because errors are caught by process sentinel.
	(Man-mode): Move calls of `Man-build-page-list',
	`Man-strip-page-headers', `Man-unindent', `Man-goto-page' to
	`Man-bgproc-sentinel'.  Doc fix.  (Bug#2588, bug#5054, bug#9084, bug#17831)

	* man.el (Man-bgproc-sentinel): Use `Man-page-from-arguments'
	for the message about the man page cleaned up.

2014-07-01  Mario Lang  <mlang@delysid.org>

	* net/gnutls.el (gnutls-negotiate): Prevent destructive modification of
	cosutomization option `gnutls-verify-error'.

2014-07-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (deactivate-mark, set-mark-command, handle-shift-selection):
	Don't keep transient-mark-mode buffer-local when not needed (bug#6316).

	* xt-mouse.el (turn-on-xterm-mouse-tracking-on-terminal)
	(turn-off-xterm-mouse-tracking-on-terminal): Don't burp if the terminal
	is suspended (bug#17857).

2014-07-01  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-open-connection-setup-interactive-shell):
	Prefer utf-8 coding.  (Bug#17859)

2014-06-30  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* emacs-lisp/subr-x.el (string-reverse): Define as obsolete alias
	for `reverse'.

2014-06-30  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/autoload.el (autoload-ensure-writable): New variable.
	(autoload-ensure-default-file): Maybe make existing output writable.
	* Makefile.in (AUTOGEN_VCS): Remove.
	(autoloads): Use autoload-ensure-writable rather than AUTOGEN_VCS.

2014-06-30  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* emacs-lisp/subr-x.el (string-reverse): Use `reverse'.

2014-06-30  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	New if-let, when-let, thread-first and thread-last macros.

	* emacs-lisp/subr-x.el
	(internal--listify, internal--check-binding)
	(internal--build-binding-value-form, internal--build-binding)
	(internal--build-bindings): New functions.
	(internal--thread-argument, thread-first, thread-last)
	(if-let, when-let): New macros.

2014-06-30  Grégoire Jadi  <daimrod@gmail.com>

	* net/rcirc.el (rcirc-buffer-process): Restore previous
	behavior.  (Bug#17772)

2014-06-29  Alan Mackenzie  <acm@muc.de>

	Don't call c-parse-state when c++-template-syntax-table is active.
	* progmodes/cc-engine.el (c-guess-continued-construct CASE G)
	(c-guess-basic-syntax CASE 5D.3): Rearrange so that
	c-syntactic-skip-backwards isn't called with the pertinent syntax table.

2014-06-28  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-set-top-priorities): Fix logic to
	account for file-wide setting of todo-top-priorities-overrides.
	Make code a bit cleaner.

2014-06-28  Glenn Morris  <rgm@gnu.org>

	* net/eww.el (eww-mode) <eww-current-title>: Make local.  (Bug#17860)

2014-06-28  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-prefix-overlays): If there is no
	category-wide setting of todo-top-priorities-overrides, check for
	a file-wide setting and fontify accordingly.

2014-06-28  Glenn Morris  <rgm@gnu.org>

	* subr.el (read-passwd): Warn about batch mode.  (Bug#17839)

2014-06-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/hideif.el: Use lexical-binding.  Fix up cl-lib usage.

2014-06-28  K. Handa  <handa@gnu.org>

	Fix Bug#17739.

	* composite.el: Setup composition-function-table for dotted circle.
	(compose-gstring-for-dotted-circle): New function.

	* international/characters.el: Add category "^" to all
	non-spacing characters.

2014-06-28  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (doit): Remove force rule.
	(custom-deps, finder-data, autoloads, update-subdirs)
	(compile-one-process): PHONY targets do not need force rules.

	* Makefile.in (compile-main, compile, compile-always):
	No need to explicitly pass variables to ourself in recursive calls.

2014-06-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files.el (minibuffer-with-setup-hook): Evaluate the first arg eagerly.

2014-06-26  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (update-authors): Update for moved authors.el.

2014-06-26  Leo Liu  <sdl.web@gmail.com>

	* skeleton.el (skeleton-end-hook): Default to nil and move the
	work to skeleton-insert.  (Bug#17850)

2014-06-26  Dmitry Antipov  <dmantipov@yandex.ru>

	* calc/calc-alg.el (math-beforep):
	* progmodes/cc-guess.el (c-guess-view-reorder-offsets-alist-in-style):
	Simplify because string-lessp can accept symbols as args.

2014-06-26  Daiki Ueno  <ueno@gnu.org>

	* emacs-lisp/package.el (package--check-signature):
	If package-check-signature is allow-unsigned, don't signal error when
	we can't verify signature because of missing public key
	(bug#17625).

2014-06-26  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/cl-macs.el (help-add-fundoc-usage):
	Remove outdated declaration.

	* emacs-lisp/authors.el (authors-valid-file-names)
	(authors-renamed-files-alist): Additions.

2014-06-26  Leo Liu  <sdl.web@gmail.com>

	* textmodes/picture.el (picture-set-tab-stops):
	* ruler-mode.el (ruler-mode-mouse-add-tab-stop)
	(ruler-mode-ruler): Fix to work with nil tab-stop-list.

	* progmodes/asm-mode.el (asm-calculate-indentation):
	Use indent-next-tab-stop.

	* indent.el (indent-accumulate-tab-stops): New function.

2014-06-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-list-unsigned): New var (bug#17625).
	(package-desc-status): Obey it.

2014-06-26  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Fix two bugs.
	(todo-insert-item--basic): If user cancels item insertion to
	another category before setting priority, show original category
	whether it is in the same or a different file.
	(todo-set-item-priority): After selecting category, instead of
	moving point to top, which extends an active region, restore it.

2014-06-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help-fns.el (describe-function-1): Check file-name is a string before
	calling help-fns--autoloaded-p (bug#17564).

2014-06-26  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-auto-save-enable)
	(desktop-auto-save-disable): New functions.
	(desktop-save-mode, desktop-auto-save-timeout): Use them.
	(desktop-read): Disable the autosave before loading the desktop,
	and enable afterwards.  (Bug#17351)

2014-06-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	Fix some indentation problem with \; and pipes (bug#17842).
	* progmodes/sh-script.el (sh-mode-syntax-table): Set syntax of ;|&.
	(sh-smie--default-forward-token, sh-smie--default-backward-token):
	New functions.
	(sh-smie-sh-forward-token, sh-smie-sh-backward-token)
	(sh-smie-rc-forward-token, sh-smie-rc-backward-token): Use them.
	(sh-smie-sh-rules): Fix indentation of a pipe at BOL.

2014-06-26  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/find-func.el (find-function-C-source-directory):
	Use file-accessible-directory-p.

	* ps-samp.el: Make it slightly less awful.
	(ps-rmail-mode-hook, ps-gnus-article-prepare-hook, ps-vm-mode-hook):
	(ps-gnus-summary-setup, ps-info-mode-hook): Use [print] key.
	Only set local values.
	(ps-article-subject, ps-article-author): Use standard functions
	like mail-fetch-field.
	(ps-info-file, ps-info-node): Use match-string.
	(ps-jts-ps-setup, ps-jack-setup): Remove, merging into...
	(ps-samp-ps-setup): ... new function.

	* progmodes/idlw-shell.el (idlwave-shell-make-temp-file):
	Optimize away code unneeded on any modern Emacs.

	* emacs-lisp/authors.el: Move to ../admin.

	* emacs-lisp/ert.el (ert-summarize-tests-batch-and-exit): New.

2014-06-26  Luke Lee  <luke.yx.lee@gmail.com>

	* progmodes/hideif.el (hif-string-to-number): Fix return value bug.
	(hif-simple-token-only, hif-tokenize): Comment in detail mainly for
	performance enhancements.
	(hif-parse-if-exp): Rename to `hif-parse-exp'.  Enhance for macro
	expansion.
	(hif-factor, hif-string-concatenation, intern-safe): Support string
	concatenation and argumented macro expansion.
	(hif-if-valid-identifier-p, hif-define-operator, hif-flatten)
	(hif-expand-token-list, hif-get-argument-list, hif-define-macro)
	(hif-delimit, hif-macro-supply-arguments, hif-invoke, hif-canonicalize)
	(hif-canonicalize-tokens, hif-place-macro-invocation)
	(hif-parse-macro-arglist): Mostly new functions for supporting
	argumented macro expansion.
	(hif-string-concatenation, hif-stringify, hif-token-concat)
	(hif-token-stringification, hif-token-concatenation):
	Stringification and concatenation.
	(hif-find-next-relevant): Fix comments.
	(hif-ifdef-to-endif, hif-looking-at-elif, hif-hide-line): Bug fix for
	some cases involving #elif.
	(hif-find-define, hif-add-new-defines): New functions for automatically
	scanning of defined symbols.
	(hide-ifdef-guts): Fix for defined symbol auto scanning.
	(hide-ifdef-undef): Fix behavior to match CPP.

2014-06-25  Glenn Morris  <rgm@gnu.org>

	* Makefile.in ($(lisp)/progmodes/cc-defs.elc)
	($(lisp)/progmodes/cc-fonts.elc, $(lisp)/progmodes/cc-langs.elc)
	($(lisp)/progmodes/cc-vars.elc): Drop hand-written deps on non-cc
	files.  They are not relevant to the original issue (bug#1004),
	and cause unnecessary recompilation (bug#2151).

2014-06-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* play/landmark.el: Use lexical-binding and avoid `intangible'.
	(landmark--last-pos): New var.
	(landmark--intangible-chars): New const.
	(landmark--intangible): New function.
	(landmark-mode, landmark-move): Use it.
	(landmark-mode): Remove properties.
	(landmark-plot-square, landmark-point-square, landmark-goto-xy)
	(landmark-cross-qtuple):
	Don't worry about `intangible' any more.
	(landmark-click, landmark-point-y): Same; and don't assume point-min==1.
	(landmark-init-display): Don't set `intangible' and `point-entered'.
	(square): Remove.  Inline it instead.
	(landmark--distance): Rename from `distance'.
	(landmark-calc-distance-of-robot-from): Rename from
	calc-distance-of-robot-from.
	(landmark-calc-smell-internal): Rename from calc-smell-internal.

2014-06-25  Dmitry Antipov  <dmantipov@yandex.ru>

	* files.el (dir-locals-find-file, file-relative-name):
	* info.el (Info-complete-menu-item):
	* minibuffer.el (completion-table-subvert): Prefer string-prefix-p
	to compare-strings to avoid out-of-range errors.
	* subr.el (string-prefix-p): Adjust to match strict range
	checking in compare-strings.

2014-06-24  Leonard Randall  <leonard.a.randall@gmail.com>  (tiny change)

	* textmodes/reftex-parse.el (reftex-using-biblatex-p): Make search
	for comment lines non-greedy and stopping at newlines to fix stack
	overflows with large files.

2014-06-24  Eli Barzilay  <eli@barzilay.org>

	* calculator.el (calculator-last-input): Drop 'ascii-character property
	lookup.

2014-06-24  Leo Liu  <sdl.web@gmail.com>

	* align.el (align-adjust-col-for-rule): Unbreak due to defaulting
	tab-stop-list to nil.  (Bug#16381)

	* indent.el (indent-next-tab-stop): Rename from indent--next-tab-stop.
	(indent-rigidly-left-to-tab-stop)
	(indent-rigidly-right-to-tab-stop, tab-to-tab-stop)
	(move-to-tab-stop): Change callers.

2014-06-24  Eli Zaretskii  <eliz@gnu.org>

	* skeleton.el (skeleton-insert): Yet another fix of the doc string
	wrt behavior of \n as the first/last element of a skeleton.

2014-06-24  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el (tramp-adb-handle-process-file):
	* net/tramp-sh.el (tramp-sh-handle-process-file):
	* net/tramp-smb.el (tramp-smb-handle-process-file): Do not raise
	the output buffer when DISPLAY is non-nil.  (Bug#17815)

2014-06-24  Glenn Morris  <rgm@gnu.org>

	* play/landmark.el (landmark-move-down, landmark-move-up):
	Fix 2007-10-20 change - preserve horizontal position.

2014-06-23  Sam Steingold  <sds@gnu.org>

	* simple.el (kill-append): Remove undo boundary depending on ...
	(kill-append-merge-undo): New user option.

2014-06-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (handle-shift-selection, exchange-point-and-mark)
	(activate-mark): Set transient-mark-mode buffer-locally (bug#6316).
	(transient-mark-mode): Use&set the global value.
	* mouse.el (mouse-set-region-1, mouse-drag-track): Idem.
	* emulation/edt.el (edt-emulation-off): Save&restore the global
	transient-mark-mode setting.
	* obsolete/pc-select.el (pc-selection-mode): Use the
	transient-mark-mode function.

2014-06-23  Eli Zaretskii  <eliz@gnu.org>

	* international/fontset.el (script-representative-chars):
	Add representative characters for scripts added in Unicode 7.0.
	(otf-script-alist): Synchronize with the latest registry of OTF
	script tags.

	* international/characters.el (char-script-table): Update for
	scripts added and codepoint ranges changed in Unicode 7.0.

2014-06-23  Eli Barzilay  <eli@barzilay.org>

	* calculator.el (calculator-standard-displayer): Fix bug in use of
	`calculator-groupize-number'.
	(calculator-funcall): Fix broken `cl-flet' use by moving it into the
	`eval' code, so it works in v24.3.1 too.
	(calculator-last-input): Comment to clarify purpose.

2014-06-22  Mario Lang  <mlang@delysid.org>

	* textmodes/rst.el (rst-comment-region): From from -> from.

	* net/tramp-adb.el (tramp-adb-send-command-and-check): And and -> and.

2013-06-22  Dmitry Antipov  <dmantipov@yandex.ru>

	* electric.el (electric-layout-post-self-insert-function):
	* emacs-lisp/ert.el (ert--insert-infos):
	* obsolete/vi.el (vi-set-mark):
	* term.el (term-handle-scroll):
	* textmodes/bibtex.el (bibtex-fill-field, bibtex-fill-entry):
	* wid-edit.el (widget-editable-list-value-create):
	Prefer point-marker to copy-marker of point.

2014-06-21  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Fix completion retrieval parsing (bug#17209).
	* progmodes/python.el (python-mode):
	(python-util-strip-string): New function.
	(python-shell-completion-get-completions): Use it.

2014-06-21  Eli Zaretskii  <eliz@gnu.org>

	* skeleton.el (skeleton-insert): Fix last change.

2014-06-21  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Enhancements for outline integration (bug#17796).
	* progmodes/python.el (python-mode): Properly set
	outline-heading-end-regexp so that comments after colons for
	defuns are supported.

2014-06-21  Eli Zaretskii  <eliz@gnu.org>

	* skeleton.el (skeleton-insert): Doc fix.

2014-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-config--guess): Fix typo.
	(smie-config-guess): Use smie-config-local so the rules are obeyed
	(bug#17818).

	* mouse.el (mouse-drag-line): Don't re-add to unread-comment-events,
	since it's already done inside the loop (bug#17819).

2014-06-21  Martin Rudalics  <rudalics@gmx.at>

	* mouse.el (mouse-drag-line): Re-remove code initially removed
	on 2013-03-09 and inadvertently reintroduced on 2013-11-30
	(Bug#17819).

2014-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-smie-sh-rules): For { after &&, don't
	align with the surrounding parent (bug#17721).

2014-06-21  Eli Zaretskii  <eliz@gnu.org>

	* textmodes/texinfo.el (texinfo-mode): Set skeleton-end-newline
	locally to nil.
	(texinfo-insert-block, texinfo-insert-@end)
	(texinfo-insert-@example, texinfo-insert-@quotation): Adjust to
	local setting of skeleton-end-newline by adding an explicit \n to
	the skeletons where appropriate.  (Bug#17801)

2014-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie--hanging-eolp-function): New var.
	(smie-indent--hanging-p): Use it.
	* progmodes/sh-script.el (sh-set-shell): Set it (bug#17621).

2014-06-21  Leo Liu  <sdl.web@gmail.com>

	* simple.el (read-quoted-char): Don't let help chars pop up help
	buffer.  (Bug#16617)

2014-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-smie-sh-rules): Use same rule for && as
	for | (bug#17621).

	* xt-mouse.el (xterm-mouse--read-event-sequence-1000):
	Drop unknown events instead of burping.

2014-06-21  Eli Zaretskii  <eliz@gnu.org>

	* term/w32-win.el (dynamic-library-alist): Support giflib 5.1.0
	and later.  (Bug#17790)

2014-06-21  Juri Linkov  <juri@jurta.org>

	* dired.el (dired-mark-pop-up): Let-bind display-buffer-mark-dedicated
	to `soft'.  (Bug#17554)

2014-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* delsel.el (electric-newline-and-maybe-indent): Mark it as well
	(bug#17737).

2014-06-21  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Don't fontify
	`!' in `!~' with `font-lock-negation-char-face'.  (Bug#17732)

2014-06-21  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus-call-method): Push only non D-Bus events into
	`unread-command-events'.

2014-06-19  William Xu  <william.xwl@gmail.com>

	* progmodes/hideif.el (hif-string-to-number): Don't return float for
	hex integer constants (bug#17807).

2014-06-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/mule-util.el (truncate-string-ellipsis): New var.
	(truncate-string-to-width): Use it.

2014-06-19  Robert Brown  <robert.brown@gmail.com>  (tiny change)

	* emacs-lisp/lisp-mode.el (lisp-string-after-doc-keyword-p): New fun.
	(lisp-string-in-doc-position-p): New function, extracted from
	lisp-font-lock-syntactic-face-function.
	(lisp-font-lock-syntactic-face-function): Use them (bug#9130).

2014-06-19  Grégoire Jadi  <daimrod@gmail.com>

	* net/rcirc.el (rcirc-omit-mode): Fix recenter error.  (Bug#17769)

2014-06-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* play/bubbles.el (bubbles--initialize, bubbles--show-scores)
	(bubbles--game-over): Don't add `intangible' properties since they
	didn't work anyway.

2014-06-18  Juri Linkov  <juri@jurta.org>

	* vc/ediff-init.el (ediff-current-diff-Ancestor)
	(ediff-fine-diff-Ancestor, ediff-even-diff-A, ediff-even-diff-B)
	(ediff-even-diff-C, ediff-even-diff-Ancestor, ediff-odd-diff-A)
	(ediff-odd-diff-B, ediff-odd-diff-C, ediff-odd-diff-Ancestor):
	Add `min-colors 88' version with removed black/white foregrounds.
	(Bug#10181)

2014-06-18  Juri Linkov  <juri@jurta.org>

	* vc/diff-mode.el (diff-changed): Empty face definition to use
	`diff-removed' and `diff-added' on tty as well.  (Bug#10181)
	(diff-context): Use darker color on light background and
	lighter color on dark background.

2014-06-18  Juri Linkov  <juri@jurta.org>

	* vc/diff-mode.el (diff-refine-changed): Rename from
	`diff-refine-change' for consistency with `diff-changed'.
	(diff-refine-change): Add obsolete face alias.  (Bug#10181)

	* vc/smerge-mode.el (smerge-refined-changed): Rename from
	`smerge-refined-change'.
	(smerge-refined-change): Add obsolete face alias.

2014-06-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* rect.el (rectangle-preview): New custom.
	(rectangle): New group.
	(rectangle--pos-cols): Add `window' argument.
	(rectangle--string-preview-state, rectangle--string-preview-window):
	New vars.
	(rectangle--string-flush-preview, rectangle--string-erase-preview)
	(rectangle--space-to, rectangle--string-preview): New functions.
	(string-rectangle): Use them.
	(rectangle--inhibit-region-highlight): New var.
	(rectangle--highlight-for-redisplay): Obey it.  Make sure
	`apply-on-region' uses the point-crutches of the right window.
	Use :align-to rather than multiple spaces.

2014-06-16  Andrea Rossetti  <andrea.rossetti@gmail.com>  (tiny change)

	* ruler-mode.el (ruler-mode-window-col)
	(ruler-mode-mouse-set-left-margin)
	(ruler-mode-mouse-set-right-margin): Fix calculation of column
	from mouse position (Bug#17768).

2014-06-16  Ron Schnell  <ronnie@driver-aces.com>

	* play/dunnet.el (dun-doassign): Fix bug where UNIX variable assignment
	without varname or rhs causes crash.
	(dun-ftp): Fix bug where blank ftp password is allowed, making it
	impossible to win endgame.
	(dun-unix-verbs): Add ssh as alias to rlogin, because nobody knows what
	rlogin is anymore.
	(dun-help): Bump version number; update contact info.

2014-06-15  Eli Barzilay  <eli@barzilay.org>

	* calculator.el (calculator-prompt, calculator-remove-zeros)
	(calculator-mode-hook, calculator-operators, calculator-stack)
	(calculator-mode): Tweak docstring.
	(calculator-user-operators): Tweak docstring, fix a bug in the last
	example.
	(calculator-displayer): `std' case has an optional boolean.
	(calculator-displayers): Use the new boolean to group in decimal mode.
	(calculator-mode-map, calculator, calculator-message)
	(calculator-op-arity, calculator-add-operators)
	(calculator-string-to-number, calculator-displayer-prev)
	(calculator-displayer-next, calculator-remove-zeros)
	(calculator-eng-display, calculator-number-to-string)
	(calculator-update-display, calculator-last-input)
	(calculator-clear-fragile, calculator-digit, calculator-decimal)
	(calculator-exp, calculator-saved-move, calculator-clear)
	(calculator-copy, calculator-put-value, calculator-help)
	(calculator-expt, calculator-truncate): Minor code improvements.
	(calculator-need-3-lines): New function pulling out code from
	`calculator'.
	(calculator-get-display): Rename from `calculator-get-prompt', and
	improved.
	(calculator-push-curnum): Rename from `calculator-curnum-value', and
	extended for all uses of it.  All callers changed.
	(calculator-groupize-number): New utility for splitting a number into
	groups.
	(calculator-standard-displayer): Improve code, new optional argument to
	use comma-split groups, make second argument optional too to use with
	'left/'right inputs.  All callers changed.
	(calculator-reduce-stack-once): New utility, doing the meat of what
	`calculator-reduce-stack' used to do, much improved (mostly using
	`pcase' for conciseness and clarity).
	(calculator-reduce-stack): Now doing just the reduction loop using
	`calculator-reduce-stack-once'.
	(calculator-funcall): Improve code, make it work in v24.3.1 too.
	(calculator-last-input): Improve code, remove some old cruft.
	(calculator-quit): Kill `calculator-buffer' in electric mode too.
	(calculator-integer-p): Remove.
	(calculator-fact): Improve code, make it work on non-integer values
	too (using truncated numbers).

2014-06-15  Michael Albinus  <michael.albinus@gmx.de>

	Sync with Tramp 2.2.10.

	* net/tramp.el (tramp-methods): Tweak docstring.
	(tramp-handle-file-accessible-directory-p): Check for
	`file-readable-p' instead of `file-executable-p'.
	(tramp-check-cached-permissions):
	Use `tramp-compat-file-attributes'.
	(tramp-call-process): Add new argument VEC.  Adapt callees in all
	tramp*.el files.

	* net/tramp-adb.el (tramp-adb-handle-write-region): Improve messages.
	(tramp-adb-maybe-open-connection): Don't set
	`tramp-current-*' variables.

	* net/tramp-cache.el (tramp-flush-file-function): Do not flush
	file properties of temporary buffers.

	* net/tramp-ftp.el (top): Remove special handling for URL syntax.

	* net/tramp-gvfs.el (tramp-gvfs-methods) <sftp>: Add.
	(tramp-gvfs-handle-delete-file): Flush file
	properties, not directory properties.
	(tramp-gvfs-handle-file-attributes): Use `string-to-number' when
	reading "unix::mode".
	(tramp-gvfs-handle-file-name-all-completions):
	Use "-h" option for "gvfs-ls".
	(tramp-gvfs-url-file-name): `user' and `localname' could be nil.
	(tramp-gvfs-send-command): Simplify traces.

	* net/tramp-sh.el (vc-handled-backends, vc-bzr-program)
	(vc-git-program, vc-hg-program): Declare.
	(tramp-methods) <sftp>: Remove.  It has never worked satisfactorily.
	(tramp-methods) <nc>: Add new method.
	(tramp-methods) <telnet>: Redirect stderr to "/dev/null".
	(tramp-methods) <plink, plinkx, pscp, psftp>: Improve
	`tramp-login-args'.
	(tramp-default-user-alist): Add "nc".
	(top): Remove completion function for "sftp".  Add completion
	functions for "nc" and "psftp".
	(tramp-do-copy-or-rename-file-out-of-band): Tweak docstring.
	Implement support for "nc" method.
	(tramp-sh-handle-expand-file-name, tramp-local-coding-commands)
	(tramp-remote-coding-commands, tramp-call-local-coding-command):
	Tweak docstring.
	(tramp-sh-handle-write-region): Tweak error message.
	(tramp-sh-handle-vc-registered): Remove backends when the remote
	binary does not exist.
	(tramp-find-inline-encoding): Do not raise an error.
	(tramp-make-copy-program-file-name): Tweak docstring.  Handle also
	the "nc" case.  Quote result also locally.

	* net/tramp-smb.el (tramp-smb-handle-copy-directory)
	(tramp-smb-handle-set-file-acl): Use `start-process'.
	(tramp-smb-handle-insert-directory): Use progress reporter.
	(tramp-smb-handle-rename-file): Flush also file properties of
	FILENAME.

	* net/trampver.el: Update release number.

2014-06-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ses.el: Miscellaneous cleanups; use lexical-binding; avoid
	add-to-list.
	(ses-localvars): Remove ses--local-printer-list, unused.
	(ses--metaprogramming): New macro.  Use it to defvar variables.
	(ses-set-localvars): Simplify.
	(ses--locprn, ses-cell): Use defstruct.  Change ses-cell's
	property-list into an alist.
	(ses-locprn-get-compiled, ses-locprn-compiled-aset)
	(ses-locprn-get-def, ses-locprn-def-aset, ses-locprn-get-number):
	Remove; use defstruct accessors/setters instead.
	(ses-cell-formula-aset, ses-cell-printer-aset)
	(ses-cell-references-aset): Remove, use setf instead.
	(ses--alist-get): New function.
	(ses-cell-property): Rename from ses-cell-property-get and rewrite.
	Use an alist instead of a plist and don't do move-to-front since the
	list is always short.
	(ses-cell-property-get-fun, ses-cell-property-delq-fun)
	(ses-cell-property-set-fun, ses-cell-property-set)
	(ses-cell-property-pop-fun, ses-cell-property-get-handle)
	(ses-cell-property-handle-car, ses-cell-property-handle-setcar): Remove.
	(ses--letref): New macro.
	(ses-cell-property-pop): Rewrite.
	(ses--cell): Rename from ses-cell and make it into a function.
	Make `formula' fallback on `value' if nil.
	(ses--local-printer): Rename from ses-local-printer and make it into
	a function.
	(ses-set-cell): Turn it into a macro so finding the accessor from the
	field name is done at compile time.
	(ses-repair-cell-reference-all): Test presence of `sym' rather than
	`ref' before adding `sym' to :ses-repair-reference.
	(ses-calculate-cell): Use ses--letref rather than
	ses-cell-property-get-handle.
	(ses-write-cells): Use a single prin1-to-string.
	(ses-setter-with-undo): New function.
	(ses-aset-with-undo, ses-set-with-undo): Rewrite using it.
	(ses-unset-with-undo): Remove.
	(ses-load): Prefer apply' over `eval'.
	(ses-read-printer, ses-set-column-width): Use standard "(default
	foo)" format.

2014-06-15  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (leim, semantic): Use `make -C' rather than `cd && make'.

	* progmodes/cc-langs.el: Require cl-lib.  (Bug#17463)
	Replace delete-duplicates and mapcan by cl- versions throughout.
	And cl-macroexpand-all by macroexpand-all.
	(delete-duplicates, mapcan, cl-macroexpand-all): No need to declare.

2014-06-15  Eli Zaretskii  <eliz@gnu.org>

	* subr.el (posn-col-row): Doc fix.  (Bug#17768)

2014-06-15  Juri Linkov  <juri@jurta.org>

	* bindings.el: Put `ascii-character' property on keypad keys
	mapped to characters.  (Bug#17759)

2014-06-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-next-sexp): Fix up "other-end" info when
	bumping forward into a closing paren (bug#17761).

	* term/xterm.el (xterm--version-handler): Work around for OSX
	Terminal.app (bug#17607).

2014-06-14  Ron Schnell  <ronnie@driver-aces.com>

	* play/dunnet.el (dun-describe-room, dun-mode):
	If a lamp is in the room, you won't be eaten by a grue.

2014-06-13  Glenn Morris  <rgm@gnu.org>

	* Makefile.in ($(lisp)/cus-load.el, $(lisp)/finder-inf.el)
	(autoloads, $(lisp)/subdirs.el, compile-main, leim, semantic, compile)
	(compile-always): GNU make automatically passes
	command-line arguments to sub-makes.

	* calendar/calendar.el (calendar-generate-window):
	Remove pointless call to font-lock-fontify-buffer.

2014-06-13  Matthias Meulien  <orontee@gmail.com>

	* simple.el (completion-list-mode-map): Navigate with tab and backtab
	(bug#17767).

2014-06-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (set-mark-command): Simplify a bit.

2014-06-12  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* help.el (help--key-binding-keymap): New function.
	(help--binding-locus): New function.
	(describe-key): Mention the keymap in which the binding was
	found.  (bug#13948)

2014-06-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* hippie-exp.el (he--all-buffers): New function.
	(try-expand-line-all-buffers, try-expand-list-all-buffers)
	(try-expand-dabbrev-all-buffers): Use it.

2014-06-12  Emilio C. Lopes  <eclig@gmx.net>

	* hippie-exp.el (try-expand-line-all-buffers)
	(try-expand-list-all-buffers, try-expand-dabbrev-all-buffers):
	Read hippie-expand-only-buffers and hippie-expand-ignore-buffers in the
	original buffer, in case they're buffer-local.

2014-06-12  Vincent Belaïche  <vincentb1@users.sourceforge.net>

	* ses.el (ses-initial-global-parameters-re): New defconst, a
	specific regexp is needed now that ses.el can handle both
	file-format 2 --- ie. no local printers --- and 3 --- i.e. may have
	local printers.
	(ses-localvars): Add local variables needed for local printer handling.
	(ses-set-localvars): Handle hashmap initialization.
	(ses-paramlines-plist): Add param-line for number of local printers.
	(ses-paramfmt-plist): New defconst, needed for code factorization
	between functions `ses-set-parameter' and
	`ses-file-format-extend-paramter-list'
	(ses-make-local-printer-info): New defsubst.
	(ses-locprn-get-compiled, ses-locprn-compiled-aset)
	(ses-locprn-get-def, ses-locprn-def-aset, ses-locprn-get-number)
	(ses-cell-printer-aset): New defmacro.
	(ses-local-printer-compile): New defun.
	(ses-local-printer): New defmacro.
	(ses-printer-validate, ses-call-printer): Add support for local
	printer functions.
	(ses-file-format-extend-paramter-list): New defun.
	(ses-set-parameter): Use const `ses-paramfmt-plist' for code
	factorization.
	(ses-load): Add support for local printer functions.
	(ses-read-printer): Update docstring and add support for local printer
	functions.
	(ses-refresh-local-printer, ses-define-local-printer): New defun.
	(ses-safe-printer): Add support for local printer functions.

2014-06-12  Ivan Andrus  <darthandrus@gmail.com>

	* ffap.el (ffap-lax-url): New var (bug#17723).
	(ffap-url-at-point): Use it.
	(ffap-file-at-point): Avoid returning just "/".

2014-06-12  Matthias Meulien  <orontee@gmail.com>

	* progmodes/python.el (import skeleton): New skeleton (bug#17672).
	(python-mode-map): Bind it.

	* progmodes/python.el (class skeleton): Don't erase last char of class
	name (bug#17683).

2014-06-12  Cameron Desautels  <camdez@gmail.com>  (tiny change)

	* help.el (where-is): Use `default' arg of completing-read (bug#17705).

2014-06-12  Kevin Ryde  <user42_kevin@yahoo.com.au>

	* files.el (auto-mode-alist): Map .ad files to xdefaults-mode
	(bug#17745).

2014-06-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/mule-cmds.el: Use lexical-binding.
	(ucs-names): Simplify.

2014-05-18  Eric Hanchrow  <eric.hanchrow@gmail.com>

	* progmodes/python.el (run-python): Use read-shell-command.

2014-06-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* rect.el: Make it possible to move bounds past EOL or into TABs.
	(operate-on-rectangle): Use apply-on-rectangle.
	(rectangle--mark-crutches): New var.
	(rectangle--pos-cols, rectangle--col-pos, rectangle--point-col)
	(rectangle--crutches, rectangle--reset-crutches): New functions.
	(apply-on-rectangle): Obey crutches.  Avoid setq.
	Fix missing final iteration if end is at EOB&BOL.
	(rectangle-mark-mode-map): Add remap bindings for
	exchange-point-and-mark and char/line movements.
	(rectangle--*-char): New function.
	(rectangle-exchange-point-and-mark, rectangle-right-char)
	(rectangle-left-char, rectangle-forward-char)
	(rectangle-backward-char, rectangle-next-line)
	(rectangle-previous-line): New commands.
	(rectangle--place-cursor): New function.
	(rectangle--highlight-for-redisplay): Use it.  Use apply-on-rectangle.

2014-06-08  Glenn Morris  <rgm@gnu.org>

	* startup.el (initial-buffer-choice): Doc fix.
	Reset :version (adding an option does not merit a :version bump).

	* bookmark.el (bookmark-load):
	* uniquify.el (uniquify-buffer-name-style): Doc fixes.

2014-06-08  Juri Linkov  <juri@jurta.org>

	* desktop.el: Activate auto-saving on window configuration changes.
	(desktop-save-mode, desktop-auto-save-timeout): Add/remove
	`desktop-auto-save-set-timer' to/from
	`window-configuration-change-hook'.
	(desktop-auto-save-set-timer): Change REPEAT arg of
	`run-with-idle-timer' from t to nil.
	https://lists.gnu.org/archive/html/emacs-devel/2014-06/msg00147.html

2014-06-08  Santiago Payà i Miralta  <santiagopim@gmail.com>

	* vc/vc-hg.el (vc-hg-working-revision): Use "hg parent" and
	vc-hg-command (bug#17570).

2014-06-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/mule-cmds.el (ucs-names): Add special entry for BEL
	(bug#17702).

2014-06-08  Glenn Morris  <rgm@gnu.org>

	* startup.el (window-setup-hook): Doc fix.

	* emacs-lisp/package.el (package-check-signature)
	(package-unsigned-archives): Doc fixes.

2014-06-08  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-use-some-window): Don't make window
	used smaller than it was before (Bug#17671).

2014-06-08  Eli Zaretskii  <eliz@gnu.org>

	* menu-bar.el (menu-bar-open): Fix last change: use the PC
	'redisplay' instead of '(sit-for 0)'.

2014-06-08  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-ssh-controlmaster-options):
	Improve search regexp.  (Bug#17653)

2014-06-08  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/package.el (package-pinned-packages): Doc fix.

2014-06-08  Eli Zaretskii  <eliz@gnu.org>

	* menu-bar.el (menu-bar-open): Fix invocation via M-x.

2014-06-06  Santiago Payà i Miralta  <santiagopim@gmail.com>

	* vc/vc-hg.el (vc-hg-create-tag, vc-hg-retrieve-tag): New functions
	(bug#17586).

	* vc/vc-hg.el (vc-hg-log-graph): New var.
	(vc-hg-print-log): Use it.
	(vc-hg-root-log-format): Include branch name and bookmarks; ignore
	graph output (bug#17515).

2014-06-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el (mouse-posn-property): Ignore buffer position info when the
	even happened elsewhere.

2014-06-06  Mario Lang  <mlang@delysid.org>

	* emacs-lisp/tabulated-list.el (tabulated-list-print): Only call
	`recenter' if `current-buffer' is equal to `window-buffer'.

2014-06-05  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/cl-macs.el (cl-macrolet): Avoid excessive progn's.

2014-06-05  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/tildify.el (tildify-foreach-region-outside-env):
	New function which calls a callback on portions of the buffer that are
	outside of ignored environments.
	(tildify-build-regexp): Remove function since it is now
	incorporated in `tildify-foreach-region-outside-env' where it is
	optimized and simplified by the use of `mapconcat'.
	(tildify-tildify): Return number of substitutions made so that…
	(tildify-count): …can be removed.
	(tildify-find-env): Accept a new PAIRS argument which was
	previously looked up in `tildify-ignored-environments-alist' each
	time the function was called.  With this change, the lookup is
	performed only once in `tildify-foreach-region-outside-env'.
	(tildify-region): Greatly simplify the function since now most of
	the work is done by `tildify-foreach-region-outside-env'.
	(tildify-mode-alist): Simplify slightly by avoiding if and setq
	and instead using or.

	* textmodes/tildify.el (tildify-ignored-environments-alist):
	Optimize environments regexes

	Each time beginning of an environment to ignore is found,
	`tildify-find-env' needs to identify regexp for the ending
	of the environment.  This is done by trying all the opening
	regexes on matched text in a loop, so to speed that up, this
	loop should have fewer things to match, which can be done by
	using alternatives in the opening regexes.

	Coincidentally, this should make matching of the opening
	regexp faster as well thanks to the use of `regexp-opt' and
	having common prefix pulled from many regexes.

	* textmodes/tildify.el (tildify-string-alist)
	(tildify-ignored-environments-alist): Add `nxml-mode' to the list
	of supported modes since `xml-mode' is no longer a thing but just
	an alias to the former.  Also include comments and insides of tags
	in `tildify-ignored-environments-alist' for XML modes.  Finally,
	since XML does not define “&nbsp;”[1], use a numeric reference for
	a no-break space (namely “&#160;”)

	[1] XML specification defines only a handful of predefined entities.
	    The list is at <http://www.w3.org/TR/REC-xml/#sec-predefined-ent>
	    and includes only &lt;, &gt;, &amp;, &apos; and &quot; (meaning <,
	    >, &, ' and " respectively).  This is in contrast to HTML and even
	    XHTML which defined a whole bunch of entities including “&nbsp;”.

	* textmodes/tildify.el (tildify-pattern-alist)
	(tildify-string-alist, tildify-ignored-environments-alist):
	Improve defcustom's types by adding more tags explaining what each
	value means and replace “sexp” used in
	`tildify-ignored-environments-alist' with a full type declaration.

	* textmodes/tildify.el (tildify-find-env): Fix matched group
	indexes in end-regex building

	When looking for a start of an ignore-environment, the regex is built
	by concatenating regexes of all the environments configured in
	`tildify-ignored-environments-alist'.  So for example, the following
	list could be used to match TeX's \verb and \verb* commands:

	    (("\\\\verb\\(.\\)" . (1))
	     ("\\\\verb\\*\\(.\\)" . (1)))

	This would result in the following regex being used to find the start
	of any of the variants of the \verb command:

	    \\\\verb\\(.\\)\\|\\\\verb\\*\\(.\\)

	But now, if “\\\\verb\\*\\(.\\)” matches, the first capture group
	won't match anything, and thus (match-string 1) will be nil, which
	will cause building of the end-matching regex to fail.

	Fix this by using capture groups from the time when the opening
	regexes are matched individually.

	* textmodes/tildify.el (tildify-find-env): Fix end-regex building
	in `tildify-find-env'

	The `tildify-ignored-environments-alist' allows the end-regex to
	be provided not as a static string but mix of strings and indexes
	of groups matched the begin-regex.  For example, the “\verb!…!”
	TeX-command (where “!” is an arbitrary character) is handled
	using:

	    ("\\\\verb\\*?\\(.\\)" . (1))

	In the same way, the following should be supported as well:

	    ("open-\\(.\\)" . ("end-" 1))

	However the tildify-find-env function fails at

	    (concat result
	            (if (stringp (setq aux (car expression)))
	                 expression  ; BUG: expression is a list
	               (regexp-quote (match-string aux))))

	where the string part is handled incorrectly.

	The most trivial fix would be to replace `expression' in the
	true-part of the if-statement with `aux', but instead, this commit
	optimizes `tildify-find-env' by changing it to use `mapconcat'
	rather than open-coded while-loop.

2014-06-05  Mario Lang  <mlang@delysid.org>

	* woman.el (woman-mapcan): Remove.
	(woman-parse-colon-path): Use cl-mapcan instead.

2014-06-03  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* register.el: Add link to Emacs manual in Commentary.

2014-06-02  Sam Steingold  <sds@gnu.org>

	* menu-bar.el (lookup-key-ignore-too-long): Extract from...
	(popup-menu): ...here.
	(menu-bar-open): Use it to avoid an error when `lookup-key'
	returns a number.

2014-06-02  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-call-process): Add traces.
	(tramp-handle-unhandled-file-name-directory): Return "/".

2014-06-02  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode revision 3cd8144.
	* progmodes/verilog-mode.el (verilog-mode-version): Bump.
	(verilog-auto-arg-format): New option, to support newlines in AUTOARG.
	(verilog-type-font-keywords): Add nor.
	(verilog-batch-execute-func): Force reading of Local Variables.
	Fix printing "no changes to be saved" with verilog-batch.
	(verilog-auto-arg-ports): Doc fix.
	Add verilog-auto-arg-format to support newlines in AUTOARG.
	(verilog-auto-arg): Doc fix.

2014-06-02  Glenn Morris  <rgm@gnu.org>

	* emulation/crisp.el, emulation/tpu-edt.el, emulation/tpu-extras.el:
	* emulation/tpu-mapper.el, emulation/vi.el, emulation/vip.el:
	* emulation/ws-mode.el: Move to obsolete/.
	* Makefile.in (AUTOGEN_VCS): Update for moved tpu-edu.el.

2014-06-02  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (keyboard-quit): Force update of mode lines, to remove
	the "Def" indicator, if we were defining a macro.  (Bug#17615)

2014-06-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (minibuffer-force-complete-and-exit):
	Obey minibuffer-default (bug#17545).

	* progmodes/js.el (js-indent-line): Don't mix columns and chars
	(bug#17619).

	* subr.el (set-transient-map): Don't wait for some "nested"
	transient-map to finish if we're only supposed to be active for
	the next command (bug#17642).

2014-06-02  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/gv.el (window-buffer, window-display-table)
	(window-dedicated-p, window-hscroll, window-point, window-start):
	Fix gv-expander.  (Bug#17630)

2014-06-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el (mouse-posn-property): Ignore posn-point for mode-line
	clicks (bug#17633).

	* leim/quail/latin-pre.el ("latin-2-prefix"): Use ",," rather than ", "
	for the single comma, since ", " is *very* common in normal French text
	(bug#17643).

2014-06-02  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/package.el (package-check-signature)
	(package-unsigned-archives): Fix :version.

2014-06-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (sit-for): Don't run input-methods (bug#15614).

2014-06-02  Glenn Morris  <rgm@gnu.org>

	* cus-start.el: Fix some :version numbers.

2014-06-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (deactivate-mark): Set mark-active to nil even if
	deactivation is done via setting transient-mark-mode to nil,
	since one is buffer-local and the other is global.

	* emacs-lisp/byte-opt.el (byte-optimize-binary-predicate): Don't assume
	there can't be more than 2 arguments (bug#17584).

2014-06-02  Glenn Morris  <rgm@gnu.org>

	* simple.el (filter-buffer-substring-functions)
	(filter-buffer-substring-function, buffer-substring-filters)
	(filter-buffer-substring, buffer-substring--filter): Doc fixes.

	* minibuffer.el (completion-in-region-functions, completion-in-region)
	(completion--in-region): Doc fixes.

	* abbrev.el (abbrev-expand-functions, abbrev-expand-function)
	(expand-abbrev, abbrev--default-expand): Doc fixes.

2014-06-02  Paul Eggert  <eggert@cs.ucla.edu>

	Include sources used to create macuvs.h.
	* international/README: Refer to the Unicode Terms of Use rather
	than copying it bodily here, as that simplifies maintenance.

2014-06-01  Glenn Morris  <rgm@gnu.org>

	* loadup.el (load-prefer-newer): Set non-nil when dumping.  (Bug#17629)

2014-05-31  Glenn Morris  <rgm@gnu.org>

	* files.el (locate-dominating-file): Expand file argument.  (Bug#17641)

2014-05-30  Glenn Morris  <rgm@gnu.org>

	* loadup.el: Treat `command-line-args' more flexibly.

2014-05-30  Alan Mackenzie  <acm@muc.de>

	Guard (looking-at "\\s!") from XEmacs.
	* progmodes/cc-engine.el (c-state-pp-to-literal): Add guard form.

2014-05-30    Ken Olum  <kdo@cosmos.phy.tufts.edu>

	* mail/rmail.el (rmail-delete-forward, rmail-delete-backward):
	The argument COUNT is now optional, to be more backward-compatible.
	Doc fix.  (Bug#17560)

2014-05-29  Reuben Thomas  <rrt@sc3d.org>

	* whitespace.el (whitespace-report-region):
	Simplify documentation.
	(whitespace-report-region): Allow report-if-bogus to take the
	value `never', for non-interactive use.
	(whitespace-report): Refer to whitespace-report-region's
	documentation.

2014-05-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* whitespace.el: Use font-lock-flush.  Minimize refontifications.
	Side benefit: it works without jit-lock.
	(whitespace-point--used): New buffer-local var.
	(whitespace-color-on): Initialize it and flush it.  Use font-lock-flush.
	(whitespace-color-off): Use font-lock-flush.
	(whitespace-point--used, whitespace-point--flush-used): New functions.
	(whitespace-trailing-regexp, whitespace-empty-at-bob-regexp)
	(whitespace-empty-at-eob-regexp): Use them.
	(whitespace-post-command-hook): Rewrite.

	* font-lock.el (font-lock-flush, font-lock-ensure): New functions.
	(font-lock-fontify-buffer): Mark interactive-only.
	(font-lock-multiline, font-lock-fontified, font-lock-set-defaults):
	Make buffer-local.
	(font-lock-specified-p): Remove redundant boundp check.
	(font-lock-flush-function, font-lock-ensure-function): New vars.
	(font-lock-turn-on-thing-lock): Set them.
	(font-lock-default-fontify-buffer): Obey font-lock-dont-widen.
	(font-lock-after-change-function): Make `old-len' optional.
	(font-lock-set-defaults): Remove redundant `set' of font-lock-defaults.
	Call font-lock-flush, just in case.
	* progmodes/verilog-mode.el (verilog-preprocess): Disable workaround in
	recent Emacsen.
	* progmodes/vera-mode.el (vera-fontify-buffer): Declare obsolete.
	(vera-mode-map, vera-mode-menu): Remove bindings to it.
	* progmodes/idlw-help.el (idlwave-help-fontify): Use font-lock-ensure
	and with-syntax-table.
	* textmodes/conf-mode.el (conf-quote-normal):
	* progmodes/sh-script.el (sh-set-shell):
	* progmodes/prog-mode.el (prettify-symbols-mode):
	* progmodes/f90.el (f90-font-lock-n):
	* progmodes/cwarn.el (cwarn-mode):
	* nxml/nxml-mode.el (nxml-toggle-char-ref-extra-display):
	* progmodes/compile.el (compilation-setup, compilation--unsetup):
	* hi-lock.el (hi-lock-mode, hi-lock-unface-buffer)
	(hi-lock-set-pattern, hi-lock-set-file-patterns): Use font-lock-flush.
	* mail/rmail.el (rmail-variables): Set font-lock-dont-widen instead of
	font-lock-fontify-buffer-function and
	font-lock-unfontify-buffer-function.
	(rmail-unfontify-buffer-function, rmail-fontify-message):
	Use with-silent-modifications.
	* htmlfontify.el (hfy-force-fontification): Use jit-lock-fontify-now
	and font-lock-ensure.
	* bs.el (bs-show-in-buffer): Use font-lock-ensure.

2014-05-28  Thien-Thi Nguyen  <ttn@gnu.org>

	* emacs-lisp/package.el (package-generate-autoloads):
	Inhibit backup files.

2014-05-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/hideshow.el (hs-hide-all): Call syntax-propertize
	(bug#17608).

2014-05-21  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/tildify.el (tildify-buffer, tildify-region):
	Add dont-ask option.

2014-05-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (zerop): Move from C.  Add compiler-macro (bug#17475).
	* emacs-lisp/byte-opt.el (byte-optimize-zerop): Remove.

	* subr.el (internal--funcall-interactively): New.
	(internal--call-interactively): Remove.
	(called-interactively-p): Detect funcall-interactively instead of
	call-interactively.
	* simple.el (repeat-complex-command): Use funcall-interactively.
	(repeat-complex-command--called-interactively-skip): Remove.

2014-05-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* register.el (register-read-with-preview): Don't burp on
	frame switches (e.g. due to the frame we just popped).

	* mouse.el (mouse-set-region): Handle spurious drag events (bug#17562).
	(mouse-drag-track): Annotate `mouse-drag-start' so we know we moved.

2014-05-26  Andreas Schwab  <schwab@linux-m68k.org>

	* cus-face.el (custom-face-attributes): Add :distant-foreground.

2014-05-26  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--dump-frame): Remove interactive specification.

2014-05-26  Glenn Morris  <rgm@gnu.org>

	* hippie-exp.el (he-line-search-regexp):
	Handle comint-prompt-regexp containing subgroups.  (Bug#17529)

2014-05-26  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Remove dependence on auto-mode-alist,
	to avoid errors when trying to create or visit a file foo.todo
	located outside to todo-directory, and to allow having such files
	without them being tied to Todo mode (bug#17482).
	(todo-show, todo-move-category, todo-merge-category, todo-find-archive)
	(todo-archive-done-item, todo-find-filtered-items-file)
	(todo-filter-items, todo-find-item, todo-diary-goto-entry)
	(todo-category-completions, todo-read-category): When visiting a
	Todo file, make sure we're in the right mode and the buffer local
	variables are set.
	(todo-make-categories-list, todo-reset-nondiary-marker)
	(todo-reset-done-string, todo-reset-comment-string):
	After processing all Todo files, kill the buffers of those files that
	weren't being visited before the processing.
	(todo-display-as-todo-file, todo-add-to-buffer-list)
	(todo-visit-files-commands): Comment out.
	(todo-modes-set-3, todo-mode): Comment out additions to find-file-hook.
	(auto-mode-alist): Remove add-to-list calls making Todo file
	extensions unrestrictedly tied to Todo modes.

2014-05-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--member-p): Change second arg.
	(advice-function-member-p): Tell it to check both names and functions
	(bug#17531).
	(advice--add-function): Adjust call accordingly.

2014-05-26  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Miscellaneous bug fixes.
	(todo-delete-file): When deleting an archive but not its todo
	file, make sure to update the todo file's category sexp.
	(todo-move-category): Keep the moved category's name unless the
	file moved to already has a category with that name.  If the
	numerically last category of the source file was moved, make the
	first category current to avoid selecting a nonexistent category.
	(todo-merge-category): Fix implementation to make merging to a
	category in another file work as documented.  Eliminate now
	insufficient and unnecessary renaming of archive category, correct
	document string accordingly, and clarify it.  If the numerically
	last category of the source file was merged, make the first
	category current to avoid selecting a nonexistent category.
	(todo-archive-done-item): When there are marked items and point
	happens to be on an unmarked item, ignore the latter.  Don't leave
	point below last item after archiving marked items.
	(todo-unarchive-items): Fix logic to ensure unarchiving an item
	from an archive with only one category deletes the archive only
	when the category is empty after unarchiving.  Make sure the todo
	file's category sexp is updated.
	(todo-read-file-name): Allow an existing file name even when it is
	not required (todo-move-category needs this to work as documented).
	(todo-add-file): Call todo-validate-name to reject the name of an
	existing todo file (needed due to fix in todo-read-file-name).
	(todo-reset-nondiary-marker): Also reset in filtered items files.
	(todo-reset-done-string, todo-reset-comment-string): Also reset in
	regexp filtered items files.
	(todo-reset-highlight-item): Also reset in filtered items files.
	Fix incorrect variable reference in document string.

2014-05-26  Glenn Morris  <rgm@gnu.org>

	* window.el (window--dump-frame): Avoid error in --without-x builds.

2014-05-26  Glenn Morris  <rgm@gnu.org>

	* nxml/nxml-mode.el (xml-mode): Only define this alias once.

2014-05-26  Eli Zaretskii  <eliz@gnu.org>

	* frame.el (set-frame-font): Doc fix.

	* menu-bar.el (menu-set-font): Doc fix.  (Bug#17532)

2014-05-26  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package--download-one-archive):
	Use `write-region' instead of `save-buffer' to avoid running various
	hooks.  (Bug#17155)
	(describe-package-1): Same.  Insert newline at the end of the
	buffer if appropriate.

2014-05-26  Juri Linkov  <juri@jurta.org>

	* avoid.el (mouse-avoidance-set-mouse-position): Don't raise frame.
	(mouse-avoidance-ignore-p): Remove `switch-frame', add `focus-out'.
	Add more modifiers: meta, control, shift, hyper, super, alt.
	(Bug#17439)

	* avoid.el (mouse-avoidance-banish-position): Fix defcustom :options
	to allow changing its value with `set-variable'.

2014-05-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/scheme.el (scheme-mode-syntax-table): Remove hack for
	#; comments.
	(scheme-syntax-propertize, scheme-syntax-propertize-sexp-comment):
	New functions.
	(scheme-mode-variables): Set syntax-propertize-function instead of
	font-lock-syntactic-face-function.
	(scheme-font-lock-syntactic-face-function): Delete.

	* emacs-lisp/lisp.el (end-of-defun): Ensure we move (bug#17274).

	* emacs-lisp/timer.el (timer-event-handler): Don't run if canceled
	(bug#17392).

2014-05-26  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-find-inline-encoding): Do not match "%%t"
	for a temporary file name.

2014-05-26  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-ignore-invisible): Doc fix.  (Bug#17511)

2014-05-26  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus-init-bus, dbus-call-method)
	(dbus-call-method-asynchronously, dbus-send-signal)
	(dbus-method-return-internal, dbus-method-error-internal):
	Check, whether Emacs has been compiled with D-Bus support.  (Bug#17508)

2014-05-26  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* emacs-lisp/eieio-opt.el (eieio-help-class): Correctly deal with
	methods which do not have a doc string.  (Bug#17490)

2014-05-25  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-ref.el (reftex-format-special): Make it work
	also for AMS Math's \eqref macro.

2014-05-25  Thien-Thi Nguyen  <ttn@gnu.org>

	Arrange to never byte-compile the generated -pkg.el file.

	* emacs-lisp/package.el (package-generate-description-file):
	Output first-line comment to set buffer-local var `no-byte-compile'.
	Suggested by Dmitry Gutov:
	<https://lists.gnu.org/archive/html/emacs-devel/2014-05/msg00401.html>.

2014-05-25  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug: Properly quote args to generated -pkg.el `define-package'.

	* emacs-lisp/package.el (package-generate-description-file):
	Inline `package--alist-to-plist'; rewrite to selectively
	quote alist values that are not self-quoting.
	(package--alist-to-plist): Delete func.

2014-05-25  Andreas Schwab  <schwab@linux-m68k.org>

	* term/xterm.el (xterm-function-map): Add mapping for shifted
	keypad keys.

2014-05-24  Daniel Colascione  <dancol@dancol.org>

	* progmodes/subword.el (subword-find-word-boundary): Move point to
	correct spot before search.  (Bug#17580)

	* emacs-lisp/nadvice.el (defun): Write in eval-and-compile to avoid
	breaking the build.

2014-05-24  Leo Liu  <sdl.web@gmail.com>

	* calc/calc.el (math-bignum): Handle most-negative-fixnum.  (Bug#17556)

2014-05-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (completion--sreverse): Remove.
	(completion--common-suffix): Use `reverse' instead.
	* emacs-lisp/regexp-opt.el (regexp-opt-group): Use `reverse' on strings.

2014-05-22  Glenn Morris  <rgm@gnu.org>

	* shell.el (shell-mode) <shell-dirstack-query>: Bypass bash aliases.

2014-05-21  Daniel Colascione  <dancol@dancol.org>

	* files.el (interpreter-mode-alist): Add mksh.

	* progmodes/sh-script.el (sh-ancestor-alist): Add mksh, a pdksh
	derivative.
	(sh-alias-alist): Alias /system/bin/sh (Android's system shell) to
	mksh. Improve custom spec; allow regular expressions.
	(sh-shell): Delegate name splitting to `sh-canonicalize-shell'.
	(sh-after-hack-local-variables): New function.
	(sh-mode): Use it; respect file-local `sh-shell' variable.  (Bug#17333)
	(sh-set-shell): Use `sh-canonicalize-shell' instead of open-coding
	the normalization.
	(sh-canonicalize-shell): Rewrite to support regexes.

2014-05-21  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/cl-lib.el (cl-endp): Fix last change.

2014-05-19  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/cl-lib.el (cl-endp): Conform to CL's semantics.

2014-05-18  Glenn Morris  <rgm@gnu.org>

	* loadup.el:
	* play/gametree.el: `track-mouse' is always defined since 2012-11-24.

2014-05-14  Sam Steingold  <sds@gnu.org>

	* progmodes/python.el (python-shell-get-or-create-process):
	Do not bind `current-prefix-arg' so that C-c C-z does not talk
	back unless requested.

2014-05-14  Glenn Morris  <rgm@gnu.org>

	* subr.el (with-file-modes): New macro.
	* printing.el (pr-save-file-modes): Make obsolete.
	* eshell/esh-util.el (eshell-with-file-modes): Make obsolete.
	* emacs-lisp/lisp-mode.el (lisp-el-font-lock-keywords-2):
	Add with-file-modes.
	* doc-view.el (doc-view-make-safe-dir):
	* epg.el (epg--start):
	* files.el (locate-user-emacs-file, make-temp-file)
	(backup-buffer-copy, move-file-to-trash):
	* printing.el (pr-despool-print, pr-call-process, pr-text2ps):
	* eshell/esh-util.el (eshell-with-private-file-modes)
	(eshell-make-private-directory):
	* net/browse-url.el (browse-url-mosaic):
	* obsolete/mailpost.el (post-mail-send-it):
	* obsolete/pgg-pgp.el (pgg-pgp-verify-region):
	* obsolete/pgg-pgp5.el (pgg-pgp5-verify-region):
	Use with-file-modes.

	* vc/emerge.el (emerge-make-temp-file): Simplify.

2014-05-14  Stephen Berman <stephen.berman@gmx.net>
	    Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (completion-pcm--merge-try): Merge trailing / with
	suffix (bug#15419).

2014-05-14  Glenn Morris  <rgm@gnu.org>

	* vc/emerge.el (emerge-temp-file-prefix):
	Make pointless option obsolete.
	(emerge-temp-file-mode): Make non-functional option obsolete.

2014-05-14  Michael Albinus  <michael.albinus@gmx.de>

	* net/browse-url.el (browse-url):
	Use `unhandled-file-name-directory' when setting `default-directory',
	in order to circumvent stalled remote connections.  (Bug#17425)

2014-05-14  Glenn Morris  <rgm@gnu.org>

	* printing.el (subst-char-in-string, make-temp-file, pr-get-symbol):
	Optimize on Emacs, which has the relevant functions for ages.

2014-05-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (undo-make-selective-list): Obey undo-no-redo.

2014-05-12  Sam Steingold  <sds@gnu.org>

	* calendar/time-date.el (seconds-to-string): New function to
	pretty print time delay in seconds.

2014-05-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mpc.el (mpc-format): Trim Date to the year.
	(mpc-songs-hashcons): Shorten the Date field.

	* emacs-lisp/nadvice.el (advice--interactive-form): Don't get fooled
	into autoloading just because of a silly indirection.

2014-05-12  Santiago Payà i Miralta  <santiagopim@gmail.com>

	* vc/vc-hg.el (vc-hg-unregister): New function.  (Bug#17454)

2014-05-12  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/find-gc.el: Move to ../admin.

	* printing.el (pr-version):
	* ps-print.el (ps-print-version): Also mention bug-gnu-emacs.

	* net/browse-url.el (browse-url-mosaic):
	Create /tmp/Mosaic.PID as a private file.

2014-05-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el: Support adding a given function multiple times.
	(advice--member-p): If name is given, only compare the name.
	(advice--remove-function): Don't stop at the first match.
	(advice--normalize-place): New function.
	(add-function, remove-function): Use it.
	(advice--add-function): Pass the name, if any, to
	advice--remove-function.

2014-05-12  Philipp Rumpf  <prumpf@gmail.com>  (tiny change)

	* electric.el (electric-indent-post-self-insert-function): Don't use
	`pos' after modifying the buffer (bug#17449).

2014-05-12  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-insert-item-from-calendar):
	Correct argument list to conform to todo-insert-item--basic.

2014-05-12  Glenn Morris  <rgm@gnu.org>

	* files.el (cd-absolute): Test if directory is accessible
	rather than executable.  (Bug#17330)

	* progmodes/compile.el (recompile):
	Handle C-u M-x recompile from a non-compilation buffer.  (Bug#17444)

	* net/browse-url.el (browse-url-mosaic):
	Be careful when writing /tmp/Mosaic.PID.  (Bug#17428)
	This is CVE-2014-3423.

2014-05-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el: Use the normal toplevel loop while dragging.
	(mouse-set-point): Handle multi-clicks.
	(mouse-set-region): Handle multi-clicks for drags.
	(mouse-drag-region): Update call accordingly.
	(mouse-drag-track): Remove `do-mouse-drag-region-post-process' hack.
	Use the normal event loop instead of a local while/read-event loop.
	(global-map): Remove redundant bindings for double/triple-mouse-1.
	* xt-mouse.el (xterm-mouse-translate-1): Only process one event at a time.
	Generate synthetic down events when the protocol only sends up events.
	(xterm-mouse-last): Remove.
	(xterm-mouse--read-event-sequence-1000): Use xterm-mouse-last-down
	terminal parameter instead.
	(xterm-mouse--set-click-count): New function.
	(xterm-mouse-event): Detect/generate double/triple clicks.
	* reveal.el (reveal-close-old-overlays): Don't close while dragging.

	* info.el (Info-quoted): New face.
	(Info-mode-font-lock-keywords): New var.
	(Info-mode): Use it.

	* emacs-lisp/lisp-mode.el (preceding-sexp): Exclude leading "," which
	are a hindrance for C-x C-e.

2014-05-11  Leo Liu  <sdl.web@gmail.com>

	* net/rcirc.el (rcirc-sentinel): Fix last change.

2014-05-08  Sam Steingold  <sds@gnu.org>

	* net/rcirc.el (rcirc-reconnect-delay): New user option.
	(rcirc-sentinel): Auto-reconnect to the server if
	`rcirc-reconnect-delay' is non-0 (but not more often than its
	value in case the host is off-line).

2014-05-09  Eli Zaretskii  <eliz@gnu.org>

	* progmodes/grep.el (lgrep): Fix a typo in last commit.

2014-05-09  Glenn Morris  <rgm@gnu.org>

	* files.el (file-expand-wildcards):
	* man.el (Man-support-local-filenames):
	* printing.el (pr-i-directory, pr-interface-directory):
	* progmodes/grep.el (lgrep, rgrep):
	* textmodes/ispell.el (ispell-call-process)
	(ispell-call-process-region, ispell-start-process)
	(ispell-init-process): Use file-accessible-directory-p.

2014-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* xt-mouse.el: Drop spurious/oddly shaped events (bug#17378).
	(xterm-mouse--read-event-sequence-1000): Return nil if something
	looks fishy.
	(xterm-mouse-event): Propagate it.
	(xterm-mouse-translate-1): Handle it.

2014-05-08  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-insert-item--apply-args): When all
	four slots of the parameter list are filled, make sure to pass it
	to the argument list of todo-insert-item--basic.

2014-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-compute-transaction): Topological sort.
	Add optional `seen' argument to detect and break infinite loops.

2014-05-08  Eli Zaretskii  <eliz@gnu.org>

	* emacs-lisp/find-gc.el (find-gc-unsafe, find-unsafe-funcs)
	(trace-unsafe, trace-use-tree): Make parentheses style be
	according to Emacs style.

2014-05-08  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-remote-process-environment):
	Remove HISTFILE and HISTSIZE; it's too late to set them here.
	Add :version entry.
	(tramp-open-shell): Do not let-bind `tramp-end-of-output'.
	Add "HISTFILE=/dev/null" to the shell's env arguments.  Do not send
	extra "PSx=..." commands.
	(tramp-maybe-open-connection): Setenv HISTFILE to /dev/null.
	(Bug#17295)

	(tramp-uudecode): Replace the hard-coded temporary file name by a
	format specifier.
	(tramp-remote-coding-commands): Enhance docstring.
	(tramp-find-inline-encoding): Replace "%t" by a temporary file
	name.  (Bug#17415)
	This is CVE-2014-3424.

2014-05-08  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/find-gc.el (find-gc-source-directory): Give it a value.
	(find-gc-source-files): Update some names.
	(trace-call-tree): Simplify and update.
	Avoid predictable temp-file names.  (http://bugs.debian.org/747100)
	This is CVE-2014-3422.

2014-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (completion--try-word-completion): Revert fix for
	Bug#15980 (bug#17375).

	* xt-mouse.el (xterm-mouse--read-event-sequence-1000): (bug#17378)
	Always store button numbers in the same way in xterm-mouse-last;
	Don't burp is xterm-mouse-last is not set as expected.
	Never return negative indices.

2014-05-08  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-propertize-function):
	Backtrack one char if the global/char-literal var matcher hits
	inside a string.  The next char could be the beginning of an
	expression expansion.

2014-05-08  Glenn Morris  <rgm@gnu.org>

	* help-fns.el (describe-function-1): Test for an autoload before a
	macro, since `macrop' works on autoloads.  (Bug#17410)

2014-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-indent-functions-without-reindent): Add yaml.

	* minibuffer.el (completion-table-with-quoting) <completion--unquote>:
	Make sure the new point we return is within the new string (bug#17239).

2014-05-05  Daniel Colascione  <dancol@dancol.org>

	* progmodes/compile.el (compilation-error-regexp-alist-alist):
	Port `gnu' pattern to rx.

2014-05-05  Jarek Czekalski  <jarekczek@poczta.onet.pl>

	Remove unneeded prompt when closing a buffer with active
	emacsclient ("Buffer ... still has clients"), #16548.
	* server.el (server-start): Remove the only call to:
	(server-kill-buffer-query-function): Remove.

2014-05-04  Leo Liu  <sdl.web@gmail.com>

	* calendar/diary-lib.el (calendar-chinese-month-name-array):
	Defvar to pacify compiler.

2014-05-04  Eli Zaretskii  <eliz@gnu.org>

	* mail/rmailsum.el (rmail-new-summary-1): Fix a typo in a comment.

2014-05-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/ediff-diff.el (ediff-set-fine-diff-properties-in-one-buffer):
	Use nil rather than `default' for the "default" appearance (bug#17388).
	* vc/ediff-util.el (ediff-inferior-compare-regions)
	(ediff-toggle-autorefine, ediff-unselect-difference): Don't use
	a misleading `default' value when it's really a boolean.
	* vc/ediff-init.el (ediff-set-overlay-face): Don't set help-echo if the
	overlay is not visible.

2014-05-04  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-edit-file): Use display-warning.
	(todo-menu): Uncomment and update.

2014-05-04  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Reimplement item editing to have the same
	basic user interface as item insertion, and make small UI and
	larger internal improvements to the latter.
	(todo-insert-item): Add reference to the Todo mode user manual to
	the documentation string.
	(todo-insert-item--basic): Rename from todo-basic-insert-item and
	adjust all callers.  Change signature to combine diary and
	nonmarking arguments.  Incorporate functionality of deleted item
	copying command and add error checking.  Remove detailed
	descriptions of the arguments from the documentation string, since
	this is treated in the Todo mode user manual.
	(todo-copy-item, todo-edit-multiline-item)
	(todo-edit-done-item-comment, todo-edit-item-header)
	(todo-edit-item-time, todo-edit-item-date-from-calendar)
	(todo-edit-item-date-to-today, todo-edit-item-date-day-name)
	(todo-edit-item-date-year, todo-edit-item-date-month)
	(todo-edit-item-date-day, todo-edit-item-diary-nonmarking):
	Remove.
	(todo-edit-item): Reimplement as wrapper command for
	todo-edit-item--next-key and make it distinguish done and not done
	todo items.
	(todo-edit-item--text): New function, replacing old command
	todo-edit-item and incorporating deleted commands
	todo-edit-multiline-item and todo-edit-done-item-comment.
	(todo-edit-item--header): Rename from todo-basic-edit-item-header.
	Use only numeric value of prefix argument.  Remove detailed
	descriptions of the arguments from the documentation string, since
	this is treated in the Todo mode user manual.
	(todo-edit-item--diary-inclusion): New function, replacing old
	command todo-edit-item-diary-inclusion and incorporating and fixing
	functionality of deleted command todo-edit-item-diary-nonmarking,
	making sure to remove todo-nondiary-marker when adding
	diary-nonmarking-symbol.
	(todo-edit-category-diary-inclusion): Make sure to delete
	diary-nonmarking-symbol when adding todo-nondiary-marker.
	(todo-edit-category-diary-nonmarking): Fix indentation.
	(todo-insert-item--parameters): Group diary and nonmarking
	parameters together.
	(todo-insert-item--apply-args): Adjust to signature of
	todo-insert-item--basic and incorporate copy parameter.
	Make small code improvements.
	(todo-insert-item--next-param): Improve prompt and adjust it to
	new parameter grouping.  Remove obsolete code.
	(todo-edit-item--param-key-alist)
	(todo-edit-item--date-param-key-alist)
	(todo-edit-done-item--param-key-alist): New defconsts.
	(todo-edit-item--prompt): New variable.
	(todo-edit-item--next-key): New function.
	(todo-key-bindings-t): Bind "e" to todo-edit-item.
	Remove bindings of deleted commands.

2014-05-04  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/cl-macs.el (cl-deftype): Fix indentation.

2014-05-04  Glenn Morris  <rgm@gnu.org>

	* allout-widgets.el (allout-widgets-tally)
	(allout-decorate-item-guides):
	* menu-bar.el (menu-bar-positive-p):
	* minibuffer.el (completion-pcm-complete-word-inserts-delimiters):
	* progmodes/gdb-mi.el (gdbmi-same-start, gdbmi-is-number):
	* progmodes/js.el (js--inside-param-list-p)
	(js--inside-dojo-class-list-p, js--forward-destructuring-spec):
	* progmodes/prolog.el (region-exists-p):
	* progmodes/verilog-mode.el (verilog-scan-cache-ok-p):
	* textmodes/reftex-parse.el (reftex-using-biblatex-p):
	Doc fixes (replace `iff').

2014-05-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mpc.el (mpc-volume-mouse-set): Don't burp at the boundaries.

2014-05-04  Leo Liu  <sdl.web@gmail.com>

	Support Chinese diary entries in calendar and diary.  (Bug#17393)
	* calendar/cal-china.el (calendar-chinese-month-name-array): New var.
	(calendar-chinese-from-absolute-for-diary)
	(calendar-chinese-to-absolute-for-diary)
	(calendar-chinese-mark-date-pattern, diary-chinese-mark-entries)
	(diary-chinese-list-entries): New functions to list and mark
	Chinese diary entries in the calendar window.
	(diary-chinese-anniversary)
	(diary-chinese-insert-anniversary-entry)
	(diary-chinese-insert-entry, diary-chinese-insert-monthly-entry)
	(diary-chinese-insert-yearly-entry): New commands to insert
	Chinese diary entries.

	* calendar/diary-lib.el (diary-font-lock-keywords):
	Support font-locking Chinese dates.

	* calendar/cal-menu.el (cal-menu-diary-menu): Add entries for
	inserting Chinese diary entries.

	* calendar/calendar.el (diary-chinese-entry-symbol):
	New customizable variable.
	(calendar-mode-map): Add bindings for inserting Chinese diary
	entries.

2014-05-03  Juri Linkov  <juri@jurta.org>

	* dired.el (dired-check-switches, dired-switches-recursive-p):
	New functions.  (Bug#17218)
	(dired-switches-escape-p, dired-move-to-end-of-filename):
	Use `dired-check-switches'.
	(dired-insert-old-subdirs, dired-build-subdir-alist)
	(dired-sort-R-check): Use `dired-switches-recursive-p'.

2014-05-01  Barry O'Reilly  <gundaetiapo@gmail.com>

	* simple.el (undo-make-selective-list): New algorithm fixes
	incorrectness of position adjustments when undoing in region.
	(Bug#17235)
	(undo-elt-crosses-region): Make obsolete.
	(undo-adjust-elt, undo-adjust-beg-end, undo-adjust-pos):
	New functions to adjust positions using undo-deltas.

2014-05-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp-mode.el (lisp--match-hidden-arg): Only highlight past
	the last consecutive closing paren (bug#17345).

2014-04-30  Reuben Thomas  <rrt@sc3d.org>

	* dired.el (dired-mode): make terminology for eXpunge command
	consistent.  (Bug#17276)

2014-04-30  Eli Zaretskii  <eliz@gnu.org>

	* dired.el (dired-initial-position-hook, dired-initial-position):
	Doc string fixes.

2014-04-30  Glenn Morris  <rgm@gnu.org>

	* mail/rmail.el (rmail-quit): Handle killed summaries.  (Bug#17283)

2014-04-30  Matthias Dahl  <matthias.dahl@binary-island.eu>

	* faces.el (face-spec-recalc): Apply X resources only after the
	defface spec has been applied. Thus, X resources are no longer
	overridden by the defface spec which also fixes issues on win32 where
	the toolbar coloring was wrong because it is set through X resources
	and was (wrongfully) overridden.  (Bug#16694)

2014-04-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/rst.el (electric-pair-pairs): Declare.
	(rst-mode): Set it (bug#17131).

2014-04-30  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-value-to-string): Let-bind `print-length'
	and `print-level' to nil.  (Bug#17351)

2014-04-30  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* battery.el (battery-update): Handle the case where battery
	status is "N/A" (bug#17319).

2014-04-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ps-mode.el: Use SMIE.  Move string and comment recognition
	to syntax-propertize.
	(ps-mode-auto-indent): Mark as obsolete.
	(ps-mode-font-lock-keywords-1): Remove string-or-comment handling.
	(ps-mode-font-lock-keywords-3): Use symbol regexp operators instead of
	word regexp operators.
	(ps-mode-map): Move initialization into declaration.  Remove binding
	for TAB, RET, >, ], and }.
	(ps-mode-syntax-table): Move initialization into declaration.
	Don't give word syntax to non-word chars.
	(ps-run-mode-map): Move initialization into declaration.
	(ps-mode-menu-main): Remove auto-indent entry.
	(ps-mode-smie-rules): New function.
	(ps-mode): Setup smie, syntax-propertize, and electric-indent-mode.
	(ps-mode-looking-at-nested, ps-mode-match-string-or-comment): Remove.
	(ps-mode--string-syntax-table): New const.
	(ps-mode--syntax-propertize-special, ps-mode-syntax-propertize):
	New functions.
	(ps-mode-newline, ps-mode-tabkey, ps-mode-r-brace, ps-mode-r-angle)
	(ps-mode-r-gt, ps-mode-r-balance): Remove functions.

2014-04-27  Daniel Colascione  <dancol@dancol.org>

	* term/xterm.el (xterm-paste): Use large finite timeout when
	reading event to avoid putting keys in this-command-keys.

2014-04-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/perl-mode.el (perl--syntax-exp-intro-regexp): New var.
	(perl-syntax-propertize-function): Use it.  Extend handling of
	here-docs to the unquoted case.

2014-04-25  Eli Zaretskii  <eliz@gnu.org>

	* tooltip.el (tooltip-show-help-non-mode, tooltip-show-help):
	Use equal-including-properties to compare help-echo strings (bug#17331).

2014-04-25  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/lisp-mode.el (emacs-lisp-mode-syntax-table):
	Fix syntax for @.  (Bug#17325)

2014-04-25  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl.el (gv): Require gv early to break eager
	macro-expansion cycles.

2014-04-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (region-active-p): Check there's a mark (bug#17324).

	* simple.el (completion-list-mode-map): Use choose-completion for the
	mouse binding as well (bug#17302).
	(completion-list-mode, completion-setup-function): Adjust docstring and
	echo area message accordingly.
	* progmodes/idlwave.el (idlwave-choose-completion): Adjust to new
	calling convention of choose-completion.
	* comint.el (comint-dynamic-list-completions):
	* term.el (term-dynamic-list-completions): Accept choose-completion.

	* progmodes/perl-mode.el (perl-syntax-propertize-function): Slash after
	&, |, +, - and * can't be a division (bug#17317).

	* term/xterm.el (xterm--version-handler): Don't use modern xterm
	features on gnome-terminal (bug#16988).

2014-04-25  Thien-Thi Nguyen  <ttn@gnu.org>

	Improve Scheme font-locking for (define ((foo ...) ...) ...).

	* progmodes/scheme.el (scheme-font-lock-keywords-1): To find
	the declared object, ignore zero or more parens, not zero or one.

2014-04-24  Leo Liu  <sdl.web@gmail.com>

	* progmodes/xscheme.el (xscheme-expressions-ring)
	(xscheme-expressions-ring-yank-pointer, xscheme-running-p)
	(xscheme-control-g-disabled-p, xscheme-process-filter-state)
	(xscheme-allow-output-p, xscheme-prompt)
	(xscheme-string-accumulator, xscheme-mode-string): Use defvar-local.

	* progmodes/scheme.el (would-be-symbol, next-sexp-as-string):
	Comment out unused functions.

2014-04-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* info.el: Use lexical-binding and cl-lib.
	Use defvar-local and setq-local instead	of make-local-variable.
	(Info-apropos-matches): Avoid add-to-list.
	(Info-edit-mode-map): Fix obsolescence call to Info-edit-map.

2014-04-24  Daniel Colascione  <dancol@dancol.org>

	* progmodes/sh-script.el (sh-builtins): Add coproc to list of bash builtins.

2014-04-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl--loop-let): Fix last merge.

2014-04-22  Michael Heerdegen  <michael_heerdegen@web.de>

	* dired.el (dired-insert-set-properties): Do not consider
	subdirectory headings and empty lines to be information that
	`dired-hide-details-mode' should hide.  (Bug#17228)

2014-04-22  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-name-all-completions):
	Remove test messages.
	(tramp-do-copy-or-rename-file-out-of-band): Do not quote `source'
	and `target' twice.

2014-04-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* dframe.el (dframe-get-focus): Remove `hook' argument (bug#17311).
	* speedbar.el (speedbar-get-focus): Run the "hook" afterwards instead.

	* emacs-lisp/cl-macs.el (cl--loop-let): Avoid `nil' as var name.

2014-04-22  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-name-all-completions):
	Set "IFS=" when using read builtin, in order to preserve spaces in
	the file name.  Add test messages for hunting a bug on hydra.
	(tramp-get-ls-command): Undo using "-b" argument.  It doesn't help.

2014-04-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/prog-mode.el (prettify-symbols--compose-symbol):
	Don't prettify a word within a symbol.

2014-04-22  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-get-ls-command): Use "-b" argument if
	possible.

2014-04-22  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/byte-run.el (function-put): Unbreak build: don't
	use defun to define `function-put'.

2014-04-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp-mode.el (lisp--match-hidden-arg): New function.
	(lisp-el-font-lock-keywords-2, lisp-cl-font-lock-keywords-2): Use it.
	(lisp-mode-variables): Set font-lock-extra-managed-props.

	* emacs-lisp/byte-run.el (function-put): New function.
	(defun-declarations-alist): Use it.  Add `pure' and `side-effect-free'.
	* emacs-lisp/cl-macs.el (cl-defstruct, cl-struct-sequence-type)
	(cl-struct-slot-info, cl-struct-slot-offset, cl-struct-slot-value):
	Use them.

2014-04-22  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/macroexp.el (internal-macroexpand-for-load):
	Add `full-p' parameter; when nil, call `macroexpand' instead of
	`macroexpand-all'.

	* emacs-lisp/byte-run.el (eval-when-compile, eval-and-compile):
	Improve docstrings.

	* emacs-lisp/bytecomp.el (byte-compile-initial-macro-environment):
	Use lambda function values, not quoted lambdas.
	(byte-compile-recurse-toplevel): Remove extraneous &optional.

	* emacs-lisp/cl-macs.el
	(cl-struct-sequence-type, cl-struct-slot-info): Declare pure.
	(cl-struct-slot-value): Conditionally use aref or nth so that the
	compiler produces optimal code.

2014-04-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl-struct-slot-offset): Mark as pure.
	(inline): Don't inline cl--set-elt.
	(cl-struct-slot-value): Remove explicit gv-setter and compiler-macro.
	Define as inlinable instead.
	(cl-struct-set-slot-value): Remove.

	* emacs-lisp/cl-lib.el (cl--set-elt): Remove.
	* emacs-lisp/cl-seq.el (cl-replace, cl-substitute, cl-nsubstitute):
	Use setf instead.

2014-04-21  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-macs.el (cl--const-expr-val): We didn't need the
	last two parameters after all.
	(cl--expr-contains,cl--compiler-macro-typep,cl--compiler-macro-member)
	(cl--compiler-macro-assoc,cl-struct-slot-value)
	(cl-struct-set-slot-value): Stop using them.

(2014-04-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* image-mode.el (image-mode-window-put): Don't assume there's a `t'
	entry in image-mode-winprops-alist.

2014-04-21  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/bytecomp.el (byte-compile-recurse-toplevel): New function.
	(byte-compile-recurse-toplevel, byte-compile-initial-macro-environment)
	(byte-compile-toplevel-file-form): Use it.

	* emacs-lisp/cl-macs.el:
	(cl--loop-let): Properly destructure `while' clauses.

2014-04-20  Daniel Colascione  <dancol@dancol.org>

	* vc/vc.el (vc-root-dir): New public autoloaded function for
	generically finding the current VC root.
	* vc/vc-hooks.el (vc-not-supported): New error.
	(vc-call-backend): Signal `vc-not-supported' instead of generic error.

2014-04-20  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-macs.el (cl-the): Make `cl-the' assert its type
	argument.
	(cl--const-expr-val): cl--const-expr-val should macroexpand its
	argument in case we're inside a symbol-macrolet.
	(cl--do-arglist, cl--compiler-macro-typep)
	(cl--compiler-macro-member, cl--compiler-macro-assoc): Pass macro
	environment to `cl--const-expr-val'.
	(cl-struct-sequence-type,cl-struct-slot-info)
	(cl-struct-slot-offset, cl-struct-slot-value)
	(cl-struct-set-slot-value): New functions.

2014-04-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-smie--sh-keyword-p): Handle variable
	assignments such as "case=hello" (bug#17297).

2014-04-18  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-run-real-handler, tramp-file-name-handler):
	Do not autoload.
	(tramp-file-name-handler, tramp-completion-file-name-handler):
	Revert patch from 2014-04-10, it isn't necessary anymore.
	(tramp-autoload-file-name-handler)
	(tramp-register-autoload-file-name-handlers): New defuns.
	(top): Autoload call of `tramp-register-autoload-file-name-handlers'.
	(tramp-register-file-name-handlers): Remove also
	`tramp-autoload-file-name-handler' from `file-name-handler-list'.
	Do not autoload its invocation, but eval it after loading of 'tramp.

	* net/tramp-adb.el (tramp-unload-hook): Unload `tramp-adb'.

	* net/tramp-compat.el (tramp-unload-hook): Unload `tramp-loaddefs'.

2014-04-17  Daniel Colascione  <dancol@dancol.org>

	Add support for bracketed paste mode; add infrastructure for
	managing terminal mode enabling and disabling automatically.

	* xt-mouse.el:
	(xterm-mouse-mode): Simplify.
	(xterm-mouse-tracking-enable-sequence)
	(xterm-mouse-tracking-disable-sequence): New constants.
	(turn-on-xterm-mouse-tracking-on-terminal)
	(turn-off-xterm-mouse-tracking-on-terminal):
	Use tty-mode-set-strings and tty-mode-reset-strings terminal
	parameters instead of random hooks.
	(turn-on-xterm-mouse-tracking)
	(turn-off-xterm-mouse-tracking): Delete.

	* term/xterm.el (xterm-extra-capabilities): Fix bitrotted comment.
	(xterm-paste-ending-sequence): New constant.
	(xterm-paste): New command used for bracketed paste support.

	(xterm-modify-other-keys-terminal-list): Delete obsolete variable.
	(terminal-init-xterm-bracketed-paste-mode): New function.
	(terminal-init-xterm): Call it.
	(terminal-init-xterm-modify-other-keys): Use tty-mode-set-strings
	and tty-mode-reset-strings instead of random hooks.
	(xterm-turn-on-modify-other-keys)
	(xterm-turn-off-modify-other-keys)
	(xterm-remove-modify-other-keys): Delete obsolete functions.

	* term/screen.el: Rewrite to just use the xterm code.
	Add copyright notice.  Mention tmux.

2014-04-17  Ian D  <dunni@gnu.org>  (tiny change)

	* image-mode.el (image-mode-window-put): Also update the property of
	the "default window".
	* doc-view.el (doc-view-new-window-function): If no window
	exists,	move to the last known page.

2014-04-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/perl-mode.el (perl-calculate-indent): Don't auto-indent in
	here-documents (bug#17262).

2014-04-16  Eli Zaretskii  <eliz@gnu.org>

	* term/pc-win.el (x-list-fonts, x-get-selection-value):
	Provide doc strings, as required by snarf-documentation.

2014-04-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ps-def.el (ps-generate-postscript-with-faces1): Use the new `sorted'
	arg of overlays-at.  Use `invisible-p'.

	* obsolete/lucid.el (extent-at):
	* htmlfontify.el (hfy-overlay-props-at): Use the new `sorted' arg of
	overlays-at.
	(hfy-fontify-buffer): Remove unused var `orig-ovls'.

2014-04-16  João Távora  <joaotavora@gmail.com>

	* net/shr.el (shr-expand-url): Use `expand-file-name' for relative
	links.  (Bug#17217).

2014-04-16  YAMAMOTO Mitsuharu  <mituharu@math.s.chiba-u.ac.jp>

	* vc/ediff-diff.el (ediff-set-fine-diff-properties-in-one-buffer):
	Use mapc to loop over a vector.  (Bug#17257).

2014-04-16  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-truename): Revert previous
	patch, there are new problems with file names containing spaces.
	Get rid of backticks.  (Bug#17238)

2014-04-16  João Távora  <joaotavora@gmail.com>

	* elec-pair.el (electric-pair--syntax-ppss): Simplify and fix
	possible bug.

2014-04-16  Eli Zaretskii  <eliz@gnu.org>

	* frame.el (blink-cursor-blinks, blink-cursor-blinks-done): Doc fixes.
	(blink-cursor-mode): Mention customization variables and the
	effect of 'blink-cursor-blinks'.

2014-04-16  Barry O'Reilly  <gundaetiapo@gmail.com>

	* simple.el (undo): Prevent insertion of identity mapping into
	undo-equiv-table so as undo-only does not inf loop in the presence
	of consecutive nils in undo list.

2014-04-16  Matthias Dahl  <matthias.dahl@binary-island.eu>

	* faces.el (make-face): Deprecate optional argument as it is no
	longer needed/used since the conditional X resources handling
	has been pushed down to make-face-x-resource-internal itself.
	(make-empty-face): Don't pass optional argument to make-face.

2014-04-16  Karl Fogel  <kfogel@red-bean.com>

	* savehist.el (savehist-save): Remove workaround for a read-passwd
	bug that was fixed before 24.3.  Thanks to Juanma Barranquero for
	noticing that the shim was still present.

2014-04-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* doc-view.el (doc-view-set-doc-type): Ignore file name case; add .pps.

2014-04-14  Juanma Barranquero  <lekktu@gmail.com>

	* faces.el (face-set-after-frame-default): Remove unused local variable.

2014-04-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/grep.el: Use lexical-binding.
	(grep-expand-template): Pass explicit lexical env to `eval'.
	(zrgrep): Let-bind grep-find-template explicitly.

	* emacs-lisp/cl-lib.el (current-case-table): Remove setter.
	* leim/quail/sisheng.el (sisheng-list): Use with-case-table.

2014-04-12  Eli Zaretskii  <eliz@gnu.org>

	* international/characters.el <standard-case-table>: Add entries
	for letters from the Coptic block u+2C80-u+2CFF.  (Bug#17243)
	Set category of Coptic characters be 'g' (Greek).

2014-04-12  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (completion-table-with-cache):
	Define if not available.
	(octave-goto-function-definition, octave-sync-function-file-names)
	(octave-find-definition-default-filename):
	Backquote upattern for compatibility.

2014-04-12  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-truename): Quote the file
	name twice due to backticks.  (Bug#17238)

2014-04-12  Glenn Morris  <rgm@gnu.org>

	* term/w32-win.el (x-win-suspend-error):
	* term/x-win.el (x-win-suspend-error): Sync docs.

2014-04-12  Matthias Dahl  <matthias.dahl@binary-island.eu>

	* faces.el (make-face): Remove deprecated optional argument.
	The conditional application of X resources is handled directly by
	make-face-x-resource-internal since Emacs 24.4.
	(make-empty-face): Don't pass optional argument to make-face.

2014-04-11  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (EMACSDATA, EMACSDOC, EMACSPATH): Unexport.  (Bug#16429)

2014-04-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	Ediff's overlay priorities cause more trouble than they solve.
	* vc/ediff-init.el (ediff-shadow-overlay-priority): Remove variable.
	(ediff-highest-priority): Remove function (bug#17234).
	* vc/ediff-util.el (ediff-highlight-diff-in-one-buffer):
	* vc/ediff-diff.el (ediff-set-diff-overlays-in-one-buffer)
	(ediff-set-fine-diff-properties-in-one-buffer): Don't mess with
	overlay priorities.

2014-04-11  Feng Li  <fengli@gmail.com>  (tiny change)

	* progmodes/pascal.el (pascal-font-lock-keywords): Fix incorrect format
	entry; use symbol boundaries to avoid mis-matches.

2014-04-11  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-file-name-handler)
	(tramp-completion-file-name-handler): Avoid recursive loading.

	* net/tramp-sh.el (tramp-make-copy-program-file-name):
	Quote result also locally.

2014-04-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emulation/cua-base.el (<toplevel>, cua--pre-command-handler-1):
	Remove left-over code.

	* newcomment.el (comment-indent-new-line): Sink code where it's used.
	Reuse the previous comment's indentation unconditionally if it's on its
	own line.

2014-04-09  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/lisp.el (backward-up-list): Add `escape-strings',
	`no-syntax-crossing' arguments.  Forward to `up-list'.
	(up-list): Add `escape-strings', `no-syntax-crossing' arguments.
	Implement logic for escaping from strings.  Use narrowing to deal
	with corner cases.

2014-04-09  Leo Liu  <sdl.web@gmail.com>

	* net/rcirc.el (rcirc-connection-info): New variable.
	(rcirc-connect): Use it to store connection info.
	(rcirc-buffer-process): Avoid get-buffer-process which returns nil
	for killed process.
	(rcirc-cmd-reconnect): New command.  (Bug#17045)
	(rcirc-mode, set-rcirc-encode-coding-system)
	(set-rcirc-decode-coding-system, rcirc-connect): Use setq-local.

2014-04-09  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-indent.el: Add comment claiming
	facility is also good for elisp.
	(lisp-indent-find-method): New function.
	(common-lisp-indent-function): Recognize cl-loop.
	(common-lisp-indent-function-1): Recognize cl constructs; use
	`lisp-indent-find-method' instead of `get' directly.
	(if): Use else-body style for elisp.

2014-04-09  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Highlight more
	Module methods.  (Bug#17216)

2014-04-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help.el (describe-bindings): Fix buffer handling (bug#17210).
	(describe-bindings-internal): Mark obsolete.

2014-04-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (with-silent-modifications): Don't bind deactivate-mark,
	buffer-file-name, and buffer-file-truename any more.

2014-04-08  Leo Liu  <sdl.web@gmail.com>

	Use lexical-binding and require cl-lib.
	* net/rcirc.el (rcirc, rcirc-handler-ctcp-KEEPALIVE)
	(rcirc-handler-generic, rcirc-fill-paragraph)
	(rcirc-format-response-string, rcirc-target-buffer)
	(rcirc-last-line, rcirc-record-activity, rcirc-split-activity)
	(rcirc-activity-string, rcirc-make-trees, rcirc-cmd-ctcp)
	(rcirc-ctcp-sender-PING, rcirc-browse-url)
	(rcirc-markup-timestamp, rcirc-markup-attributes)
	(rcirc-markup-my-nick, rcirc-markup-urls)
	(rcirc-markup-bright-nicks, rcirc-markup-fill)
	(rcirc-check-auth-status, rcirc-handler-WALLOPS)
	(rcirc-handler-JOIN, rcirc-handler-PART-or-KICK)
	(rcirc-handler-PART, rcirc-handler-KICK, rcirc-handler-QUIT)
	(rcirc-handler-NICK, rcirc-handler-PING, rcirc-handler-PONG)
	(rcirc-handler-TOPIC, rcirc-handler-301, rcirc-handler-317)
	(rcirc-handler-332, rcirc-handler-333, rcirc-handler-477)
	(rcirc-handler-MODE, rcirc-handler-353, rcirc-handler-366)
	(rcirc-authenticate, rcirc-handler-INVITE, rcirc-handler-ERROR)
	(rcirc-handler-ctcp-VERSION, rcirc-handler-ctcp-TIME)
	(rcirc-handler-CTCP-response): Fix unused arguments warnings and
	use cl-lib.

2014-04-07  João Távora  <joaotavora@gmail.com>

	* elec-pair.el (electric-pair--syntax-ppss):
	When inside comments parse from comment beginning.
	(electric-pair--balance-info): Fix typo in comment.
	(electric-pair--in-unterminated-string-p): Delete.
	(electric-pair--unbalanced-strings-p): New function.
	(electric-pair-string-bound-function): New var.
	(electric-pair-inhibit-if-helps-balance): Decide quote pairing
	according to `electric-pair--in-unterminated-string-p'

	* elec-pair.el (electric-pair-inhibit-if-helps-balance):
	Inhibit quote pairing if point-max is inside an unterminated string.
	(electric-pair--looking-at-unterminated-string-p): Delete.
	(electric-pair--in-unterminated-string-p): New function.

2014-04-07  Glenn Morris  <rgm@gnu.org>

	* shell.el (shell-directory-tracker):
	Go back to just ignoring failures.  (Bug#17159)

2014-04-07  João Távora  <joaotavora@gmail.com>

	Fix `electric-pair-delete-adjacent-pairs' in modes binding
	backspace.  (Bug#16981)
	* elec-pair.el (electric-pair-backward-delete-char): Delete.
	(electric-pair-backward-delete-char-untabify): Delete.
	(electric-pair-mode-map): Bind backspace to a menu item filtering
	a new `electric-pair-delete-pair' command.
	(electric-pair-delete-pair): New command.

	* progmodes/python.el (python-electric-pair-string-delimiter):
	Fix triple-quoting electricity.  (Bug#17192)

	* elec-pair.el (electric-pair-post-self-insert-function):
	Don't skip whitespace when `electric-pair-text-pairs' and
	`electric-pair-pairs' were used. syntax to
	electric-pair--skip-whitespace.  (Bug#17183)

2014-04-07  Eli Zaretskii  <eliz@gnu.org>

	* leim/quail/ipa.el (ipa-x-sampa): Fix the character produced for
	"<F>".  (Bug#17199)

2014-04-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mpc.el (mpc--status-timer-run): Disable timer if not displayed.
	(mpc--status-idle-timer-run): Use mpc--status-timer-run.

2014-04-07  Glenn Morris  <rgm@gnu.org>

	* help.el (view-lossage): Doc tweak.

2014-04-07  Matthias Dahl  <ml_emacs-lists@binary-island.eu>

	* faces.el (face-spec-recalc): Call make-face-x-resource-internal
	only when inhibit-x-resources is nil, and do that earlier in the
	function.  Doc fix.  (Bug#16694)
	(face-spec-choose): Accept additional optional argument, whose
	value is returned if no matching attributes are found.
	(face-spec-recalc): Use the new optional argument when calling
	face-spec-choose.  (Bug#16378)
	(make-face-x-resource-internal): Do nothing when
	inhibit-x-resources is non-nil.  Don't touch the default face if
	reversed video is given--as was done in previous versions of Emacs.
	(face-set-after-frame-default): Don't call
	make-face-x-resource-internal here.  (Bug#16434)

2014-04-07  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el (doc-view-bookmark-jump):
	Use `bookmark-after-jump-hook' to jump to the right page after the
	buffer is shown in a window.  (bug#16090)

2014-04-07  Eli Zaretskii  <eliz@gnu.org>

	* international/characters.el (mirroring): Fix last change:
	instead of loading uni-mirrored.el explicitly, do that implicitly
	by creating the 'mirroring' uniprop table.  This avoids announcing
	the loading of uni-mirrored.el.

2014-04-07  Glenn Morris  <rgm@gnu.org>

	* files.el (buffer-stale--default-function)
	(buffer-stale-function, revert-buffer--default):
	* autorevert.el (auto-revert-buffers): Doc tweaks.

2014-04-07  Eli Zaretskii  <eliz@gnu.org>

	* international/characters.el: Preload uni-mirrored.el.  (Bug#17169)

2014-04-07  Glenn Morris  <rgm@gnu.org>

	* files.el (make-backup-file-name-function)
	(make-backup-file-name, make-backup-file-name--default-function)
	(make-backup-file-name-1, find-backup-file-name)
	(revert-buffer-function, revert-buffer-insert-file-contents-function)
	(buffer-stale--default-function, buffer-stale-function)
	(before-revert-hook, after-revert-hook, revert-buffer-in-progress-p)
	(revert-buffer, revert-buffer--default)
	(revert-buffer-insert-file-contents--default-function):
	Doc fixes related to defaults no longer being nil.
	(make-backup-file-name-function): Bump :version.
	Restore nil as a valid but deprecated custom type.

2014-04-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/perl-mode.el (perl-syntax-propertize-function):
	Handle $' used as a variable (bug#17174).

	* progmodes/perl-mode.el (perl-indent-new-calculate):
	Handle forward-sexp failure (bug#16985).
	(perl-syntax-propertize-function): Add "foreach" and "for" statement
	modifiers introducing expressions (bug#17116).

2014-04-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* dired-aux.el (dired-file-set-difference): Use lexical-scoping.

2014-04-05  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/lisp-mode.el (lisp-imenu-generic-expression):
	Add define-compilation-mode.

2014-04-04  João Távora  <joaotavora@gmail.com>

	* elec-pair.el (electric-pair--syntax-ppss): When inside comments
	parse from comment beginning.
	(electric-pair--balance-info): Fix typo in comment.
	(electric-pair--in-unterminated-string-p): Delete.
	(electric-pair--unbalanced-strings-p): New function.
	(electric-pair-string-bound-function): New var.
	(electric-pair-inhibit-if-helps-balance): Decide quote pairing
	according to `electric-pair--in-unterminated-string-p'.

2014-04-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/reftex-parse.el (reftex--index-tags): Rename `index-tags'.
	Move declaration before first use.
	(reftex-move-to-next-arg): Silence compiler warning.

2014-04-04  Joost Kremers  <joostkremers@fastmail.fm>  (tiny change)

	* textmodes/reftex-toc.el (reftex-toc, reftex-re-enlarge):
	Use `window-total-width' instead of `window-width'.

2014-04-03  Daniel Colascione  <dancol@dancol.org>

	* subr.el (set-transient-map): Remove rms's workaround entirely;
	use new `suspicious-object' subr to mark our lambda for closer
	scrutiny during gc.

2014-04-02  Richard Stallman  <rms@gnu.org>

	* subr.el (set-transient-map): Comment out previous change.

2014-04-02  Glenn Morris  <rgm@gnu.org>

	* menu-bar.el (menu-bar-file-menu):
	* vc/ediff.el (ediff-current-file):
	Update for revert-buffer-function no longer being nil by default.

	* simple.el (command-execute): Respect nil disabled-command-function.

2014-04-02  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* simple.el (command-execute): Do not execute the command when it
	is disabled; fixes thinko in 2013-02-20 conversion from C.  (Bug#17151)

2014-04-02  Juri Linkov  <juri@jurta.org>

	* dired-aux.el (dired-compress-file): Don't use string-match-p
	because its match data is used afterwards.

2014-04-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-built-in-p): Treat a min-version of
	0 like nil.

2014-04-02  João Távora  <joaotavora@gmail.com>

	* elec-pair.el (electric-pair-inhibit-if-helps-balance):
	Inhibit quote pairing if point-max is inside an unterminated string.
	(electric-pair--looking-at-unterminated-string-p):
	Delete.
	(electric-pair--in-unterminated-string-p): New function.

2014-04-01  Daniel Colascione  <dancol@dancol.org>

	* minibuffer.el (minibuffer-complete): Prevent assertion failure
	when trying to complete the prompt.

2014-03-31  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/eldoc.el (eldoc-print-current-symbol-info):
	Refactor out eldoc-documentation-function-default.
	(eldoc-documentation-function-default): New function.
	(eldoc-documentation-function): Change value.

2014-03-31  Glenn Morris  <rgm@gnu.org>

	* simple.el (cycle-spacing--context, cycle-spacing): Doc tweaks.

	* progmodes/vhdl-mode.el (vhdl-speedbar-select-mra)
	(vhdl-compose-components-package, vhdl-compose-configuration):
	Abbreviate default-directory (missing from some previous upstream sync).

2014-03-31  Reto Zimmermann  <reto@gnu.org>

	Sync with upstream vhdl mode v3.35.2.
	* progmodes/vhdl-mode.el (vhdl-version, vhdl-time-stamp): Update.
	(top-level): No longer require assoc.
	(vhdl-asort, vhdl-anot-head-p, vhdl-aput, vhdl-adelete, vhdl-aget):
	New functions.  Use throughout to replace aget etc.
	(vhdl-aput-delete-if-nil): Rename from vhdl-aput.
	(vhdl-update-file-contents): Update for vhdl-aput-delete-if-nil rename.
	(vhdl-template-replace-header-keywords): Fix bug for "<title string>".
	(vhdl-compile-init): Do not initialize regexps for Emacs 22+.
	(vhdl-error-regexp-emacs-alist): Remove regexps from all compilers
	except `vhdl-compiler'.
	(vhdl-error-regexp-add-emacs): Remove all other compilers,
	when appropriate.

2014-03-31  Glenn Morris  <rgm@gnu.org>

	* progmodes/vhdl-mode.el (vhdl-expand-abbrev, vhdl-expand-paren):
	Revert 2014-03-26 merge goof; go back to using defalias.

2014-03-30  Daniel Colascione  <dancol@dancol.org>

	* comint.el (comint-send-input):
	Deactivate completion-in-region-mode before we send comint input.
	(Bug#17139).

	* simple.el (keyboard-quit): Deactivate completion-in-region-mode
	on keyboard-quit.

2014-03-29  Glenn Morris  <rgm@gnu.org>

	* textmodes/reftex.el: Manage most autoloads automatically.
	* textmodes/reftex-auc.el, textmodes/reftex-cite.el:
	* textmodes/reftex-dcr.el, textmodes/reftex-global.el:
	* textmodes/reftex-index.el, textmodes/reftex-parse.el:
	* textmodes/reftex-ref.el, textmodes/reftex-sel.el:
	* textmodes/reftex-toc.el: Set generated-autoload-file,
	and add autoload cookies for reftex.el.
	* Makefile.in (AUTOGEN_VCS): Add textmodes/reftex.el.

2014-03-28  Glenn Morris  <rgm@gnu.org>

	* cus-start.el (report-emacs-bug-address): Set custom properties.
	* mail/emacsbug.el (report-emacs-bug-address):
	Variable is now defined in emacs.c.

	* mail/emacsbug.el (report-emacs-bug):
	Include system-configuration-features.

2014-03-28  Michal Nazarewicz  <mina86@mina86.com>

	* simple.el (cycle-spacing): Never delete spaces on first run by
	default, but do so in a new 'fast mode and if there are already
	N spaces (the previous behavior).
	Compare N with its value in previous invocation so that changing
	prefix argument restarts `cycle-spacing' sequence.
	The idea is that with this change, binding M-SPC to
	`cycle-spacing' should not introduce any changes in behavior of
	the binding so long as users do not type M-SPC twice in a raw with
	the same prefix argument or lack thereof.

2014-03-28  Glenn Morris  <rgm@gnu.org>

	* faces.el (term-file-aliases): New variable.
	(tty-run-terminal-initialization): Respect term-file-aliases.
	* term/apollo.el, term/vt102.el, term/vt125.el, term/vt201.el:
	* term/vt220.el, term/vt240.el, term/vt300.el, term/vt320.el:
	* term/vt400.el, term/vt420.el: Remove files, replaced by aliases.

2014-03-27  Glenn Morris  <rgm@gnu.org>

	* startup.el (inhibit-startup-hooks): Doc tweak.
	(normal-top-level): Simplify running of hooks.
	For window-setup-hook, respect inhibit-startup-hooks.
	(command-line-1): Don't set window-setup-hook to nil.

	Allow selective autoloading from obsolete/ directory.
	* Makefile.in (obsolete-autoloads): New rule.
	(autoloads): Run obsolete-autoloads.
	* obsolete/iswitchb.el (iswitchb-mode): Use obsolete-autoload.
	* simple.el (iswitchb-mode): Remove hand-written autoloads.

2014-03-27  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Highlight special globals with font-lock-builtin-face.  (Bug#17057)

	* progmodes/ruby-mode.el (ruby-syntax-propertize-function):
	Don't propertize `?' or `!' as symbol constituent when after
	colon.  (Bug#17097)

2014-03-27  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--restore-frame): Remove workaround for bug#14795
	which is no longer needed and causes trouble in GTK builds (bug#17046).

	* emacs-lisp/package-x.el (package--archive-contents-from-url):
	Use url-insert-file-contents; package-handle-response no longer exists.

2014-03-26  Daniel Colascione  <dancol@dancol.org>

	* simple.el (process-menu-mode-map): New variable.
	(process-menu-delete-process): New command.

2014-03-26  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/package.el: Fix bug#16733 (again).
	(url-http-parse-response, url-http-end-of-headers, url-recreate-url)
	(url-http-target-url): Remove unused declarations.
	(package-handle-response): Remove.
	(package--with-work-buffer): Use url-insert-file-contents and simplify.
	(package--download-one-archive): Use current-buffer instead of
	dynamic binding of `buffer'.
	(describe-package-1): Do not decode readme-string.

2014-03-26  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-methods, tramp-connection-timeout): Fix docstring.

	* net/tramp-sh.el (tramp-sh-handle-vc-registered): Revert change
	from 2014-03-07, it decreases performance unnecessarily.  Let-bind
	`remote-file-name-inhibit-cache' to nil in the second pass.
	(tramp-find-executable): Do not call "which" on SunOS.
	(tramp-send-command-and-check): Fix docstring.
	(tramp-do-copy-or-rename-file-directly): In the `rename' case,
	check whether source directory has set the sticky bit.

2014-03-26  Barry O'Reilly  <gundaetiapo@gmail.com>

	* simple.el (primitive-undo): Only process marker adjustments
	validated against their corresponding (TEXT . POS).  Issue warning
	for lone marker adjustments in undo history.  (Bug#16818)
	(undo-make-selective-list): Add marker adjustments to selective
	undo list based on whether their corresponding (TEXT . POS) is in
	the region.  Remove variable adjusted-markers, which was unused
	and only non nil during undo-make-selective-list.
	(undo-elt-in-region): Return nil when passed a marker adjustment
	and explain in function doc.

2014-03-26  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* align.el (align-region): Do not fail when end-mark is nil (bug#17088).

2014-03-26  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-expression-expansion-re):
	Match special global variables without curlies, too.
	(ruby-font-lock-keywords): Simplify the matcher for special global
	variables.  Don't require a non-word character after the variable.
	(Bug#17057)

2014-03-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (redisplay-highlight-region-function): Increase priority of
	overlay to make sure boundaries are visible (bug#15899).

2014-03-26  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--initial-params): Fix typo in parameter name.
	(frameset-restore): Compare display strings with equal.

	* frame.el (make-frame): Don't quote display name in error message,
	it is already a string.

2014-03-26  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* net/tramp.el (tramp-read-passwd): Suspend the timers while reading
	the password.

2014-03-26  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package--add-to-archive-contents):
	Include already installed and built-in packages in
	`package-archive-contents'.
	(package-install): Don't include already installed packages in the
	options during interactive invocation.  (Bug#16762)
	(package-show-package-list): If the buffer is already displayed in
	another window, switch to that window.

2014-03-26  Reto Zimmermann  <reto@gnu.org>

	Sync with upstream vhdl mode v3.35.1.
	* progmodes/vhdl-mode.el (vhdl-version, vhdl-time-stamp): Update.
	(vhdl-compiler-alist): Doc fix.
	(vhdl-goto-line): Remove.
	(vhdl-mode-abbrev-table-init): Add XEmacs compat.
	(vhdl-mode) <paragraph-start>: Fix value.
	(vhdl-fix-statement-region): Not `for' in wait-statement.
	(vhdl-beautify-region): Also (un)tabify.
	(vhdl-get-visible-signals):
	Scan declarative part of generate statements.
	(vhdl-template-record): Fix indentation for record type declaration.
	(vhdl-expand-abbrev, vhdl-expand-paren):
	Revert to using fset again rather than defalias.
	(vhdl-scan-directory-contents): Tweak.
	(vhdl-speedbar-find-file, vhdl-speedbar-port-copy)
	(vhdl-compose-components-package):
	Replace vhdl-goto-line with forward-line.
	(top-level): Tweak speedbar frame selection.
	(vhdl-generate-makefile-1): Support for compilers with no
	unit-to-file name mapping (create directory with dummy files).

2014-03-26  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode revision 702457d.
	* progmodes/verilog-mode.el (verilog-mode-version): Update.
	(create-lockfiles): Declare.
	(verilog-read-decls): Fix module header imports, bug709.
	Reported by Victor Lau.
	Fix parsing 'var' in AUTOs, msg1294.  Reported by Dominique Chen.
	(verilog-auto-inout-module): Fix AUTOINOUTMODULE not inserting
	interface-only modules, bug721.  Reported by Dean Hoyt.

2014-03-26  Glenn Morris  <rgm@gnu.org>

	* obsolete/gulp.el: Move here from emacs-lisp/.

	* files.el (lock-buffer, unlock-buffer, file-locked-p):
	Remove fallback aliases, since they are always defined now.

2014-03-24  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-macs.el (cl--do-arglist): Use `plist-member'
	instead of cl-loop search function.

2014-03-23  Lars Ingebrigtsen  <larsi@gnus.org>

	* calendar/parse-time.el (parse-time-iso8601-regexp)
	(parse-iso8601-time-string): Copy from `url-dav' so that we can use
	it more generally.

2014-03-23  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/dns.el (network-interface-list): Define for XEmacs.

2014-03-23  Magnus Henoch  <magnus.henoch@gmail.com>

	* net/dns.el (dns-servers-up-to-date-p): New function to see whether
	the network interfaces changed.
	(dns-query): Use it to flush the data.

2014-03-23  Juanma Barranquero  <lekktu@gmail.com>

	* vc/vc.el (vc-rollback): Use set-buffer-modified-p.

2014-03-23  Daniel Colascione  <dancol@dancol.org>

	Change subword-mode to use `find-word-boundary-function-table' and
	replace `capitalized-words-mode'.  Also, convert to lexical binding.
	* progmodes/cap-words.el: Delete now-obsolete file.
	* progmodes/subword.el: Reimplement using
	`find-word-boundary-function-table'.
	(subword-mode-map): Hollow out.
	(capitalized-words-mode): Define as obsolete alias for
	`subword-mode'.
	(subword-mode, superword-mode): Tweak documentation to reflect new
	implementation; call `subword-setup-buffer'.
	(subword-forward, subword-capitalize): Add underscore to indicate
	unused variable.
	(subword-find-word-boundary-function-table): New constant.
	(subword-empty-char-table): New constant.
	(subword-setup-buffer): New function.
	(subword-find-word-boundary): New function.

2014-03-23  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-macs.el (cl--do-arglist): Use a little `cl-loop'
	list to look for keyword arguments instead of `memq', fixing
	(Bug#3647) --- unfortunately, only for freshly-compiled code.
	Please make bootstrap.

2014-03-22  Glenn Morris  <rgm@gnu.org>

	* dired.el (dired-read-regexp): Make obsolete.
	(dired-mark-files-regexp, dired-mark-files-containing-regexp)
	(dired-flag-files-regexp):
	* dired-aux.el (dired-mark-read-regexp):
	* dired-x.el (dired-mark-unmarked-files): Use read-regexp directly.

	* startup.el (fancy-startup-text):
	* help.el (describe-gnu-project): Visit online info about GNU project.

	* help-fns.el (help-fns--interactive-only): New function.
	(help-fns-describe-function-functions): Add the above function.
	* simple.el (beginning-of-buffer, end-of-buffer, insert-buffer)
	(next-line, previous-line): Remove hand-written interactive-only
	information from doc strings, it is auto-generated now.
	* bookmark.el (bookmark-write):
	* epa-mail.el (epa-mail-decrypt, epa-mail-verify, epa-mail-sign)
	(epa-mail-import-keys): Mark interactive-only,
	and remove hand-written interactive-only information from doc strings.
	* epa.el (epa-decrypt-armor-in-region, epa-verify-region)
	(epa-verify-cleartext-in-region, epa-sign-region, epa-encrypt-region):
	* files.el (not-modified):
	* simple.el (mark-whole-buffer): Mark interactive-only.

	* emacs-lisp/byte-run.el (defun-declarations-alist):
	Add interactive-only.  Doc tweak.
	(macro-declarations-alist): Doc tweak.
	* subr.el (declare): Doc tweak (add xref to manual).
	* comint.el (comint-run):
	* files.el (insert-file-literally, insert-file):
	* replace.el (replace-string, replace-regexp):
	* simple.el (beginning-of-buffer, end-of-buffer, delete-backward-char)
	(delete-forward-char, goto-line, insert-buffer, next-line)
	(previous-line): Set interactive-only via declare.

2014-03-22  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-desc): Use the contents of the
	quoted form, not its cdr.  (Bug#16873)

2014-03-22  Juanma Barranquero  <lekktu@gmail.com>

	* w32-common-fns.el (x-selection-owner-p): Add empty docstring for the
	benefit of doc.c; change parameter profile to match the X function.

2014-03-22  Leo Liu  <sdl.web@gmail.com>

	* help.el (temp-buffer-setup-hook): Remove help-mode-setup.
	(temp-buffer-show-hook): Remove help-mode-finish.  (Bug#16038)

2014-03-21  Richard Stallman  <rms@gnu.org>

	* battery.el (battery-linux-sysfs): Search for each field
	from the beginning of the buffer.

	* subr.el (set-transient-map): Clear out function and value
	of the temporary symbol when we're done with it.

	* mail/rmailsum.el (rmail-summary-delete-forward):
	Optimize case of reaching end and handling count.
	(rmail-summary-mark-deleted): Optimize when N is current msg.
	Don't create new summary line.
	(rmail-summary-undelete): Pass arg to rmail-undelete-previous-message.
	(rmail-summary-undelete-many): Rewrite for speed.
	(rmail-summary-msg-number): New function.

	* mail/rmail.el (rmail-delete-message): Update summary.
	(rmail-undelete-previous-message): Handle repeat count arg.
	(rmail-delete-backward, rmail-delete-forward): Likewise.

2014-03-21  Daniel Colascione  <dancol@dancol.org>

	* mail/emacsbug.el (report-emacs-bug): Include memory usage
	information in bug reports.

2014-03-21  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-methods): Add docstring for `tramp-login-env'
	and `tramp-copy-env'.

	* net/tramp-sh.el (tramp-methods) <sudo>: Add `tramp-login-env'.
	(tramp-maybe-open-connection): Handle `tramp-login-env'.

2014-03-21  Glenn Morris  <rgm@gnu.org>

	* electric.el (electric-indent-post-self-insert-function): Add doc.

2014-03-21  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-compute-transaction):
	Use `version-list-<=' to compare the requirement version against
	the version of package already to be installed.  Update the error
	message.  (Bug#16826)

	* progmodes/ruby-mode.el (ruby-smie-rules):
	Add indentation rule for ` @ '.  (Bug#17050)

2014-03-21  Juanma Barranquero  <lekktu@gmail.com>

	* align.el (align-regexp): Remove superfluous backslash.

	* ffap.el (ffap-ftp-default-user, ffap-url-regexp)
	(ffap-pass-wildcards-to-dired, dired-at-point-require-prefix)
	(ffap-rfc-path, ffap-ftp-sans-slash-regexp, ffap-menu-regexp):
	Fix docstring typos.
	(ffap-next): Use C-u in docstring.
	(ffap-machine-p, ffap-list-env, ffap-alist, ffap-alist)
	(ffap-string-at-point-mode-alist, ffap-menu, ffap-menu-ask):
	Remove superfluous backslashes.
	(ffap-string-at-point): Reflow docstring.

	* server.el (server-host): Reflow docstring.
	(server-unload-function): Fix docstring typo.
	(server-eval-at): Remove superfluous backslash.

	* skeleton.el (skeleton-insert): Remove superfluous backslash.
	(skeleton-insert): Doc fix.
	(skeleton-insert): Reflow docstring.

	* term/tty-colors.el (tty-color-alist, tty-modify-color-alist)
	(tty-color-approximate, tty-color-by-index, tty-color-values)
	(tty-color-desc): Remove superfluous backslashes.

2014-03-21  Glenn Morris  <rgm@gnu.org>

	* cus-start.el (history-length): Bump :version.

	* Makefile.in ($(MH_E_DIR)/mh-loaddefs.el)
	($(TRAMP_DIR)/tramp-loaddefs.el, $(CAL_DIR)/cal-loaddefs.el)
	($(CAL_DIR)/diary-loaddefs.el, $(CAL_DIR)/hol-loaddefs.el):
	Don't set `make-backup-files'.

	* info.el (info--prettify-description): New function,
	to give info-finder descriptions consistent case, punctuation.
	(Info-finder-find-node): Use it.  Sort packages.
	Refer to "description" rather than "commentary".

2014-03-21  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--print-register): New function.
	(frameset-to-register): Use it.

2014-03-20  Juanma Barranquero  <lekktu@gmail.com>

	* progmodes/hideif.el (hif-string-to-number): New function.
	(hif-tokenize): Use it to understand non-decimal floats.

	* emacs-lisp/cl-extra.el (cl--map-overlays): Remove obsolete code.

	* skeleton.el (skeleton-autowrap): Mark as obsolete.  Doc fix.

2014-03-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-newline-and-maybe-indent): New command.
	Bind it globally to C-j.
	(electric-indent-mode): Don't mess with the global map any more.
	Don't drop the post-self-insert-hook is some buffer is still using it
	(bug#16770).

	* bindings.el (global-map): Remove C-j binding.

	* emacs-lisp/nadvice.el (advice--make-docstring): Try harder to find
	the docstring of functions advised before dumping (bug#16993).

2014-03-19  Stefan-W. Hahn  <stefan.hahn@s-hahn.de>  (tiny change)

	* ps-print.el (ps-generate-postscript-with-faces):
	Explicitly deactivate the mark (bug#16866).
	* simple.el (deactivate-mark): Update region highlight.

2014-03-19  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/package.el (describe-package-1):
	Decode commentary (bug#16733).

2014-03-18  Juanma Barranquero  <lekktu@gmail.com>

	* custom.el (defcustom): Doc fix: recommend avoiding destructive
	modification of the value argument of :set (bug#16755).

2014-03-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (newline-and-indent): Do autofill (bug#17031).

2014-03-18  Dmitry Gutov  <dgutov@yandex.ru>

	* newcomment.el (comment-normalize-vars): Only add escaping check
	to `comment-start-skip' if not `comment-use-syntax'.  (Bug#16971)
	(comment-beginning): Use `narrow-to-region' instead of moving back
	one character.
	(https://lists.gnu.org/archive/html/emacs-devel/2014-03/msg00488.html)
	(comment-start-skip): Update the docstring.

2014-03-18  Richard Stallman  <rms@gnu.org>

	* dired.el (dired-display-file): Force use of other window.

2014-03-18  Daniel Colascione  <dancol@dancol.org>

	* startup.el (tty-handle-args): Remove debug message from 2007.

2014-03-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--interactive-form): New function.
	(advice--make-interactive-form): Use it to avoid (auto)loading function.
	(advice--make-1, advice-add, advice-remove):
	Remove braindead :advice-pending hack.

2014-03-17  Glenn Morris  <rgm@gnu.org>

	* calendar/calendar.el (calendar-generate-month): Apply weekend
	face to the right days; fixes 2013-08-06 change.  (Bug#17028)

2014-03-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-action-out-of-band): Read pending output.
	(tramp-call-process): Trace also DESTINATION.

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-out-of-band):
	Quote file names when they are local.  Remove superfluous trace.

2014-03-17  Dmitry Gutov  <dgutov@yandex.ru>

	* newcomment.el (comment-beginning): If `comment-start-skip'
	doesn't match, move back one char and try again.  (Bug#16971)

	* emacs-lisp/lisp-mode.el (lisp-mode-variables):
	Set `comment-use-syntax' to t to avoid the unnecessary runtime check.
	Set `comment-start-skip' to a simpler value that doesn't try to
	check if the semicolon is escaped (this is handled by
	`syntax-ppss' now).  (Bug#16971)

	* progmodes/scheme.el (scheme-mode-variables): Same.

2014-03-16  Martin Rudalics  <rudalics@gmx.at>

	Fix behavior of with-temp-buffer-window (Bug#16816, Bug#17007).
	* window.el (with-temp-buffer-window): Don't make BUFFER-OR-NAME
	current (Bug#16816, Bug#17007).
	(with-current-buffer-window): New macro doing the same as
	`with-temp-buffer-window' but with BUFFER-OR-NAME current.
	* help.el (help-print-return-message): Warn in doc-string to not
	use this in `with-help-window'.
	(describe-bindings-internal): Call `describe-buffer-bindings'
	from within help buffer.  See Juanma's scenario in (Bug#16816).
	(with-help-window): Update doc-string.
	* dired.el (dired-mark-pop-up):
	* files.el (save-buffers-kill-emacs):
	* register.el (register-preview): Use `with-current-buffer-window'
	instead of `with-temp-buffer-window'.

2014-03-16  Juanma Barranquero  <lekktu@gmail.com>

	* textmodes/rst.el (rst-arabic-to-roman, rst-roman-to-arabic):
	Implement inserting into current buffer, documented in their docstrings.
	(rst-define-key, rst-compare-adornments, rst-insert-list-new-item)
	(rst-section-tree-point, rst-forward-section, rst-indent)
	(rst-compute-tabs, rst-font-lock-find-unindented-line-end)
	(rst-font-lock-find-unindented-line-limit, rst-adornment-level)
	(rst-font-lock-handle-adornment-pre-match-form)
	(rst-repeat-last-character): Reflow docstrings.
	(rst-preferred-adornments, rst-update-section, rst-find-title-line)
	(rst-adjust-adornment-work, rst-initial-items, rst-insert-list)
	(rst-toc-insert-style, rst-toc-insert-node, rst-goto-section)
	(rst-compile, rst-imenu-convert-cell, rst-imenu-create-index):
	Fix docstring typos.
	(rst-all-sections, rst-section-hierarchy, rst-adjust): Doc fixes.
	(rst-uncomment-region, rst-font-lock-find-unindented-line-match)
	(rst-font-lock-handle-adornment-matcher): Mark unused arguments.

2014-03-15  Juanma Barranquero  <lekktu@gmail.com>

	* term/ns-win.el (x-command-line-resources): Rename from ns-... version,
	for compatibility with other ports.
	(ns-initialize-window-system): Use it.  It is set in term/common-win.el
	from the -xrm command line argument, but in the Nextstep port its value
	is irrelevant because nsfns.m:Fx_open_connection ignores it for now.

	* progmodes/python.el (defconst, python-syntax-count-quotes)
	(python-indent-region, python-indent-shift-right)
	(python-indent-dedent-line-backspace, python-nav-backward-sexp)
	(python-nav-backward-sexp-safe, python-nav-backward-up-list)
	(python-shell-prompt-block-regexp, python-shell-prompt-output-regexp)
	(python-shell-prompt-pdb-regexp, python-shell-enable-font-lock)
	(inferior-python-mode, python-shell-make-comint, run-python-internal)
	(python-shell-buffer-substring, python-shell-send-buffer)
	(python-pdbtrack-activate, python-pdbtrack-stacktrace-info-regexp)
	(python-completion-complete-at-point, python-fill-docstring-style)
	(python-eldoc-function, python-imenu-format-item-label)
	(python-imenu-format-parent-item-label)
	(python-imenu-format-parent-item-jump-label)
	(python-imenu--build-tree, python-imenu-create-index)
	(python-imenu-create-flat-index): Fix docstring typos.
	(python-indent-context, python-shell-prompt-regexp, run-python):
	Remove superfluous backslashes.
	(python-indent-line, python-nav-beginning-of-defun)
	(python-shell-get-buffer, python-shell-get-process)
	(python-info-current-defun, python-info-current-line-comment-p)
	(python-info-current-line-empty-p, python-util-popn): Doc fixes.
	(python-indent-post-self-insert-function, python-shell-send-file)
	(python-shell-completion-get-completions)
	(python-shell-completion-complete-or-indent)
	(python-eldoc--get-doc-at-point): Reflow docstrings.

2014-03-14  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/package.el (package-menu-mode-map):
	Replace use of obsolete function alias.  Tweak menu item text.

	* info.el (Info-finder-find-node):
	Ignore the `emacs' metapackage.  (Bug#10813)

	* finder.el (finder-list-matches): Include unversioned packages
	in the result of a keyword search.

	* finder.el (finder--builtins-descriptions): New constant.
	(finder-compile-keywords): Use finder--builtins-descriptions.

2014-03-14  Dmitry Gutov  <dgutov@yandex.ru>

	* simple.el (blink-matching-paren): Describe the new value,
	`jump', enabling the old behavior.
	(blink-matching-open): Use that value.  (Bug#17008)

2014-03-14  Glenn Morris  <rgm@gnu.org>

	* finder.el (finder-no-scan-regexp): Add leim-list.
	(finder-compile-keywords):
	Don't skip files with same basename.  (Bug#14010)
	* Makefile.in (setwins_finder): New, excluding leim.
	(finder-data): Use setwins_finder.

	* help-fns.el (help-split-fundoc, help-add-fundoc-usage)
	(help-function-arglist, help-make-usage): Move from here...
	* help.el (help-split-fundoc, help-add-fundoc-usage)
	(help-function-arglist, help-make-usage): ... to here.  (Bug#17001)
	* emacs-lisp/bytecomp.el (byte-compile-lambda): Do not load help-fns.

2014-03-14  Juanma Barranquero  <lekktu@gmail.com>

	* net/socks.el (socks, socks-override-functions)
	(socks-find-services-entry):
	* progmodes/hideif.el (hif-set-var, hif-nexttoken, hif-comma)
	(hif-find-ifdef-block):
	* progmodes/modula2.el (m2-indent): Fix docstring typos.

	* net/tls.el (tls-program): Reflow docstring.

	* progmodes/pascal.el (pascal-mode-abbrev-table)
	(pascal-imenu-generic-expression, pascal-auto-endcomments)
	(pascal-mark-defun, pascal-comment-area, pascal-indent-level)
	(pascal-outline-mode): Fix docstring typos.
	(pascal-mode): Let define-derived-mode document mode hook.
	(pascal-uncomment-area): Reflow.
	(pascal-exclude-str-start, pascal-exclude-str-end): Add docstring.

	* progmodes/opascal.el (opascal-compound-block-indent)
	(opascal-case-label-indent): Fix docstring typos.
	(opascal-mode): Fix typos; let defined-derived-mode document mode hook.

2014-03-13  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Fontify multiple adjacent negation chars.  (Bug#17004)

2014-03-13  Tom Willemse  <tom@ryuslash.org>  (tiny change)

	* emacs-lisp/package.el (package--prepare-dependencies):
	Accept requirements without explicit version (bug#14941).

2014-03-12  Juanma Barranquero  <lekktu@gmail.com>

	* register.el (register-separator, copy-to-register): Doc fixes.
	(register-preview-default): Remove unnecessary call to concat.

	* frameset.el (frameset-restore): When checking for a visible frame,
	use the action map instead of calling visible-frame-list.

2014-03-12  Jonas Bernoulli  <jonas@bernoul.li>

	* emacs-lisp/eieio.el (with-slots): Use cl-symbol-macrolet (bug#16998).

2014-03-12  Martin Rudalics  <rudalics@gmx.at>

	* window.el (fit-frame-to-buffer): Get maximum width from
	display's width instead of height.

2014-03-12  Glenn Morris  <rgm@gnu.org>

	* desktop.el (desktop-restore-frames)
	(desktop-restore-in-current-display, desktop-restore-forces-onscreen)
	(desktop-restore-reuses-frames): Doc tweaks.

	* electric.el (electric-indent-mode): Doc fix.

2014-03-12  Juanma Barranquero  <lekktu@gmail.com>

	* vc/pcvs.el (cvs-temp-buffer, defun-cvs-mode, cvs-get-cvsroot)
	(cvs-checkout, cvs-mode-checkout, cvs-update-filter, cvs-mode-mark)
	(cvs-mode-diff-head, cvs-mode-diff-repository, cvs-mode-diff-yesterday)
	(cvs-mode-diff-vendor, cvs-mode-do, cvs-change-cvsroot)
	(cvs-dired-use-hook): Fix docstring typos.
	(cvs-mode-view-file-other-window, cvs-mode-byte-compile-files):
	Doc fixes.

	* vc/pcvs-defs.el (cvs-auto-remove-handled)
	(cvs-auto-remove-directories, cvs-default-ignore-marks)
	(cvs-idiff-imerge-handlers, cvs-reuse-cvs-buffer)
	(cvs-execute-single-dir): Fix docstring typos.

	* vc/pcvs-info.el (cvs-status-map, cvs-states): Fix docstring typos.
	(cvs-fileinfo-pp, cvs-fileinfo-from-entries): Doc fixes.

	* vc/pcvs-parse.el (cvs-parsed-fileinfo): Reflow docstring.

	* vc/pcvs-util.el (cvs-flags-query, cvs-flags-set, cvs-prefix-set):
	Fix docstring typos.

2014-03-12  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--jump-to-register): Add autoload; it could be
	called from jump-to-register after unloading the frameset package.

2014-03-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (set-mark): Ensure mark-active is nil if the mark is nil
	(bug#16975).  Deactivate the mark before setting it to nil.
	(activate-mark): Do nothing if region is already active.

2014-03-11  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--target-display): Remove definition; declare.
	(frameset-save, frameset-restore): Let-bind frameset--target-display.

2014-03-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--make-1): Fix autoloading avoidance.
	(advice-add): Add a :advice--pending marker, so advice--make-1 knows
	when the advice is pending.
	(advice-remove): Remove this marker when not needed any more.

2014-03-11  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el: Separate options for reusing frames and cleaning up.
	(frameset--reuse-list): Remove definition; declare.
	(frameset--action-map): Declare.
	(frameset--find-frame-if): Doc fix.
	(frameset--restore-frame): Cache frame action.
	(frameset-restore): New keyword arg CLEANUP-FRAMES, allows to select
	how to clean up the frame list after restoring.  Remove cleaning
	options from REUSE-FRAMES.  Change all keyword values to symbols.
	(frameset--jump-to-register): Simplify by using CLEANUP-FRAMES.

	* desktop.el (desktop-restore-forces-onscreen)
	(desktop-restore-reuses-frames): Use non-keyword values.
	(desktop-restore-frameset): Use CLEANUP-FRAMES arg of frameset-restore.

2014-03-10  Glenn Morris  <rgm@gnu.org>

	* files.el (find-file): Doc fix: update info node name.

	* emacs-lisp/advice.el (ad-add-advice, defadvice):
	Doc fix: remove references to deleted info nodes.

2014-03-10  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-open-connection-setup-interactive-shell):
	Do not add nil to the environment, when there's no remote `locale'.
	(tramp-find-inline-encoding): Check, that the remote host has
	installed perl, before sending scripts.

2014-03-10  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/eldoc.el (eldoc-minibuffer-message):
	Clear eldoc-last-message.  (Bug#16920)

2014-03-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* desktop.el (desktop-create-buffer): Don't run activate-mark-hook
	(bug#14430).

2014-03-09  Juri Linkov  <juri@jurta.org>

	* ansi-color.el (ansi-color-names-vector): Copy default colors
	from `xterm-standard-colors' that look well on the default white
	background (and also on the black background) to avoid illegible
	color combinations like yellow-on-white and white-on-white.
	https://lists.gnu.org/archive/html/emacs-devel/2014-02/msg00157.html

2014-03-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-restore): When no frame is visible, do not
	generate a list of frames, just make visible the selected one.

2014-03-08  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-git.el (vc-git-command): Turn FILE-OR-LIST into nil when
	it only contains the repository root.  (Bug#16897)

2014-03-07  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-vc-registered): Run first pass
	only when `remote-file-name-inhibit-cache' is nil.
	(tramp-sh-file-name-handler): Use `tramp-error'.  Simplify code.

2014-03-06  Martin Rudalics  <rudalics@gmx.at>

	* window.el (fit-frame-to-buffer, fit-frame-to-buffer-margins):
	Fix doc-strings.
	(fit-frame-to-buffer): New argument ONLY.  Remove dependency on
	fit-frame-to-buffer variable.  Fix doc-string.
	(fit-window-to-buffer): Set ONLY argument in call of
	fit-frame-to-buffer.  Fix doc-string.

2014-03-06  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-error): VEC-OR-PROC can be nil.
	(tramp-action-password): Clear password cache if needed.
	(tramp-read-passwd): Do not clear password cache.

	* net/tramp-gvfs.el (tramp-gvfs-handler-askpassword): Clear password
	cache unless it is the first password request.

2014-03-06  Glenn Morris  <rgm@gnu.org>

	* simple.el (newline): Doc tweak.

	* emacs-lisp/shadow.el (load-path-shadows-find):
	Ignore dir-locals.  (Bug#12357)

2014-03-05  Glenn Morris  <rgm@gnu.org>

	* files.el (interpreter-mode-alist):
	* progmodes/sh-script.el (sh-ancestor-alist): Add dash.  (Bug#16938)

2014-03-05  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--initial-params): Filter out null entries.

2014-03-05  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-min-height, window-min-width):
	Rewrite doc-strings.
	(window-body-size): Add PIXELWISE argument to make it consistent
	with its callees.

2014-03-05  Juanma Barranquero  <lekktu@gmail.com>

	* finder.el (finder-mode-map, finder-mode-syntax-table):
	Revert part of 2014-02-28 change.

2014-03-05  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-mode-map): [tab] doesn't work on tty.
	(eww-setup-buffer): Clear next/prev/etc more reliably.
	(eww-textarea-map): [tab] doesn't work on tty.
	Reported by Mario Lang.

	* net/shr.el (shr-map): Ditto.

2014-03-04  Glenn Morris  <rgm@gnu.org>

	* minibuffer.el (completion-hilit-commonality):
	Revert 2014-03-01 short-cut, which changed the return value. (Bug#16933)

2014-03-04  Juanma Barranquero  <lekktu@gmail.com>

	* hilit-chg.el (hilit-chg-unload-function): New function.
	(highlight-changes-mode, highlight-changes-visible-mode): Fix typos.
	(hilit-chg-map-changes): Prefer cardinal number to digit.
	(hilit-chg-display-changes): Reflow docstring.
	(highlight-changes-rotate-faces): Remove superfluous backslash.

2014-03-04  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-vc-registered): Do not call
	`tramp-send-command-and-check'.

2014-03-04  Juanma Barranquero  <lekktu@gmail.com>

	* hexl.el (hexl-address-region, hexl-ascii-region)
	(hexl-goto-hex-address, hexl-backward-char, hexl-forward-char)
	(hexl-backward-short, hexl-forward-short, hexl-backward-word)
	(hexl-forward-word, hexl-previous-line, hexl-next-line):
	Use "Hexl mode" for non-hyperlinked hexl-mode references in docstrings.
	(hexl-mode): Doc fix.
	(hexl-ascii-start-column, hexl-beginning-of-line, hexl-end-of-line)
	(hexl-mode-ruler): Fix typos in docstrings.

	* strokes.el (strokes-xpm-header, strokes-rate-stroke): Fix typos.
	(strokes-character, strokes-get-grid-position, strokes-list-strokes):
	Remove superfluous backslashes.
	(strokes-last-stroke, strokes-global-map, strokes-mode):
	Reflow docstrings.
	(strokes-xpm-for-stroke, strokes-xpm-to-compressed-string)
	(strokes-xpm-for-compressed-string): Use quotes with buffer name.
	(strokes-distance-squared, strokes-global-set-stroke)
	(strokes-global-set-stroke-string): Doc fixes.
	(strokes-help): Fix typos; reflow docstring.

2014-03-04  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-in-direction): Fix doc-string.

2014-03-04  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/smie.el (smie-config-guess): Doc fix.
	Explicit error if no grammar.
	(smie-config-save): Doc fix.  Fix quote typo.

2014-03-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/cc-mode.el (c-initialize-cc-mode): Only hook into
	electric-indent-mode-hook if we obey electric-indent-mode.
	(c-basic-common-init): Use (fboundp 'electric-indent-local-mode) to
	decide whether we obey electric-indent-mode.
	(c-change-set-fl-decl-start, c-extend-after-change-region):
	Silence warnings.
	(c-electric-indent-mode-hook): Assume we do want to obey
	electric-indent-mode.

	* electric.el (electric-indent-mode-has-been-called): Remove.
	(electric-indent-mode): Fix accordingly.

	* files.el (hack-local-variables): Mention file name in warning.

	* htmlfontify.el (hfy-fontify-buffer): Drop `invis-range' message.

2014-03-04  Michal Nazarewicz  <mina86@mina86.com>

	* bindings.el: Add comment describing why C-d binds to `delete-char'.
	* simple.el (delete-forward-char): Mark as interactive-only.

2014-03-03  Juanma Barranquero  <lekktu@gmail.com>

	* icomplete.el (icomplete-completions):
	Follow-up to 2014-03-01 change.

	* icomplete.el: Miscellaneous doc fixes.
	Use Icomplete everywhere instead of icomplete for consistency.
	(icomplete-max-delay-chars): Fix typo.
	(icomplete-mode): Use \[].
	(icomplete-tidy, icomplete-exhibit): Reflow.
	(icomplete-minibuffer-setup-hook, icomplete-completions):
	Remove superfluous backlashes.

	* ido.el: Miscellaneous doc fixes.
	Use Ido everywhere instead of ido or `ido' for consistency.
	(ido-record-ftp-work-directories, ido-merge-ftp-work-directories)
	(ido-cache-ftp-work-directory-time, ido-slow-ftp-hosts)
	(ido-slow-ftp-host-regexps, ido-reread-directory): Upcase "ftp".
	(ido-separator): Extract obsolescence info from docstring and declare
	with make-obsolete-variable.
	(ido-minibuffer-setup-hook): Simplify example.
	(ido-text, ido-text-init, ido-input-stack, ido-report-no-match)
	(ido-wide-find-file, ido-wide-find-dir, ido-wide-find-dir-or-delete-dir)
	(ido-completion-help, ido-completing-read): Fix typos in docstrings.
	(ido-everywhere): Reflow docstring.
	(ido-toggle-vc): Doc fix.
	(ido-switch-buffer, ido-find-file): Use tabs to improve legibility
	of long list of keybindings.

2014-03-03  Glenn Morris  <rgm@gnu.org>

	* frame.el (display-pixel-height, display-pixel-width)
	(display-mm-dimensions-alist, display-mm-height)
	(display-mm-width): Doc tweaks.

2014-03-02  Barry O'Reilly  <gundaetiapo@gmail.com>

	* simple.el (undo-elt-in-region): Fix buffer corruption for edge
	case of undo in region.

2014-03-02  Martin Rudalics  <rudalics@gmx.at>

	* window.el (fit-window-to-buffer): Fix argument in window-size
	call when window is horizontally combined.

2014-03-02  Juanma Barranquero  <lekktu@gmail.com>

	* icomplete.el (icomplete-completions): Use string-width.
	Suggested by Stefan Monnier <monnier@iro.umontreal.ca>.

2014-03-01  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Highlight regexp options.  (Bug#16914)

2014-03-01  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--max-delta-1): Round down when calculating
	how many lines/columns we can get from a window.

2014-03-01  Glenn Morris  <rgm@gnu.org>

	* isearch.el (search-invisible): Doc fix.

	* minibuffer.el (completion-hilit-commonality):
	Make `base-size' argument optional.  Short-cut if `prefix-len' is 0.
	* comint.el (comint-dynamic-list-completions): Doc fix.
	* comint.el (comint-dynamic-list-completions):
	* filecache.el (file-cache-minibuffer-complete):
	* tempo.el (tempo-display-completions):
	* eshell/em-hist.el (eshell-list-history):
	Replace use of obsolete argument of display-completion-list.

2014-03-01  Juanma Barranquero  <lekktu@gmail.com>

	* icomplete.el (icomplete-completions):
	Revert back to using "..." when ?… cannot be displayed.

2014-02-28  Juanma Barranquero  <lekktu@gmail.com>

	* finder.el (finder-unload-function): New function.

2014-02-28  Juanma Barranquero  <lekktu@gmail.com>

	* dframe.el (dframe-detach):
	* find-dired.el (find-dired, find-name-dired):
	* finder.el (finder-mode-map, finder-mode-syntax-table)
	(finder-headmark, finder-select, finder-mouse-select):
	Fix docstring typos.

2014-02-28  Martin Rudalics  <rudalics@gmx.at>

	Revert recent with-temp-buffer-window change (Bug#16816, Bug#16882).
	* window.el (with-temp-buffer-window): Revert change from 2014-02-21.
	Suggested by Thierry Volpiatto <thierry.volpiatto@gmail.com>.
	Fix doc-string based on a suggestion by Nicolas Richard
	<theonewiththeevillook@yahoo.fr>.
	* help.el (with-help-window): Fix doc-string.

2014-02-28  Ivan Kanis  <ivan@kanis.fr>

	* net/shr.el (shr-image-animate): New option.
	(shr-put-image): Respect shr-image-animate.

2014-02-28  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el (tramp-adb-parse-device-names):
	Use `accept-process-output'.
	(tramp-adb-handle-file-truename): Cache the localname only.
	(tramp-adb-handle-make-directory)
	(tramp-adb-handle-delete-directory): Flush file properties correctly.
	(tramp-adb-handle-set-file-modes): Do not raise an error when file
	modes cannot be changed.

	* net/tramp-cache.el (tramp-flush-directory-property): Remove also
	file properties of symlinks.

2014-02-28  Per Starbäck  <starback@stp.lingfil.uu.se>

	* textmodes/bibtex.el (bibtex-biblatex-entry-alist): Update
	required/optional fields to match development biblatex.  (Bug#16781)

2014-02-28  Andy Sawyer  <andy.sawyer@gmail.com>  (tiny change)

	* saveplace.el (toggle-save-place):
	Fix argument handling.  (Bug#16673)

2014-02-28  Glenn Morris  <rgm@gnu.org>

	* minibuffer.el (completions-first-difference)
	(completions-common-part, completion-hilit-commonality): Doc fixes.

2014-02-28  Karl Berry  <karl@gnu.org>

	* info.el (Info-mode-map): Add H for describe-mode,
	to synchronize with standalone Info.

2014-02-28  Emilio C. Lopes  <eclig@gmx.net>

	* progmodes/sql.el (sql-interactive-mode):
	Avoid setting global comint-input-ring-separator.  (Bug#16814)

2014-02-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus--init-bus): Declare function.
	(dbus-path-local, dbus-interface-local): New defconst.
	(dbus-init-bus): Use them.
	(dbus-return-values-table): Extend doc.
	(dbus-handle-bus-disconnect): Extend error message.

2014-02-27  Juanma Barranquero  <lekktu@gmail.com>

	* subr.el (y-or-n-p): Fix double space issue in message.

2014-02-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-call-process): Improve trace message.
	(tramp-handle-insert-file-contents): Trace error case.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist)
	<insert-directory>: Use `tramp-handle-insert-directory'.
	(tramp-adb-handle-insert-directory): Remove function.
	(tramp-adb-send-command-and-check): New defun, replacing
	`tramp-adb-command-exit-status'.  Change all callees.
	(tramp-adb-handle-file-attributes)
	(tramp-adb-handle-directory-files-and-attributes): Use it.
	(tramp-adb-ls-output-name-less-p):
	Use `directory-listing-before-filename-regexp'.
	(tramp-adb-handle-delete-directory): Flush also file properties of
	the truename of directory.
	(tramp-adb-handle-file-name-all-completions): Add "./" and "../".
	(tramp-adb-handle-file-local-copy): Make the local copy readable.
	(tramp-adb-handle-write-region): Implement APPEND.
	(tramp-adb-handle-rename-file): Make it more robust.  Flush file
	properties correctly.
	(tramp-adb-maybe-open-connection): Set `tramp-current-*'
	variables.  Check for connected devices only when needed.

2014-02-27  Glenn Morris  <rgm@gnu.org>

	* minibuffer.el (completion-table-dynamic)
	(completion-table-with-cache): Doc fixes.

	* emacs-lisp/crm.el (crm-default-separator, crm-separator)
	(completing-read-multiple): Doc fixes.

2014-02-27  Daniel Colascione  <dancol@dancol.org>

	* minibuffer.el (completion--nth-completion): Fix indentation.

	* net/tramp-sh.el (tramp-get-remote-path): Don't signal error when
	explicit tramp path is empty.

2014-02-27  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/crm.el (completing-read-multiple):
	Empower help-enable-auto-load.

2014-02-26  Glenn Morris  <rgm@gnu.org>

	* startup.el (command-line): Don't init the tty in daemon mode.

	Avoid calling tty-setup-hook twice, eg if a term file
	explicitly calls tty-run-terminal-initialization.  (Bug#16859)
	* faces.el (tty-run-terminal-initialization): Add run-hook argument.
	(tty-create-frame-with-faces): Use it.
	* startup.el (command-line): Pass run-hook argument
	to tty-run-terminal-initialization.

	* dired.el (dired-restore-desktop-buffer): Demote errors;
	eg in case a glob match fails.  (Bug#16884)

2014-02-26  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/lisp.el (lisp--local-variables): Catch `end-of-file'
	error from `read-from-string'.  (Bug#16850)

	* emacs-lisp/ert.el (ert-run-tests-interactively): `read' the
	result of `completing-read' in the interactive form.  (Bug#16854)

2014-02-25  Glenn Morris  <rgm@gnu.org>

	* image.el (image-animate, image-animate-timeout):
	Stop animating images in dead buffers.  (Bug#16878)

	* emacs-lisp/edebug.el (defmacro): Fix debug spec.  (Bug#16868)

	* faces.el (tty-setup-hook, tty-run-terminal-initialization):
	Doc fixes.
	* startup.el (term-setup-hook): Doc fix.  Make obsolete.
	* term/sun.el (sun-raw-prefix-hooks):
	Use tty-setup-hook instead of term-setup-hook.
	(terminal-init-sun): Construct message from bytecomp plist.
	* term/wyse50.el (enable-arrow-keys): Doc fix.

2014-02-24  Juanma Barranquero  <lekktu@gmail.com>

	* term/sun.el (kill-region-and-unmark, sun-raw-prefix-hooks):
	Fix docstring typos.

2014-02-24  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-truename): Improve last fix.

2014-02-24  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* minibuffer.el (completion--try-word-completion):
	Fix error when completing M-x commands (bug#16808).

2014-02-24  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/easy-mmode.el (define-minor-mode): Fix debug spec.

2014-02-24  Juanma Barranquero  <lekktu@gmail.com>

	* apropos.el (apropos-print): Avoid formatting error when
	apropos-do-all and apropos-compact-layout are both t.

2014-02-23  Juanma Barranquero  <lekktu@gmail.com>

	* apropos.el (apropos-property, apropos-all-words-regexp)
	(apropos-true-hit, apropos-variable, apropos-print):
	Fix docstring typos, and remove obsolete comment.

2014-02-23  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-truename):
	Preserve trailing "/".  (Bug#16851)

2014-02-23  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-rules): Don't indent specially
	after `=>' (bug#16811).
	(ruby-smie-rules): Handle the inconsistent second element of the
	list returned by `smie-indent--parent'.
	(ruby-font-lock-keywords): Disqualify any identifier before `=' as
	method call.

2014-02-23  Juanma Barranquero  <lekktu@gmail.com>

	* elec-pair.el (electric-pair-text-syntax-table)
	(electric-pair-syntax-info, electric-pair--syntax-ppss)
	(electric-pair--balance-info, electric-pair-mode): Fix docstring typos.
	(electric-pair--looking-at-unterminated-string-p): Doc fix.
	(electric-pair--inside-string-p): Doc fix.  Use `let', not `let*'.

2014-02-22  Glenn Morris  <rgm@gnu.org>

	* imenu.el (imenu--generic-function): Doc fix.

	* register.el (frame-configuration-to-register): Make obsolete.

2014-02-22  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-save-buffer-p): Do not fail when
	desktop-files-not-to-save is nil.  Return t for true result
	as the doc says.

2014-02-22  Daniel Colascione  <dancol@dancol.org>

	* net/secrets.el (secrets-create-item, secrets-search-items):
	Check that attribute values are strings, avoiding the construction
	of invalid dbus messages.

2014-02-21  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/gv.el: Avoid duplicating gv-expander and gv-setter in
	defun-declarations-alist.

2014-02-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl-define-compiler-macro): Add indent rule
	(bug#16829).

2014-02-21  Juanma Barranquero  <lekktu@gmail.com>

	* whitespace.el (whitespace-space, whitespace-hspace, whitespace-tab)
	(whitespace-newline, whitespace-trailing, whitespace-line)
	(whitespace-space-before-tab, whitespace-indentation, whitespace-empty)
	(whitespace-space-after-tab): Fix typo in docstrings.

2014-02-21  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (auto-mode-alist): Add missing "or".

	* electric.el (electric-indent-functions-without-reindent):
	Add `yaml-indent-line'.

2014-02-21  Juanma Barranquero  <lekktu@gmail.com>

	* w32-vars.el (w32-enable-synthesized-fonts): Mark as obsolete.
	It has done nothing for years; should be removed after the release.

	* simple.el (choose-completion): Fix docstring typo.
	(read-quoted-char-radix): Remove unneeded * in docstring.
	(process-file, kill-whole-line, pop-to-mark-command, set-mark-command):
	Don't escape parentheses unnecessarily in docstrings.

2014-02-21  Martin Rudalics  <rudalics@gmx.at>

	Fix handling of window-min-height/-width (Bug#16738).
	* window.el (window--dump-window, window--dump-frame):
	New functions.
	(window--min-size-1): Account for window dividers.
	When window-resize-pixelwise is nil, delay rounding till after the
	sum of the window components has been calculated.
	(window--min-delta-1, window--max-delta-1): When PIXELWISE is
	nil make sure at least one text line and two text columns remain
	fully visible.
	(window-resize): Signal an error when window-resize-apply fails.
	(window--resize-child-windows): Fix calculation of by how many
	pixels a window can still be shrunk via window-new-normal.
	(adjust-window-trailing-edge): Call window--resizable with
	correct TRAIL argument.

	(with-temp-buffer-window): Don't evaluate BODY within
	with-current-buffer (Bug#16816).

2014-02-21  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-check-cached-permissions):
	Call `file-attributes' with `suffix' being a symbol but a string.

2014-02-21  Daniel Colascione  <dancol@dancol.org>

	* net/dbus.el (dbus-init-bus-1): Declare new subr.
	(dbus-init-bus): New function: call into dbus-init-bus-1
	and installs a handler for the disconnect signal.
	(dbus-call-method): Rewrite to look for result in cons.
	(dbus-call-method-handler): Store result in cons.
	(dbus-check-event): Recognize events with nil sender as valid.
	(dbus-handle-bus-disconnect): New function.  React to bus
	disconnection signal by synthesizing dbus error for each
	pending synchronous or asynchronous call.
	(dbus-notice-synchronous-call-errors): New function.
	(dbus-handle-event): Raise errors directly only when `dbus-debug'
	is true, not all the time.

2014-02-21  Juanma Barranquero  <lekktu@gmail.com>

	* w32-fns.el (w32-enable-italics, w32-charset-to-codepage-alist):
	Remove obsolescence declarations, these variables do not exist anymore.

	* savehist.el (savehist-save-minibuffer-history)
	(savehist-additional-variables, savehist-file, savehist-mode-hook)
	(savehist-save-hook, savehist-coding-system, savehist-loaded)
	(savehist-load, savehist-install, savehist-autosave): Fix typos;
	mostly, refer to "Savehist mode" when talking about the mode,
	and not the function.

	* saveplace.el (save-place): Remove redundant info in docstring.
	(save-place-forget-unreadable-files, toggle-save-place)
	(save-place-forget-unreadable-files, save-place-dired-hook):
	Fix typos and remove unneeded backslashes.

2014-02-20  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (ls-lisp-use-insert-directory-program): Declare.
	(tramp-handle-insert-directory): New defun, taken from tramp-gvfs.el.

	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist)
	<insert-directory>: Use `tramp-handle-insert-directory'.
	(tramp-gvfs-handle-insert-directory): Remove function.

	* net/tramp-sh.el (tramp-sh-handle-insert-directory):
	Call `tramp-handle-insert-directory'.

2014-02-20  Juanma Barranquero  <lekktu@gmail.com>

	* elec-pair.el (electric-pair-syntax-info): Do not check syntax
	before the start of buffer/region (bug#16799).

2014-02-20  Glenn Morris  <rgm@gnu.org>

	* isearch.el (search-invisible): Doc fix.

2014-02-20  W. Trevor King  <wking@tremily.us>  (tiny change)

	* term/xterm.el (xterm--version-handler): Adapt to xterm-280's output
	(bug#16657).

2014-02-19  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-restore): Delay removing an old frame's
	duplicate id until the new frame has been correctly created.

2014-02-19  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-handle-make-symbolic-link): New defun.
	(tramp-check-cached-permissions): Call `file-attributes' if the
	cache is empty.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist)
	<make-symbolic-link>: Use `tramp-handle-make-symbolic-link'.

	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist)
	<make-symbolic-link>: Use `tramp-handle-make-symbolic-link'.
	(tramp-gvfs-maybe-open-connection): Set always connection
	properties, even if target is mounted already.

	* net/tramp-sh.el (tramp-color-escape-sequence-regexp):
	Set tramp-autoload cookie.
	(tramp-get-remote-touch): New defun.
	(tramp-sh-handle-set-file-times): Use it.
	(tramp-sh-handle-directory-files-and-attributes):
	Use `tramp-handle-directory-files-and-attributes' if neither stat
	nor perl are available on the remote host.

	* net/tramp-smb.el (tramp-smb-handle-insert-directory): Mark trailing
	"/".  Write long listing only when "l" belongs to the switches.

	* net/trampver.el: Update release number.

2014-02-19  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--reuse-frame): Remove workaround for bug#16793.

2014-02-19  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-state-put): Allow WINDOW to refer to an
	internal window (Bug#16793).

2014-02-19  Glenn Morris  <rgm@gnu.org>

	* textmodes/remember.el: Move provide statement to end.
	(remember-mode-map, remember-notes-mode-map, remember-notes-mode)
	(remember-notes): Doc fixes.

2014-02-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* delsel.el (delete-char): Restore incorrectly erased property
	(bug#16795).

2014-02-18  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--restore-frame): When a frame is being reused
	and its root window is not alive, delete all the frame's windows before
	restoring the window state.  This works around the issue in bug#16793.

2014-02-18  Glenn Morris  <rgm@gnu.org>

	* textmodes/remember.el (remember-data-directory)
	(remember-directory-file-name-format, remember-store-in-files)
	(remember-notes-initial-major-mode, remember-notes-bury-on-kill)
	(remember-notes-save-and-bury-buffer)
	(remember-notes--kill-buffer-query): Doc fixes.

	* desktop.el (desktop-save-mode, desktop-auto-save-timeout): Doc fixes.

2014-02-17  Alan Mackenzie  <acm@muc.de>

	Connect electric-indent-mode up with CC Mode.  Bug #15478.
	* progmodes/cc-mode.el (c-initialize-cc-mode): Add CC Mode hooks
	to electric-indent-{,local-}-mode.
	(c-basic-common-init): Set electric-indent-inhibit.
	Initialize c-electric-flag from electric-indent-mode.
	(c-electric-indent-mode-hook, c-electric-indent-local-mode-hook):
	New hook functions which propagate electric-indent-mode to CC mode.

	* progmodes/cc-cmds.el (c-toggle-electric-state): When C-c C-l is
	hit, toggle electric-indent-local-mode.

	* electric.el (electric-indent-mode-has-been-called):
	New variable.

2014-02-17  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-cfg-id): New function.
	(frameset--reuse-frame, frameset-restore): Use it.
	(frameset--jump-to-register): Try harder to reuse frames (bug#16748).

2014-02-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ido.el (ido-file-internal): Remove unused var `d'.
	Use \` for to match BoS.  Fit within 80n columns.

2014-02-17  Daniel Colascione  <dancol@dancol.org>

	* net/dbus.el (dbus-call-method): Work around bug#16775 by having
	dbus-call-method check for completion using a busy-wait loop with
	gradual backoff.

2014-02-16  Michael Albinus  <michael.albinus@gmx.de>

	Sync with Tramp 2.2.9.

	* net/trampver.el: Update release number.

2014-02-16  Dmitry Gutov  <dgutov@yandex.ru>

	* ido.el (ido-file-internal): Don't add the name of an existing
	directory twice.  (Bug#16747)

2014-02-16  Glenn Morris  <rgm@gnu.org>

	* vc/ediff-init.el (ediff-use-faces, ediff-highlight-all-diffs):
	Do not use ediff-defvar-local on pre-defined variables.  (Bug#16744)

2014-02-15  Michael R. Mauger  <michael@mauger.com>

	* progmodes/sql.el: Version 3.4
	(sql-oracle-options): New default value ("-L").
	(sql-mode-oracle-font-lock-keywords): Add placeholder highlighting.
	(sql-placeholders-filter): Correct placeholder pattern.
	(sql-read-table-name): Bug fix.  Detect absence of SQLi process.
	(sql-login-delay): New variable.
	(sql-product-interactive): Use it.

2014-02-15  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--jump-to-register): Check that buffer is live
	(bug#16749).

2014-02-15  Glenn Morris  <rgm@gnu.org>

	* info.el (info-initialize): Revert 2014-01-10 change.

2014-02-14  Glenn Morris  <rgm@gnu.org>

	* replace.el (map-query-replace-regexp)
	(read-regexp-defaults-function, read-regexp): Doc fixes.

	* dired.el (dired-read-regexp):
	* faces.el (list-faces-display):
	* misearch.el (multi-isearch-read-matching-buffers)
	(multi-isearch-read-matching-files):
	* play/cookie1.el (cookie-apropos):
	* progmodes/grep.el (grep-read-regexp): Doc fixes.

	* textmodes/remember.el (remember): Use frameset-to-register
	rather than frame-configuration-to-register.

2014-02-14  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-menu.el (calc-vectors-menu): Remove menu item for
	incorrect keybinding.

2014-02-13  Daniel Colascione  <dancol@dancol.org>

	* progmodes/flymake.el (flymake-post-syntax-check): Widen buffer
	when adding overlays so that line numbers from compiler match line
	numbers we use.

2014-02-13  Glenn Morris  <rgm@gnu.org>

	* mail/rmail.el (rmail-probe): Be less strict.  (Bug#16743)

	* jit-lock.el (jit-lock-mode): Doc fix.

2014-02-13  Juanma Barranquero  <lekktu@gmail.com>

	* apropos.el (apropos-read-pattern): When the user passes an empty
	string, give a more helpful error message than "Wrong type
	argument: stringp, nil".

2014-02-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* jit-lock.el (jit-lock-mode): Keep it disabled in indirect buffers.

2014-02-13  Glenn Morris  <rgm@gnu.org>

	* finder.el (finder-known-keywords, finder-mode-map): Doc fixes.

2014-02-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emulation/cua-base.el (cua-scroll-up, cua-scroll-down): Mark them as
	shift-select commands.

2014-02-12  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/js.el (js-indent-line): Don't widen.
	https://lists.gnu.org/archive/html/emacs-devel/2012-06/msg00276.html

2014-02-12  Glenn Morris  <rgm@gnu.org>

	* icomplete.el (icomplete): Add info-link to defgroup.
	(icomplete-with-completion-tables, icomplete-minibuffer-setup-hook)
	(icomplete-minibuffer-map, icomplete-mode)
	(icomplete-simple-completing-p, icomplete-completions): Doc fixes.

	* emacs-lisp/package.el (package-menu-mode-map): Tweak menu.
	(package-menu-filter): Rename from package-menu-filter-interactive.
	Doc fix.

2014-02-11  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--jump-to-register): Select the required
	window and buffer before restoring position (bug#16696).

2014-02-11  Lars Ingebrigtsen  <larsi@gnus.org>

	* dired.el (dired-get-marked-files): Clarify doc (bug#11534).

2014-02-10  Glenn Morris  <rgm@gnu.org>

	* jit-lock.el (jit-lock-force-redisplay): Doc fix.  (Bug#14394)

2014-02-10  Eli Zaretskii  <eliz@gnu.org>

	* w32-common-fns.el (x-get-selection): Doc fix.
	* select.el (x-get-selection): Doc fix.  (Bug#15109)

	* face-remap.el (face-remap-add-relative)
	(face-remap-remove-relative, face-remap-reset-base)
	(face-remap-set-base): Call force-mode-line-update to redisplay
	the current buffer due to potential change in faces.  (Bug#16709)

2014-02-10  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-vc-registered): Apply heredoc
	script more robustly.

2014-02-10  Lars Ingebrigtsen  <larsi@gnus.org>

	* dired.el (dired-get-marked-files): Doc fix (bug#11534).

	* simple.el (choose-completion): Doc fix (bug#14160).

	* subr.el (event-start): Say what a nil EVENT value means.

	* kmacro.el (kmacro-bind-to-key): Say that the parameter is unused
	(bug#14197).

	* progmodes/grep.el (find-program): Doc fix (bug#14289).

	* files.el (confirm-kill-emacs): Clarify doc (bug#15455).

	* emacs-lisp/lisp.el (up-list): Doc fix (bug#15832).

	* files.el (confirm-kill-emacs): Allow specifying an arbitrary
	predicate function (bug#15455).

2014-02-10  Dmitry Gutov  <dgutov@yandex.ru>

	* ielm.el (inferior-emacs-lisp-mode): Instead of
	`comment-use-global-state', set `comment-use-syntax'.

2014-02-10  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/gulp.el (gulp-discard): Add emacs-devel.

2014-02-09  Alan Mackenzie  <acm@muc.de>

	Fix c-invalidate-state-cache on narrowed buffers.
	* progmodes/cc-defs.el (c-with-all-but-one-cpps-commented-out):
	Widen when setting and clearing the CPP delimiter properties.

2014-02-09  Lars Ingebrigtsen  <larsi@gnus.org>

	* help.el (describe-bindings): Doc fix (bug#9888).

	* files.el (save-buffer): Use ARG as the parameter name for
	consistency (bug#10346).
	(save-buffer): Clarify the 0 argument (bug#10346).

	* cus-edit.el (customize-apropos): Fix error string.
	(custom-buffer-create): Doc fix (bug#11122).
	(custom-sort-items): Doc fix (bug#11121).

	* repeat.el (repeat-message-function): Reword doc slightly (bug#11619).

	* icomplete.el (icomplete-with-completion-tables): Doc fix (bug#11654).
	(icomplete-simple-completing-p): Mention the previous variable.

	* font-lock.el (font-lock-value-in-major-mode): Clarify the
	meaning of the parameter (bug#12282).

	* files.el (find-file-noselect): Clarify prompt when changing
	readedness (bug#13261).
	(locate-file): Suffixes aren't returned, so don't say that they
	are (bug#12674).
	(backup-inhibited): Doc clarification (bug#12525).

	* dired.el (dired-internal-do-deletions): Don't say "Deleting..."
	before we actually start to delete things (bug#16331).

	* subr.el (event-start): Doc fix (bug#14228).
	(event-end): Ditto.

2014-02-09  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/warnings.el (lwarn):
	Empower help-enable-auto-load.  (Bug#15940)

2014-02-08  Andreas Schwab  <schwab@linux-m68k.org>

	* vc/log-edit.el (log-edit-comment-to-change-log): Doc fix.
	(Bug#16690)

2014-02-08  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-start-file-process):
	Insert output at end of buffer.  (Bug#16120)

2014-02-08  Lars Ingebrigtsen  <larsi@gnus.org>

	* simple.el (choose-completion-string-functions): Document new
	calling convention (bug#14153).
	(execute-extended-command): Clarify doc string (bug#13373).

	* kmacro.el (kmacro-exec-ring-item): Doc fix (bug#14198).

	* find-dired.el (find-name-dired): Doc fix (bug#14290).
	(find-grep-dired): Doc fix (bug#14288).

2014-02-08  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-quote-char): Check character validity
	like in `quoted-insert' (bug#16677).

2014-02-08  Lars Ingebrigtsen  <larsi@gnus.org>

	* files.el (find-file-visit-truename): Doc clarification (bug#14697).

	* isearch.el (isearch-hide-immediately): Doc clarification
	(bug#14723).

	* simple.el (line-move): Document utility function used many
	places in the Emacs sources (bug#14843).

	* dired.el (dired-mode-map): Make :help text more accurate (bug#14893).
	(dired-prev-marked-file): Doc fix (bug#14855).
	(dired-up-directory): Doc fix (bug#14848).

	* minibuffer.el (read-file-name): Doc clarification (bug#15096).

	* files.el (file-relative-name): Doc fix (bug#15159).

	* fringe.el (fringe-styles): Doc fix (bug#15239).

	* isearch.el (isearch-filter-predicate): Documentation typo fix
	(bug#15474).

	* info-look.el (info-lookup-symbol): Document MODE (bug#15498).

	* isearch.el (isearch-cmds): Doc clarification (bug#15547).

	* replace.el (replace-match-maybe-edit): Doc clarification
	(bug#15632).

	* subr.el (add-to-list): Refill the paragraphs (bug#15791).

	* macros.el (insert-kbd-macro): Doc fix (bug#16025).

2014-02-08  Glenn Morris  <rgm@gnu.org>

	* help-fns.el (describe-variable):
	Check {file,dir}-local-variables-alist, and buffer-file-name,
	in the correct buffer.

2014-02-08  Ingo Lohmar  <i.lohmar@gmail.com>

	* help-fns.el (describe-variable): Fix the case where
	a value is directory-local with no dir-locals file.  (Bug#16635)

2014-02-08  Glenn Morris  <rgm@gnu.org>

	* abbrev.el (edit-abbrevs-mode):
	Derive from fundamental-mode.  (Bug#16682)

2014-02-07  Juanma Barranquero  <lekktu@gmail.com>

	* simple.el (quoted-insert): Check character validity (bug#16677).

2014-02-07  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-read): Claim the lock when the owner is not
	the current process.  (Bug#16157)

2014-02-07  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-buffers-not-to-save): Change default from nil
	to "\\` ".  (Bug#16651)

2014-02-07  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-save-mode): Call `desktop-auto-save-set-timer'
	when enabling, and `desktop-auto-save-cancel-timer' when disabling.
	(desktop-auto-save-cancel-timer): New function with some code from
	`desktop-auto-save-set-timer'.
	(after-init-hook): Don't call `desktop-auto-save-set-timer'.
	Instead of setting `desktop-save-mode' to nil, call
	`desktop-save-mode' with arg 0.  (Bug#16630)

2014-02-07  Glenn Morris  <rgm@gnu.org>

	* hi-lock.el (hi-lock-auto-select-face, hi-lock-line-face-buffer)
	(hi-lock-face-buffer, hi-lock-face-phrase-buffer)
	(hi-lock-face-symbol-at-point, hi-lock-read-face-name): Doc tweaks.

	* obsolete/iswitchb.el: Move to obsolete/.
	* simple.el (iswitchb-mode): Add manual autoloads to ease transition,
	since obsolete/ is not scanned for autoloads.
	* emacs-lisp/authors.el (authors-valid-file-names):
	Add iswitchb.el.

	* obsolete/meese.el: Restore as obsolete (deleted 2014-01-11).
	Disable now non-functional find-file-hook.

2014-02-06  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-start-file-process): Use "&&"
	instead of ";" in order to avoid additional prompts.  Let heredoc
	scripts read from tty.  (Bug#16582)
	(tramp-send-command): No special handling of heredocs, it isn't
	necessary anymore.

2014-02-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp.el (lisp-completion-at-point): Symbols don't start
	with a space (bug#16664).  Limit the symbols considered to the ones
	that are bound or fbound (bug#16646).

2014-02-06  Glenn Morris  <rgm@gnu.org>

	* epa.el (epa-mail-aliases): Doc fix.

2014-02-06  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/lisp.el (lisp-completion-at-point):
	Use `completion-table-merge' instead of `completion-table-in-turn'
	(bug#16604).

	* minibuffer.el (completion-table-merge): New function.

2014-02-05  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-end-of-heredoc): New defconst.
	(tramp-sh-handle-set-file-acl)
	(tramp-sh-handle-start-file-process)
	(tramp-sh-handle-write-region, tramp-sh-handle-vc-registered)
	(tramp-find-executable, tramp-send-command): Use it.

2014-02-05  Glenn Morris  <rgm@gnu.org>

	* epa.el (epa-mail-aliases): Fix custom type.  Doc tweak.

2014-02-04  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-send-string)
	(python-shell-send-string-no-output): Fix docstring (Bug#16547).

2014-02-04  Anders Lindgren  <andlind@gmail.com>

	* emacs-lisp/ert.el (ert--activate-font-lock-keywords): Allow dashes in
	the names (bug#16620).

2014-02-03  Martin Rudalics  <rudalics@gmx.at>

	* faces.el (window-divider): New default value.  Rewrite doc-string.
	(window-divider-first-pixel, window-divider-last-pixel): New faces.

2014-02-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): `private',
	`protected' and `public' can also be called without arguments.

2014-02-03  Glenn Morris  <rgm@gnu.org>

	* register.el (window-configuration-to-register)
	(frame-configuration-to-register): Unadvertise unused argument.
	* frameset.el (frameset-to-register): Remove unused argument.

	* frameset.el (frameset-to-register):
	* kmacro.el (kmacro-to-register):
	* register.el (increment-register):
	* calc/calc-yank.el (calc-copy-to-register, calc-insert-register)
	(calc-append-to-register, calc-prepend-to-register):
	* play/gametree.el (gametree-layout-to-register)
	(gametree-apply-register-layout):
	* textmodes/picture.el (picture-clear-rectangle-to-register)
	(picture-yank-rectangle-from-register):
	* vc/emerge.el (emerge-combine-versions-register):
	Use register-read-with-preview to read registers.

2014-02-03  João Távora  <joaotavora@gmail.com>

	* elec-pair.el (electric-pair-backward-delete-char): Don't error
	when at beginning of (possibly narrowed) buffer.

2014-02-02  Daniel Colascione  <dancol@dancol.org>

	* help-at-pt.el (help-at-pt-string, help-at-pt-maybe-display):
	Also try to display local help from just before point.

2014-02-02  Alan Mackenzie  <acm@muc.de>

	c-parse-state.  Don't "append-lower-brace-pair" in certain
	circumstances.  Also fix an obscure bug where "\\s!" shouldn't be
	recognized as a comment.

	* progmodes/cc-engine.el (c-state-pp-to-literal): Check for "\\s!"
	as well as normal comment starter.
	(c-parse-state-get-strategy): Extra return possibility
	'back-and-forward.
	(c-remove-stale-state-cache): Extra element CONS-SEPARATED in
	return value list to indicate replacement of a brace-pair cons
	with its car.
	(c-parse-state-1): With 'back-and-forward, only call
	c-append-lower-brace-pair-to state-cache when cons-separated.

2014-02-02  Jan Djärv  <jan.h.d@swipnet.se>

	* term/ns-win.el (ns-suspend-error): New function.
	(ns-initialize-window-system): Add ns-suspend-error to
	suspend-hook (Bug#16612).

2014-02-02  Daniel Colascione  <dancol@dancol.org>

	* progmodes/cc-defs.el (c-find-assignment-for-mode):
	Make loading cc-mode silent.

2014-02-02  Daniel Colascione  <dancol@dancol.org>

	* comint.el (comint-prompt-read-only): Change doc to suggest
	remap keybinding.

2014-02-02  Glenn Morris  <rgm@gnu.org>

	* register.el (register-read-with-preview, point-to-register)
	(window-configuration-to-register, frame-configuration-to-register)
	(jump-to-register, number-to-register, view-register, insert-register)
	(copy-to-register, append-to-register, prepend-to-register)
	(copy-rectangle-to-register): Doc fixes.

2014-02-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help-fns.el (help-C-file-name): Handle advised functions (bug#16478).
	* emacs-lisp/find-func.el (find-function-C-source): Idem.
	* emacs-lisp/nadvice.el (advice--cd*r): New function.
	* help-fns.el (describe-function-1): Use it.

2014-02-02  Glenn Morris  <rgm@gnu.org>

	* register.el (register-preview-default): New function,
	split from register-preview.
	(register-preview-function): Rename from register-preview-functions,
	make it not a hook.
	(register-preview): Use register-preview-function.
	(register-read-with-preview): Error on non-character event.  (Bug#16595)

2014-02-01  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--implicit-semi-p): Check for
	`:' before binary operators (bug#16609).  Don't check for `:'
	before `[' and `(', or their syntax status.  A percent literal
	can't end with either.
	(ruby-font-lock-keywords): For built-ins that require arguments,
	check that they're followed by something that looks like argument
	(bug#16610).

2014-02-01  Lars Ingebrigtsen  <larsi@gnus.org>

	* subr.el (butlast): Document what an omitted N means (bug#13437).
	(nbutlast): Ditto.

2014-01-31  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-generic): Make into a defsubst to make the stack
	depth shallower (bug#16587).
	(shr-tag-svg): Respect `shr-inhibit-images'.
	(shr-dom-to-xml): Respect `shr-blocked-images' (bug#15882).

2014-01-31  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-align-chained-calls): New option.
	(ruby-smie-grammar): Make "." right-associative.  Make its priority
	lower than the ternary and all binary operators.
	(ruby-smie-rules): Indent "(" relative to the first non-"."
	parent, or the first "." parent at indentation.
	Use `ruby-align-chained-calls' for indentation of "." tokens.
	(Bug#16593)

2014-01-31  Juri Linkov  <juri@jurta.org>

	* sort.el (delete-duplicate-lines): Remove `:weakness 'key'
	from `make-hash-table'.

	* textmodes/ispell.el (ispell-init-process): Change message format
	to be consistent with other messages.

2014-01-31  Glenn Morris  <rgm@gnu.org>

	* delsel.el (delete-selection-mode): Doc fix.

	* emacs-lisp/trace.el (trace--read-args, trace-function-foreground)
	(trace-function-background): Doc fixes.

	* ido.el (ido-use-virtual-buffers): Doc fix.
	Reset :version, since the default value has not changed.

	* register.el (register-preview-delay, register-read-with-preview):
	Doc fixes.

	* mail/reporter.el (reporter-dump-variable): In case of void-variable,
	do not mess with mail-buffer position (fixes 2009-11-03 change).
	* progmodes/cc-mode.el (c-submit-bug-report):
	Check auto-fill-mode is bound.  (Bug#16592)

2014-01-31  Darren Hoo  <darren.hoo@gmail.com>

	* startup.el (fancy-splash-image-file): New function,
	split from fancy-splash-head.
	(fancy-splash-head, use-fancy-splash-screens-p): Use it,
	so that we are both using the same image.  (Bug#16574)

2014-01-30  Glenn Morris  <rgm@gnu.org>

	* simple.el (eval-expression): Doc fix.

	* hexl.el (hexl-mode-hook):
	* ielm.el (ielm-mode-hook):
	* emacs-lisp/lisp-mode.el (emacs-lisp-mode-hook)
	(lisp-interaction-mode-hook):
	* progmodes/cfengine.el (cfengine3-documentation-function):
	Replace obsolete alias `turn-on-eldoc-mode' with `eldoc-mode'.

2014-01-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-opt.el (eieio-help-generic): Don't assume `generic'
	is a symbol (bug#16584).

2014-01-30  Glenn Morris  <rgm@gnu.org>

	* help.el (help-for-help-internal): Add "P" to text.

2014-01-29  Glenn Morris  <rgm@gnu.org>

	* simple.el (just-one-space, cycle-spacing): Doc fixes.

2014-01-28  Martin Rudalics  <rudalics@gmx.at>

	* window.el (fit-frame-to-buffer): Fix calculations for margins and
	height constraints.

2014-01-28  Luke Lee  <luke.yx.lee@gmail.com>

	* progmodes/hideif.el: Extend to full CPP expression syntax.
	(hif-token-alist): Add missing tokens.
	(hif-token-regexp): Add support for float/octal/hex immediates.
	(hif-string-literal-regexp): New const.
	(hif-tokenize): Recognize strings and float/octal/hex immediates.
	(hif-exprlist): New function.
	(hif-parse-if-exp): Use it.
	(hif-logior-expr, hif-logxor-expr, hif-logand-expr, hif-comp-expr)
	(hif-logshift-expr, hif-muldiv-expr, hif-lognot, hif-shiftleft)
	(hif-shiftright, hif-multiply, hif-divide, hif-modulo, hif-equal)
	(hif-logxor, hif-comma): New functions.

2014-01-28  Glenn Morris  <rgm@gnu.org>

	* textmodes/fill.el (fill-single-char-nobreak-p): Doc tweak.

	* indent.el (tab-stop-list): Doc fix.  Add :version.

	* vc/pcvs.el (vc-editable-p, vc-checkout): Remove unused declarations.
	(cvs-append-to-ignore): Add compatibility alias.

2014-01-27  Glenn Morris  <rgm@gnu.org>

	* dired.el (dired-hide-details-mode): Don't autoload it,
	since it cannot be used outside Dired buffers anyway.

	* emulation/cua-base.el (cua-mode): Doc fix.

	* dired.el (dired-hide-details-hide-symlink-targets)
	(dired-hide-details-hide-information-lines)
	(dired-hide-details-mode): Doc fixes.

	* shadowfile.el (shadow-info-file, shadow-todo-file): Doc fix.
	* strokes.el (strokes-file): Doc fix.  Bump :version.
	(strokes-help): Doc fix.
	* emulation/viper-init.el (viper-vi-style-in-minibuffer): Doc fix.
	* emulation/viper.el (viper): Doc fix for custom group.
	(top-level): Remove oh-so-no-longer-relevant text about vip.
	* obsolete/otodo-mode.el (todo-prefix): Doc fix.

	* ido.el (ido-save-directory-list-file):
	* saveplace.el (save-place-file):
	* calendar/timeclock.el (timeclock-file):
	* net/quickurl.el (quickurl-url-file):
	* obsolete/otodo-mode.el (todo-file-do, todo-file-done, todo-file-top):
	* progmodes/idlwave.el (idlwave-config-directory):
	* textmodes/remember.el (remember-data-file):
	Bump :version.

2014-01-26  Glenn Morris  <rgm@gnu.org>

	* progmodes/opascal.el (opascal-tab-always-indents, opascal-tab):
	Doc fix.  Make obsolete.
	(opascal-mode): No longer mention opascal-tab-always-indents in doc.

	* sort.el (delete-duplicate-lines): Doc fix.

2014-01-25  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/ada-mode.el (ada):
	* woman.el (woman): Link to info manual and Commentary section.

	* progmodes/flymake.el (flymake):
	* nxml/nxml-mode.el (nxml):
	* net/eww.el (eww):
	* speedbar.el (speedbar, speedbar-faces, speedbar-vc):
	* htmlfontify.el (htmlfontify):
	* ses.el (ses):
	* epa.el (epa):
	* ido.el (ido): Link to info manual.

2014-01-25  Leo Liu  <sdl.web@gmail.com>

	* progmodes/flymake.el (flymake-make-overlay): No rear advance.

2014-01-25  Adam Sjøgren  <asjo@koldfront.dk>

	* net/shr.el (shr-tag-img): Prefer the title over the alt text
	(bug#16537).

2014-01-24  Juanma Barranquero  <lekktu@gmail.com>

	* net/eww.el (eww-download-callback):
	Fix reference to eww-download-directory.

	* emacs-lisp/bytecomp.el (byte-compile-file):
	Remove unused local variable `file-name'.

2014-01-24  Glenn Morris  <rgm@gnu.org>

	* woman.el (woman-default-faces, woman-monochrome-faces):
	Fix obsolescence specification.

	* subr.el (with-demoted-errors): Doc fix.

2014-01-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el: Improve type->predicate mapping (bug#16520).
	(cl--macroexp-fboundp): New function.
	(cl--make-type-test): Use it.

2014-01-23  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/lisp-mode.el (eval-print-last-sexp, eval-last-sexp):
	* simple.el (eval-expression): Doc fixes.

2014-01-22  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/authors.el (authors-fixed-entries): Addition.

2014-01-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el: Write files silently.
	(package-autoload-ensure-default-file, package--write-file-no-coding)
	(package-generate-description-file, package--download-one-archive)
	(package-install-from-archive): Tell `write-region' to stay quiet.
	(package-menu-mode, package-menu--print-info): Omit the Archive column
	if there's only one archive.
	(package-all-keywords, package--has-keyword-p): Remove dead code.

2014-01-22  Glenn Morris  <rgm@gnu.org>

	* version.el (emacs-bzr-version-bzr): Fix typo.

	* version.el (emacs-repository-get-version):
	Check either .bzr or .git, but not both.
	Make the git case actually use the DIR argument, and return nil
	rather than the empty string.
	Avoid error if .git exists but the git executable is not found.

2014-01-22  Martin Rudalics  <rudalics@gmx.at>

	Fixes in window size functions around Bug#16430 and Bug#16470.
	* window.el (window-total-size, window-size): New argument ROUND.
	(window--min-delta-1, window-min-delta, window--max-delta-1):
	Be more conservative when calculating the numbers of lines or
	columns a window can shrink (Bug#16430).
	(fit-window-to-buffer): Simplify code.
	* term.el (term-window-width): Call window-body-width again.

2014-01-22  Glenn Morris  <rgm@gnu.org>

	* image.el (image-format-suffixes): Doc fix.

	* international/quail.el (quail-define-package): Doc fix.

	* emacs-lisp/authors.el (authors-valid-file-names)
	(authors-renamed-files-alist): Additions.

	* vc/vc-git.el (vc-git-print-log): Remove --follow;
	reverts 2014-01-09 change.  (Bug#16422)

	* calc/calc-embed.el (thing-at-point-looking-at):
	* emacs-lisp/map-ynp.el (x-popup-dialog):
	* obsolete/lmenu.el (x-popup-dialog):
	* emacs-lisp/package.el (url-recreate-url):
	* mail/mailclient.el (clipboard-kill-ring-save):
	* subr.el (x-popup-dialog): Update declaration.
	* mail/rmail.el (rmail-mime-message-p):
	* window.el (tool-bar-lines-needed): Remove unnecessary declaration.

2014-01-21  Daniel Colascione  <dancol@dancol.org>

	* progmodes/sh-script.el (sh--inside-noncommand-expression):
	Correctly detect when we're inside an arithmetic expansion form
	containing nested parenthesis.
	(sh--maybe-here-document): Use `sh--inside-noncommand-expression'
	to detect cases where we shouldn't expand "<<" to a heredoc
	skeleton.

2014-01-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eldoc.el: Properly remove message in minibuffer case.
	(eldoc--message-command-p): New function.
	(eldoc-display-message-p): Use it.
	(eldoc-pre-command-refresh-echo-area): In the minibuffer case, the
	message is not automatically erased for us.
	(eldoc-print-current-symbol-info): Erase previous message, if any.

2014-01-21  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex.el (reftex-create-bibtex-file): Fix autoload to
	specify it's an interactive function.

	* textmodes/reftex-cite.el (reftex-all-used-citation-keys):
	Fix regex used for scanning for citation keys which failed for
	citations with optional arguments.

2014-01-21  Leo Liu  <sdl.web@gmail.com>

	* simple.el (read--expression): Don't enable eldoc-mode.

2014-01-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (move-beginning-of-line): Make sure we don't move forward
	(bug#16497).

2014-01-20  Juri Linkov  <juri@jurta.org>

	* saveplace.el (toggle-save-place, save-place-to-alist)
	(save-places-to-alist, save-place-dired-hook): Add (derived-mode-p
	'dired-mode) before checking for dired-directory.  (Bug#16477)

2014-01-20  Juri Linkov  <juri@jurta.org>

	* indent.el (indent-line-to): Use backward-to-indentation
	instead of back-to-indentation.  (Bug#16461)

2014-01-20  Paul Eggert  <eggert@cs.ucla.edu>

	Revert some of the CANNOT_DUMP fix (Bug#16494).
	Because of this, "make bootstrap" won't work if CANNOT_DUMP=yes,
	but fixing this can wait until after the next release.
	* Makefile.in (emacs): Keep EMACSLOADPATH empty.

2014-01-19  Michael Albinus  <michael.albinus@gmx.de>

	* eshell/esh-mode.el (eshell-password-prompt-regexp):
	Use `password-word-equivalents'.
	(eshell-watch-for-password-prompt): Let-bind `case-fold-search'
	to t.  (Bug#5664, Bug#13124)

2014-01-19  Alan Mackenzie  <acm@muc.de>

	Bind open-paren-in-column-0-is-defun-start to nil at some entry
	points.
	* progmodes/cc-engine.el (c-invalidate-state-cache-1)
	(c-parse-state-1, c-guess-basic-syntax): Bind it here.
	* progmodes/cc-mode.el (c-before-change, c-after-change)
	(c-font-lock-fontify-region): Bind it here.

2014-01-19  Martin Rudalics  <rudalics@gmx.at>

	* term.el (term-window-width): Call window-text-width instead of
	window-width (Bug#16470).

2014-01-18  Paul Eggert  <eggert@cs.ucla.edu>

	* simple.el (password-word-equivalents): Remove duplicates.
	Sort, to make this easier next time.
	Downcase.  Omit ": " after "jelszó".

2014-01-18  Jan Djärv  <jan.h.d@swipnet.se>

	* term/common-win.el (saved-region-selection): Defvar it.
	(x-select-text): Set saved-region-selection (Bug#16382).

2014-01-18  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/authors.el (authors-aliases)
	(authors-renamed-files-alist): Add some entries.

2014-01-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-password-prompt-regexp):
	Use `password-word-equivalents' if available.
	(tramp-action-password, tramp-process-one-action)
	(tramp-read-passwd): Let-bind `case-fold-search' to t.  (Bug#13124)

2014-01-17  Chong Yidong  <cyd@gnu.org>

	* simple.el (password-word-equivalents): New defcustom.
	* comint.el (comint-password-prompt-regexp): Use it.  Bump version
	to 24.4.
	(comint-watch-for-password-prompt): Let-bind `case-fold-search'
	to t.  (Bug#13124)

2014-01-17  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-alignable-keywords): New constant.
	(ruby-align-to-stmt-keywords): Change the default value.
	Use `ruby-alignable-keywords' to generate the possible customization
	choices.
	(ruby-smie-rules): Instead of using a hardcoded list of alignable
	keywords, check against the value of `ruby-alignable-keywords'
	(https://lists.gnu.org/archive/html/emacs-devel/2014-01/msg01439.html).

2014-01-17  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/authors.el (authors-aliases): Remove unnecessary entries.

	Make M-x authors return zero *Authors Errors* from current logs.
	* emacs-lisp/authors.el (authors-obsolete-files-regexps)
	(authors-ignored-files): Add some entries, remove others.
	(authors-ambiguous-files, authors-valid-file-names):
	Add some entries.
	(authors-renamed-files-alist): Add, remove, and adjust entries.
	(authors-renamed-files-regexps): Add some entries.
	Remove some very broad ones.  Make some entries `lax'.
	(authors-lax-changelogs): New constant.
	(authors-disambiguate-file-name): Treat top-level specially.
	(authors-lax-changelog-p): New function.
	(authors-canonical-file-name): Check file as written against
	authors-valid-file-names.  Do not special-case etc/.
	Handle `lax' logs and authors-renamed-files-regexps elements.

2014-01-16  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-desc--keywords): Use `cdr' with
	`assoc'.  Use `nth' instead of `cdr'.  Make private.  Update all
	callers.

2014-01-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* follow.el (follow-adjust-window): Remove `dest' argument (bug#16426).
	Assume we're already in the proper buffer.
	Inspired by Anders Lindgren <andlind@gmail.com>.
	(follow-post-command-hook): Call it from the right buffer.
	(follow-comint-scroll-to-bottom): Adjust call.
	(follow-all-followers): Use get-buffer-window-list.

2014-01-15  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/bytecomp.el (byte-compile-file): Use whole
	`buffer-file-name' in interactive-form so that we don't leave
	pathless file names in `file-name-history'.

2014-01-15  Juri Linkov  <juri@jurta.org>

	* indent.el (indent-rigidly): Set deactivate-mark to nil
	in transient indentation mode.  (Bug#16438)

2014-01-15  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-desc-keywords): New function
	(Bug#16222).
	(describe-package-1, package-all-keywords)
	(package--has-keyword-p): Use it.

2014-01-14  Nicolas Richard  <theonewiththeevillook@yahoo.fr>

	* simple.el (define-alternatives): When creating the
	COMMAND-alternatives variable, assign COMMAND as its definition
	name so that `describe-variable' can relocate it.

2014-01-14  Matthew Leach  <matthew@mattleach.net>

	* font-lock.el (font-lock-keywords): Fix typo in docstring
	(bug#16307).

2014-01-14  Agustín Martín Domingo  <agustin.martin@hispalinux.es>

	* textmodes/ispell.el (ispell-region): Reset `in-comment' for new
	line instead of wrongly reset `add-coment' (bug#13577).

2014-01-14  Daiki Ueno  <ueno@gnu.org>

	* epa-file.el (epa-file-write-region): Encode the region according
	to `buffer-file-format'.  Problem reported at:
	<http://sourceforge.jp/ticket/browse.php?group_id=2267&tid=32917>.

2014-01-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug--display): Move protective let-binding
	so it applies in the right buffer (bug#16410).

2014-01-13  Daniel Colascione  <dancol@dancol.org>

	* textmodes/rst.el (rst-define-key): Provide deprecated
	keybindings through named functions instead of anonymous ones so
	that "??" doesn't appear in describe-mode output.

2014-01-13  Bastien Guerry  <bzg@gnu.org>

	* simple.el (define-alternatives): Call the selected command
	interactively.  When setting `COMMAND--implementation' for the
	first time, tell the user how to chose another implementation.
	Enhance the docstring.

2014-01-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/log-edit.el: Fix highlighting of summary when it's the first line.
	(log-edit--match-first-line): New function.
	(log-edit-font-lock-keywords): Use it.
	(log-edit-mode): Make jit-lock-defer-multiline work.

2014-01-13  Bastien Guerry  <bzg@gnu.org>

	* rect.el (rectangle-mark-mode): When the region is not active,
	display a message saying that the mark as been set and that
	rectangle mode is in use.
	(rectangle--highlight-for-redisplay): Only put an overlay with a
	visible vertical bar when (display-graphic-p) is non-nil.
	This partially fixes Bug#16403.

2014-01-13  Juri Linkov  <juri@jurta.org>

	* info.el (Info-find-file): Go to DIR before displaying the error
	about a nonexistent file if no previous Info file is visited.
	Use `user-error' instead of `error' for "Info file %s does not exist".
	(Info-find-node-2): In case of a nonexistent node in unwind forms
	go to the Top node if there is no previous node to revert to.
	(Bug#16405)

2014-01-13  Martin Rudalics  <rudalics@gmx.at>

	fit-frame/window-to-buffer code fixes including one for Bug#14096.
	* window.el (fit-frame-to-buffer): Fix doc-string.
	Respect window-min-height/-width.  Fit pixelwise when
	frame-resize-pixelwise is non-nil.  Adjust right/bottom edge
	when avoiding that frame goes partially off-screen.
	(fit-window-to-buffer): Respect window-min-height/-width
	(Bug#14096).

2014-01-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* indent.el (indent-according-to-mode): Flush to column 0 in text-mode
	after an empty line.

2014-01-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* net/shr.el (shr-render-region): Autoload.

2014-01-12  Xue Fuqiao  <xfq.free@gmail.com>

	* net/eww.el (eww-download-directory): Rename from
	`eww-download-path' (Bug#16419).

2014-01-12  Leo Liu  <sdl.web@gmail.com>

	* dired-x.el (dired-mode-map): Fix last change.

	* emacs-lisp/eldoc.el (eldoc-mode): Add hook locally.

2014-01-12  Paul Eggert  <eggert@cs.ucla.edu>

	Spelling fixes.
	* emacs-lisp/generic.el (generic--normalize-comments):
	Rename from generic--normalise-comments.  All uses changed.
	* play/bubbles.el (bubbles--neighborhood-score)
	(bubbles--mark-direct-neighbors, bubbles--mark-neighborhood)
	(bubbles--neighborhood-available)
	(bubbles--update-neighborhood-score):
	Rename from names with 'neighbourhood'.  All uses changed.

2014-01-12  Leo Liu  <sdl.web@gmail.com>

	Re-implement the feature of showing eldoc info after editing.
	* emacs-lisp/eldoc.el (eldoc-post-insert-mode): Remove.
	(eldoc-edit-message-commands): New function.
	(eldoc-print-after-edit): New variable.
	(eldoc-pre-command-refresh-echo-area): Emit message only by
	eldoc-message-commands.
	(eldoc-mode): Restrict eldoc-message-commands to editing commands
	if eldoc-print-after-edit is set.  (Bug#16346)
	* simple.el (read--expression): Enable eldoc-mode.
	* progmodes/octave.el (octave-mode-menu): Adapt to change in eldoc.

2014-01-11  Dani Moncayo  <dmoncayo@gmail.com>
	    Eric S. Raymond  <esr@thyrsus.com>

	* version.el (emacs-repository-get-version): Enhance so the
	function works correctly in either a Bazaar or Git repo.

2014-01-11  Eric S. Raymond  <esr@thyrsus.com>

	* play/meese.el: It's 2014 and Ed Meese is justly forgotten.
	Goes with removal of the joke manpages from /etc.

2014-01-10  Kenichi Handa  <handa@gnu.org>

	* mail/rmail.el (rmail-get-coding-system):
	Check rmail-get-coding-function before "funcall"ing it.

2014-01-10  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/authors.el (authors-fixed-entries):
	Update for files that no longer exist.

2014-01-10  Eric S. Raymond  <esr@thyrsus.com>

	* version.el (emacs-bzr-get-version): Restore compatibility with
	24.3 (Tested).

2014-01-10  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (auto-mode-alist): Add .podspec
	and Podfile.

2014-01-10  Eli Zaretskii  <eliz@gnu.org>

	* emacs-lisp/authors.el (authors-fixed-entries): Update my entry.

2014-01-10  Chong Yidong  <cyd@gnu.org>

	* progmodes/octave.el (octave-mode-menu): Don't assume eldoc is loaded.

2014-01-10  Anders Lindgren  <andlind@gmail.com>

	* follow.el (follow-cache-command-list): Include right-char and
	left-char.

2014-01-10  Paul Eggert  <eggert@cs.ucla.edu>

	Spelling fixes.
	* mail/unrmail.el (unrmail-mbox-format): Choice is mboxo, not mboxro.
	* woman.el (woman-mark-horizontal-position):
	Rename from woman-mark-horizonal-position.  Use changed.

2014-01-10  Glenn Morris  <rgm@gnu.org>

	* info.el (info-initialize): If running uninstalled, ensure our
	own info files are always found first, even if INFOPATH is set.

	* help.el (view-order-manuals): Open emacs.info rather than ORDERS.

2014-01-09  David Engster  <deng@randomsample.de>

	* emacs-lisp/eieio-custom.el:
	* emacs-lisp/eieio-opt.el: Set generated autoload file to
	'eieio.el'.  This was accidentally removed in 2012-10-01T18:10:29Z!cyd@gnu.org.
	* emacs-lisp/eieio.el: Regenerate autoloads.

2014-01-09  Eric S. Raymond  <esr@thyrsus.com>

	* vc/vc-git.el (vc-git-print-log): Add --follow option to command,
	following renames.  (Bug#8756)

2014-01-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (deactivate-mark, activate-mark): Force-mode-line-update
	(bug#16382).
	(activate-mark): Add `no-tmm' argument.
	(set-mark, push-mark-command): Use it instead of running
	activate-mark-hook by hand.

2014-01-08  Eric S. Raymond  <esr@thyrsus.com>

	In preparation for the move to git, sanitize out some
	Bazaar-specific names.

	* emacs-lisp/authors.el: INSTALL.BZR renamed to INSTALL.REPO.

	* version.el (emacs-bzr-version): Name changed to
	emacs-repository-version.  Obsolete-variable alias made.
	* loadup.el: Follow through on this name change.
	* mail/emacsbug.el (report-emacs-bug): Factor out any
	assumption about the version control system in use.

2014-01-08  David Engster  <deng@randomsample.de>

	* help-fns.el (help-fns-describe-function-functions):
	New variable to call functions for augmenting help buffers.
	(describe-function-1): Remove explicit calls to
	`help-fns--compiler-macro', `help-fns--parent-mode' and
	`help-fns--obsolete'.  Put them in above new variable instead, and
	call them through `run-hook-with-args'.
	* emacs-lisp/eieio-opt.el (eieio-help-class): Rename from
	`eieio-describe-class'.  Not meant for interactive use anymore,
	but to augment existing help buffers.  Remove optional second
	argument.  Create proper button for file location.
	Rewrite function to use `insert' instead of `princ' and `prin1' where
	possible.
	(eieio-help-class-slots): Rename from `eieio-describe-class-slots'.
	(eieio-method-def, eieio-class-def): Move further up.
	(describe-method, describe-generic, eieio-describe-method):
	Remove aliases.
	(eieio-help-constructor, eieio-help-generic): Rename from
	`eieio-describe-constructor' and `eieio-describe-generic', resp.
	Rewrite to use `insert' in the current buffer and use proper help
	buttons.
	(eieio-help-find-method-definition)
	(eieio-help-find-class-definition): Also accept symbols as
	arguments.
	(eieio-help-mode-augmentation-maybee): Remove.
	(eieio-describe-class-sb): Use `describe-function'.
	* emacs-lisp/eieio.el (help-fns-describe-function-functions):
	Add `eieio-help-generic' and `eieio-help-constructor'.

2014-01-08  Paul Eggert  <eggert@cs.ucla.edu>

	Spelling fixes.
	* language/china-util.el (hz-ascii-designation):
	Rename from hz-ascii-designnation.
	(hz-ascii-designation): Rename from hz-ascii-designnation.
	All uses changed.

2014-01-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-delete): Only remove pkg-desc from
	package-alist.

2014-01-08  Bastien Guerry  <bzg@gnu.org>

	* emacs-lisp/package.el (package-delete):
	Correctly delete the package from package-alist.

2014-01-08  Daiki Ueno  <ueno@gnu.org>

	* emacs-lisp/package.el (url-recreate-url): Declare.
	(url-http-target-url): Declare.
	(package-handle-response): Include requested URL in the error message.
	(package--check-signature): Don't re-signal errors from
	package--with-work-buffer.  Suggested by Stefan Monnier.

2014-01-07  Bastien Guerry  <bzg@gnu.org>

	* minibuffer.el (completion--try-word-completion): When both a
	hyphen and a space are possible candidates for the character
	following a word, display both candidates.  (Bug#15980)

2014-01-07  Martin Rudalics  <rudalics@gmx.at>

	* window.el (balance-windows-2): While rounding don't give a
	window more than the remainder.  Bug#16351, bug#16383.

2014-01-07  Glenn Morris  <rgm@gnu.org>

	* menu-bar.el (menu-bar-help-extra-packages): Remove.
	(menu-bar-help-menu): Use view-external-packages instead.

2014-01-07  Bastien Guerry  <bzg@gnu.org>

	* emacs-lisp/package.el (package-delete): Also delete the package
	name from `package-alist', not its description only.

2014-01-07  Glenn Morris  <rgm@gnu.org>

	* help.el (view-external-packages):
	* menu-bar.el (menu-bar-help-extra-packages):
	Visit efaq.info rather than etc/MORE.STUFF.

2014-01-07  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-mode-map): Bind [return] and [backspace] to
	isearch-exit and isearch-delete-char resp.  (Bug#16342, bug#16035)

	* progmodes/ps-mode.el (ps-mode-map): Remove [return] key binding
	that shadows RET.  (Bug#16342)

2014-01-07  Chong Yidong  <cyd@gnu.org>

	* isearch.el (isearch-yank-char, isearch-yank-word)
	(isearch-yank-line): Doc fix.

2014-01-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* abbrev.el (define-abbrev): Beware new meaning of fboundp.
	* emacs-lisp/elint.el (elint-find-builtins):
	* emacs-lisp/eldoc.el (eldoc-symbol-function):
	* emacs-lisp/bytecomp.el (byte-compile-callargs-warn)
	(byte-compile-file-form-defmumble, byte-compile, byte-compile-form):
	* emacs-lisp/byte-opt.el (byte-compile-inline-expand):
	* apropos.el (apropos-safe-documentation):
	* subr.el (symbol-file): Remove redundant fboundp.
	* progmodes/idlw-shell.el (idlwave-shell-comint-filter): Use defalias.

2014-01-06  Bastien Guerry  <bzg@gnu.org>

	* hl-line.el (global-hl-line-overlay): Make a local variable.
	(global-hl-line-overlays): New variable to store all overlays.
	(global-hl-line-mode): Don't delete overlays from the current
	buffer when `global-hl-line-sticky-flag' is non-nil.
	(global-hl-line-highlight): Add new overlays to
	`global-hl-line-overlays'.
	(global-hl-line-unhighlight-all): New function to delete all
	overlays when turning off `global-hl-line-mode'.
	This fixes Bug#16183.

2014-01-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (set-transient-map): Fix nested case and docstring.

2014-01-06  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (reftex-label-alist-builtin): Add a
	`Texinfo' entry.

2014-01-06  Daniel Colascione  <dancol@dancol.org>

	Fix defun navigation in vc log view.

	* vc/log-view.el (log-view-beginning-of-defun): Rewrite to behave
	like `beginning-of-defun'.
	(log-view-end-of-defun, log-view-end-of-defun-1): Rename old
	log-view-end-of-defun to log-view-end-of-defun-1.  Replace
	log-view-end-of-defun with wrapper that behaves like `end-of-defun'.
	(log-view-extract-comment): Call `log-view-current-entry' directly
	instead of relying on broken `log-view-beginning-of-defun' behavior.

2014-01-06  Paul Eggert  <eggert@cs.ucla.edu>

	Spelling fixes.
	* calc/calc-yank.el (calc-edit-mode, calc-edit-cancel):
	* emacs-lisp/debug.el (cancel-debug-on-entry):
	* epg.el (epg-error-to-string):
	* files.el (recover-file):
	* lpr.el (lpr-buffer, print-buffer, lpr-region, print-region):
	* mail/emacsbug.el (report-emacs-bug-hook):
	* mail/sendmail.el (mail-recover):
	* ses.el (ses-yank-resize):
	* term/ns-win.el (ns-print-buffer):
	Spelling fixes in diagnostics, mostly for "canceled" with one L.
	* epg.el (epg-key-capability-alist): Rename from misspelled version.
	All uses changed.
	* obsolete/xesam.el (xesam-all-fields): Fix misspelled field name.

2014-01-06  Leo Liu  <sdl.web@gmail.com>

	* dired-x.el (dired-mode-map): Rebind dired-omit-mode to C-x M-o
	to avoid shadowing global key.  (Bug#16354)

2014-01-06  Daniel Colascione  <dancol@dancol.org>

	* textmodes/rst.el (rst-mode): Set electric-indent-inhibit for
	rst-mode.

2014-01-05  Martin Rudalics  <rudalics@gmx.at>

	* window.el (balance-windows): Add mising t to fix Bug#16351.

2014-01-05  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-descend): Don't bug out if the anchor is empty
	(bug#16285).
	(shr-insert): If we have a word that's longer than `shr-width',
	break after it anyway.  Otherwise we'll do no breaking once we get
	such a long word.

2014-01-05  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww): Support single/double quote for search.
	* net/eww.el (eww-list-histories, eww-history-browse): Fixup.
	(eww-history-quit): Delete and use quit-window.
	(eww-history-kill): Delete, because it doesn't work well and
	not necessary.
	(eww-history-mode-map): Delete some keys and add easy-menu.

2014-01-05  Paul Eggert  <eggert@cs.ucla.edu>

	Fix misspelling of 'chinese' in rx (Bug#16237).
	* emacs-lisp/rx.el (rx-categories): Correct spelling of
	chinese-two-byte.

	Change subword regexps back to vars (Bug#16296).
	* progmodes/subword.el (subword-forward-regexp)
	(subword-backward-regexp): Change these back to variables.

2014-01-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp-mode.el (lisp-mode-variables): Don't bother with
	syntax-begin-function (bug#16247).

2014-01-03  Chong Yidong  <cyd@gnu.org>

	* emacs-lisp/nadvice.el (advice--make-docstring): Change args.
	(advice--docstring): Delete variable.
	(advice--make-1): Leave the docstring empty.
	(advice-add): Use function-documentation for advised docstring.

	* emacs-lisp/advice.el (ad--make-advised-docstring): Change args.
	Ignore function-documentation property when getting documentation.
	(ad-activate-advised-definition): Use function-documentation
	generate the docstring.
	(ad-make-advised-definition): Don't call
	ad-make-advised-definition-docstring.
	(ad-make-advised-definition-docstring, ad-advised-definition-p):
	Delete functions.

	* progmodes/sql.el (sql-help): Use function-documentation instead
	of dynamic-docstring-function property.  No need to autoload now.
	(sql--help-docstring): New variable.
	(sql--make-help-docstring): Use it.

2014-01-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ielm.el (ielm-tab): Retarget.
	(ielm-map): Use ielm-tab for tab.
	(ielm-complete-filename): Use comint-filename-completion.
	(ielm-complete-symbol): Remove.
	(inferior-emacs-lisp-mode): Use lisp-completion-at-point instead and
	remove ielm-tab from completion-at-point-functions (bug#16224).

	* emacs-lisp/pcase.el (pcase--split-equal, pcase--split-member):
	Beware signals raised by predicates (bug#16201).

2014-01-02  Richard Stallman  <rms@gnu.org>

	* dired-aux.el (dired-do-print): Handle printer-name.

	* mail/rmailmm.el (rmail-mime-message-p): Move to rmail.el.
	* mail/rmail.el (rmail-mime-message-p): Move from rmailmm.el.
	(rmail-epa-decrypt): Turn off mime processing.

	* mail/rmail.el (rmail-make-in-reply-to-field):
	Add parens in message-id.

	* mail/rmail.el (rmail-get-coding-function): Variable.
	(rmail-get-coding-system): Use it.

2013-12-31  Eli Zaretskii  <eliz@gnu.org>

	* international/mule-conf.el: Unify the charset indian-is13194.
	(indian-is13194): Specify unify-map.

2013-12-31  Leo Liu  <sdl.web@gmail.com>

	* subr.el (set-temporary-overlay-map): Obsolete alias.  (Bug#16305)

2013-12-30  Daniel Colascione  <dancol@dancol.org>

	* term/x-win.el ([XF86WakeUp]): Ignore the XF86WakeUp key instead
	of printing a useless when we resume from sleep.

	* progmodes/sh-script.el
	(sh-smie-sh-forward-token, sh-smie-rc-forward-token): Fix infloop
	in indentation code.  (Bug#16233)

2013-12-28  João Távora  <joaotavora@gmail.com>

	* elec-pair.el (electric-pair-post-self-insert-function):
	Don't open extra newlines at beginning of buffer.  (Bug#16272)

2013-12-28  Eli Zaretskii  <eliz@gnu.org>

	* frame.el (window-system-for-display): Don't allow to create a
	GUI frame from a -nw session on MS-Windows.  (Bug#14739)

2013-12-28  Glenn Morris  <rgm@gnu.org>

	* mail/hashcash.el (hashcash-program): Rename from hashcash-path.
	Update callers.

	* apropos.el (apropos-match-face):
	* calculator.el (calculator-displayer):
	* dabbrev.el (dabbrev-search-these-buffers-only):
	* face-remap.el (buffer-face-mode-face):
	* simple.el (yank-handled-properties):
	* emacs-lisp/testcover.el (testcover-potentially-1value-functions):
	* mail/footnote.el (footnote-mode-line-string, footnote-prefix):
	* mail/hashcash.el (hashcash-accept-resources, hashcash-program)
	(hashcash-double-spend-database):
	* progmodes/ruby-mode.el (ruby-deep-indent-paren)
	(ruby-deep-indent-paren-style):
	* textmodes/flyspell.el (flyspell-auto-correct-binding):
	* textmodes/rst.el (rst-toc-indent, rst-toc-insert-style)
	(rst-toc-insert-number-separator, rst-toc-insert-max-level):
	* vc/pcvs-defs.el (cvs-minor-mode-prefix):
	Specify custom types.

	* emacs-lisp/smie.el (smie-config): Add type, version, initialize.
	* bookmark.el (bookmark-bmenu-use-header-line):
	* doc-view.el (doc-view-scale-internally):
	* pcmpl-x.el (pcmpl-x-tlmgr-program, pcmpl-x-ack-program):
	* register.el (register-preview-delay):
	* net/shr.el (shr-bullet):
	* progmodes/cfengine.el (cfengine-cf-promises)
	(cfengine-parameters-indent):
	* progmodes/octave.el (inferior-octave-error-regexp-alist):
	* textmodes/reftex-vars.el (reftex-label-regexps):
	* vc/log-edit.el (log-edit-setup-add-author): Add version.

	* net/tls.el (tls-certtool-program): Fix default value.

	* desktop.el (desktop-restore-in-current-display):
	* newcomment.el (comment-empty-lines):
	* progmodes/idlwave.el (idlwave-scan-all-buffers-for-routine-info)
	(idlwave-pad-keyword):
	* progmodes/tcl.el (tcl-tab-always-indent):
	* textmodes/reftex-vars.el (reftex-index-default-tag):
	* elec-pair.el (electric-pair-skip-whitespace):
	* progmodes/cfengine.el (cfengine-cf-promises): Fix custom types.

	* emacs-lisp/authors.el (authors-ignored-files)
	(authors-valid-file-names, authors-renamed-files-alist): Additions.

2013-12-27  Jarek Czekalski  <jarekczek@poczta.onet.pl>

	* shell.el (shell-dynamic-complete-command): Doc fix.
	(shell--command-completion-data): Shell completion now matches
	executable filenames from the current buffer's directory, on
	systems in which this behavior is the default (windows-nt, ms-dos).

2013-12-27  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-insert): Don't infloop if the width is zero.

2013-12-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* icomplete.el (icomplete-show-matches-on-no-input): Default to nil
	(bug#16251).

	* electric.el: Move all electric-pair-* to elec-pair.el.
	* elec-pair.el: New file, split from electric.el.

2013-12-27  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-find-fill-point): Don't try to fill if the
	indentation level is larger than the width, because that will
	infloop.
	(shr-insert): Fill repeatedly long texts, so that Japanese is
	formatted correctly (bug#16263).
	(shr-find-fill-point): Off by one error in comparison with the
	indentation.

2013-12-26  João Távora  <joaotavora@gmail.com>

	* electric.el (electric-pair-mode): More flexible engine for skip-
	and inhibit predicates, new options for pairing-related functionality.
	(electric-pair-preserve-balance): Pair/skip parentheses and quotes
	if that keeps or improves their balance in buffers.
	(electric-pair-delete-adjacent-pairs): Delete the pair when
	backspacing over adjacent matched delimiters.
	(electric-pair-open-extra-newline): Open extra newline when
	inserting newlines between adjacent matched delimiters.
	(electric--sort-post-self-insertion-hook):
	Sort post-self-insert-hook according to priority values when
	minor-modes are activated.
	* simple.el (newline-and-indent): Call newline with interactive
	set to t.
	(blink-paren-post-self-insert-function): Set priority to 100.
	* emacs-lisp/lisp-mode.el (lisp-mode-variables):
	Use electric-pair-text-pairs to pair backtick-and-quote in strings and
	comments.  Locally set electric-pair-skip-whitespace to 'chomp and
	electric-pair-open-newline-between-pairs to nil.

2013-12-26  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el: Use lexical-binding.
	(python-nav-beginning-of-defun): Stop searching ASAP.

2013-12-25  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc.el (vc-ignore): Use `vc-responsible-backend'.
	Fix interactive spec.  Doc fix.  (Bug#15754)

2013-12-25  Katsumi Yamaoka  <yamaoka@jpl.org>

	* emacs-lisp/byte-run.el (eval-when-compile):
	* progmodes/cc-defs.el (cc-eval-when-compile):
	Fix edebug spec (bug#16184).

2013-12-25  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-visit-file): Remove debugging function.
	(shr-insert): Don't infloop if we can't find a good place to break
	the line (bug#16256).

2013-12-25  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-nav--lisp-forward-sexp): New function.
	(python-nav--lisp-forward-sexp-safe): Use it.  Rename from
	python-nav-lisp-forward-sexp-safe.
	(python-nav--forward-sexp): New argument SAFE allows switching
	forward sexp movement behavior for parens.
	(python-nav-forward-sexp): Throw errors on unterminated parens
	(Bug#16191).
	(python-nav-backward-sexp, python-nav-forward-sexp-safe)
	(python-nav-backward-sexp-safe): New functions.
	(python-shell-buffer-substring):
	Use `python-nav-forward-sexp-safe'.

2013-12-25  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-find-fill-point): Don't break lines before a
	quotation mark.
	(shr-char-kinsoku-bol-p): The quotation mark isn't a kinsoky BOL char.
	(shr-find-fill-point): Remove the special checks for the quotation
	mark, since `shr-char-kinsoku-bol-p' should now return the right thing.

2013-12-25  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-form-textarea): Use a different face for
	textareas than text input since they have different keymaps
	(bug#16142).

2013-12-24  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-nav-beginning-of-statement):
	Speed up (Bug#15295).

2013-12-24  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-bookmark-browse): Use `quit-window' to restore
	the window configuration.

2013-12-24  Eli Zaretskii  <eliz@gnu.org>

	* net/eww.el (eww-open-file): Ensure 3 slashes after "file:" when
	we run on MS-Windows or MS-DOS.

2013-12-24  Martin Rudalics  <rudalics@gmx.at>

	* window.el (balance-windows-area): Call window-size instead of
	window-height and window-width.  Bug#16241.

2013-12-24  Lars Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-bookmark-quit): Remove.
	(eww-bookmark-browse): Restore the window configuration when you
	choose a bookmark (bug#16144).

2013-12-24  Daniel Colascione  <dancol@dancol.org>

	* icomplete.el: Remove redundant :group arguments to `defcustom'
	throughout.
	(icomplete-show-matches-on-no-input): New customizable variable.
	(icomplete-minibuffer-setup): Call `icomplete-exhibit' on setup if
	we have something to show.
	(icomplete-exhibit): Compute completions even if we have no user input.

2013-12-23  Daniel Colascione  <dancol@dancol.org>

	* icomplete.el: Move `provide' to end of file.

2013-12-23  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/gnutls.el (gnutls-verify-error): Add version tag.

2013-12-23  Chong Yidong  <cyd@gnu.org>

	* subr.el (set-transient-map): Rename from
	set-temporary-overlay-map.  Doc fix.

	* face-remap.el (text-scale-adjust):
	* indent.el (indent-rigidly):
	* kmacro.el (kmacro-call-macro):
	* minibuffer.el (minibuffer-force-complete):
	* repeat.el (repeat):
	* simple.el (universal-argument--mode):
	* calendar/todo-mode.el (todo-insert-item--next-param):
	* progmodes/f90.el (f90-abbrev-start): Callers changed.

	* indent.el (indent-rigidly): Use substitute-command-keys.

2013-12-22  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-tag-select): Add text-property to jump to next
	select field.
	(eww): Add non-supported ftp error.

2013-12-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby--electric-indent-p): Improve the
	comments.  Handle electric indent after typing `?' and `!'.

2013-12-22  Chong Yidong  <cyd@gnu.org>

	* faces.el (face-spec-recalc): If the theme specs are not
	applicable to a frame, fall back on the defface spec.
	This prevents themes from obliterating faces on low-color terminals.

2013-12-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--implicit-semi-p): Return t
	after `{'.  We need it after block openers, and it doesn't seem
	to hurt after hash openers.

2013-12-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby--at-indentation-p): New function,
	extracted from `ruby-smie-rules'.
	(ruby--electric-indent-chars): New variable.
	(ruby--electric-indent-p): New function.
	(ruby-mode): Use `electric-indent-functions' instead of
	`electric-indent-chars'.

2013-12-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-align-to-stmt-keywords): Tweak the
	docstring.
	(ruby-smie-rules): Indent plus one level after `=>'.

2013-12-21  Richard Stallman  <rms@gnu.org>

	* simple.el (newline): Doc fix.

2013-12-21  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-list-histories, eww-list-histories)
	(eww-history-browse, eww-history-quit, eww-history-kill)
	(eww-history-mode-map, eww-history-mode): New command and
	functions to list browser histories.
	(eww-form-text): Support text form with disabled
	and readonly attributes.
	(eww-checkbox-map): Fix wrong key bind to `eww-toggle-checkbox'.

2013-12-21  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* net/eww.el (eww-back-url, eww-forward-url, eww-next-url)
	(eww-previous-url, eww-up-url, eww-top-url, eww-add-bookmark)
	(eww-bookmark-prepare, eww-bookmark-kill, eww-bookmark-yank)
	(eww-bookmark-browse, eww-next-bookmark, eww-previous-bookmark):
	Use `user-error'.
	(eww-bookmark-mode-map): Add menu.
	(eww-render, eww-mode): Use `setq-local'.
	(eww-tool-bar-map): New variable.
	(eww-mode): Set `tool-bar-map'.
	(eww-view-source): Check for `html-mode' with `fboundp'.

2013-12-21  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr--extract-best-source): Don't bug out on audio
	elements with text inside.  Also remove debugging.

2013-12-21  Jan Djärv  <jan.h.d@swipnet.se>

	* cus-start.el (all): Add ns-use-srgb-colorspace.

2013-12-21  Chong Yidong  <cyd@gnu.org>

	* custom.el (custom-theme-recalc-face): Do nothing if the face is
	undefined.  Thus, theme settings for undefined faces do not take
	effect until the faces are defined with defface, the same as with
	theme variables.

	* faces.el (face-spec-set): Use face-spec-recalc in all cases.
	(face-spec-reset-face): Don't assign extra properties in temacs.
	(face-spec-recalc): Apply X resources too.

2013-12-21  Chong Yidong  <cyd@gnu.org>

	* faces.el (face-spec-set):
	* cus-face.el (custom-theme-set-faces, custom-set-faces):
	* custom.el (defface): Doc fixes (Bug#16203).

	* indent.el (indent-rigidly-map): Add docstring, and move commands
	into named functions.
	(indent-rigidly-left, indent-rigidly-right)
	(indent-rigidly-left-to-tab-stop)
	(indent-rigidly-right-to-tab-stop): New functions.  Decide on
	indentation direction based on bidi direction, and accumulate
	sequential commands in a single undo boundary.
	(indent-rigidly--pop-undo): New utility function.

2013-12-20  Juanma Barranquero  <lekktu@gmail.com>

	* faces.el (read-face-name): Require crm.el when using crm-separator.

2013-12-20  Daniel Colascione  <dancol@dancol.org>

	* progmodes/sh-script.el (sh-mode): Tweak paragraph-separate
	so that we don't reflow comments into the shebang line.

2013-12-20  Juri Linkov  <juri@jurta.org>

	* saveplace.el (save-place-to-alist): Add `dired-filename' as
	a position when `dired-directory' is non-nil.  Check integer
	positions with `integerp'.
	(toggle-save-place, save-places-to-alist): Add check for
	`dired-directory'.
	(save-place-find-file-hook): Check integer positions with
	`integerp'.
	(save-place-dired-hook): Use `dired-goto-file' when
	`dired-filename' is found in the assoc list.  Check integer
	positions with `integerp'.
	(dired-initial-position-hook): Rename from `dired-initial-point-hook'.

	* dired.el (dired-initial-position-hook): Rename back from
	`dired-initial-point-hook'.
	(dired-initial-position): Rename `dired-initial-point-hook' to
	`dired-initial-position-hook'.
	(dired-file-name-at-point): Doc fix.  (Bug#15329)

2013-12-20  Juri Linkov  <juri@jurta.org>

	* replace.el (read-regexp-defaults-function): New defcustom (bug#14405).
	(read-regexp-suggestions): New function.
	(read-regexp): Use `read-regexp-defaults-function' to get default values.
	Use `read-regexp-suggestions'.  Add non-empty default to history
	for empty input.
	(occur-read-regexp-defaults-function): Remove function.
	(occur-read-primary-args): Use `regexp-history-last' instead of
	`occur-read-regexp-defaults-function'.

	* hi-lock.el (hi-lock-read-regexp-defaults-function): Remove function.
	(hi-lock-line-face-buffer, hi-lock-face-buffer)
	(hi-lock-face-phrase-buffer): Use `regexp-history-last' instead of
	`hi-lock-read-regexp-defaults-function'.  Doc fix.
	(hi-lock-face-symbol-at-point): Replace `find-tag-default-as-regexp'
	with `find-tag-default-as-symbol-regexp'.  Doc fix.
	(hi-lock-read-regexp-defaults): Remove function.
	(hi-lock-regexp-okay): Add check for null.

	* progmodes/grep.el (grep-read-regexp): Use `grep-tag-default' for
	the arg DEFAULTS.  Move formatting of the prompt to `read-regexp'.

	* subr.el (find-tag-default-as-symbol-regexp): New function.
	(find-tag-default-as-regexp): Move symbol regexp formatting to
	`find-tag-default-as-symbol-regexp'.

2013-12-20  E Sabof  <esabof@gmail.com>  (tiny change)

	* hi-lock.el (hi-lock-set-pattern): Check for `font-lock-specified-p'.
	(Bug#14179)

2013-12-20  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: New implementation of item insertion
	commands and key bindings.
	(todo-key-prompt): New face.
	(todo-insert-item): New command.
	(todo-insert-item--parameters): New defconst, replacing defvar
	todo-insertion-commands-args-genlist.
	(todo-insert-item--param-key-alist): New defconst, replacing
	defvar todo-insertion-commands-arg-key-list.
	(todo-insert-item--keyof, todo-insert-item--this-key): New defsubsts.
	(todo-insert-item--argsleft, todo-insert-item--apply-args)
	(todo-insert-item--next-param): New functions.
	(todo-insert-item--args, todo-insert-item--argleft)
	(todo-insert-item--argsleft, todo-insert-item--newargsleft):
	New variables.
	(todo-key-bindings-t): Change binding of "i" from
	todo-insertion-map to todo-insert-item.
	(todo-powerset, todo-gen-arglists, todo-insertion-commands-args)
	(todo-insertion-command-name, todo-insertion-commands-names)
	(todo-define-insertion-command, todo-insertion-commands)
	(todo-insertion-key-bindings, todo-insertion-map): Remove.

2013-12-20  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Bug fixes and new features (bug#15225).
	(todo-toggle-item-highlighting): Use eval-and-compile instead of
	eval-when-compile.
	(todo-move-category): Allow choosing a non-existing todo file to
	move the category to, and create that file.
	(todo-default-priority): New user option.
	(todo-set-item-priority): Use it.
	(todo-desktop-save-buffer, todo-restore-desktop-buffer): New functions.
	(desktop-restore-file-buffer): Declare.
	(desktop-buffer-mode-handlers): Add todo-restore-desktop-buffer.
	(todo-modes-set-2): Locally set desktop-save-buffer to
	todo-desktop-save-buffer.
	(todo-mode, todo-archive-mode, todo-filtered-items-mode)
	(auto-mode-alist): Add autoload cookie.

2013-12-20  Bozhidar Batsov  <bozhidar@batsov.com>

	* emacs-lisp/subr-x.el: Renamed from helpers.el.
	helpers.el was a poor choice of name.
	(string-remove-prefix): New function.
	(string-remove-suffix): New function.

2013-12-20  Martin Rudalics  <rudalics@gmx.at>

	Fix assignment for new window total sizes.
	* window.el (window--pixel-to-size): Remove function.
	(window--pixel-to-total-1, window--pixel-to-total):
	Fix calculation of new total sizes.

2013-12-20  Vitalie Spinu  <spinuvit@gmail.com>

	* comint.el (comint-output-filter): Fix rear-nonsticky property
	placement (Bug#16010).

2013-12-20  Chong Yidong  <cyd@gnu.org>

	* faces.el (read-color): Minor fix for completion function.

2013-12-20  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-align-to-stmt-keywords):
	New option.  (Bug#16182)
	(ruby-smie--indent-to-stmt-p): Use it.
	(ruby-smie-rules): Revert the logic in the handling of `when'.
	Expand the begin clause to handle `ruby-align-to-stmt-keywords'.
	(ruby-deep-arglist, ruby-deep-indent-paren)
	(ruby-deep-indent-paren-style): Update docstrings to note that the
	vars don't have any effect with SMIE.

2013-12-20  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc.el (calc-enter, calc-pop): Use the variable
	`calc-context-sensitive-enter'.

2013-12-20  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-insert): Protect against infloops in degenerate
	tables.

2013-12-20  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (octave): Add link to manual and octave
	homepage.
	(octave-mode-menu): Link to octave-mode manual.

2013-12-20  Leo Liu  <sdl.web@gmail.com>

	* skeleton.el (skeleton-pair-insert-maybe): Disable newline
	insertion using skeleton-end-newline.  (Bug#16138)

2013-12-20  Juri Linkov  <juri@jurta.org>

	* replace.el (occur-engine): Use `add-face-text-property'
	to add the face property to matches and titles.  (Bug#14645)

	* hi-lock.el (hi-green): Use lighter color "light green" closer to
	the palette of other hi-lock colors.
	(hi-lock-set-pattern): Prepend hi-lock face to the existing face.

2013-12-19  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-mode-map): Bind `M-s e' to `isearch-edit-string'.
	Put :advertised-binding on `M-s c', `M-s r', `M-s e'.  (Bug#16035)
	(minibuffer-history-symbol): Move variable declaration closer to
	its usage.

	* isearchb.el (isearchb): Add `event-basic-type' on `last-command-event'.
	(Bug#14785)

2013-12-19  Juri Linkov  <juri@jurta.org>

	* vc/log-edit.el (log-edit-insert-filenames-without-changelog):
	New function.
	(log-edit-hook): Add it to :options.  (Bug#16170)

2013-12-19  Juri Linkov  <juri@jurta.org>

	* simple.el (eval-expression-print-format): Don't check for
	command names and the last command.  Always display additional
	formats of the integer result in the echo area, and insert them
	to the current buffer only with a zero prefix arg.
	Display character when char-displayable-p is non-nil.
	(eval-expression): With a zero prefix arg, set `print-length' and
	`print-level' to nil, and insert the integer values from
	`eval-expression-print-format' at the end.  Doc fix.  (Bug#12985)

	* emacs-lisp/lisp-mode.el (eval-print-last-sexp): Add arg
	`eval-last-sexp-arg-internal'.  Doc fix.
	(eval-last-sexp-1): Pass arg `eval-last-sexp-arg-internal' to
	`eval-last-sexp-print-value'.  Doc fix.
	(eval-last-sexp-print-value): Add arg `eval-last-sexp-arg-internal'.
	Set `print-length' and `print-level' to nil when arg is zero.
	(eval-last-sexp): Doc fix.
	(eval-defun-2): Print the integer values from
	`eval-expression-print-format' at the end.

	* emacs-lisp/edebug.el (edebug-eval-defun): Print the integer
	values from `eval-expression-print-format' at the end.

	* ielm.el (ielm-eval-input): Print the integer
	values from `eval-expression-print-format' at the end.

2013-12-19  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/eww.el (eww-exit, eww-close, eww-mode-map): Revert change of
	2013-12-11T19:01:44Z!tzz@lifelogs.com.

2013-12-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* hl-line.el (hl-line-make-overlay): New fun.  Set priority (bug#16192).
	(hl-line-highlight, global-hl-line-highlight): Use it.
	(hl-line-overlay): Use defvar-local.

2013-12-19  Jan Djärv  <jan.h.d@swipnet.se>

	* term/ns-win.el: Require dnd.
	(global-map): Remove drag items.
	(ns-insert-text, ns-set-foreground-at-mouse)
	(ns-set-background-at-mouse):
	Remove (ns-drag-n-drop, ns-drag-n-drop-other-frame)
	(ns-drag-n-drop-as-text, ns-drag-n-drop-as-text-other-frame):
	New functions.

2013-12-19  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/ert.el (ert-select-tests):
	Fix string/symbol mixup.  (Bug#16121)

2013-12-19  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-rules): Indent middle-of-block
	keywords to their parent.

2013-12-19  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--args-separator-p): Allow the
	first arg to be a string (fixed dead code), or an operator symbol.
	(ruby-smie--forward-token): Tokenize ` @ ' before strings and
	operator symbols.
	(ruby-smie-rules): Remove parent token check in the `.' clause, it
	did nothing.  Don't respond to `(:after ".")', it will be called
	with :before anyway.  Remove the ` @ ' rule, it didn't seem to
	change anything.  Only return indentation for binary operators
	when they are hanging.  De-dent opening paren when its parent is
	`.', otherwise it looks bad when the dot is not at bol or eol
	(bug#16182).

2013-12-19  Juri Linkov  <juri@jurta.org>

	* replace.el (query-replace-read-args): Split a non-negative arg
	and a negative arg into separate elements.
	(query-replace, query-replace-regexp, replace-string)
	(replace-regexp): Add arg `backward'.  Doc fix.
	(replace-match-maybe-edit): When new arg `backward' is non-nil,
	move point to the beginning of the match.
	(replace-search, replace-highlight): Use new arg `backward'
	to set the value of `isearch-forward'.
	(perform-replace): Add arg `backward' and use it to perform
	replacement backward.  (Bug#14979)

	* isearch.el (isearch-query-replace): Use a negative prefix arg
	to call `perform-replace' with a non-nil arg `backward'.

2013-12-18  Juri Linkov  <juri@jurta.org>

	* vc/log-edit.el (log-edit-hook): Add `log-edit-insert-message-template'
	to the default list.  Move `log-edit-show-files' to the end.
	Add more available functions to options.
	(log-edit): Move default specific settings to
	`log-edit-insert-message-template'.  Don't move point.
	(log-edit-insert-message-template): New function.
	(log-edit-insert-changelog): Add `save-excursion' and don't move point.
	(Bug#16170)

2013-12-18  Juri Linkov  <juri@jurta.org>

	* help-mode.el (help-mode-map): Bind "l" to help-go-back,
	and "r" to help-go-forward for compatibity with Info.  (Bug#16178)

2013-12-18  Leo Liu  <sdl.web@gmail.com>

	* eshell/em-prompt.el (eshell-emit-prompt): Fix last change.
	(Bug#16186)

2013-12-18  Eli Zaretskii  <eliz@gnu.org>

	* ls-lisp.el (ls-lisp-insert-directory): Don't modify %d and %f
	formats for displaying file sizes when the -s switch is given.
	Instead, compute a separate format for displaying the size in
	blocks, which is displayed in addition to the "regular" size.
	When -h is given in addition to -s, produce size in blocks in
	human-readable form as well.  (Bug#16179)

2013-12-18  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (reftex-label-alist-builtin):
	Reference tables with ~\ref{...} instead of only \ref{...}.

2013-12-18  Chong Yidong  <cyd@gnu.org>

	* cus-edit.el (custom-magic-alist): Fix "themed" description
	(Bug#14348).

	* custom.el (custom-push-theme): If custom--inhibit-theme-enable
	is non-nil, do not create a new entry in the symbol's theme-value
	or theme-face property; update theme-settings only (Bug#14664).
	(custom-available-themes): Doc fix.

	* cus-theme.el (custom-new-theme-mode-map): Add bindings
	(Bug#15674).

	* replace.el (occur-engine): Avoid infloop (Bug#7593).

2013-12-18  Kazuhiro Ito  <kzhr@d1.dion.ne.jp>  (tiny change)

	* progmodes/make-mode.el (makefile-fill-paragraph): Fix infloop
	(Bug#13914).

2013-12-18  Shigeru Fukaya  <shigeru.fukaya@gmail.com>

	* apropos.el (apropos-words-to-regexp): Fix algorithm (Bug#13946).

2013-12-18  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (BYTE_COMPILE_FLAGS): Set load-prefer-newer to t.
	* cus-start.el (load-prefer-newer): New option.

2013-12-18  Le Wang  <l26wang@gmail.com>

	* comint.el (comint-previous-matching-input-from-input):
	Retain point (Bug#13404).

2013-12-18  Chong Yidong  <cyd@gnu.org>

	* simple.el (append-next-kill): Doc fix (Bug#15995, Bug#16016).

2013-12-18  Glenn Morris  <rgm@gnu.org>

	* mail/emacsbug.el (report-emacs-bug):
	Only mention enable-multibyte-characters if non-standard.

2013-12-17  Juri Linkov  <juri@jurta.org>

	* arc-mode.el (archive-extract-by-file): Check if directory exists
	before deletion to not show irrelevant errors if it doesn't exist.

2013-12-17  Juri Linkov  <juri@jurta.org>

	* menu-bar.el (menu-bar-tools-menu): Add `browse-web'.
	(Bug#14751)

	* net/eww.el (browse-web): Add alias to `eww'.
	(eww-mode-map): Bind "r" to `eww-forward-url' like in Info.
	Bind "S-SPC" to `scroll-down-command'.  (Bug#16178)

	* net/browse-url.el (browse-url-browser-function): Move `eww'
	closer to similar functions.

	* startup.el (fancy-startup-screen, fancy-about-screen):
	Set browse-url-browser-function to eww-browse-url locally.
	(Bug#14751)

2013-12-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* window.el (window--pixel-to-total): Remove unused `mini' var.
	(maximize-window, minimize-window): Remove unused `pixelwise' arg.
	(split-window): Remove unused `new' var.
	(window--display-buffer): Remove unused `frame' and `delta' vars.
	(fit-window-to-buffer): Remove unused vars `frame', `display-height',
	and display-width'.

2013-12-17  Martin Rudalics  <rudalics@gmx.at>

	* dired.el (dired-mark-pop-up):
	* register.el (register-preview): Don't bind
	split-height-threshold here since it's now done in
	display-buffer-below-selected.

2013-12-17  oblique  <psyberbits@gmail.com>  (tiny change)

	* term/rxvt.el (rxvt-rgb-convert-to-16bit): Standardize with
	xterm-rgb-convert-to-16bit.
	(rxvt-register-default-colors): Standardize with
	xterm-register-default-colors (Bug#14078).

2013-12-17  Dima Kogan  <dima@secretsauce.net>  (tiny change)

	* simple.el (kill-region): Pass mark first, then point, so that
	kill-append works right (Bug#12819).
	(copy-region-as-kill, kill-ring-save): Likewise.

2013-12-17  Leo Liu  <sdl.web@gmail.com>

	* net/rcirc.el (rcirc-add-face):
	* eshell/em-prompt.el (eshell-emit-prompt):
	* eshell/em-ls.el (eshell-ls-decorated-name): Use font-lock-face.
	(Bug#16167)

2013-12-17  Chong Yidong  <cyd@gnu.org>

	* files.el (break-hardlink-on-save): Doc fix (Bug#13801).
	Suggested by Xue Fuqiao.

2013-12-17  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-rules): Indent ternary if.

2013-12-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* net/shr.el (shr-insert-document): Remove unused var
	`shr-preliminary-table-render'.
	(shr-rescale-image): Remove unused arg `force'.
	(shr-put-image): Update calls accordingly.
	(shr-tag-a): Use `cont' rather than dyn-bound `dom'.

2013-12-17  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/smie.el (smie-indent--rule): Extract `smie-indent--rule-1'.
	(smie-indent-close): Call `smie-indent--rule-1' with METHOD
	:close-all, to see which indentation method to use (Bug#16116).
	(smie-rules-function): Document the method :close-all.

2013-12-16  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-tag-a): Support zero-length <a name="foo"> elements.

	* net/eww.el (eww-display-html): If we can't find the anchor we're
	looking for, then go to point-min.

2013-12-16  Paul Eggert  <eggert@cs.ucla.edu>

	Fix problems with CANNOT_DUMP and EMACSLOADPATH.
	* Makefile.in (emacs): Add lisp src to EMACSLOADPATH.
	* loadup.el: Check for src/bootstrap-emacs only when Emacs can dump.
	Expand dir too, in case it's relative.

2013-12-16  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-auto-save-timeout): Change default to
	`auto-save-timeout'.  Doc fix.
	(desktop-save): Skip the timestamp in desktop-saved-frameset
	when checking for auto-save changes.
	(desktop-auto-save): Don't call desktop-auto-save-set-timer since
	`desktop-auto-save' is called repeatedly by the idle timer.
	(desktop-auto-save-set-timer): Replace `run-with-timer' with
	`run-with-idle-timer' and a non-nil arg REPEAT.  Doc fix.
	(Bug#15331)

2013-12-16  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-mode-map): Remove [escape] key bindinds.
	(Bug#16035)
	(isearch-pre-command-hook): Check `this-command' for symbolp.

2013-12-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/gv.el (gv-ref): Mention lexbind restriction (bug#16153).

2013-12-16  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine3--current-word): Remove.
	(cfengine3--current-function): Bring in the current-function
	functionality from `cfengine3--current-word'.
	(cfengine3-completion-function): Bring in the
	bounds-of-current-word functionality from
	`cfengine3--current-word'.

2013-12-16  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-below-selected):
	Bind split-height-threshold to 0 as suggested by Juri Linkov.

2013-12-16  Leo Liu  <sdl.web@gmail.com>

	* progmodes/compile.el (compile-goto-error): Do not push-mark.
	Remove NOMSG arg and all uses changed.

2013-12-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emulation/cua-rect.el (cua-rectangle-mark-mode): New minor mode.
	(cua--deactivate-rectangle): Don't deactivate the mark.
	(cua-set-rectangle-mark): Don't set mark-active since
	cua--activate-rectangle already does it for us.
	(cua--rectangle-highlight-for-redisplay): Unhighlight a previous
	non-rectangular region.

	* emulation/cua-base.el (cua-repeat-replace-region):
	Use with-current-buffer.

	* net/gnutls.el: Use cl-lib.
	(gnutls-negotiate): `mapcan' -> cl-mapcan.

2013-12-14  Teodor Zlatanov  <tzz@lifelogs.com>

	* emacs-lisp/package.el (package-built-in-p): Support both
	built-in and the package.el converted package descriptions.
	(package-show-package-list): Allow keywords.
	(package-keyword-button-action): Use it instead of
	`finder-list-matches'.
	(package-menu-filter-interactive): Interactive filtering (by
	keyword) function.
	(package-menu--generate): Support keywords and change keymappings
	and headers when they are given.
	(package--has-keyword-p): Helper function.
	(package-menu--refresh): Use it.
	(package--mapc): Helper function.
	(package-all-keywords): Use it.
	(package-menu-mode-map): Set up menu items and keybindings to
	provide a filtering UI.

2013-12-14  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/gnutls.el (gnutls-verify-error): New defcustom to control
	the behavior when a certificate fails validation.  Defaults to
	old behavior: never abort, just warn.
	(gnutls-negotiate): Use it.

2013-12-14  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-below-selected): Never split window
	horizontally.  Suggested by Juri Linkov <juri@jurta.org>.

2013-12-14  Tom Willemse  <tom@ryuslash.org>  (tiny change)

	* emacs-lisp/package.el (package--prepare-dependencies): New function.
	(package-buffer-info): Use it (bug#15108).

2013-12-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* icomplete.el (icomplete-completions): Make sure the prefix is already
	displayed elsewhere before hiding it (bug#16219).

2013-12-14  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-rules): Return nil before
	open-paren tokens when preceded by a open-paren, too.
	(ruby-smie-rules): Handle virtual indentation after open-paren
	tokens specially.  If there is code between it and eol, return the
	column where is starts (Bug#16118).

2013-12-13  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el: Fix `add-hook' doc.
	(cfengine-mode-syntax-functions-regex): Initialize sensibly.
	(cfengine3--current-word): Fix parameters.
	(cfengine3-make-syntax-cache): Simplify further.
	(cfengine3-completion-function, cfengine3--current-function):
	Use `assq' for symbols.
	(cfengine3--current-function): Fix `cfengine3--current-word' call.

2013-12-13  Glenn Morris  <rgm@gnu.org>

	* loadup.el (load-path): Warn if site-load or site-init changes it.
	No more need to reset it when bootstrapping.

2013-12-13  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine-cf-promises): Add more default
	locations for cf-promises.
	(cfengine-mode-syntax-functions-regex): New caching variable.
	(cfengine3-fallback-syntax): Fallback syntax for cases where
	cf-promises doesn't run.
	(cfengine3--current-word): Reimplement using
	`cfengine-mode-syntax-functions-regex'.
	(cfengine3-completion-function, cfengine3--current-function):
	Use `cfengine3-make-syntax-cache' directly.
	(cfengine3-clear-syntax-cache): New function.
	(cfengine3-make-syntax-cache): Simplify and create
	`cfengine-mode-syntax-functions-regex' on demand.
	(cfengine3-format-function-docstring): Don't call
	`cfengine3-make-syntax-cache' explicitly.

2013-12-13  Martin Rudalics  <rudalics@gmx.at>

	Fix windmove-find-other-window broken after pixelwise resizing
	(Bug#16017).
	* windmove.el (windmove-other-window-loc): Revert change from
	2013-12-04.
	(windmove-find-other-window): Call window-in-direction.
	* window.el (window-in-direction): New arguments SIGN, WRAP and
	MINI to emulate original windmove-find-other-window behavior.

2013-12-13  Dmitry Gutov  <dgutov@yandex.ru>

	* simple.el (blink-matching--overlay): New variable.
	(blink-matching-open): Instead of moving point, highlight the
	matching paren with an overlay
	(https://lists.gnu.org/archive/html/emacs-devel/2013-12/msg00333.html).

	* faces.el (paren-showing-faces, show-paren-match)
	(show-paren-mismatch): Move from paren.el.

2013-12-13  Leo Liu  <sdl.web@gmail.com>

	* indent.el (indent-region): Disable progress reporter in
	minibuffer.  (Bug#16108)

	* bindings.el (visual-order-cursor-movement): Fix version.

2013-12-13  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-pdbtrack-stacktrace-info-regexp):
	Also match after beginning of line.
	(python-pdbtrack-set-tracked-buffer): Fix logic for remote
	files.  Thanks to Russell Sim.  (Bug#15378)

2013-12-13  Juri Linkov  <juri@jurta.org>

	* simple.el <Keypad support>: Remove key bindings duplicated
	with bindings.el.  (Bug#14397)

2013-12-13  Juri Linkov  <juri@jurta.org>

	* comint.el (comint-mode-map): Replace `delete-char' with
	`delete-forward-char'.  (Bug#16109)

2013-12-12  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-calculate-indentation):
	Fix de-denters cornercase.  (Bug#15731)

2013-12-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el: Add `depth' property to manage ordering.
	(advice--make): Pay attention to `depth'.
	(advice--make-1): Don't autoload commands eagerly.
	* emacs-lisp/elp.el (elp-instrument-function):
	* emacs-lisp/trace.el (trace-function-internal):
	* emacs-lisp/debug.el (debug-on-entry): Keep them "first".

	* iswitchb.el (iswitchb-mode): Don't belittle ido.

2013-12-12  Eli Zaretskii  <eliz@gnu.org>

	* term/w32-win.el (w32-handle-dropped-file):
	* startup.el (normal-top-level):
	* net/browse-url.el (browse-url-file-url):
	* dnd.el (dnd-get-local-file-name): On MS-Windows, encode and
	decode file names using 'utf-8' rather than
	file-name-coding-system.

2013-12-12  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-context)
	(python-indent-calculate-indentation): Fix auto-identation
	behavior for comment blocks.  (Bug#15916)

2013-12-12  Nathan Trapuzzano  <nbtrap@nbtrap.com>  (tiny change)

	* progmodes/python.el (python-indent-calculate-indentation):
	When determining indentation, don't treat "return", "pass", etc., as
	operators when they are just string constituents.  (Bug#15812)

2013-12-12  Juri Linkov  <juri@jurta.org>

	* uniquify.el (uniquify-buffer-name-style): Change default to
	`post-forward-angle-brackets'.

	* menu-bar.el (menu-bar-options-menu): Don't require preloaded
	`uniquify'.  Change default to `post-forward-angle-brackets'.

2013-12-11  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/package.el (finder-list-matches):
	Autoload rather than falsely declaring.

2013-12-11  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/eww.el (eww-exit, eww-close): Add UI convenience wrappers.
	(eww-mode-map): Use them.

2013-12-11  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-in-side-window): Fix doc-string
	(Bug#16115).

2013-12-11  Juanma Barranquero  <lekktu@gmail.com>

	* vc/vc-git.el: Silence byte-compiler warnings.
	(vc-git-dir-extra-headers): Rename arg _dir which is no longer ignored.
	(log-edit-set-header): Declare.

2013-12-11  Eli Zaretskii  <eliz@gnu.org>

	* Makefile.in (custom-deps, finder-data): Run output file names
	through unmsys--file-name.  (Bug#16099)

2013-12-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-indent--hanging-p): Don't bother matching
	comment-start-skip, which fails when that uses submatch 1 (bug#16041).

	* emulation/cua-base.el (cua-paste): Add `delete-selection' property
	instead of deleting the selection "by hand" (bug#16098).
	Rely on insert-for-yank to yank rectangles.
	(cua-highlight-region-shift-only): Mark obsolete.
	(cua-mode): Don't enable/disable transient-mark-mode,
	shift-select-mode (cua-mode works both with and without them), and
	pc-selection-mode (obsolete).
	* emulation/cua-rect.el (cua--activate-rectangle): Activate the mark.
	(cua--deactivate-rectangle): Deactivate it.

	* delsel.el (delete-selection-mode): Don't enable transient-mark-mode.
	(delete-selection-helper): Make sure yank starts at the top of the
	deleted region.
	(minibuffer-keyboard-quit): Use region-active-p.

	* emacs-lisp/trace.el (trace-make-advice): Don't deactivate the mark.

	* simple.el (normal-erase-is-backspace-mode): Map kp-delete identically
	to `delete' (bug#16109).

2013-12-11  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (octave-mode, inferior-octave-mode): Link to
	info manual and show keybindings and set `:group' keyword.

2013-12-11  Juri Linkov  <juri@jurta.org>

	* delsel.el (delete-active-region): Let-bind `this-command'
	to prevent `kill-region' from changing its original value.
	(delete-selection-helper): Handle `overwrite-mode' for the type
	`kill' exactly the same way as for the type `t'.
	(insert-char, quoted-insert, reindent-then-newline-and-indent):
	Support more commands.  (Bug#13312)

2013-12-11  Juri Linkov  <juri@jurta.org>

	* bindings.el: Map kp keys to non-kp keys systematically
	with basic modifiers control, meta and shift.  (Bug#14397)

2013-12-11  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-mode-map): Instead of "Quit" show "Exit" and
	"Close browser" menu items.  Fix wrong function of "List
	bookmarks".

2013-12-11  Juri Linkov  <juri@jurta.org>

	* misearch.el (multi-isearch-buffers): Set the value of
	`multi-isearch-buffer-list' globally.  Set NO-RECURSIVE-EDIT
	arg of isearch-forward to t.
	(multi-isearch-buffers-regexp): Set the value of
	`multi-isearch-buffer-list' globally.  Set NO-RECURSIVE-EDIT
	arg of isearch-forward-regexp to t.
	(multi-isearch-files): Set the value of
	`multi-isearch-file-list' globally.  Set NO-RECURSIVE-EDIT
	arg of isearch-forward to t.
	(multi-isearch-files-regexp): Set the value of
	`multi-isearch-file-list' globally.  Set NO-RECURSIVE-EDIT
	arg of isearch-forward-regexp to t.  (Bug#16035)

	* dired-aux.el (dired-isearch-filenames): Set NO-RECURSIVE-EDIT
	arg of isearch-forward to t.
	(dired-isearch-filenames-regexp): Set NO-RECURSIVE-EDIT
	arg of isearch-forward-regexp to t.
	(dired-isearch-filter-filenames): Remove unnecessary check for
	`dired-isearch-filenames'.

	* comint.el (comint-history-isearch-backward):
	Set NO-RECURSIVE-EDIT arg of isearch-backward to t.
	(comint-history-isearch-backward-regexp):
	Set NO-RECURSIVE-EDIT arg of isearch-backward-regexp to t.

2013-12-10  Eli Zaretskii  <eliz@gnu.org>

	* Makefile.in (autoloads): Run $(srcdir)/loaddefs.el through
	unmsys--file-name.  (Bug#16099)

2013-12-10  Teodor Zlatanov  <tzz@lifelogs.com>

	* emacs-lisp/package.el (package-keyword-button-action):
	Remove finder.el require dependency.

2013-12-09  Teodor Zlatanov  <tzz@lifelogs.com>

	* emacs-lisp/package.el: Require finder.el.
	(describe-package-1): Add keyword buttons.
	(package-make-button): New convenience function.
	(package-keyword-button-action): Keyword button action using
	`finder-list-matches'.

2013-12-09  Eli Zaretskii  <eliz@gnu.org>

	* autorevert.el (auto-revert-notify-add-watch): Fix a thinko in
	last commit.

2013-12-09  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-notify-add-watch): Do not handle
	symlinked files.

2013-12-09  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--implicit-semi-p): Return t
	after the end of a percent literal.

2013-12-09  Cameron Desautels  <camdez@gmail.com>  (tiny change)

	* progmodes/ruby-mode.el (ruby-forward-string): Document.
	Handle caret-delimited strings (Bug#16079).

2013-12-09  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-accurate-end-of-block):
	When `ruby-use-smie' is t, use `smie-forward-sexp' instead of
	`ruby-parse-partial' (Bug#16078).

2013-12-09  Leo Liu  <sdl.web@gmail.com>

	* subr.el (read-passwd): Disable show-paren-mode.  (Bug#16091)

2013-12-08  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/js.el (js-auto-indent-flag): Remove, was unused.
	(js-switch-indent-offset): New option.
	(js--proper-indentation): Use it.  And handle the case when
	"default" is actually a key in an object literal.
	(js--same-line): New function.
	(js--multi-line-declaration-indentation): Use it.
	(js--indent-in-array-comp, js--array-comp-indentation):
	New functions.
	(js--proper-indentation): Use them, to handle array comprehension
	continuations.

2013-12-08  Leo Liu  <sdl.web@gmail.com>

	* progmodes/flymake.el (flymake-highlight-line): Re-write.
	(flymake-make-overlay): Remove arg MOUSE-FACE.
	(flymake-save-string-to-file, flymake-read-file-to-string): Remove.

2013-12-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emulation/cua-rect.el (cua--rectangle-highlight-for-redisplay):
	New function.
	(redisplay-highlight-region-function): Use it.

	* emulation/cua-base.el (cua--explicit-region-start)
	(cua--last-region-shifted): Remove.
	(cua--deactivate): Use deactivate-mark.
	(cua--pre-command-handler-1): Don't handle shift-selection.
	(cua--post-command-handler-1): Don't change transient-mark-mode.
	(cua--select-keymaps): Use region-active-p rather than
	cua--explicit-region-start or cua--last-region-shifted.
	(cua-mode): Enable shift-select-mode.

2013-12-08  Leo Liu  <sdl.web@gmail.com>

	* progmodes/flymake.el (flymake-popup-current-error-menu):
	Rename from flymake-display-err-menu-for-current-line.  Reimplement.
	(flymake-posn-at-point-as-event, flymake-popup-menu)
	(flymake-make-emacs-menu): Remove.  (Bug#16077)

2013-12-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* rect.el (rectangle-mark-mode): Activate mark even if
	transient-mark-mode is off (bug#16066).
	(rectangle--highlight-for-redisplay): Fix boundary condition when point
	is > mark and at bolp.

	* emulation/cua-rect.el (cua--rectangle-region-extract): New function.
	(region-extract-function): Use it.
	(cua-mouse-save-then-kill-rectangle): Use cua-copy-region.
	(cua-copy-rectangle, cua-cut-rectangle, cua-delete-rectangle):
	Delete functions.
	(cua--init-rectangles): Don't re-remap copy-region-as-kill,
	kill-ring-save, kill-region, delete-char, delete-forward-char.
	Ignore self-insert-iso.

	* emulation/cua-gmrk.el (cua--init-global-mark):
	Ignore `self-insert-iso'.

	* emulation/cua-base.el (cua--prefix-copy-handler)
	(cua--prefix-cut-handler): Rely on region-extract-function rather than
	checking cua--rectangle.
	(cua-delete-region): Use region-extract-function.
	(cua-replace-region): Delete function.
	(cua-copy-region, cua-cut-region): Obey region-extract-function.
	(cua--pre-command-handler-1): Don't do the delete-selection thing.
	(cua--self-insert-char-p): Ignore `self-insert-iso'.
	(cua--init-keymaps): Don't remap delete-selection commands.
	(cua-mode): Use delete-selection-mode instead of rolling our own
	(bug#16085).

	* menu-bar.el (clipboard-kill-ring-save, clipboard-kill-region):
	Obey region-extract-function.

	Make registers and delete-selection-mode work on rectangles.
	* register.el (describe-register-1): Don't modify the register's value.
	(copy-to-register): Obey region-extract-function.
	* delsel.el (delete-active-region): Obey region-extract-function.

2013-12-08  Leo Liu  <sdl.web@gmail.com>

	* progmodes/flymake.el (flymake, flymake-error-bitmap)
	(flymake-warning-bitmap, flymake-fringe-indicator-position)
	(flymake-compilation-prevents-syntax-check)
	(flymake-start-syntax-check-on-newline)
	(flymake-no-changes-timeout, flymake-gui-warnings-enabled)
	(flymake-start-syntax-check-on-find-file, flymake-log-level)
	(flymake-xml-program, flymake-master-file-dirs)
	(flymake-master-file-count-limit)
	(flymake-allowed-file-name-masks): Relocate.
	(flymake-makehash, flymake-float-time)
	(flymake-replace-regexp-in-string, flymake-split-string)
	(flymake-get-temp-dir): Remove.
	(flymake-popup-menu, flymake-nop, flymake-make-xemacs-menu)
	(flymake-current-row, flymake-selected-frame)
	(flymake-get-point-pixel-pos): Remove xemacs compatibity and
	related functions.  (Bug#16077)

2013-12-07  Bozhidar Batsov  <bozhidar@batsov.com>

	* emacs-lisp/helpers.el (string-blank-p): Use `string-match-p'.

2013-12-07  Tassilo Horn  <tsdh@gnu.org>

	* help-fns.el (describe-function-1): Use new advice-* functions
	rather than old ad-* functions.  Fix function type description and
	source links for advised functions and subrs.

2013-12-07  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-tag-img): Don't bug out on <img src=""> data.

2013-12-06  Michael Albinus  <michael.albinus@gmx.de>

	* progmodes/compile.el (compilation-start):
	* progmodes/grep.el (rgrep): Revert change 2012-12-20T11:15:38Z!michael.albinus@gmx.de.

	* net/tramp-sh.el (tramp-sh-handle-start-file-process):
	Handle long command lines, lasting from "sh -c ...".  (Bug#16045)

2013-12-06  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-propertize-function):
	Touch up the last change.

2013-12-06  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-prompt): Use shy groups.
	(inferior-octave-startup): Always use "octave> " for prompt.
	(octave-goto-function-definition)
	(octave-sync-function-file-names)
	(octave-find-definition-default-filename): Remove redundant backquotes.

2013-12-06  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-mode-syntax-table): Don't modify
	syntax for `?'.
	(ruby-expr-beg): Expect that `!' will have syntax class "symbol"
	where appropriate already.
	(ruby-syntax-propertize-function): Propertize `?' and `!' at the
	end of method names (Bug#15874).

2013-12-06  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch--saved-overriding-local-map):
	New internal variable.
	(isearch-mode): Set it to the initial value of
	`overriding-terminal-local-map'.
	(isearch-pre-command-hook): Compare `overriding-terminal-local-map'
	with `isearch--saved-overriding-local-map'.  (Bug#16035)

2013-12-06  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/octave.el (inferior-octave-completion-table):
	Turn back into function, use `completion-table-with-cache'
	(Bug#11906).  Update all references.

	* minibuffer.el (completion-table-with-cache): New function.

2013-12-05  Cameron Desautels  <camdez@gmail.com>  (tiny change)

	* emacs-lisp/regexp-opt.el (regexp-opt-charset): Fix ^ (bug#16046).

2013-12-05  Teodor Zlatanov  <tzz@lifelogs.com>

	* net/eww.el (eww-current-source): New variable to store page
	source.
	(eww-display-html, eww-mode, eww-save-history)
	(eww-restore-history): Use it.
	(eww-view-source): New command to view page source.
	Opportunistically uses `html-mode' to highlight the buffer.
	(eww-mode-map): Install it.

2013-12-05  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus-unregister-service)
	(dbus-escape-as-identifier, dbus-unescape-from-identifier):
	Fix docstring.
	(dbus-unregister-service): Skip :serial entries in
	`dbus-registered-objects-table'.
	(dbus-byte-array-to-string): New optional arg MULTIBYTE.

2013-12-04  Teodor Zlatanov  <tzz@lifelogs.com>

	* emacs-lisp/lisp-mnt.el (lm-keywords-list): Trim whitespace
	around keywords with extra `split-string' argument.

2013-12-04  Martin Rudalics  <rudalics@gmx.at>

	* windmove.el (windmove-other-window-loc): Handle navigation
	between windows (excluding the minibuffer window - Bug#16017).

2013-12-04  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus-byte-array-to-string): Accept also byte arrays
	in D-Bus type syntax.
	(dbus-unescape-from-identifier): Use `byte-to-string' in order to
	preserve unibyte strings.  (Bug#16048)

2013-12-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eldoc.el (eldoc-minibuffer-message):
	Call force-mode-line-update is the proper buffer (bug#16042).

2013-12-04  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/log-edit.el (log-edit-add-new-comment): Rename to
	`log-edit-remember-comment', make argument optional.  Adjust all
	callers.
	(log-edit-mode): Add `log-edit-remember-comment' to
	`kill-buffer-hook' locally.
	(log-edit-kill-buffer): Don't remember comment explicitly since
	the buffer is killed anyway.

2013-12-04  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-mode, isearch-done): Don't set arg LOCAL in
	add-hook and remove-hook for multi-buffer search.  (Bug#16035)

2013-12-03  Tom Regner  <tom@goochesa.de>  (tiny change)

	* notifications.el (notifications-close-notification): Call the
	D-Bus method with ID being a `:uint32'.  (Bug#16030)

2013-12-03  Katsumi Yamaoka  <yamaoka@jpl.org>

	* net/eww.el (eww-render): Don't pass arg to eww-display-image.

2013-12-03  Juri Linkov  <juri@jurta.org>

	* progmodes/compile.el (compilation-start): Rename window alist
	entry `no-display-ok' to `allow-no-window'.

	* simple.el (shell-command): Add window alist entry
	`allow-no-window' to `display-buffer'.
	(async-shell-command): Doc fix.

	* window.el (display-buffer-no-window): New action function.
	(display-buffer-alist, display-buffer): Doc fix.  (Bug#13594)

2013-12-02  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/log-edit.el (log-edit-set-header): Extract from
	`log-edit-toggle-header'.
	(log-edit-extract-headers): Separate the summary, when extracted
	from header, from the rest of the message with an empty line.

	* vc/vc-git.el (vc-git-log-edit-toggle-amend): Move the summary
	line, if present, to the Summary header.

2013-12-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* epa-file.el (epa-file-insert-file-contents): Ensure we insert text
	in current-buffer (bug#16029).

2013-12-02  Helmut Eller  <eller.helmut@gmail.com>

	* emacs-lisp/debug.el (debugger-toggle-locals): New command.
	(debugger-mode-map): Bind it.
	(debugger--backtrace-base): New function.
	(debugger-eval-expression): Use it.
	(debugger-frame-number): Skip local vars when present.
	(debugger--locals-visible-p, debugger--insert-locals)
	(debugger--show-locals, debugger--hide-locals): New functions.

2013-12-02  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-remote-process-environment): Do not set
	"LC_ALL".
	(tramp-get-remote-locale): New defun.
	(tramp-open-connection-setup-interactive-shell): Use it.

2013-12-02  Leo Liu  <sdl.web@gmail.com>

	* subr.el (process-live-p): Return nil for non-process.  (Bug#16023)

	* progmodes/sh-script.el (sh-shell-process):
	* progmodes/octave.el (inferior-octave-process-live-p):
	* progmodes/gdb-mi.el (gdb-delchar-or-quit)
	(gdb-inferior-io-sentinel):
	* emacs-lock.el (emacs-lock-live-process-p): All uses changed.

2013-12-02  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/log-edit.el (log-edit-kill-buffer): Move the use of
	`save-selected-window' to `log-edit-hide-buf'.  This makes
	`log-edit-show-files' idempotent.
	(log-edit-show-files): Mark the new window as dedicated.

2013-12-02  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/log-edit.el (log-edit-mode-map): Add binding for
	`log-edit-kill-biffer'.
	(log-edit-hide-buf): Add a FIXME comment.
	(log-edit-add-new-comment): New function, extracted from
	`log-edit-done'.
	(log-edit-done, log-edit-add-to-changelog): Use it.
	(log-edit-kill-buffer): New command.

2013-12-01  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-mode-map): Have `q' do a normal `quit-window'
	instead of killing the buffer.

2013-12-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (newline): Mention `electric-indent-mode' (bug#16015).

2013-12-01  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* net/eww.el (eww-form-checkbox-selected-symbol)
	(eww-form-checkbox-symbol): New customizable variable.
	(eww-form-checkbox, eww-toggle-checkbox):
	Use `eww-form-checkbox-selected-symbol' and `eww-form-checkbox-symbol'.

	* net/shr.el (shr-prefer-media-type-alist): New customizable variable.
	(shr--get-media-pref, shr--extract-best-source): New function.
	(shr-tag-video, shr-tag-audio): Use `shr--extract-best-source' when
	no :src tag was specified.

	* net/eww.el (eww-use-external-browser-for-content-type): New variable.
	(eww-render): Handle `eww-use-external-browser-for-content-type'.
	Use \\` to match beginning of string instead of ^.
	(eww-browse-with-external-browser): Provide optional URL parameter.
	(eww-render): Set `eww-current-title' back to "".

	* net/shr.el (shr-tag-video): Display content for video if no
	poster is available.
	(shr-tag-audio): Add support for <audio> tag.

	* net/eww.el (eww-text-input-types): New const.
	(eww-process-text-input): Treat input types in
	`eww-text-input-types' as text.

	* net/shr.el (shr-tag-table): Fix comment typo.

2013-12-01  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-follow-link): New command to avoid reloading
	pages when we follow #target links (bug#15243).
	(eww-quit): Special mode buffers shouldn't query before exiting.

2013-12-01  Kenjiro NAKAYAMA  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-tag-select): Support <optgroup> tags in <select>
	forms.

2013-12-01  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-restore-history): Update the window title after
	moving in the history.
	(eww-current-dom): New variable used to save the current DOM.

2013-12-01  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/log-edit.el (log-edit-mode-map): Add binding for
	`log-edit-beginning-of-line'.
	(log-edit-setup-add-author): New user option.
	(log-edit-beginning-of-line): New command.
	(log-edit): Move major mode call above the contents setup so that
	the local variable values are already applied.
	(log-edit): Only insert "Author: " when
	`log-edit-setup-add-author' is non-nil.
	(log-edit): When SETUP is non-nil, position point after ": "
	instead of point-min.

2013-12-01  Glenn Morris  <rgm@gnu.org>

	* startup.el (command-line): Warn if ~/emacs.d is in load-path.

2013-11-30  Eli Zaretskii  <eliz@gnu.org>

	* startup.el (fancy-splash-frame): On MS-Windows, trigger
	redisplay to make sure the initial frame gets a chance to become
	visible.  (Bug#16014)

2013-11-30  Martin Rudalics  <rudalics@gmx.at>

	Support resizing frames and windows pixelwise.
	* cus-start.el (frame-resize-pixelwise)
	(window-resize-pixelwise): New entries.
	* emacs-lisp/debug.el (debug): Use window-total-height instead
	of window-total-size.
	* frame.el (tool-bar-lines-needed): Defalias to tool-bar-height.
	* help.el (describe-bindings-internal): Use help-buffer as
	argument for with-help-window.
	(temp-buffer-max-width): New option.
	(resize-temp-buffer-window, help-window-setup)
	(with-help-window): Rewrite.
	* mouse.el (mouse-drag-line): Rewrite.  Add key bindings for
	dragging dividers.
	* window.el (frame-char-size, window-min-pixel-height)
	(window-safe-min-pixel-height, window-safe-min-pixel-width)
	(window-min-pixel-width, window-safe-min-pixel-size)
	(window-combination-p, window-safe-min-size)
	(window-resizable-p, window--size-to-pixel)
	(window--pixel-to-size, window--resize-apply-p): New functions.
	(window-safe-min-height): Fix doc-string.
	(window-size, window-min-size, window--min-size-1)
	(window-sizable, window-sizable-p, window--min-delta-1)
	(window-min-delta, window--max-delta-1, window-max-delta)
	(window--resizable, window--resizable-p, window-resizable)
	(window-full-height-p, window-full-width-p, window-at-side-p)
	(window--in-direction-2, window-in-direction)
	(window--resize-reset-1, window--resize-mini-window)
	(window-resize, window-resize-no-error)
	(window--resize-child-windows-normal)
	(window--resize-child-windows, window--resize-siblings)
	(window--resize-this-window, window--resize-root-window)
	(window--resize-root-window-vertically)
	(adjust-window-trailing-edge, enlarge-window, shrink-window)
	(maximize-window, minimize-window, delete-window)
	(quit-restore-window, window-split-min-size, split-window)
	(balance-windows-2, balance-windows)
	(balance-windows-area-adjust, balance-windows-area)
	(window--state-get-1, window-state-get, window--state-put-1)
	(window--state-put-2, window-state-put)
	(display-buffer-record-window, window--display-buffer):
	Make functions handle pixelwise sizing of windows.
	(display-buffer--action-function-custom-type)
	(display-buffer-fallback-action):
	Add display-buffer-in-previous-window.
	(display-buffer-use-some-window): Resize window to height it had
	before.
	(fit-window-to-buffer-horizontally): New option.
	(fit-frame-to-buffer): Describe new values.
	(fit-frame-to-buffer-bottom-margin): Replace with
	fit-frame-to-buffer-margins.
	(window--sanitize-margin): New function.
	(fit-frame-to-buffer, fit-window-to-buffer): Rewrite completely
	using window-text-pixel-size.

2013-11-30  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-form):
	Make the `interactive-only' warning like the `obsolete' one.
	* comint.el (comint-run):
	* files.el (insert-file-literally, insert-file):
	* replace.el (replace-string, replace-regexp):
	* simple.el (beginning-of-buffer, end-of-buffer, delete-backward-char)
	(goto-line, insert-buffer, next-line, previous-line):
	Tweak `interactive-only' spec.

	Stop keeping (most) generated cedet grammar files in the repository.
	* Makefile.in (semantic): New.
	(compile-main): Depend on semantic.

2013-11-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* net/newst-reader.el (newsticker-html-renderer): Default to SHR if
	available.  Suggested by Clément B. <barthele1u@etu.univ-lorraine.fr>.

	* uniquify.el (uniquify-buffer-name-style): Change default.

	* loadup.el: Preload "uniquify".

	* time.el (display-time-update): Update all mode lines (bug#15999).

	* electric.el (electric-indent-mode): Enable by default.
	* loadup.el: Preload "electric".

2013-11-29  Bozhidar Batsov  <bozhidar@batsov.com>

	* emacs-lisp/helpers.el (string-empty-p): New function.
	(string-blank-p): New function.

2013-11-29  Andreas Politz  <politza@hochschule-trier.de>

	* imenu.el (imenu--index-alist): Add missing dot to the docstring
	(Bug#14029).

2013-11-29  Andreas Politz  <politza@fh-trier.de>
	* imenu.el (imenu--subalist-p): Don't error on non-conses and
	allow non-lambda lists as functions.
	(imenu--in-alist): Don't recurse into non-subalists.
	(imenu): Don't pass function itself as an argument (Bug#14029).

2013-11-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/python.el (python-mode-map): Remove binding for ":".
	(python-indent-electric-colon): Remove command.
	(python-indent-post-self-insert-function): Integrate the previous code
	of python-indent-electric-colon.  Make it conditional on
	electric-indent-mode.
	(python-mode): Add ?: to electric-indent-chars.
	Move python-indent-post-self-insert-function to the end of
	post-self-insert-hook.

2013-11-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* doc-view.el (doc-view-goto-page): Update mode-line.

	* vc/vc-dispatcher.el (vc-log-edit): Setup the Summary&Author headers.

2013-11-27  Glenn Morris  <rgm@gnu.org>

	* international/charprop.el, international/uni-bidi.el:
	* international/uni-category.el, international/uni-combining.el:
	* international/uni-comment.el, international/uni-decimal.el:
	* international/uni-decomposition.el, international/uni-digit.el:
	* international/uni-lowercase.el, international/uni-mirrored.el:
	* international/uni-name.el, international/uni-numeric.el:
	* international/uni-old-name.el, international/uni-titlecase.el:
	* international/uni-uppercase.el:
	Remove generated files from VCS repository.

2013-11-27  Eli Zaretskii  <eliz@gnu.org>

	* filenotify.el (file-notify-add-watch): Don't special-case
	w32notify when computing the directory to watch.

2013-11-27  Glenn Morris  <rgm@gnu.org>

	Make bootstrap without generated uni-*.el files possible again.
	* loadup.el: Update command-line-args checking for unidata-gen.
	Add vc to load-path to allow loading vc-bzr when writing uni-*.el.
	* composite.el, international/characters.el:
	Handle unicode tables being undefined.

	Move ja-dic, quail, leim-list.el from ../leim to a leim subdirectory.
	* Makefile.in (setwins_for_subdirs): Skip leim/ directory.
	(compile-main): Depend on leim rule.
	(leim): New rule.
	* loadup.el: Move leim-list.el to leim/ subdirectory.
	* startup.el (normal-top-level): No more leim directory.
	* international/ja-dic-cnv.el (skkdic-convert):
	Disable version-control and autoloads in output files.
	* international/titdic-cnv.el (titdic-convert, miscdic-convert):
	Disable version-control and autoloads in output files.
	* leim/quail: Move here from ../leim.
	* leim/quail/hangul.el (hangul-input-method-activate):
	Add autoload cookie.
	(generated-autoload-load-name): Set file-local value.
	* leim/quail/uni-input.el (ucs-input-activate): Add autoload cookie.
	(generated-autoload-load-name): Set file-local value.

2013-11-26  Kenjiro NAKAYAMA  <knakayam@redhat.com>

	* net/eww.el (eww-bookmark-browse): Use 'eww-browse-url'.
	(eww-add-bookmark): Ask confirmation when add to bookmarks.
	(eww-quit): Ask confirmation before quitting eww.

2013-11-26  Eli Zaretskii  <eliz@gnu.org>

	* vc/vc.el (vc-diff-internal): Use *-dos coding-system when
	reading output from Diff on MS-Windows and MS-DOS.

2013-11-26  Bozhidar Batsov  <bozhidar@batsov.com>

	* emacs-lisp/helpers.el (string-reverse): New function.

2013-11-26  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-file-name-regexp-unified): Support IPv6 host
	names on MS Windows, like "/[::1]:".

	* net/tramp-sh.el (tramp-sh-handle-insert-directory): Accept nil
	SWITCHES.

2013-11-26  Glenn Morris  <rgm@gnu.org>

	* progmodes/python.el (python-indent-guess-indent-offset):
	Avoid corner-case error.  (Bug#15975)

	Preload leim-list.el.  (Bug#4789)
	* loadup.el: Load leim-list.el when found.
	* startup.el (normal-top-level): Skip re-loading leim/leim-list.el.

2013-11-25  Bozhidar Batsov  <bozhidar@batsov.com>

	* emacs-lisp/bytecomp.el (byte-compile-form): Fix a typo.

	* emacs-lisp/helpers.el (string-join): New function.

2013-11-25  Sebastian Wiesner  <lunaryorn@gmail.com>  (tiny change)

	* emacs-lisp/bytecomp.el (byte-compile-interactive-only-functions):
	Mark as obsolete and replace it with a symbol property.
	(byte-compile-form): Use new 'interactive-only property.
	* comint.el, files.el, replace.el, simple.el:
	Apply new 'interactive-only properly.

2013-11-25  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-at-bottom): Make sure that
	split-window-sensibly creates the new window on bottom
	(Bug#15961).

2013-11-23  David Kastrup  <dak@gnu.org>

	* vc/smerge-mode.el (smerge-ediff): Choose default buffer names based
	on the conflict markers when available.
	(smerge--get-marker): New function.
	(smerge-end-re, smerge-base-re): Add subgroup.

2013-11-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* frame.el (handle-focus-in, handle-focus-out): Add missing
	interactive spec.

2013-11-25  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cmds.el (tramp-cleanup-connection): Clean up
	`tramp-current-connection' only when KEEP-PASSWORD is non-nil.

2013-11-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* play/gomoku.el: Don't use intangible property.  Use lexical-binding.
	(gomoku--last-pos): New var.
	(gomoku--intangible-chars): New const.
	(gomoku--intangible): New function.
	(gomoku-mode): Use it.  Derive from special-mode.
	(gomoku-move-up): Adjust line count.
	(gomoku-click, gomoku-point-y, gomoku-point-square, gomoku-goto-xy)
	(gomoku-plot-square, gomoku-init-display, gomoku-cross-qtuple):
	Simplify accordingly.

	* frame.el (handle-focus-in, handle-focus-out): Move from frame.c.
	Remove blink-cursor code.
	(blink-cursor-timer-function, blink-cursor-suspend):
	Don't special-case GUIs.
	(blink-cursor-mode): Use focus-in/out-hook.

2013-11-25  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-git.el (vc-git-annotate-extract-revision-at-line): Make it
	work when annotation is invisible (Bug#13886).

2013-11-24  Simon Schubert  <2@0x2c.org>  (tiny change)

	* json.el (json-alist-p): Only return non-nil if the alist has
	simple keys (Bug#13518).

2013-11-24  Mihir Rege  <mihirrege@gmail.com>  (tiny change)

	* progmodes/js.el (js--ctrl-statement-indentation): Fix indent
	when control-statement is the first statement in a buffer (Bug#15956).

2013-11-24  Dmitry Gutov  <dgutov@yandex.ru>

	* imenu.el (imenu-generic-skip-comments-and-strings):
	New option (Bug#15560).
	(imenu--generic-function): Use it.

2013-11-24  Jorgen Schaefer  <contact@jorgenschaefer.de>

	* minibuffer.el (completion--in-region-1): Scroll the correct window.
	(Bug#13898)

2013-11-24  Bozhidar Batsov  <bozhidar@batsov.com>

	* emacs-lisp/helpers.el: Add some string helpers.
	(string-trim-left): Removes leading whitespace.
	(string-trim-right): Removes trailing whitespace.
	(string-trim): Removes leading and trailing whitespace.

	* subr.el (string-suffix-p): New function.

2013-11-23  Glenn Morris  <rgm@gnu.org>

	* progmodes/python.el (python-shell-send-file):
	Add option to delete file when done.  (Bug#15647)
	(python-shell-send-string, python-shell-send-region): Use it.

2013-11-23  Ivan Shmakov  <ivan@siamics.net>

	* vc/diff-mode.el (diff-mode): Only allow diff-default-read-only
	to set buffer-read-only to t, never to nil.  (Bug#15938)

	* textmodes/tex-mode.el (latex-noindent-environments):
	Add safe-local-variable property.  (Bug#15936)

2013-11-23  Glenn Morris  <rgm@gnu.org>

	* textmodes/enriched.el (enriched-mode): Doc fix.
	* emacs-lisp/authors.el (authors-renamed-files-alist):
	Add enriched.doc -> enriched.txt.

	* Makefile.in (emacs): Empty EMACSLOADPATH rather than unsetting.

2013-11-22  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup): Spit out error
	message.

2013-11-22  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby-custom-encoding-magic-comment-template):
	Improve docstring.
	Add :version.
	(ruby-encoding-magic-comment-style): Add :version.

2013-11-22  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-operator-regexp): Exclude newline.
	(Bug#15076)
	(octave-help-mode): Adapt to change to help-mode-finish to use
	derived-mode-p on 2013-09-17.
	(inferior-octave-prompt): Also match octave-gui.
	(octave-kill-process): Don't ask twice.  (Bug#10564)

2013-11-22  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-process-live-p): New helper.
	(inferior-octave-startup, inferior-octave-check-process)
	(inferior-octave-track-window-width-change)
	(octave-completion-at-point, octave-eldoc-function): Use it.
	(octave-kill-process): Provide confirmation.  (Bug#10564)

2013-11-21  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode, inferior-octave-mode):
	Fix obsolete variable comment-use-global-state.

2013-11-21  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (octave-mode-map, octave-mode-menu):
	Add `octave-source-file'.
	(octave-source-file): New function.  (Bug#15935)

2013-11-21  Kenjiro Nakayama  <nakayamakenjiro@gmail.com>

	* net/eww.el (eww-local-regex): New variable.
	(eww): Use it to detect localhost and similar.

2013-11-21  Leo Liu  <sdl.web@gmail.com>

	Add completion for command `ag'.
	* pcmpl-x.el (pcmpl-x-ag-options): New variable.
	(pcomplete/ag): New function.
	(pcmpl-x-ag-options): New function.  Handle `[no]' in long options.

2013-11-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/byte-run.el (eval-when-compile): Fix edebug spec
	(bug#14646).
	(make-obsolete): Remove interactive spec.

2013-11-21  Glenn Morris  <rgm@gnu.org>

	* startup.el (command-line-1): Use path-separator with -L.

2013-11-20  Teodor Zlatanov  <tzz@lifelogs.com>

	* emacs-lisp/package.el (describe-package-1): Add package archive
	to shown fields.

2013-11-20  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby-custom-encoding-magic-comment-template):
	Change default to "# encoding: %s" to differentiate it from the
	default Ruby encoding comment template.

2013-11-20  Era Eriksson  <era+emacsbugs@iki.fi>

	* ses.el (ses-mode): Doc fix.  (Bug#14748)

2013-11-20  Leo Liu  <sdl.web@gmail.com>

	* window.el (display-buffer-alist): Doc fix.  (Bug#13594)

2013-11-19  Dan Nicolaescu  <dann@gnu.org>

	* vc/vc-git.el (vc-git-dir-extra-headers): Add headers
	when rebase or bisect are in progress.

2013-11-19  Xue Fuqiao  <xfq.free@gmail.com>

	* filenotify.el (file-notify-add-watch): Doc fix.

2013-11-19  Leo Liu  <sdl.web@gmail.com>

	* obsolete/rcompile.el: Mark obsolete.

	* progmodes/compile.el (compilation-start)
	(compilation-goto-locus, compilation-find-file):
	Pass no-display-ok and handle nil value from display-buffer.
	(Bug#13594)

	* window.el (display-buffer-alist, display-buffer): Document the
	new parameter no-display-ok.  Return either a window or nil
	but never a non-window value.

2013-11-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-indent-mode-map): Remove.
	(electric-indent-mode): Change the global-map instead (bug#15915).

	* textmodes/text-mode.el (paragraph-indent-minor-mode):
	Use add-function.

2013-11-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (remove-function): Align with
	add-function's behavior.

	* progmodes/gdb-mi.el: Avoid backtracking in regexp matcher.
	(gdb--string-regexp): New constant.
	(gdb-tooltip-print, gdb-var-evaluate-expression-handler)
	(gdbmi-bnf-stream-record, gdb-jsonify-buffer): Use it.
	(gdb-source-file-regexp, gdb-prompt-name-regexp): Use it and change
	submatch 1.
	(gdb-get-source-file-list, gdb-get-prompt, gdb-get-source-file):
	Adjust use accordingly.
	(gdb-breakpoints-list-handler-custom): Pre-build the y/n string.

2013-11-17  Adam Sokolnicki  <adam.sokolnicki@gmail.com>  (tiny change)

	* progmodes/ruby-mode.el (ruby-toggle-block): Don't stop at
	interpolation curlies (Bug#15914).

2013-11-17  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc.el (calc-context-sensitive-enter): New variable.
	(calc-enter): Use `calc-context-sensitive-enter'.

2013-11-16  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el: Version bump.
	(cfengine-cf-promises): New defcustom to locate cf-promises.
	(cfengine3-vartypes): Add new "data" type.
	(cfengine3--current-word): New function to get current name-like
	word or its bounds.
	(cfengine3--current-function): New function to look up a CFEngine
	function's definition.
	(cfengine3-format-function-docstring): New function.
	(cfengine3-make-syntax-cache): New function.
	(cfengine3-documentation-function): New function: ElDoc glue.
	(cfengine3-completion-function): New function: completion glue.
	(cfengine3-mode): Set `compile-command',
	`eldoc-documentation-function', and add to
	`completion-at-point-functions'.

2013-11-16  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cmds.el (tramp-cleanup-connection): Clean up
	`tramp-current-connection'.

2013-11-15  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): End regexp for
	nil/self/true/false with "end of symbol".

2013-11-15  Bozhidar Batsov  <bozhidar@batsov.com>

	* subr.el (version-regexp-alist): Fix a typo.

2013-11-15  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-remote-process-environment): Set "LC_ALL" to
	"en_US.utf8" and "LC_CTYPE" to "".
	(tramp-maybe-open-connection): Set "LC_ALL" to "en_US.utf8".
	(tramp-sh-handle-insert-directory): Don't set "LC_ALL" and "LC_CTYPE".

2013-11-15  Leo Liu  <sdl.web@gmail.com>

	* loadhist.el (read-feature): Get rid of fake feature nil.  (Bug#15889)

2013-11-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/gud.el (ctl-x-map):
	Remove C-x SPC binding.  (Bug#12342)
	(gud-jdb-find-source-using-classpath): Remove ((lambda (..)..)..).

2013-11-14  Bozhidar Batsov  <bozhidar@batsov.com>

	* subr.el (version-regexp-alist):
	Recognize hg, svn and darcs versions as snapshot versions.

	* progmodes/ruby-mode.el (ruby--detect-encoding): Make aware of
	'always-utf8 value of `ruby-insert-encoding-magic-comment'.
	(ruby--encoding-comment-required-p): Extract from
	`ruby-mode-set-encoding'.
	(ruby-mode-set-encoding): Add the ability to always insert an
	utf-8 encoding comment.  Fix and simplify coding comment update
	logic.

2013-11-14  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-gvfs.el (top): Run init code only when
	`tramp-gvfs-enabled' is not nil.
	(tramp-gvfs-enabled): Check also :system bus.

2013-11-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	Sync with upstream verilog-mode revision 78e66ba.
	* progmodes/verilog-mode.el (verilog-end-of-defun)
	(verilog-type-completion, verilog-get-list): Remove unused funcs.
	(verilog-get-end-of-defun): Remove unused argument.
	(verilog-comment-depth): Remove unused local `e'.
	(verilog-read-decls, verilog-read-sub-decls, verilog-read-instants):
	Don't pass arg to verilog-get-end-of-defun.

2013-11-14  Glenn Morris  <rgm@gnu.org>

	* obsolete/assoc.el (aget): Prefix dynamic variable.

	* allout-widgets.el (allout-widgets): No need to autoload defgroup.

2013-11-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* widget.el, hfy-cmap.el: Remove bogus package version number.

2013-11-13  Glenn Morris  <rgm@gnu.org>

	* replace.el (replace-eval-replacement):
	Try to give more helpful error message.  (Bug#15836)

	* arc-mode.el (archive-7z-extract, archive-7z-expunge)
	(archive-7z-update): Avoid custom type mismatches.

	* vc/vc.el (vc-diff-knows-L): Remove; unused since 2007-10-10.

2013-11-13  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-remote-file-name-spec-regexp): An IPv6
	address can be empty.

	* net/tramp-gvfs.el (tramp-gvfs-handle-insert-directory):
	Accept nil SWITCHES.
	(tramp-gvfs-handle-write-region): Implement APPEND.

2013-11-12  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-grammar): Disambiguate between
	binary "|" operator and closing block args delimiter.
	Remove FIXME comment referring to Ruby 1.8-only syntax.
	(ruby-smie--implicit-semi-p): Not after "|" operator.
	(ruby-smie--closing-pipe-p): New function.
	(ruby-smie--forward-token, ruby-smie--backward-token): Use it.
	(ruby-smie-rules): Indent after "|".

2013-11-12  Glenn Morris  <rgm@gnu.org>

	* ps-print.el (ps-face-attribute-list):
	Handle anonymous faces.  (Bug#15827)

2013-11-12  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-other-frame): Fix doc-string.
	(Bug#15868)

2013-11-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (force-mode-line-update): Delete, move to buffer.c.

2013-11-11  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-via-buffer)
	(tramp-sh-handle-file-local-copy): Don't write a message when
	saving temporary files.

	* net/tramp-smb.el (tramp-smb-handle-copy-directory): Fix bug when
	both directories are remote.
	(tramp-smb-handle-directory-files): Do not return double entries.
	Do not expand full file names.
	(tramp-smb-handle-insert-directory): Accept nil SWITCHES.
	(tramp-smb-handle-write-region): Implement APPEND.
	(tramp-smb-get-stat-capability): Fix a stupid bug.

2013-11-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* bindings.el (ctl-x-map): Bind C-x SPC to rectangle-mark-mode.

2013-11-11  Nathan Trapuzzano  <nbtrap@nbtrap.com>  (tiny change)

	* emacs-lisp/cconv.el (cconv-convert): Print warning instead of
	throwing error over malformed let/let* (bug#15814).

2013-11-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* iswitchb.el (iswitchb-mode): Mark obsolete.

2013-11-11  Glenn Morris  <rgm@gnu.org>

	* international/uni-bidi.el, international/uni-category.el:
	* international/uni-name.el, international/uni-numeric.el:
	Regenerate for Unicode 6.3.0.

2013-11-10  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-methods):
	* net/tramp-sh.el (tramp-compute-multi-hops): Revert change of
	2013-10-29 (2013-10-29T02:50:24Z!dancol@dancol.org).

2013-11-09  Andreas Schwab  <schwab@linux-m68k.org>

	* progmodes/sh-script.el (sh-font-lock-keywords-var):
	Force highlighting text after Summary keyword in doc face for rpm.

2013-11-09  Dmitry Gutov  <dgutov@yandex.ru>

	* textmodes/ispell.el (ispell-lookup-words): When `look' is not
	available and the word has no wildcards, append one to the grep pattern.
	https://lists.gnu.org/archive/html/emacs-devel/2013-11/msg00258.html
	(ispell-complete-word): Call `ispell-lookup-words' with the value
	independent of `ispell-look-p'.

2013-11-08  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--implicit-semi-p):
	Not after "||".
	(ruby-smie-rules): Indent non-hanging "begin" blocks as part of
	their parent.

2013-11-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ruby-mode.el: Don't require cl any more.  Use pcase instead.
	(ruby-font-lock-keywords): Use backquote.

2013-11-08  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--forward-token)
	(ruby-smie--backward-token): Only consider full-string matches.

2013-11-08  Jan Djärv  <jan.h.d@swipnet.se>

	* faces.el (describe-face): Add distant-foreground.

2013-11-08  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el: Improve encoding comment handling.
	(ruby-encoding-magic-comment-style): New option.
	(ruby-custom-encoding-magic-comment-template): New option.
	(ruby--insert-coding-comment, ruby--detect-encoding):
	New functions extracted from `ruby-mode-set-encoding'.
	(ruby-mode-set-encoding): Use `ruby-encoding-magic-comment-style'
	to control the style of the auto-inserted encoding comment.

2013-11-08  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--indent-to-stmt):
	Use `smie-backward-sexp' with token argument.

2013-11-08  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-set-remote-path, tramp-get-ls-command):
	Remove instrumentation code.

2013-11-08  Glenn Morris  <rgm@gnu.org>

	* progmodes/autoconf.el (autoconf-mode):
	Tweak comment-start-skip.  (Bug#15822)

2013-11-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el (sh-smie--sh-keyword-in-p): Don't inf-loop
	at bobp (bug#15826).
	(sh-smie--sh-keyword-in-p): Recognize keywords at bobp.

2013-11-08  Darren Hoo  <darren.hoo@gmail.com>

	* man.el (Man-start-calling): New macro, extracted from
	Man-getpage-in-background.
	(Man-getpage-in-background): Use it.
	(Man-update-manpage): New command.
	(Man-mode-map): Bind it.

2013-11-08  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-grammar): Improve precedences
	of "and", "or", "&&" and "||".
	(ruby-smie--args-separator-p): Prohibit keyword "do" as the first
	argument.  Prohibit opening curly brace because it could only be a
	block opener in that position.
	(ruby-smie--forward-token, ruby-smie--backward-token):
	Separate "|" from "&" or "*" going after it.  That can happen in block
	arguments.
	(ruby-smie--indent-to-stmt): New function, seeks the end of
	previous statement or beginning of buffer.
	(ruby-smie-rules): Use it.
	(ruby-smie-rules): Check if there's a ":" before a curly block
	opener candidate; if there is, it's a hash.

2013-11-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl-symbol-macrolet): Use macroexp-progn.
	(cl--block-wrapper): Fix last accidental change.

2013-11-07  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-set-remote-path, tramp-get-ls-command):
	Instrument, in order to hunt failure on hydra.

2013-11-05  Nathan Trapuzzano  <nbtrap@nbtrap.com>  (tiny change)

	* emacs-lisp/cl-macs.el (cl-symbol-macrolet): Print warning for
	malformed bindings form (bug#15814).

2013-11-07  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-grammar): Lower priority of
	"." compared to " @ ".  This incidentally fixes some indentation
	examples with "do".
	(ruby-smie--implicit-semi-p): No implicit semi after "^", "and" or "or".
	(ruby-smie-grammar): New tokens: "and" and "or".
	(ruby-smie--args-separator-p): Fix the check for tokens at POS.
	Exclude "and" and "or".  Remove "do" in order to work around token
	priorities.
	(ruby-smie-rules): Add all infix tokens.  Handle the case of
	beginning-of-buffer.

2013-11-06  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (setwins_almost, setwins_for_subdirs):
	Avoid accidental matches.

2013-11-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* menu-bar.el (popup-menu): Use key-binding.

2013-11-06  Eli Zaretskii  <eliz@gnu.org>

	* menu-bar.el (popup-menu, menu-bar-open): When displaying TTY
	menus, support also the menus produced by minor modes.
	(Bug#15817)

2013-11-06  Leo Liu  <sdl.web@gmail.com>

	* thingatpt.el (thing-at-point-looking-at): Add optional arg
	DISTANCE to bound the search.  All uses changed.  (Bug#15808)

2013-11-06  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (setwins, setwins_almost, setwins_for_subdirs): Simplify.
	(setwins_almost, setwins_for_subdirs): Don't assume called from srcdir.
	(custom-deps, finder-data, autoloads, update-subdirs): No need to cd.

2013-11-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-indent-just-newline): New command.
	(electric-indent-mode-map): New keymap.
	(electric-indent-mode, electric-pair-mode, electric-layout-mode):
	Re-add :group which weren't redundant.

	* electric.el (electric-indent-local-mode): New minor mode.
	(electric-indent-functions-without-reindent): New var.
	(electric-indent-post-self-insert-function): Use it.
	* emacs-lisp/gv.el (buffer-local-value): Add setter.

2013-11-05  Eli Zaretskii  <eliz@gnu.org>

	* international/quail.el (quail-help): Be more explicit about the
	meaning of the labels shown on the keys.  (Bug#15800)

	* startup.el (normal-top-level): Load the subdirs.el files before
	setting the locale environment.  (Bug#15805)

2013-11-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-rcs.el (vc-rcs-parse): Make `gather' get e, b, and @-holes
	via arguments so as to get the right ones (bug#15418).

	* net/rcirc.el (rcirc-record-activity): Don't abuse add-to-list.

2013-11-05  Michael Albinus  <michael.albinus@gmx.de>

	Fix problems found while writing a test suite.

	* net/tramp-compat.el (tramp-compat-load): New defun.
	* net/tramp.el (tramp-handle-load): Use it.

	* net/tramp-sh.el (tramp-sh-handle-add-name-to-file): Handle the case
	"(numberp ok-if-already-exists)" correctly.

2013-11-05  Xue Fuqiao  <xfq.free@gmail.com>

	* international/characters.el (glyphless-char-display-control):
	Add usage note.

2013-11-05  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/python.el (python-mode):
	* progmodes/scheme.el (scheme-mode):
	* progmodes/prolog.el (prolog-mode):
	* progmodes/ruby-mode.el (ruby-mode):
	* emacs-lisp/lisp-mode.el (lisp-mode, lisp-interaction-mode)
	(emacs-lisp-mode): Remove incorrect and redundant text from docstring.

2013-11-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* rect.el (rectangle--highlight-for-redisplay):
	* emacs-lisp/smie.el (smie--next-indent-change):
	Use buffer-chars-modified-tick.

	* emacs-lisp/byte-run.el (defmacro, defun): Set their `indent' property.

	* electric.el (electric-indent-post-self-insert-function):
	Only delete trailing whitepsace if it is indeed trailing (bug#15767).

2013-11-04  Helmut Eller  <eller.helmut@gmail.com>

	* emacs-lisp/cl-indent.el (with-compilation-unit): Add rule (bug#15782).

2013-11-04  Nathan Trapuzzano  <nbtrap@nbtrap.com>  (tiny change)

	* emacs-lisp/cconv.el (cconv-convert): Check form of let binding
	(bug#15786).

2013-11-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/helpers.el: Move from helpers.el.  Use lexical-binding.

	* progmodes/python.el: Fix up last change.
	(python-shell--save-temp-file): New function.
	(python-shell-send-string): Use it.  Remove `msg' arg.  Don't assume
	`string' comes from the current buffer.
	(python-shell-send-string-no-output): Remove `msg' arg.
	(python--use-fake-loc): New var.
	(python-shell-buffer-substring): Obey it.  Try to compensate for the
	extra coding line added by python-shell--save-temp-file.
	(python-shell-send-region): Use python-shell--save-temp-file and
	python-shell-send-file directly.  Add `nomain' argument.
	(python-shell-send-buffer): Use python-shell-send-region.
	(python-electric-pair-string-delimiter): New function.
	(python-mode): Use it.

2013-11-04  Eli Zaretskii  <eliz@gnu.org>

	* startup.el (normal-top-level): Move setting eol-mnemonic-unix,
	eol-mnemonic-mac, eol-mnemonic-dos, and also setup of the locale
	environment and decoding all of the default-directory's to here
	from command-line.
	(command-line): Decode also argv[0].

	* loadup.el: Error out if default-directory is a multibyte string
	when we are dumping.

	* Makefile.in (emacs): Don't set LC_ALL=C.  (Bug#15260)

2013-11-04  Teodor Zlatanov  <tzz@lifelogs.com>

	* emacs-lisp/package.el (package-menu-mode)
	(package-menu--print-info, package-menu--archive-predicate):
	Add Archive column to package list.

2013-11-04  Michael Albinus  <michael.albinus@gmx.de>

	Fix problems found while writing a test suite.

	* net/tramp.el (tramp-file-name-regexp-unified): Simplify.
	(tramp-file-name-for-operation): Use `tramp-tramp-file-p'.
	(tramp-handle-substitute-in-file-name): Let-bind `process-environment'
	to nil when running original file name handler.  Otherwise,
	there are problems with constructs like "$$FOO".

	* net/tramp-sh.el (tramp-do-copy-or-rename-file): Use correct prefix
	for `localname'.

2013-11-04  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby-mode): Clean up docstring.

	* subr.el (version<, version<=, version=):
	Update docstrings with information for snapshot versions.

	* helpers.el: New library for misc helper functions.
	(hash-table-keys): New function returning a list of hash keys.
	(hash-table-values): New function returning a list of hash values.

2013-11-04  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--forward-token)
	(ruby-smie--backward-token): Tokenize heredocs as semicolons.

2013-11-04  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/fill.el (fill-single-char-nobreak-p): New function
	checking whether point is after a 1-letter word.

2013-11-04  Nathan Trapuzzano  <nbtrap@nbtrap.com>  (tiny change)

	* progmodes/cperl-mode.el (cperl-font-lock-fontify-region-function):
	Don't infloop when expanding region over `multiline' syntax-type that
	begins a line (bug#15778).

2013-11-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* rect.el (rectangle-mark-mode): Rename from rectangle-mark.
	Make it into a proper minor mode.
	(rectangle--region): (Implicitly) rename to rectangle-mark-mode.
	(rectangle-mark-mode-map): New keymap.
	(rectangle--highlight-for-redisplay): Fix some corner cases (bug#15796).

2013-11-04  Glenn Morris  <rgm@gnu.org>

	* startup.el (command-line-1): Allow `-L :...' to append to load-path.

2013-11-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ruby-mode.el (ruby-smie--rule-parent-skip-assign): Remove.
	(ruby-smie-rules): Use smie-rule-parent instead.

	* emacs-lisp/smie.el (smie-rule-parent): Always call
	smie-indent-virtual rather than only for hanging tokens.
	(smie--next-indent-change): New helper command.

2013-11-03  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (abs_srcdir): Remove.
	(emacs): Unset EMACSLOADPATH.

2013-11-02  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (EMACS): Use a relative filename.
	(abs_top_builddir): Remove.
	(custom-deps, finder-data, autoloads): Use --chdir.

	* Makefile.in (abs_lisp): Remove, replace by abs_srcdir.

	Use relative filenames in TAGS files.
	* Makefile.in (lisptagsfiles1, lisptagsfiles2, lisptagsfiles3)
	(lisptagsfiles4, TAGS): Use relative file names.
	(TAGS-LISP): Remove.
	(maintainer-clean): No more TAGS-LISP file.

	* Makefile.in (lisptagsfiles1, lisptagsfiles2, lisptagsfiles3)
	(lisptagsfiles4): Use absolute filenames again.
	(TAGS, TAGS-LISP): Not everything needs to run in one line.
	Remove all *loaddefs files, not just the first.  Remove esh-groups.
	(maintainer-clean): Delete TAGS, TAGS-LISP.

2013-11-02  Bozhidar Batsov  <bozhidar@batsov.com>

	* emacs-lisp/package.el (package-version-join):
	Recognize snapshot versions.

2013-11-02  Bozhidar Batsov  <bozhidar@batsov.com>

	* subr.el (version-regexp-alist): Add support for snapshot versions.

2013-11-02  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--rule-parent-skip-assign):
	New function, replacement for `smie-rule-parent' for when we want to
	skip over our direct parent if it's an assignment token..
	(ruby-smie-rules): Use it.

2013-11-02  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el: Use `syntax-propertize-function'
	unconditionally.  Remove now unnecessary forward declarations.
	Remove XEmacs-specific setup.
	(ruby-here-doc-end-re, ruby-here-doc-beg-match)
	(ruby-font-lock-syntactic-keywords)
	(ruby-comment-beg-syntax, ruby-in-here-doc-p)
	(ruby-here-doc-find-end, ruby-here-doc-beg-syntax)
	(ruby-here-doc-end-syntax): Remove.
	(ruby-mode): Don't check whether `syntax-propertize-rules' is
	defined as function.

2013-11-02  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby-mode-variables, ruby-mode): Use `setq-local'.

2013-11-01  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby-mode-variables): Don't set syntax
	table and abbrev table, `define-derived-mode' does that for us
	anyway.

2013-11-01  Glenn Morris  <rgm@gnu.org>

	* Makefile.in: Remove manual mh-e dependencies (writing .elc
	files is atomic for some time, so no parallel compilation issues).

2013-11-01  Jan Djärv  <jan.h.d@swipnet.se>

	* faces.el (face-x-resources): Add :distant-foreground.
	(region): Use :distant-foreground for gtk and ns.

2013-11-01  Tassilo Horn  <tsdh@gnu.org>

	Allow multiple bibliographies when BibLaTeX is used rather than
	BibTeX.
	* textmodes/reftex-parse.el (reftex-using-biblatex-p): New function.
	(reftex-locate-bibliography-files): Us it.

2013-11-01  Claudio Bley  <claudio.bley@googlemail.com>

	* image.el (image-type-header-regexps): Fix the 'pbm' part to
	allow comments in pbm files.

	* term/w32-win.el (dynamic-library-alist): Support newer versions
	of libjpeg starting with v7: look only for the DLL from the
	version against which Emacs was built.
	Support versions of libpng beyond 1.4.x.
	Support libtiff v4.x.

2013-11-01  Bozhidar Batsov  <bozhidar@batsov.com>

	* progmodes/ruby-mode.el (ruby-indent-tabs-mode)
	(ruby-indent-level, ruby-comment-column, ruby-deep-arglist):
	Add property :safe.
	(ruby-deep-arglist): Add property :type.

2013-10-31  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (custom-deps, finder-data): No need to setq the target
	variables, we are in the right directory and the defaults work fine.

2013-10-30  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (autoloads): Do not use abs_lisp.

	* emacs-lisp/autoload.el (autoload-generate-file-autoloads):
	`newline' does not respect `standard-output', so use `princ'.

2013-10-30  Alp Aker  <alp.tekin.aker@gmail.com>

	Ensure unmarking in buffer menu clears 'S' marks.  (Bug#15761)
	* buff-menu.el (Buffer-menu--unmark): New function.
	(Buffer-menu-unmark, Buffer-menu-backup-unmark): Use it.

2013-10-30  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (AUTOGENEL): Add org/org-loaddefs.el.

	* emacs-lisp/package.el (lm-homepage): Declare.

	* eshell/em-ls.el (eshell-ls-directory, eshell-ls-symlink):
	Fix doc typos.

	* vc/pcvs.el (cvs-status-cvstrees): Autoload to silence compiler.

	* Makefile.in (finder-data, autoloads, update-subdirs)
	(compile-main, compile-clean, compile-always, bootstrap-clean):
	Check return value of cd.
	(compile-calc): Remove.

2013-10-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (copy-region-as-kill): Fix call to region-extract-function.

	* emacs-lisp/bytecomp.el (byte-defop-compiler): Add new `2-and' handler.
	(byte-compile-and-folded): New function.
	(=, <, >, <=, >=): Use it.

	* dos-w32.el (minibuffer-history-case-insensitive-variables)
	(path-separator, null-device, buffer-file-coding-system)
	(lpr-headers-switches): Check system-type before modifying them.
	(find-buffer-file-type-coding-system): Mark obsolete.
	(w32-find-file-not-found-set-buffer-file-coding-system): Rename from
	find-file-not-found-set-buffer-file-coding-system.
	(w32-untranslated-filesystem-list, w32-untranslated-canonical-name)
	(w32-add-untranslated-filesystem, w32-remove-untranslated-filesystem)
	(w32-direct-print-region-use-command-dot-com, w32-untranslated-file-p)
	(w32-direct-print-region-helper, w32-direct-print-region-function)
	(w32-direct-ps-print-region-function): Rename by adding a "w32-" prefix.
	* startup.el (normal-top-level-add-subdirs-to-load-path):
	* ps-print.el (ps-print-region-function):
	* lpr.el (print-region-function): Use new name.

	* subr.el (custom-declare-variable-early): Remove function.
	(custom-declare-variable-list): Remove var.
	(error, user-error): Remove `while' loop.
	(read-quoted-char-radix, read-quoted-char): Move to simple.el.
	(user-emacs-directory-warning, locate-user-emacs-file):
	Move to files.el.
	* simple.el (read-quoted-char-radix, read-quoted-char):
	* files.el (user-emacs-directory-warning, locate-user-emacs-file):
	Move from subr.el.
	* custom.el (custom-declare-variable-list): Don't process
	custom-declare-variable-list.

	* progmodes/python.el (python-shell-get-buffer): New function.
	(python-shell-get-process): Use it.
	(python-shell-send-string): Always use utf-8 and add a cookie to tell
	Python which encoding was used.  Don't split-string since we only care
	about the first line.  Return the temp-file, if applicable.
	(python-shell-send-region): Tell compile.el how to turn locations in
	the temp-file into locations in the source buffer.

2013-10-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (undefined): Add missing behavior from the C code for
	unbound keys.

	* rect.el: Use lexical-binding.  Add new rectangular region support.
	(rectangle-mark): New command.
	(rectangle--region): New var.
	(deactivate-mark-hook): Reset rectangle--region.
	(rectangle--extract-region, rectangle--insert-for-yank)
	(rectangle--highlight-for-redisplay)
	(rectangle--unhighlight-for-redisplay): New functions.
	(region-extract-function, redisplay-unhighlight-region-function)
	(redisplay-highlight-region-function): Use them to handle
	rectangular region.
	* simple.el (region-extract-function): New var.
	(delete-backward-char, delete-forward-char, deactivate-mark): Use it.
	(kill-new, kill-append): Remove obsolete `yank-handler' argument.
	(kill-region): Replace obsolete `yank-handler' arg with `region'.
	(copy-region-as-kill, kill-ring-save): Add `region' argument.
	(redisplay-unhighlight-region-function)
	(redisplay-highlight-region-function): New vars.
	(redisplay--update-region-highlight): New function.
	(pre-redisplay-function): Use it.
	(exchange-point-and-mark): Don't deactivate the mark before
	reactivate-it anyway.
	* comint.el (comint-kill-region): Remove yank-handler argument.
	* delsel.el (delete-backward-char, backward-delete-char-untabify)
	(delete-char): Remove property, since it's now part of their
	default behavior.
	(self-insert-iso): Remove property since this command doesn't exist.

	* emacs-lisp/package.el (package--download-one-archive)
	(describe-package-1): Don't query the user about final newline.

2013-10-29  Daniel Colascione  <dancol@dancol.org>

	* net/tramp.el (tramp-methods): Document new functionality.
	* net/tramp-sh.el (tramp-compute-multi-hops): Punt to
	tramp-hostname-checker if method provides one instead of scanning
	argument list for "%h" to decide hostname acceptability.

2013-10-28  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-copy-directory):
	* net/tramp-smb.el (tramp-smb-handle-copy-directory):
	Handle COPY-CONTENTS.  (Bug#15737)

2013-10-28  Daiki Ueno  <ueno@gnu.org>

	* epa-file.el (epa-file-cache-passphrase-for-symmetric-encryption):
	Document that this option has no effect with GnuPG 2.0 (bug#15552).

2013-10-27  Xue Fuqiao  <xfq.free@gmail.com>

	* image.el (defimage, image-load-path): Doc fixes.

2013-10-27  Alan Mackenzie  <acm@muc.de>

	Indent statements in macros following "##" correctly.
	* progmodes/cc-engine.el (c-crosses-statement-barrier-p):
	Modify the "#" arm of a cond form to handle "#" and "##" operators.

2013-10-27  Nathan Trapuzzano  <nbtrap@nbtrap.com>  (tiny change)

	* linum.el (linum-update-window): Fix boundary test (bug#13446).

2013-10-27  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--bosp): Anything that goes
	after `=' is probably a new expression.

2013-10-27  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* man.el (man-imenu-title): New option.
	(Man-mode-map): Add menu.  (Bug#15722)
	(Man-mode): Add imenu to menu.

2013-10-26  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--args-separator-p): Be more
	specific in what the first arg can be: a non-keyword word,
	string/regexp/percent literal opener, opening paren, or unary
	operator followed directly by word.

2013-10-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/prolog.el: Remove old indent; use post-self-insert-hook.
	(prolog-align-comments-flag, prolog-indent-mline-comments-flag)
	(prolog-object-end-to-0-flag, prolog-electric-newline-flag)
	(prolog-electric-tab-flag, prolog-use-prolog-tokenizer-flag):
	Remove vars, they do not apply any more.
	(prolog-mode-abbrev-table): Remove redundant declaration.
	(prolog-upper-case-string, prolog-lower-case-string): Remove.
	(prolog-use-smie): Remove.
	(prolog-smie-rules): Add indentation rule for the if-then-else layout
	supported by prolog-electric-if-then-else-flag.
	(prolog-mode-variables, prolog-menu): Use setq-local.
	(prolog-mode-keybindings-edit): Don't rebind M-C-p and M-C-n.
	Remove binding to `Backspace' since this key doesn't exist anyway.
	Remove bindings for electric self-inserting keys.
	(prog-mode): Assume it's defined.
	(prolog-post-self-insert): New function.
	(prolog-mode): Use it.
	(prolog-indent-line, prolog-indent-level)
	(prolog-find-indent-of-matching-paren)
	(prolog-indentation-level-of-line, prolog-goto-comment-column)
	(prolog-paren-is-the-first-on-line-p, prolog-region-paren-balance)
	(prolog-goto-next-paren, prolog-in-string-or-comment)
	(prolog-tokenize, prolog-inside-mline-comment)
	(prolog-find-start-of-mline-comment): Remove functions.
	(prolog-find-unmatched-paren, prolog-clause-end)
	(prolog-guess-fill-prefix, prolog-get-predspec): Use syntax-ppss.
	(prolog-electric--if-then-else): Rename from
	prolog-insert-spaces-after-paren; use prolog-electric-if-then-else-flag.
	(prolog-tokenize-searchkey): Remove const.
	(prolog-clause-info): Use forward-sexp.
	(prolog-forward-list, prolog-backward-list, prolog-electric-delete)
	(prolog-electric-if-then-else): Remove commands.
	(prolog-electric--colon): Rename from prolog-electric-colon; adapt it
	for use in post-self-insert-hook.
	(prolog-electric--dash): Rename from prolog-electric-dash; adapt it
	for use in post-self-insert-hook.
	(prolog-electric--dot): Rename from prolog-electric-dot; adapt it
	for use in post-self-insert-hook.
	(prolog-electric--underscore): Rename from prolog-electric--underscore;
	adapt it for use in post-self-insert-hook.

2013-10-25  Michael Albinus  <michael.albinus@gmx.de>

	* emacs-lisp/ert.el (ert-run-tests-interactively):
	Use `completing-read'.  (Bug#9756)

2013-10-25  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move): Call line-move-1 instead of
	line-move-visual when the current window hscroll is zero, but
	temporary-goal-column indicates we will need to hscroll as result
	of the movement.  (Bug#15712)

2013-10-25  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-mode-menu): Use proper
	capitalization.  Use :visible instead of :active.
	Fix `ruby-indent-exp' reference.  Add menu items for the generic
	commands that are used with SMIE.
	(ruby-do-end-to-brace): Insert space after `{'.

2013-10-25  John Anthony  <john@jo.hnanthony.com>

	* progmodes/ruby-mode.el (ruby-mode-menu): Add a menu.  (Bug#15600)

	* progmodes/inf-lisp.el (inferior-lisp-menu): Add a menu.  (Bug#15599)

2013-10-25  Glenn Morris  <rgm@gnu.org>

	* vc/vc.el (vc-print-log): Don't use a working revision unless
	one was explicitly specified.  (Bug#15322)

2013-10-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (add-to-list): Preserve return value in compiler-macro
	(bug#15692).

2013-10-25  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (octave-lookfor): Handle empty lookfor
	result.  Ask user to retry using '-all' flag.  (Bug#15701)

2013-10-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el: New smie-config system.
	(smie-config): New defcustom.
	(smie-edebug, smie-config-show-indent, smie-config-set-indent)
	(smie-config-guess, smie-config-save): New commands.
	(smie-config--mode-local, smie-config--buffer-local)
	(smie-config--trace, smie-config--modefuns): New vars.
	(smie-config--advice, smie-config--mode-hook)
	(smie-config--setter, smie-config-local, smie-config--get-trace)
	(smie-config--guess-value, smie-config--guess): New functions.
	(smie-indent-forward-token, smie-indent-backward-token): Don't copy
	text properties.  Treat "string fence" syntax like string syntax.

	* progmodes/sh-script.el (sh-use-smie): Change default.
	(sh-smie-sh-rules, sh-smie-rc-rules): Obey legacy sh-indent-* vars.
	(sh-var-value): Simplify by CSE.
	(sh-show-indent, sh-set-indent, sh-learn-line-indent)
	(sh-learn-buffer-indent): Redirect to their SMIE equivalent when SMIE
	is used.
	(sh-guess-basic-offset): Use cl-incf.
	(sh-guess-basic-offset): Use push+nreverse to avoid O(n^2).

2013-10-24  Helmut Eller  <eller.helmut@gmail.com>

	* emacs-lisp/lisp-mode.el (lisp-cl-font-lock-keywords-2): Fix cut&paste
	(bug#15699).

2013-10-24  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (abs_top_srcdir): Remove.
	(update-subdirs): Use relative path to update-subdirs.

2013-10-24  Eli Zaretskii  <eliz@gnu.org>

	* Makefile.in ($(MH_E_DIR)/mh-loaddefs.el)
	($(TRAMP_DIR)/tramp-loaddefs.el, $(CAL_DIR)/cal-loaddefs.el)
	($(CAL_DIR)/diary-loaddefs.el, $(CAL_DIR)/hol-loaddefs.el):
	Call unmsys--file-name before expand-file-name, not after it.

2013-10-24  Michael Albinus  <michael.albinus@gmx.de>

	* emacs-lisp/ert.el (ert-deftest): Bind macro `skip-unless'.
	(ert-test-skipped): New error.
	(ert-skip, ert-stats-skipped): New defuns.
	(ert--skip-unless): New macro.
	(ert-test-skipped): New struct.
	(ert--run-test-debugger, ert-test-result-type-p)
	(ert-test-result-expected-p, ert--stats, ert-stats-completed)
	(ert--stats-set-test-and-result, ert-char-for-test-result)
	(ert-string-for-test-result, ert-run-tests-batch)
	(ert--results-update-ewoc-hf, ert-run-tests-interactively):
	Handle skipped tests.  (Bug#9803)

2013-10-24  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (check-declare): Remove unnecessary path in -l argument.

	* Makefile.in (abs_top_srcdir): New, set by configure.
	(update-subdirs): Correct build-aux location.

2013-10-24  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc.el (vc-print-root-log): Always set `default-directory'
	value, whether we could auto-deduce `backend', or not.

	* progmodes/ruby-mode.el (ruby-smie-rules): Fix the "curly block
	with parameters" example.  Simplify the "is it block or is it
	hash" check, but also make it more thorough.

2013-10-23  Masashi Fujimoto  <masfj.dev@gmail.com>  (tiny change)

	* battery.el (battery-pmset): Handle OS X Mavericks.  (Bug#15694)

2013-10-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ruby-mode.el (ruby-smie-rules): Only align with parent of
	{ if it is hanging.

	* progmodes/ruby-mode.el (ruby-smie-rules): Don't return 0 for
	:before ";".

2013-10-23  Jed Brown  <jed@59A2.org>  (tiny change)

	* progmodes/compile.el (compilation-directory-matcher)
	(compilation-page-delimiter):
	Support GNU Make-4.0 directory quoting.  (Bug#15678)

2013-10-23  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-tidy): Handle read-only text.

2013-10-23  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (abs_srcdir, abs_lisp): New, set by configure.
	(emacs, compile, compile-always):
	Quote entities that might contain whitespace.
	(custom-deps, finder-data, autoloads): Use abs_lisp.
	($(MH_E_DIR)/mh-loaddefs.el, $(TRAMP_DIR)/tramp-loaddefs.el)
	($(CAL_DIR)/cal-loaddefs.el, $(CAL_DIR)/diary-loaddefs.el)
	($(CAL_DIR)/hol-loaddefs.el): Manually expand target file name.

2013-10-23  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--at-dot-call):
	Use `following-char'.

2013-10-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-rule-parent): Fix opener-test.
	* progmodes/ruby-mode.el (ruby-smie-rules):
	Remove corresponding workaround.  Fix indentation rule of ";" so it
	also applies when ";" is the parent.

2013-10-22  Xue Fuqiao  <xfq.free@gmail.com>

	* frame.el (display-screens, display-pixel-height)
	(display-pixel-width, display-mm-width, display-backing-store)
	(display-save-under, display-planes, display-color-cells)
	(display-visual-class, display-monitor-attributes-list):
	Mention the optional ‘display’ argument in doc strings.

2013-10-22  Michael Gauland  <mikelygee@amuri.net>

	* progmodes/ebnf2ps.el (ebnf-prologue): Avoid PS error with some
	viewers such as evince when ebnf-production-name-p is nil.  (Bug#15625)

2013-10-21  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-grammar): Remove outdated
	TODO.  Add "." after " @ ".
	(ruby-smie--at-dot-call): New function.  Checks if point at method
	call with explicit target.
	(ruby-smie--forward-token, ruby-smie--backward-token): Prepend "."
	to the method name tokens when it precedes them.
	(ruby-smie--backward-id, ruby-smie--forward-id): Remove.
	(ruby-smie-rules): Add rule for indentation before and after "."
	token.

2013-10-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/remember.el (remember-diary-extract-entries):
	Avoid add-to-list.

	* progmodes/ruby-mode.el (ruby-smie-rules): Indent after + used as
	an instruction.

2013-10-21  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-grammar):
	Add (almost) all infix operators.
	(ruby-smie--implicit-semi-p): Add new operator chars.

	* progmodes/ruby-mode.el (ruby-mode-map): Add binding for
	`smie-down-list'.
	(ruby-smie--args-separator-p): Check that there's no newline
	between method call and its arguments.

2013-10-20  Alan Mackenzie  <acm@muc.de>

	Allow comma separated lists after Java "implements".

	* progmodes/cc-engine.el (c-backward-over-enum-header):
	Parse commas.
	* progmodes/cc-fonts.el (c-basic-matchers-after): Remove comma
	from a "disallowed" list in enum fontification.

2013-10-20  Johan Bockgård  <bojohan@gnu.org>

	* startup.el (default-frame-background-mode): Remove unused defvar.

	* progmodes/verilog-mode.el (verilog-mode): Don't set
	comment-indent-function globally.

2013-10-20  Jan Djärv  <jan.h.d@swipnet.se>

	* menu-bar.el: Put help-menu in menu-bar-final-items unconditionally.
	Move Info menu item creation to ns-win.el.

	* term/ns-win.el (ns-initialize-window-system): Rename Help to Info
	in menu bar.

	* menu-bar.el: Move GNUstep specific menus...

	* term/ns-win.el (ns-initialize-window-system): ... to here.

2013-10-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (newline): Only run post-self-insert-hook when
	called interactively.

2013-10-19  Johan Bockgård  <bojohan@gnu.org>

	* icomplete.el (icomplete-with-completion-tables): Add :version.

2013-10-19  Alan Mackenzie  <acm@muc.de>

	Fix fontification bugs with constructors and const.

	* progmodes/cc-engine.el (c-forward-decl-or-cast-1): (Just after
	CASE 2) Remove the check for the absence of a suffix construct
	after a function declaration with only types (no identifiers) in
	the parentheses.  Also, accept a function declaration with just a
	type inside the parentheses, if this type can be positively
	recognized as such, or if a prefix keyword like "explicit" nails
	down the construct as a declaration.

2013-10-19  Eli Zaretskii  <eliz@gnu.org>

	* menu-bar.el (tty-menu-navigation-map): Bind mouse-N to perform
	TTY menu actions and down-mouse-N to tty-menu-ignore.  This solves
	the problem whereby selecting a menu item that leads to a
	minibuffer prompt moves the cursor out of the minibuffer window,
	making it hard to type at the prompt.  Suggested by Stefan Monnier
	<monnier@iro.umontreal.ca>.

2013-10-19  Jan Djärv  <jan.h.d@swipnet.se>

	* menu-bar.el: Don't make Services menu.

2013-10-19  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* ffap.el: Handle "/usr/include/c++/<version>" directories.
	(ffap-alist): Use ffap-c++-mode for c++-mode.
	(ffap-c++-path): New variable.
	(ffap-c++-mode): New function.

2013-10-19  Joe Vornehm Jr.  <joe.vornehm@gmail.com>  (tiny change)

	* ido.el (dired-other-frame): Only list directories.  (Bug#15638)

2013-10-18  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-smb.el (tramp-smb-maybe-open-connection): Fix an error
	introduced on 2013-09-08, which results in an infinite loop
	requesting a password.

2013-10-18  Glenn Morris  <rgm@gnu.org>

	* progmodes/verilog-mode.el (verilog-case-fold): Add :version.

2013-10-18  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode revision 1a6ecec7.
	* progmodes/verilog-mode.el (verilog-mode-version): Update.
	(verilog-mode-release-date): Remove.
	(verilog-highlight-grouping-keywords, verilog-active-low-regexp)
	(verilog-auto-inst-param-value, verilog-auto-input-ignore-regexp)
	(verilog-auto-inout-ignore-regexp, verilog-auto-output-ignore-regexp)
	(verilog-auto-tieoff-ignore-regexp)
	(verilog-auto-unused-ignore-regexp, verilog-typedef-regexp)
	(verilog-scan-cache-preserving, verilog-mode, verilog-at-struct-p)
	(verilog-signals-with, verilog-dir-cache-preserving)
	(verilog-auto-inst, verilog-auto-inout-param, verilog-auto):
	Doc fixes.
	(verilog-case-fold): New option, to control case folding in
	regexp searches, bug597.
	(verilog-menu): Add verilog-sk-uvm-component, minor tweaks.
	(verilog-string-match-fold, verilog-in-paren-count)
	(verilog-in-struct-nested-p, verilog-at-struct-mv-p)
	(verilog-at-close-struct-p): New functions.
	(verilog-beg-block-re-ordered, verilog-extended-case-re)
	(verilog-forward-sexp, verilog-set-auto-endcomments)
	(verilog-leap-to-case-head): Handle "unique0" case.
	(verilog-in-constraint-re): New constant.
	(verilog-keywords, verilog-type-font-keywords):
	Add some SystemVerilog 1800-2012 keywords.
	(verilog-label-be): Remove unimplemented argument, bug669.
	(verilog-batch-execute-func): When batch expanding clear
	create-lockfiles to prevent spurious user locks when a file ends
	up not changing.
	(verilog-calculate-indent, verilog-calc-1)
	(verilog-at-close-constraint-p, verilog-at-constraint-p)
	(verilog-do-indent): Fix indentation of nested constraints
	and structures.
	(verilog-sig-tieoff, verilog-typedef-name-p, verilog-auto-inst)
	(verilog-auto-inst-param): Use verilog-string-match-fold.
	(verilog-read-inst-module-matcher):
	Fix AUTOINST on gate primitives with #1.
	(verilog-read-decls): Fix double-declaring user-defined typed signals.
	Reads all user-defined typed variables.
	(verilog-read-defines): Fix reading definitions inside comments, bug647.
	(verilog-signals-matching-regexp)
	(verilog-signals-not-matching-regexp, verilog-auto):
	Respect verilog-case-fold.
	(verilog-diff-report): Fix line count.
	(verilog-auto-assign-modport): Remove unused local `modi'.
	(verilog-auto-inst-port): Support [][] in AUTO_TEMPLATE to
	better handle multidimensional arrays.
	Fix packed array ports misadding bit index in AUTOINST, bug637.
	(verilog-auto-output, verilog-auto-input): Fix AUTOINPUT and AUTOOUTPUT
	to not double-declare existing outputs and inputs, respectively.
	(verilog-template-map): Bind U to verilog-sk-uvm-component.
	(verilog-sk-uvm-object): Rename from verilog-sk-uvm-class.
	(verilog-sk-uvm-component): New skeleton.
	(verilog-submit-bug-report): Add verilog-case-fold,
	remove verilog-mode-release-date.

2013-10-17  Barry O'Reilly  <gundaetiapo@gmail.com>

	* subr.el (sit-for): Call (input-pending-p t) so as to behave
	as before.

2013-10-18  Reuben Thomas  <rrt@sc3d.org>

	* textmodes/remember.el (remember): Set buffer-offer-save in
	remember buffers (bug#13566).

2013-10-18  Daniel Colascione  <dancol@dancol.org>

	When evaluating forms in ielm, direct standard output to ielm
	buffer.  Add new ielm-return-for-effect command.  Remove trailing
	whitespace throughout.

	* ielm.el (ielm-map): Bind M-RET to ielm-return-for-effect.
	(ielm-return-for-effect): New command.
	(ielm-send-input): Accept optional `for-effect' parameter.
	(ielm-eval-input): Accept optional `for-effect' parameter.
	Bind `standard-output' to stream we create using
	`ielm-standard-output-impl'.  Suppress printing result when
	`for-effect'.
	(ielm-standard-output-impl): New function.
	(inferior-emacs-lisp-mode): Explain new features in documentation.

2013-10-17  Michael Albinus  <michael.albinus@gmx.de>

	Code cleanup.

	* net/tramp.el (tramp-debug-message): Do not check for connection
	buffer.
	(tramp-message): Use "vector" connection property.

	* net/tramp.el (tramp-rfn-eshadow-update-overlay)
	(tramp-equal-remote, tramp-eshell-directory-change)
	* net/tramp-adb.el (tramp-adb-handle-copy-file)
	(tramp-adb-handle-rename-file)
	* net/tramp-cmds.el (tramp-list-remote-buffers)
	(tramp-cleanup-connection, tramp-cleanup-this-connection)
	* net/tramp-compat.el (tramp-compat-process-running-p)
	* net/tramp-ftp.el (tramp-ftp-file-name-handler)
	* net/tramp-gvfs.el (tramp-gvfs-handle-copy-file)
	(tramp-gvfs-handle-rename-file)
	* net/tramp-sh.el (tramp-sh-handle-set-file-times)
	(tramp-set-file-uid-gid)
	* net/tramp-smb.el (tramp-smb-handle-copy-file)
	(tramp-smb-handle-rename-file): Use `tramp-tramp-file-p' instead
	of `file-remote-p'.

	* net/tramp.el (tramp-connectable-p, tramp-handle-file-remote-p)
	* net/tramp-gw.el (tramp-gw-gw-proc-sentinel)
	(tramp-gw-aux-proc-sentinel, tramp-gw-process-filter)
	(tramp-gw-open-network-stream): Suppress unrelated traces.

	* net/tramp-adb.el (tramp-adb-maybe-open-connection)
	* net/tramp-gvfs.el (tramp-gvfs-handle-file-notify-add-watch)
	* net/tramp-sh.el (tramp-do-copy-or-rename-file-out-of-band)
	* net/tramp-smb.el (tramp-smb-maybe-open-connection): Set "vector"
	connection property.

	* net/tramp-cache.el (top): Suppress traces when reading
	persistency file.

	* net/tramp-sh.el (tramp-sh-handle-file-notify-add-watch):
	Refactor common code.  Improve debug message.
	(tramp-maybe-open-connection)
	* net/tramp-smb.el (tramp-smb-call-winexe): Do not request
	connection buffer too early.

	* net/tramp-smb.el (tramp-smb-actions-get-acl): New defconst, renamed
	from `tramp-smb-actions-with-acl'.
	(tramp-smb-actions-set-acl): New defconst.
	(tramp-smb-handle-copy-directory)
	(tramp-smb-action-get-acl): New defun, renamed from
	`tramp-smb-action-with-acl'.
	(tramp-smb-action-set-acl): New defun.
	(tramp-smb-handle-set-file-acl): Rewrite.

2013-10-17  Glenn Morris  <rgm@gnu.org>

	* indent.el (indent-rigidly): Fix 2013-10-08 change.  (Bug#15635)

2013-10-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* skeleton.el (skeleton-newline): Remove.
	(skeleton-internal-1): Use (insert "\n") instead.

	* emacs-lisp/lisp.el (lisp-completion-at-point): Complete var names for
	let-bindings.

	* progmodes/sh-script.el (sh-find-prev-matching): Disable SMIE's
	forward-sexp-function while we redo its job (bug#15613).

2013-10-17  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-comb.el (math-prime-test): Don't assume large integers are
	represented by lists.

2013-10-16  Glenn Morris  <rgm@gnu.org>

	* tmm.el (tmm--history): New dynamic variable.
	(tmm-prompt): Use tmm--history in place of `history'.  (Bug#15623)

2013-10-16  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-smb.el (tramp-smb-acl-program): New customer option.
	(tramp-smb-errors): Add error messages.
	(tramp-smb-actions-with-acl): New defconst.
	(tramp-smb-file-name-handler-alist) <set-file-acl>: Add handler.
	(tramp-smb-action-with-acl, tramp-smb-handle-set-file-acl): New defuns.
	(tramp-smb-handle-file-acl): Rewrite, using "smbcacls".
	(tramp-smb-handle-file-attributes): Simplify test for "stat" capability.
	(tramp-smb-get-stat-capability): Fix tests.

2013-10-16  Dima Kogan  <dima@secretsauce.net>  (tiny change)

	* progmodes/subword.el (subword-capitalize): Fix Stefan's mess
	(bug#15580).

2013-10-16  Glenn Morris  <rgm@gnu.org>

	* ansi-color.el (ansi-color-drop-regexp):
	Add 1J, 1K, 2K.  (Bug#15617)

	* files.el (hack-local-variables--warned-lexical): New.
	(hack-local-variables):
	Warn about misplaced lexical-binding.  (Bug#15616)

	* net/eww.el (eww-render): Always set eww-current-url,
	and update header line.  (Bug#15622)
	(eww-display-html): ... Rather than just doing it here.

2013-10-15  Eli Zaretskii  <eliz@gnu.org>

	* menu-bar.el (tty-menu-navigation-map): Bind mouse wheels to TTY
	menu navigations commands.

2013-10-14  Dima Kogan  <dima@secretsauce.net>  (tiny change)

	* progmodes/subword.el (subword-capitalize): Be careful when
	the search for [[:alpha:]] fails (bug#15580).

2013-10-14  Eli Zaretskii  <eliz@gnu.org>

	* menu-bar.el (tty-menu-navigation-map): Bind shifted mouse clicks
	to commands that scroll the menu.

2013-10-14  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--args-separator-p):
	Handle methods ending with `?' and `!'.

2013-10-14  Akinori MUSHA  <knu@iDaemons.org>

	* progmodes/ruby-mode.el (ruby-encoding-map): Add a mapping from
	`japanese-cp932' to `cp932' to fix the problem where saving a
	source file written in Shift_JIS twice would end up having
	`coding: japanese-cp932' which Ruby could not recognize.
	(ruby-mode-set-encoding): Add support for encodings mapped to nil
	in `ruby-encoding-map'.
	(ruby-encoding-map): Map `us-ascii' to nil by default, meaning it
	doesn't need to be explicitly declared in magic comment.
	(ruby-encoding-map): Add type declaration for better customize UI.

2013-10-13  Glenn Morris  <rgm@gnu.org>

	* progmodes/sh-script.el (sh-mark-line, sh-learn-buffer-indent):
	Occur buffers are read-only.  http://bugs.debian.org/720775

	* emacs-lisp/authors.el (authors-fixed-entries):
	Comment out old alpha stuff.

2013-10-13  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-mode): Add `ruby-mode-set-encoding'
	to `after-save-hook' instead of `before-save-hook'.
	(ruby-mode-set-encoding): Use the value of coding system used to
	write the file.  Call `basic-save-buffer-1' after modifying the
	buffer.

2013-10-13  Alan Mackenzie  <acm@muc.de>

	Fix indentation/fontification of Java enum with
	"implements"/generic.

	* progmodes/cc-engine.el (c-backward-over-enum-header):
	Extracted from the three other places and enhanced to handle generics.
	(c-inside-bracelist-p): Uses new function above.
	* progmodes/cc-fonts.el (c-font-lock-declarations): Uses new
	function above.
	(c-font-lock-enum-tail): Uses new function above.

2013-10-13  Kenichi Handa  <handa@gnu.org>

	* international/mule-cmds.el (select-safe-coding-system): Remove a
	superfluous condition in chekcing whether a coding system is safe
	or not.

2013-10-13  Oleh Krehel  <ohwoeowho@gmail.com>

	* replace.el (how-many): Fix rstart and !rend case.  (Bug#15589)

2013-10-13  Andreas Politz  <politza@hochschule-trier.de>

	* progmodes/sql.el (sql-add-product): Fix paren typo.  (Bug#15435)

2013-10-13  Glenn Morris  <rgm@gnu.org>

	* menu-bar.el (menu-bar-update-buffers):
	Unify Buffers menu prompt string.  (Bug#15576)

	* face-remap.el (text-scale-adjust): Doc fix.  (Bug#15434)

	* emacs-lisp/authors.el (authors-aliases, authors-ignored-files):
	Add some entries.
	(authors-fixed-entries): Use accented form of name.

2013-10-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ruby-mode.el (ruby-smie-grammar): Add rule for paren-free
	method calls (bug#15594).
	(ruby-smie--args-separator-p): New function.
	(ruby-smie--forward-token, ruby-smie--backward-token): Use it to
	recognize paren-free method calls.

	* isearch.el (isearch-pre-command-hook): Don't build in knowledge about
	internals of universal-argument.

2013-10-11  Eli Zaretskii  <eliz@gnu.org>

	* menu-bar.el (tty-menu-navigation-map): Remap F10 to tty-menu-exit.
	Bind all menu-bar sequences to tty-menu-exit -- this pops down a
	dropped menu on second mouse click on the menu bar.

2013-10-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/sh-script.el: Provide simpl(e|istic) completion.
	(explicit-shell-file-name): Declare.
	(sh--vars-before-point, sh--cmd-completion-table): New functions.
	(sh-completion-at-point-function): New function.
	(sh-mode): Use it.
	(sh-smie--keyword-p): Remove unused argument.
	(sh-smie-sh-backward-token, sh-smie-rc-backward-token): Remove unused
	vars.
	(sh-set-shell): Always setup SMIE, even if we use the
	old indentation code.

2013-10-11  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--implicit-semi-p): Split the
	cases of ? and =.
	(ruby-smie-rules): Simplify the "do" rule.  The cases when the
	predicate would return nil are almost non-existent.
	(ruby-smie--redundant-do-p): Include "until" and "for" statements.

	* emacs-lisp/smie.el (smie--matching-block-data): Invalidate the
	cache also after commands that modify the buffer but don't move
	point.

2013-10-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* env.el (substitute-env-in-file-name): New function.
	(substitute-env-vars): Extend the meaning of the optional arg.

2013-10-10  Eli Zaretskii  <eliz@gnu.org>

	* term/w32-win.el (dynamic-library-alist): Define separate lists
	of GIF DLLs for versions before and after 5.0.0 of giflib.
	(Bug#15531)

2013-10-10  João Távora  <joaotavora@gmail.com>

	* vc/vc.el (vc-diff-build-argument-list-internal): If the file is
	not locked, use last revision and current source as
	defaults.  (Bug#15569)

2013-10-10  Masatake YAMATO  <yamato@redhat.com>

	* menu-bar.el (menu-bar-open): Don't use popup-menu if
	menu-bar is hidden.

2013-10-10  Martin Rudalics  <rudalics@gmx.at>

	* window.el (pop-to-buffer-same-window): Fix doc-string.
	(Bug#15492)

2013-10-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* menu-bar.el (tty-menu-navigation-map): Reduce redundancy.

2013-10-10  Andrei Chițu  <andrei.chitu1@gmail.com>  (tiny change)

	* calendar/icalendar.el (icalendar-import-file):
	Fix interactive spec.  (Bug#15482)

2013-10-10  Glenn Morris  <rgm@gnu.org>

	* desktop.el (desktop-save): Default to saving in .emacs.d,
	since PWD is no longer in desktop-path by default.  (Bug#15319)

	* menu-bar.el (menu-bar-options-menu): Remove text-mode auto-fill,
	now that text mode has a menu with the same entry.
	(menu-bar-text-mode-auto-fill): Remove now unused func.
	* textmodes/text-mode.el (text-mode-map):
	Use auto-fill help text from menu-bar.el.

2013-10-10  John Anthony  <john@jo.hnanthony.com>

	* textmodes/text-mode.el (text-mode-map): Add a menu.  (Bug#15562)

2013-10-09  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-pre-command-hook): Use this-single-command-keys
	instead of this-command-keys.  Add universal-argument-more and
	universal-argument-minus to the list of prefix commands.  (Bug#15568)

2013-10-09  Glenn Morris  <rgm@gnu.org>

	* vc/vc-svn.el (vc-svn-create-repo):
	Expand paths in file://... url.  (Bug#15446)

	* emacs-lisp/authors.el (authors-aliases, authors-fixed-case):
	Add some entries.
	(authors): Remove unused local variables.

2013-10-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* profiler.el: Create a more coherent calltree from partial backtraces.
	(profiler-format): Hide the tail with `invisible' so that C-s can still
	find the hidden elements.
	(profiler-calltree-depth): Don't recurse so enthusiastically.
	(profiler-function-equal): New hash-table-test.
	(profiler-calltree-build-unified): New function.
	(profiler-calltree-build): Use it.
	(profiler-report-make-name-part): Indent the calltree less.
	(profiler-report-mode): Add visibility specs for profiler-format.
	(profiler-report-expand-entry, profiler-report-toggle-entry):
	Expand the whole subtree when provided with a prefix arg.

2013-10-09  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-rules): Indent after hanging
	iuwu-mod token.
	(ruby-smie--implicit-semi-p): Prohibit implicit semicolon after
	hanging iuwu-mod token.
	(ruby-smie--forward-token): Do not include a dot after a token in
	that token.
	(ruby-smie--backward-token): Likewise.

2013-10-08  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-help-map, isearch-mode-map): Don't bind [t]
	to isearch-other-control-char.
	(isearch-mode): Add isearch-pre-command-hook to pre-command-hook
	and isearch-post-command-hook to post-command-hook.
	(isearch-done): Remove isearch-pre-command-hook from pre-command-hook
	and isearch-post-command-hook from post-command-hook.
	(isearch-unread-key-sequence)
	(isearch-reread-key-sequence-naturally)
	(isearch-lookup-scroll-key, isearch-other-control-char)
	(isearch-other-meta-char): Remove functions.
	(isearch-pre-command-hook, isearch-post-command-hook):
	New functions based on isearch-other-meta-char rewritten
	relying on the new behavior of overriding-terminal-local-map
	that does not replace the local keymaps any more.  (Bug#15200)

2013-10-08  Eli Zaretskii  <eliz@gnu.org>

	Support menus on text-mode terminals.
	* tmm.el (tmm-menubar): Adapt doc string to TTY menus
	functionality.

	* tooltip.el (tooltip-mode): Don't error out on TTYs.

	* menu-bar.el (popup-menu, popup-menu-normalize-position):
	Move here from mouse.el.
	(popup-menu): Support menu-bar navigation on TTYs using C-f/C-b
	and arrow keys.
	(tty-menu-navigation-map): New map for TTY menu navigation.

	* loadup.el ("tooltip"): Load even if x-show-tip is not available.

	* frame.el (display-mouse-p): Report text-mode mouse as available
	on w32.
	(display-popup-menus-p): Report availability if mouse is
	available; don't condition on window-system.

	* faces.el (tty-menu-enabled-face, tty-menu-disabled-face)
	(tty-menu-selected-face): New faces.

2013-10-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp-mode.el: Font-lock cl-lib constructs.
	(lisp-el-font-lock-keywords, lisp-el-font-lock-keywords-1)
	(lisp-el-font-lock-keywords-2, lisp-cl-font-lock-keywords)
	(lisp-cl-font-lock-keywords-1, lisp-cl-font-lock-keywords-2):
	New constants.
	(lisp-mode-variables): New `elisp' argument.
	(emacs-lisp-mode): Use it.
	* font-lock.el (lisp-font-lock-keywords, lisp-font-lock-keywords-1)
	(lisp-font-lock-keywords-2): Move to lisp-mode.el.

	* indent.el: Use lexical-binding.
	(indent-region): Add progress reporter.
	(tab-stop-list): Make it implicitly extend to infinity by repeating the
	last step.
	(indent--next-tab-stop): New function to implement this behavior.
	(tab-to-tab-stop, move-to-tab-stop): Use it.

2013-10-08  Teemu Likonen  <tlikonen@iki.fi>

	* indent.el (indent-rigidly--current-indentation): New function.
	(indent-rigidly-map): New var.
	(indent-rigidly): Use it to provide interactive mode (bug#8196).

2013-10-08  Bastien Guerry  <bzg@gnu.org>

	* register.el (insert-register): Fix 2013-10-07 change.

2013-10-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/perl-mode.el: Use lexical-binding.
	Remove redundant :group args.
	(perl-nochange): Change default to be closer to other major modes's
	standard behavior.
	(perl-indent-line): Don't consider text on current line as a
	valid beginning of function from which to indent.

	* emacs-lisp/backquote.el (backquote-process): Catch uses of , and ,@
	with more than one argument (bug#15538).

	* mpc.el (mpc-songs-jump-to): Adjust to different playlist format.

	* vc/pcvs.el: Use lexical-binding.
	(cvs-temp-buffer, cvs-make-cvs-buffer): Pass some vars in the lexical
	environment of `eval'.
	(cvs-mode-run, cvs-mode-do): Change `postproc' to be a function rather
	than a list of expressions.  Adjust callers.
	* vc/pcvs-defs.el (cvs-postprocess): Remove, unused.

2013-10-07  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie--implicit-semi-p): Handle the
	case of the dot in a chained method call being on the following line.

2013-10-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-indent-inhibit): New var.
	(electric-indent-post-self-insert-function): Use it.
	* progmodes/python.el (python-mode): Set it.

	* progmodes/ruby-mode.el (ruby-smie-rules): Tweak handling of
	open braces.

	* emacs-lisp/smie.el (smie-next-sexp): Refine last fix.

	* textmodes/css-mode.el (css-smie-rules): Fix indentation (bug#15467).
	(css-mode): Use electric-indent-chars.

	* nxml/nxml-mode.el: Use lexical-binding and syntax-propertize.
	(font-lock-beg, font-lock-end): Move before first use.
	(nxml-mode): Use syntax-propertize-function.
	(nxml-after-change, nxml-after-change1): Adjust accordingly.
	(nxml-extend-after-change-region): Remove.
	* nxml/xmltok.el: Use lexical-binding.
	(xmltok-save): Use `declare'.
	(xmltok-unclosed-reparse-p, xmltok-semi-closed-reparse-p): Remove.
	* nxml/nxml-util.el: Use lexical-binding.
	(nxml-with-degradation-on-error, nxml-with-invisible-motion):
	Use `declare'.
	* nxml/nxml-ns.el: Use lexical-binding.
	(nxml-ns-save): Use `declare'.
	(nxml-ns-prefixes-for): Avoid add-to-list.
	* nxml/rng-match.el: Use lexical-binding.
	(rng--ipattern): Use cl-defstruct.
	(rng-compute-start-tag-open-deriv, rng-compute-start-attribute-deriv)
	(rng-cons-group-after, rng-subst-group-after)
	(rng-subst-interleave-after, rng-apply-after, rng-compute-data-deriv):
	Use closures instead of `(lambda...).

2013-10-07  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-handle-insert-file-contents): Improve handling
	of BEG and END.

	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist):
	Use `tramp-handle-insert-file-contents'.
	(tramp-gvfs-handle-insert-file-contents): Remove function.

	* net/tramp-sh.el (tramp-sh-handle-insert-directory):
	Use `save-restriction' in order to keep markers.

	* net/trampver.el: Update release number.

2013-10-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/compile.el (compilation-parse-errors):
	Use compilation--put-prop.
	(compilation--ensure-parse): Check compilation-multiline.

	* emacs-lisp/easymenu.el (easy-menu-create-menu): Use closures.

	* emacs-lisp/lisp-mode.el (eval-defun-2): Simplify, using
	lexical-binding.

	* emacs-lisp/tq.el (tq-create): Use a closure instead of `(lambda...).

	* progmodes/ruby-mode.el: Fix recently added tests.
	(ruby-smie-grammar): Add - and +.
	(ruby-smie--redundant-do-p, ruby-smie--forward-id)
	(ruby-smie--backward-id): New functions.
	(ruby-smie--forward-token, ruby-smie--backward-token): Use them.
	(ruby-smie-rules): Handle hanging do.  Get rid of hack, not needed
	any more.

2013-10-07  Leo Liu  <sdl.web@gmail.com>

	* register.el (register-preview-delay)
	(register-preview-functions): New variables.
	(register-read-with-preview, register-preview)
	(register-describe-oneline): New functions.
	(point-to-register, window-configuration-to-register)
	(frame-configuration-to-register, jump-to-register)
	(number-to-register, view-register, insert-register)
	(copy-to-register, append-to-register, prepend-to-register)
	(copy-rectangle-to-register): Use register-read-with-preview to
	read register.  (Bug#15525)

2013-10-06  Dato Simó  <dato@net.com.org.es>  (tiny change)

	* net/network-stream.el (network-stream-open-starttls): Don't add
	--insecure if it's already present, because that gnutls-cli
	rejects getting that parameter twice.

2013-10-06  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-smie-rules): Dedent `ensure'
	keyword, too.

2013-10-05  Dmitry Gutov  <dgutov@yandex.ru>

	* newcomment.el (comment-use-global-state): Change default value
	to t, mark obsolete (Bug#15251).
	(comment-beginning): In addition to `comment-to-syntax', check the
	value of `comment-use-global-state'.

2013-10-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ruby-mode.el (ruby-use-smie): Change default.
	(ruby-comment-column): Follow the global default, by default.
	(ruby-smie-grammar): Add assignment syntax.
	(ruby-smie--implicit-semi-p): No implicit semi-colon after an
	open-paren, a comma, or a \.
	(ruby-smie--forward-token, ruby-smie--backward-token): Handle heredocs,
	and line continuations.
	(ruby-smie-rules): Adjust handling of open-paren, now that it's never
	followed by implicit semi-colons.  Add rule for string concatenation
	and for indentation at BOB.
	(ruby-forward-sexp, ruby-backward-sexp): Adjust for when SMIE is in use.

	* emacs-lisp/smie.el (smie-next-sexp): Don't go back to pos before
	calling next-sexp, since next-token may have skipped chars which
	next-sexp doesn't know should be skipped!

2013-10-05  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-send-region):
	Call compilation-forget-errors.

2013-10-04  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-svn.el (vc-svn-find-admin-dir):
	* vc/vc-rcs.el (vc-rcs-find-admin-dir):
	* vc/vc-mtn.el (vc-mtn-find-admin-dir):
	* vc/vc-cvs.el (vc-cvs-find-admin-dir):
	* vc/vc-arch.el (vc-arch-find-admin-dir): New functions.

2013-10-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/css-mode.el (css-smie-rules): Toplevel's a list (bug#15467).

2013-10-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (read-passwd): Hide chars even when called within a context
	where after-change-functions is disabled (bug#15501).
	(set-temporary-overlay-map): Don't remove oneself from pre-command-hook
	until we removed ourself from overriding-terminal-local-map.

2013-10-04  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-mode):
	Call compilation-forget-errors.

2013-10-04  Xue Fuqiao  <xfq.free@gmail.com>

	* emacs-lisp/syntax.el (syntax-ppss): Doc fix.

2013-10-04  Michael Albinus  <michael.albinus@gmx.de>

	* net/secrets.el (secrets-create-collection): Add optional
	argument ALIAS.  Use proper Label keyword.  Append ALIAS as
	dbus-call-method argument.  (Bug#15516)

2013-10-04  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-error-regexp-alist)
	(inferior-octave-compilation-font-lock-keywords): New variables.
	(compilation-error-regexp-alist)
	(compilation-mode-font-lock-keywords): Defvar to pacify compiler.
	(inferior-octave-mode): Use compilation-shell-minor-mode.

2013-10-04  Jorgen Schaefer  <forcer@forcix.cx>

	* minibuffer.el (completion--replace): Be careful that `end' might be
	a marker.

2013-10-03  Daiki Ueno  <ueno@gnu.org>

	Add support for package signature checking.
	* emacs-lisp/package.el (url-http-file-exists-p)
	(epg-make-context, epg-context-set-home-directory)
	(epg-verify-string, epg-context-result-for)
	(epg-signature-status, epg-signature-to-string)
	(epg-check-configuration, epg-configuration)
	(epg-import-keys-from-file): Declare.
	(package-check-signature): New user option.
	(package-unsigned-archives): New user option.
	(package-desc): Add `signed' field.
	(package-load-descriptor): Set `signed' field if .signed file exists.
	(package--archive-file-exists-p): New function.
	(package--check-signature): New function.
	(package-install-from-archive): Check package signature.
	(package--download-one-archive): Check archive signature.
	(package-delete): Remove .signed file.
	(package-import-keyring): New command.
	(package-refresh-contents): Import default keyring.
	(package-desc-status): Add "unsigned" status.
	(describe-package-1, package-menu--print-info)
	(package-menu-mark-delete, package-menu--find-upgrades)
	(package-menu--status-predicate): Support "unsigned" status.

2013-10-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cconv.el (cconv-convert, cconv-analyse-form): Adjust for
	the new compilation scheme using the new byte-codes.

	* emacs-lisp/bytecomp.el (byte-pushcatch, byte-pushconditioncase)
	(byte-pophandler): New byte codes.
	(byte-goto-ops): Adjust accordingly.
	(byte-compile--use-old-handlers): New var.
	(byte-compile-catch): Use new byte codes depending on
	byte-compile--use-old-handlers.
	(byte-compile-condition-case--old): Rename from
	byte-compile-condition-case.
	(byte-compile-condition-case--new): New function.
	(byte-compile-condition-case): New function that dispatches depending
	on byte-compile--use-old-handlers.
	(byte-compile-unwind-protect): Pass a function to byte-unwind-protect
	when we can.

	* emacs-lisp/byte-opt.el (byte-optimize-form-code-walker):
	Optimize under `condition-case' and `catch' if
	byte-compile--use-old-handlers is nil.
	(disassemble-offset): Handle new bytecodes.

2013-10-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (error): Use `declare'.
	(decode-char, encode-char): Use advertised-calling-convention instead
	of the docstring to discourage use of the `restriction' arg.

2013-10-03  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-verify-file): Add a comment saying that it does not
	notify verification error as a return value nor a signal.
	(epg-verify-string): Ditto.

2013-10-02  Kevin Rodgers  <kevin.d.rodgers@gmail.com>

	* progmodes/compile.el (compilation-start): Try globbing the arg to
	`cd' (bug#15417).

2013-10-02  Michael Albinus  <michael.albinus@gmx.de>

	Sync with Tramp 2.2.8.

	* net/tramp-cmds.el (tramp-bug, tramp-append-tramp-buffers):
	* net/tramp-cache.el (tramp-cache-print): Use `tramp-compat-funcall'.
	* net/trampver.el: Update release number.

2013-10-01  Jan Djärv  <jan.h.d@swipnet.se>

	* term/ns-win.el (ns-initialize-window-system): Set locale-coding-system
	and default-process-coding-system for darwin only.

2013-10-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-desc): Simplify (bug#15495).

2013-10-01  Mitchel Humpherys  <mitch.special@gmail.com>  (tiny change)

	* vc/vc-git.el (vc-git-grep): Disable pager.

2013-10-01  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-buffer-info, describe-package-1):
	Use :url instead of :homepage, as per
	https://lists.gnu.org/archive/html/emacs-devel/2013-09/msg00622.html

	* newcomment.el (comment-beginning): When `comment-use-syntax' is
	non-nil, use `syntax-ppss' (Bug#15251).

2013-09-30  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (inferior-octave-startup-file):
	Prefer ~/.emacs.d/init_octave.m.

2013-09-29  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-desc-from-define):
	Accept additional arguments as plist, convert them to an alist and store
	them in the `extras' slot.
	(package-generate-description-file): Convert extras alist back to
	plist and append to the `define-package' form arguments.
	(package--alist-to-plist): New function.
	(package--ac-desc): Add `extras' slot.
	(package--add-to-archive-contents): Check if the archive-contents
	vector is long enough, and if it is, pass its `extras' slot value
	to `package-desc-create'.
	(package-buffer-info): Call `lm-homepage', pass the returned value
	to `package-desc-from-define'.
	(describe-package-1): Render the homepage button (Bug#13291).

	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Pass `extras' slot from `package-desc' to `package-make-ac-desc'.

2013-09-29  Jan Djärv  <jan.h.d@swipnet.se>

	* term/ns-win.el (ns-initialize-window-system): Set locale-coding-system
	and default-process-coding-system to utf-8-unix (Bug#15402).

2013-09-29  Xue Fuqiao  <xfq.free@gmail.com>

	* subr.el (looking-back): Do not recommend using looking-back.

2013-09-28  Alan Mackenzie  <acm@muc.de>

	Fix indentation/fontification of Java enum with "implements".

	* progmodes/cc-langs.el (c-postfix-decl-spec-key): New variable, a
	regexp which matches "implements", etc., in Java.
	* progmodes/cc-engine.el (c-inside-bracelist-p): Check for extra
	specifier clauses coming after "enum".
	* progmodes/cc-fonts.el (c-font-lock-declarations)
	(c-font-lock-enum-tail): Check for extra specifier clauses coming
	after "enum".

2013-09-28  Jan Djärv  <jan.h.d@swipnet.se>

	* faces.el (region): Change ns_selection_color to
	ns_selection_fg_color, add ns_selection_bg_color.

2013-09-28  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-completion-table)
	(inferior-octave-completion-at-point): Minor tweaks.

	* textmodes/ispell.el (ispell-lookup-words): Rename from
	lookup-words.  (Bug#15460)
	(lookup-words): Obsolete.
	(ispell-complete-word, ispell-command-loop): All uses changed.

2013-09-28  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (octave-mode-map): Bind octave-send-buffer.
	(octave-mode-menu): Add octave-send-buffer.
	(octave-send-buffer): New function.

2013-09-28  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (octave-mode-map): Add key binding for
	octave-lookfor.
	(octave-mode-menu): Add octave-lookfor.
	(inferior-octave-mode-map, octave-help-mode-map): Bind C-ha to
	octave-lookfor.
	(octave-lookfor): New function.

2013-09-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl--loop-destr-temps): Remove.
	(cl--loop-iterator-function): Rename from cl--loop-map-form and change
	its convention.
	(cl--loop-set-iterator-function): New function.
	(cl-loop): Adjust accordingly, so as not to use cl-subst.
	(cl--parse-loop-clause): Adjust all uses of cl--loop-map-form.
	Bind `it' with `let' instead of substituting it with `cl-subst'.
	(cl--unused-var-p): New function.
	(cl--loop-let): Don't use the cl--loop-destr-temps hack any more.
	Eliminate some unused variable warnings (bug#15326).

2013-09-27  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el (doc-view-scale-reset): Rename from
	`doc-view-reset-zoom-level'.
	(doc-view-scale-adjust): New command.
	(doc-view-mode-map): Remap `text-scale-adjust' bindings to
	`doc-view-scale-adjust'.

2013-09-26  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el (doc-view-reset-zoom-level): New command.
	(doc-view-mode-map): Remap text-scale-adjust bindings to doc-view
	zoom commands (bug#15466).

2013-09-26  Kenichi Handa  <handa@gnu.org>

	* international/quail.el (quail-help): Make it not a command.

2013-09-26  Leo Liu  <sdl.web@gmail.com>

	* minibuffer.el (completion-all-sorted-completions): Make args
	optional as they are.

2013-09-25  Daniel Colascione  <dancol@dancol.org>

	* emacs-lisp/cl-macs.el (cl-type-spec): Tell edebug what type
	specs are and that they're not evaluated.

2013-09-24  Sam Steingold  <sds@gnu.org>

	* midnight.el (clean-buffer-list-kill-regexps)
	(clean-buffer-list-kill-buffer-names): Update for the new Man
	buffer naming which includes the object name.

2013-09-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* eshell/esh-cmd.el (eshell--sep-terms): New var.
	(eshell-parse-command, eshell-parse-pipeline): Use it since
	eshell-separate-commands requires a dynamic scoped var.
	Reported by Jan Moringen <jmoringe@techfak.uni-bielefeld.de>.

2013-09-23  Leo Liu  <sdl.web@gmail.com>

	* autoinsert.el (auto-insert-alist): Make the value of
	lexical-binding match its file setting.

2013-09-23  Juanma Barranquero  <lekktu@gmail.com>

	* vc/vc-sccs.el (vc-sccs-search-project-dir): Mark unused argument.

	* autoarg.el (autoarg-kp-digit-argument):
	* electric.el (Electric-command-loop):
	* kmacro.el (kmacro-step-edit-insert):
	Do not set universal-argument-num-events.

2013-09-22  Leo Liu  <sdl.web@gmail.com>

	* files.el (interpreter-mode-alist): Add octave.

2013-09-21  Alan Mackenzie  <acm@muc.de>

	C++: fontify identifier in declaration following "public:" correctly.
	* progmodes/cc-langs.el (c-decl-start-colon-kwd-re): New lang var
	to match "public", etc.
	(c-decl-prefix-re): Add ":" into the C++ value.
	* progmodes/cc-engine.el (c-find-decl-prefix-search): Refactor a
	bit.  Add a check for a ":" preceded by "public", etc.

2013-09-21  Eli Zaretskii  <eliz@gnu.org>

	* files.el (auto-mode-alist): Support OBJFILE-gdb.gdb script files
	recognized by GDB 7.5 and later.

2013-09-21  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-dir.el (vc-dir-mode-map): Add keybinding for vc-log-incoming.

2013-09-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (internal--call-interactively): New const.
	(called-interactively-p): Use it (bug#3984).

2013-09-20  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/pcvs.el (cvs-mode-ignore):
	* vc/vc-cvs.el (vc-cvs-ignore, vc-cvs-append-to-ignore):
	Rename cvs-append-to-ignore to vc-cvs-append-to-ignore.

2013-09-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* eshell/em-ls.el: Use advice.  Remove redundant :group keywords.
	(eshell-ls-orig-insert-directory): Remove.
	(eshell-ls-unload-hook): Not a defcustom any more.  Use advice-remove.
	(eshell-ls-use-in-dired): Use advice-add/remove.
	(eshell-ls--insert-directory): Rename from eshell-ls-insert-directory.
	Add `orig-fun' arg for use in :around advice.
	Make it check (redundantly) eshell-ls-use-in-dired.

2013-09-19  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/cl-macs.el (cl-defsubst): Remove unused local `pbody'.

	* simple.el (x-selection-owner-p, x-selection-exists-p): Declare.

	* emacs-lisp/eieio.el (class-parent): Undo previous change.

2013-09-19  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-get-remote-id): Do not raise an error.
	(tramp-get-remote-uid-with-id, tramp-get-remote-gid-with-id)
	(tramp-get-remote-python): New defuns.
	(tramp-get-remote-uid-with-perl)
	(tramp-get-remote-gid-with-perl): New defuns.  Perl code
	contributed by yary <not.com@gmail.com> (tiny change).
	(tramp-get-remote-uid-with-python)
	(tramp-get-remote-gid-with-python): New defuns.  Python code
	contributed by Andrey Tykhonov <atykhonov@gmail.com> (tiny change).
	(tramp-get-remote-uid, tramp-get-remote-gid): Use new defuns.

2013-09-19  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/eieio.el (class-parent): Don't use defalias with macros.

	* eshell/em-unix.el (eshell-remove-entries):
	Rename argument to avoid name-clash with global `top-level'.

	* eshell/esh-proc.el (eshell-kill-process-function):
	Remove eshell-reset-after-proc from eshell-kill-hook if present.
	(eshell-reset-after-proc): Remove unused arg `proc'.

	* eshell/esh-util.el (eshell-read-hosts-file): Use `filename' arg.
	(directory-files-and-attributes): Mark unused arg.

	* eshell/em-unix.el (eshell-remove-entries):
	Remove unused arg `path'.  Update callers.

	* eshell/em-hist.el (eshell-hist-parse-arguments):
	Remove unused arg `silent'.  Update callers.

	* eshell/em-ls.el (eshell-ls-use-in-dired): Use `symbol' arg.
	Fix (f)boundp mix-up.

	* eshell/em-smart.el (eshell-smart-scroll-window)
	(eshell-disable-after-change):
	* eshell/em-term.el (eshell-term-sentinel): Mark unused arg.

2013-09-18  Alan Mackenzie  <acm@muc.de>

	Fix fontification of type when followed by "const".
	* progmodes/cc-engine.el (c-forward-decl-or-cast-1): Don't exclude
	"known" types from fontification.

2013-09-18  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/chart.el (x-display-color-cells): Declare.
	(chart-face-list): Drop Emacsen without display-color-p.

	* net/eww.el (libxml-parse-html-region): Declare.
	(eww-display-html): Explicit error if no libxml2 support.

	* doc-view.el (doc-view-mode): Silence --without-x compilation.

	* image.el (image-type-from-buffer, image-multi-frame-p):
	Remove --without-x warning/error.

	* mouse.el (mouse-yank-primary):
	* term.el (term-mouse-paste):
	Reorder to silence --without-x compilation.

	* mpc.el (doc-view-mode): Silence --without-x compilation.

	* mail/rmailmm.el (rmail-mime-set-bulk-data):
	Silence --without-x compilation.

	* progmodes/gud.el (gud-find-file, gud-mode):
	Silence --without-x compilation.
	(tooltip-mode): Declare.

	* wdired.el (dired-backup-overwrite): Remove declaration.
	(wdired-mode-map): Add doc string.

	* custom.el (x-get-resource): Declare.

	* eshell/em-glob.el (ange-cache):
	* eshell/em-unix.el (ange-cache): Declare.

	* faces.el (x-display-list, x-open-connection, x-get-resource):
	Declare.

	* follow.el (scroll-bar-toolkit-scroll, scroll-bar-drag)
	(scroll-bar-scroll-up, scroll-bar-scroll-down, mwheel-scroll):
	Declare.

	* frame.el (x-display-grayscale-p, x-display-name): Declare.

	* net/gnutls.el (gnutls-log-level): Declare.

	* net/shr.el (image-size, image-animate): Declare.

	* simple.el (font-info): Declare.

	* subr.el (x-popup-dialog): Declare.

	* term/common-win.el (x-select-enable-primary)
	(x-last-selected-text-primary, x-last-selected-text-clipboard):
	Declare.

	* term/ns-win.el (x-handle-args): Declare.

	* term/x-win.el (x-select-enable-clipboard): Declare.

	* term/w32-win.el (create-default-fontset): Declare.

	* w32-common-fns.el (x-server-version, x-select-enable-clipboard):
	Declare.

	* window.el (x-display-pixel-height, tool-bar-lines-needed): Declare.
	(fit-frame-to-buffer): Explicit error if --without-x.
	(mouse-autoselect-window-select): Silence compiler.

	* dframe.el (x-sensitive-text-pointer-shape, x-pointer-shape): Declare.

	* eshell/em-cmpl.el (eshell-complete-parse-arguments):
	* eshell/em-hist.el (eshell/history, eshell-isearch-backward):
	* eshell/em-pred.el (eshell-parse-modifiers, eshell-pred-file-time):
	* eshell/esh-util.el (eshell-sublist):
	Remove unused local variables.

	* eshell/esh-io.el (x-select-enable-clipboard): Declare.

	* textmodes/two-column.el: Make 2C-split work for --without-x.
	(scroll-bar-columns): Autoload.
	(top-level): Require fringe when compiling.

2013-09-18  Leo Liu  <sdl.web@gmail.com>

	* subr.el (add-hook): Robustify to handle closure as well.

2013-09-17  Glenn Morris  <rgm@gnu.org>

	* simple.el (messages-buffer-mode-map): Unbind "g".

2013-09-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help-mode.el (help-mode-finish): Use derived-mode-p.
	Remove obsolete highlighting.

	* play/life.el (life-mode): Use define-derived-mode.  Derive from
	special-mode.
	(life): Let-bind inhibit-read-only.
	(life-setup): Avoid `setq'.  Use `life-mode'.

	* emacs-lisp/package.el (package-generate-autoloads): Remove `require'
	which should not be needed any more.
	(package-menu-refresh, package-menu-describe-package): Use user-error.

	* eshell/esh-cmd.el (eshell-post-rewrite-command-function): New var.
	(eshell-post-rewrite-command-hook): Make obsolete.
	(eshell-parse-command): Simplify.
	(eshell-structure-basic-command): Remove unused arg `vocal-test'.
	(eshell--cmd): Declare.
	(eshell-parse-pipeline): Remove unused var `final-p'.
	Pass a dynvar to eshell-post-rewrite-command-hook.
	Implement the new eshell-post-rewrite-command-function.
	(eshell-invoke-directly): Remove unused arg `input'.
	* eshell/esh-io.el (eshell-io-initialize):
	Use eshell-post-rewrite-command-function (bug#15399).
	(eshell--apply-redirections): Rename from eshell-apply-redirections;
	adjust to new calling convention.
	(eshell-create-handles): Rename args to avoid clashing with dynvar
	`standard-output'.

2013-09-17  Glenn Morris  <rgm@gnu.org>

	* simple.el (messages-buffer-mode): New major mode.
	(messages-buffer): New function.
	* startup.el (normal-top-level): Switch mode of *Messages* buffer.
	* emacs-lisp/ert.el (ert--force-message-log-buffer-truncation)
	(ert-run-test): Use `messages-buffer' function.
	(ert--force-message-log-buffer-truncation): Ignore read-only.
	* help.el (view-echo-area-messages): Use `messages-buffer' function.
	* mail/emacsbug.el (report-emacs-bug): Use `messages-buffer' function.

2013-09-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (eval-after-load): Preserve evaluation order (bug#15389).

	* abbrev.el (abbrev--check-chars): Fix thinko (bug#15360).

2013-09-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* icomplete.el (icomplete-in-buffer): New var.
	(icomplete-pre-command-hook, icomplete-post-command-hook): Remove those
	vars and replace them with functions.
	(icomplete-minibuffer-setup): Adjust accordingly.
	(icomplete--completion-table, icomplete--completion-predicate)
	(icomplete--field-string, icomplete--field-beg, icomplete--field-end):
	New functions.
	(icomplete-forward-completions, icomplete-backward-completions)
	(icomplete-simple-completing-p, icomplete-exhibit)
	(icomplete-completions): Use them.
	(icomplete--in-region-buffer): New var.
	(icomplete--in-region-setup): New function.
	(icomplete-mode): Use it.

	* eshell/esh-opt.el: Fix last change to set lexical-vars properly
	(bug#15379).
	(eshell--do-opts): Rename from eshell-do-opt, remove arg `body-fun',
	return args and options.
	(eshell-eval-using-options): Use the new return value of
	eshell--do-opts to set the options's vars in their scope.
	(eshell--set-option): Rename from eshell-set-option.
	Add arg `opt-vals'.
	(eshell--process-option): Rename from eshell-process-option.
	Add arg `opt-vals'.
	(eshell--process-args): Use an `opt-vals' alist to store the options's
	values during their processing and return them additionally to the
	remaining args.

2013-09-15  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-operator-re): Consider line
	continuation character an operator, as far as indentation is
	concerned (Bug#15369).

2013-09-15  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--state-put-2): Don't process buffer state
	when buffer doesn't exist any more (Bug#15382).

2013-09-15  Glenn Morris  <rgm@gnu.org>

	* eshell/em-unix.el (eshell/rm):
	Make -f ignore missing files.  (Bug#15373)

	* eshell/esh-cmd.el (eshell--local-vars): New variable.  (Bug#15372)
	(eshell-rewrite-for-command): Add for loop vars to eshell--local-vars.
	* eshell/esh-var.el (eshell-get-variable): Respect eshell--local-vars.

2013-09-14  Glenn Morris  <rgm@gnu.org>

	* eshell/esh-var.el (eshell-variable-aliases-list): Fix doc typo.

2013-09-13  Glenn Morris  <rgm@gnu.org>

	* dired-x.el (dired-guess-shell-alist-user): Doc fix.
	(dired-guess-default): Make `file' available in the env.  (Bug#15363)

2013-09-13  Dmitry Antipov  <dmantipov@yandex.ru>

	* frame.el (x-focus-frame): Mark as declared in frame.c.

2013-09-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ls-lisp.el: Use advice-add.
	(original-insert-directory): Remove.
	(ls-lisp--insert-directory): Rename from insert-directory; add
	`orig-fun' argument.
	(insert-directory): Advise.

2013-09-13  Eli Zaretskii  <eliz@gnu.org>

	* term.el (term-emulate-terminal): Decode the command string
	before passing it to term-command-hook.  (Bug#15337)

2013-09-13  Glenn Morris  <rgm@gnu.org>

	* eshell/esh-util.el (ange-cache): Move declaration earlier.

	* eshell/esh-ext.el (eshell-search-path): Declare.

	* eshell/em-prompt.el (eshell/pwd): Autoload it.
	Otherwise an error occurs if eshell-dirs module not loaded.

	* progmodes/gdb-mi.el (gud-cont, gud-step): Declare.

2013-09-13  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-check-proper-method-and-host): Rename it from
	`tramp-check-proper-host'.  Check for a valid method name.

	* net/tramp-adb.el (tramp-adb-maybe-open-connection):
	* net/tramp-gvfs.el (tramp-gvfs-maybe-open-connection):
	* net/tramp-sh.el (tramp-maybe-open-connection):
	* net/tramp-smb.el (tramp-smb-maybe-open-connection): Call it.

	* net/tramp-cache.el (tramp-cache-print): Don't print text properties
	also for hash values.

2013-09-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* term/ns-win.el (parameters): Don't declare as dynamic.
	(before-make-frame-hook): Don't add ineffective function.

	* eshell/*.el: Use lexical-binding (bug#15231).

2013-09-12  Kenichi Handa  <handa@gnu.org>

	* composite.el (compose-gstring-for-graphic): Handle enclosing mark.

2013-09-12  Glenn Morris  <rgm@gnu.org>

	* vc/vc-svn.el (vc-svn-dir-status-files, vc-svn-dir-extra-headers)
	(vc-svn-ignore, vc-svn-retrieve-tag): Mark unused arguments.

	* subr.el (do-after-load-evaluation): Also give compiler warnings
	when obsolete files are used (except by obsolete files).

	* vc/vc-svn.el (vc-svn-parse-status): If there are multiple files
	in the status output, assume `filename' is the first.  (Bug#15322)

	* vc/vc.el (vc-deduce-fileset): Doc fix.

	* calc/calc-help.el (Info-goto-node):
	* progmodes/cperl-mode.el (Info-find-node):
	* vc/ediff.el (Info-goto-node): Update declarations.

	* vc/vc-dispatcher.el (vc-dir-refresh): Declare.

	* vc/vc-bzr.el (vc-compilation-mode): Declare.
	(vc-bzr-pull): Require vc-dispatcher.
	* vc/vc-git.el (vc-compilation-mode): Declare.
	(vc-git-pull): Require vc-dispatcher.

	* progmodes/ruby-mode.el (ruby-syntax-propertize-function): Declare.

	* progmodes/octave.el (help-button-action): Declare.

	* shell.el (shell-directory-tracker): Output error as a message
	rather than just returning it as a string.
	(shell-process-pushd): Remove useless use of message.

	* dframe.el (dframe-timer-fn):
	* files.el (dir-locals-read-from-file):
	* mpc.el (mpc--status-timer-run, mpc--status-idle-timer-run)
	(mpc-format):
	* reveal.el (reveal-post-command):
	* saveplace.el (load-save-place-alist-from-file):
	* shell.el (shell-resync-dirs):
	* w32-common-fns.el (x-get-selection-value):
	* emacs-lisp/copyright.el (copyright-find-copyright):
	* emacs-lisp/eldoc.el (eldoc-print-current-symbol-info):
	* emulation/tpu-edt.el (tpu-copy-keyfile):
	* play/bubbles.el (bubbles--mark-neighbourhood):
	* progmodes/executable.el
	(executable-make-buffer-file-executable-if-script-p):
	* term/pc-win.el (x-get-selection-value): Use with-demoted-errors.

2013-09-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	Cleanup Eshell to rely less on dynamic scoping.
	* eshell/esh-opt.el (eshell-eval-using-options): Don't bind usage-msg,
	last-value, and ext-command here.  Bind `args' closer to `body'.
	(temp-args, last-value, usage-msg, ext-command, args): Don't defvar.
	(eshell--args): Declare new dynamic var.
	(eshell-do-opt): Add argument `args'.  Bind our own usage-msg,
	last-value, and ext-command.  Pass `args' to `body'.
	(eshell-process-args): Bind eshell--args.
	(eshell-set-option): Use eshell--args.
	* eshell/eshell.el (eshell): Use derived-mode-p.
	* eshell/esh-var.el (eshell-parse-variable): Use backquote.
	(eshell-parse-variable-ref): Remove unused vars `end' and `err'.
	(eshell-glob-function): Declare.
	* eshell/esh-util.el: Require cl-lib.
	(eshell-read-hosts-file): Avoid add-to-list.
	* eshell/esh-cmd.el (eshell-parse-lisp-argument): Remove unused var
	`err'.
	* eshell/em-unix.el (compilation-scroll-output, locate-history-list):
	Declare.
	(eshell/diff): Remove unused var `err'.
	* eshell/em-rebind.el (eshell-delete-backward-char): Remove unused arg
	`killflag'.
	* eshell/em-pred.el (eshell-parse-modifiers): Remove unused var `err'.
	* eshell/em-ls.el (eshell-ls-highlight-alist): Move defvars before
	first use.
	* eshell/em-glob.el (eshell-glob-matches, message-shown):
	Move declaration before first use.
	* eshell/em-alias.el (eshell-maybe-replace-by-alias): Use backquotes.
	* autorevert.el (auto-revert-notify-handler): Use `cl-dolist' since we
	rely on cl-return.

2013-09-12  Glenn Morris  <rgm@gnu.org>

	* term/ns-win.el (global-map): Remove binding for ispell-next,
	deleted 1999-05-29.  (Bug#15357)

2013-09-11  Glenn Morris  <rgm@gnu.org>

	* echistory.el (electric-command-history): Remove call to deleted func.

	* play/landmark.el (landmark-mode): Fix typos.

	* vc/vc-cvs.el (cvs-append-to-ignore): Fix arg spec.
	Check cvs-sort-ignore-file is bound.

	* savehist.el: No need for cl when compiling on Emacs.

2013-09-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* eshell/esh-mode.el (eshell-mode-syntax-table): Fix up initialization
	(bug#15338).
	(eshell-self-insert-command, eshell-send-invisible):
	Remove unused argument.
	(eshell-handle-control-codes): Remove unused var `orig'.
	Avoid delete-backward-char.

	* files.el (set-auto-mode): Simplify a bit further.

2013-09-11  Glenn Morris  <rgm@gnu.org>

	* files.el (interpreter-mode-alist): Remove \\` \\' parts.
	(set-auto-mode): Don't regexp-quote elements.
	* progmodes/python.el (interpreter-mode-alist): Remove \\` \\'.
	* progmodes/cc-mode.el (interpreter-mode-alist):
	* progmodes/ruby-mode.el (interpreter-mode-alist):
	Revert previous change.

2013-09-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* play/snake.el (snake-mode):
	* play/mpuz.el (mpuz-mode):
	* play/landmark.el (lm-mode):
	* play/blackbox.el (blackbox-mode):
	* play/5x5.el (5x5-mode):
	* obsolete/options.el (Edit-options-mode):
	* net/quickurl.el (quickurl-list-mode):
	* net/newst-treeview.el (newsticker-treeview-mode):
	* mail/rmailsum.el (rmail-summary-mode):
	* mail/mspools.el (mspools-mode):
	* locate.el (locate-mode):
	* ibuffer.el (ibuffer-mode):
	* emulation/ws-mode.el (wordstar-mode):
	* emacs-lisp/debug.el (debugger-mode):
	* array.el (array-mode):
	* net/eudc.el (eudc-mode): Use define-derived-mode.
	* net/mairix.el (mairix-searches-mode-font-lock-keywords):
	Move initialization into declaration.
	(mairix-searches-mode): Use define-derived-mode.
	* net/eudc-hotlist.el (eudc-hotlist-mode): Use define-derived-mode.
	(eudc-edit-hotlist): Use dolist.
	* man.el (Man-mode-syntax-table): Rename from man-mode-syntax-table.
	(Man-mode): Use define-derived-mode.
	* info.el (Info-edit-mode-map): Rename from Info-edit-map.
	(Info-edit-mode): Use define-derived-mode.
	(Info-cease-edit): Use Info-mode.
	* eshell/esh-mode.el (eshell-mode-syntax-table): Move initialization
	into declaration.
	(eshell-mode): Use define-derived-mode.
	* chistory.el (command-history-mode-map): Rename from
	command-history-map.
	(command-history-mode): Use define-derived-mode.
	(Command-history-setup): Remove function.
	* calc/calc.el (calc-trail-mode-map): New var.
	(calc-trail-mode): Use define-derived-mode.
	(calc-trail-buffer): Set calc-main-buffer manually.
	* bookmark.el (bookmark-insert-annotation): New function.
	(bookmark-edit-annotation): Use it.
	(bookmark-edit-annotation-mode): Make it a proper major mode.
	(bookmark-send-edited-annotation): Use derived-mode-p.
	* arc-mode.el (archive-mode): Move kill-all-local-variables a tiny bit
	closer to its ideal place.  Use \' to match EOS.

	* profiler.el (profiler-calltree-find): Use function-equal.

2013-09-10  Glenn Morris  <rgm@gnu.org>

	* files.el (interpreter-mode-alist): Convert to regexps.
	(set-auto-mode): Adapt for this.  (Bug#15306)
	* progmodes/cperl-mode.el (cperl-clobber-mode-lists):
	Comment out unused variable.
	* progmodes/cc-mode.el (interpreter-mode-alist):
	* progmodes/python.el (interpreter-mode-alist):
	* progmodes/ruby-mode.el (interpreter-mode-alist): Convert to regexps.
	* progmodes/sh-script.el (sh-set-shell):
	No longer use interpreter-mode-alist to get list of shells.

	* progmodes/cc-mode.el (awk-mode): Remove duplicate autoload.

2013-09-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el: Use set-temporary-overlay-map for universal-argument.
	(universal-argument-map): Don't use default-bindings (bug#15317).
	Bind switch-frame explicitly.  Replace universal-argument-minus with
	a conditional binding.
	(universal-argument-num-events, saved-overriding-map): Remove.
	(restore-overriding-map): Remove.
	(universal-argument--mode): Rename from save&set-overriding-map,
	and rewrite.
	(universal-argument, universal-argument-more, negative-argument)
	(digit-argument): Adjust accordingly.
	(universal-argument-minus): Remove.
	(universal-argument-other-key): Remove.

	* subr.el (with-demoted-errors): Add `format' argument.

2013-09-10  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-cleanup): Remove.  Functionality added to
	`tramp-cleanup-connection'.

	* net/tramp-cmds.el (tramp-cleanup-connection): Add optional
	parameters KEEP-DEBUG and KEEP-PASSWORD.

	* net/tramp.el (tramp-file-name-handler):
	* net/tramp-adb.el (tramp-adb-maybe-open-connection):
	* net/tramp-sh.el (tramp-open-connection-setup-interactive-shell)
	(tramp-maybe-open-connection):
	* net/tramp-smb.el (tramp-smb-maybe-open-connection):
	Use `tramp-cleanup-connection'.

	* net/tramp-sh.el (tramp-maybe-open-connection):
	Catch 'uname-changed inside the progress reporter.

2013-09-10  Glenn Morris  <rgm@gnu.org>

	* simple.el (read-minibuffer): Unbreak it.  (Bug#15318)

	* dired-x.el (dired-mark-sexp): Unbreak for systems where ls
	returns "alternate access method" in mode (eg "-rw-r--r--.").

2013-09-08  Glenn Morris  <rgm@gnu.org>

	* saveplace.el (load-save-place-alist-from-file):
	Demote errors.  (Bug#15305)

2013-09-08  Michael Albinus  <michael.albinus@gmx.de>

	Improve compatibility with older Emacsen, and XEmacs.

	* net/tramp.el (tramp-find-method, tramp-find-user): Call `propertize'
	only if it is bound.  It isn't for XEmacs.
	(with-tramp-progress-reporter): Do not let-bind `result'.
	This yields to scoping errors in XEmacs.
	(tramp-handle-make-auto-save-file-name): New function, moved from
	tramp-sh.el.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist): Add handler
	for `make-auto-save-file-name'.
	(tramp-adb--gnu-switches-to-ash):
	Use `tramp-compat-replace-regexp-in-string'.

	* net/tramp-cache.el (tramp-cache-print): Call
	`substring-no-properties' only if it is bound.  It isn't for XEmacs.

	* net/tramp-cmds.el (tramp-bug): Call `propertize' only if it is
	bound.  It isn't for XEmacs.

	* net/tramp-compat.el (tramp-compat-copy-file):
	Catch `wrong-number-of-arguments' error.
	(tramp-compat-replace-regexp-in-string): New defun.

	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist): Add handler
	for `make-auto-save-file-name'.
	(tramp-gvfs-handle-copy-file): Use `tramp-compat-funcall' for
	`copy-file'.
	(tramp-gvfs-file-gvfs-monitor-file-process-filter)
	(tramp-gvfs-file-name): Use `tramp-compat-replace-regexp-in-string'.
	(tramp-synce-list-devices): Use `push' instead of `pushnew'.

	* net/tramp-gw.el (tramp-gw-open-network-stream):
	Use `tramp-compat-replace-regexp-in-string'.

	* net/tramp-sh.el (tramp-sh-file-name-handler-alist):
	Call `tramp-handle-make-auto-save-file-name'.
	(tramp-sh-handle-make-auto-save-file-name): Move to tramp.el.
	(tramp-sh-file-gvfs-monitor-dir-process-filter)
	(tramp-sh-file-inotifywait-process-filter):
	Use `tramp-compat-replace-regexp-in-string'.
	(tramp-compute-multi-hops): Use `push' instead of `pushnew'.

	* net/tramp-smb.el (tramp-smb-file-name-handler-alist): Add handler
	for `make-auto-save-file-name'.
	(tramp-smb-handle-copy-directory):
	Call `tramp-compat-replace-regexp-in-string'.
	(tramp-smb-get-file-entries): Use `push' instead of `pushnew'.
	(tramp-smb-handle-copy-file): Improve error message.
	(tramp-smb-handle-rename-file): Rename directly only in case
	`newname' does not exist yet.  This is a restriction of smbclient.
	(tramp-smb-maybe-open-connection): Rerun the function only when
	`auth-sources' is non-nil.

2013-09-08  Kenichi Handa  <handa@gnu.org>

	* international/characters.el: Set category "^" (Combining) for
	more characters.

2013-09-07  Alan Mackenzie  <acm@muc.de>

	Correctly fontify Java class constructors.
	* progmodes/cc-langs.el (c-type-decl-suffix-key): Now matches ")"
	in Java Mode.
	(c-recognize-typeless-decls): Set the Java value to t.
	* progmodes/cc-engine.el (c-forward-decl-or-cast-1):
	While handling a "(", add a check for, effectively, Java, and handle a
	"typeless" declaration there.

2013-09-07  Roland Winkler  <winkler@gnu.org>

	* textmodes/bibtex.el (bibtex-biblatex-entry-alist): Add optional
	field subtitle for entry type book.

2013-09-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el: Make minibuffer-complete call completion-in-region
	rather than other way around.
	(completion--some, completion-pcm--find-all-completions):
	Don't delay signals when debugging.
	(minibuffer-completion-contents): Beware fields within the
	minibuffer contents.
	(completion-all-sorted-completions): Use defvar-local.
	(completion--do-completion, completion--cache-all-sorted-completions)
	(completion-all-sorted-completions, minibuffer-force-complete):
	Add args `beg' and `end'.
	(completion--in-region-1): New fun, extracted from minibuffer-complete.
	(minibuffer-complete): Use completion-in-region.
	(completion-complete-and-exit): New fun, extracted from
	minibuffer-complete-and-exit.
	(minibuffer-complete-and-exit): Use it.
	(completion--complete-and-exit): Rename from
	minibuffer--complete-and-exit.
	(completion-in-region--single-word): New function, extracted from
	minibuffer-complete-word.
	(minibuffer-complete-word): Use it.
	(display-completion-list): Make `common-substring' argument obsolete.
	(completion--in-region): Call completion--in-region-1 instead of
	minibuffer-complete.
	(completion-help-at-point): Pass boundaries to
	minibuffer-completion-help as args rather than via an overlay.
	(completion-pcm--string->pattern): Use `any-delim'.
	(completion-pcm--optimize-pattern): New function.
	(completion-pcm--pattern->regex): Handle `any-delim'.
	* icomplete.el (icomplete-forward-completions)
	(icomplete-backward-completions, icomplete-completions):
	Adjust calls to completion-all-sorted-completions and
	completion--cache-all-sorted-completions.
	(icomplete-with-completion-tables): Default to t.
	* emacs-lisp/crm.el (crm--current-element): Rename from
	crm--select-current-element.  Don't put an overlay but return the
	boundaries instead.
	(crm--completion-command): Take two new args to bind to the boundaries.
	(crm-completion-help): Adjust accordingly.
	(crm-complete): Use completion-in-region.
	(crm-complete-word): Use completion-in-region--single-word.
	(crm-complete-and-exit): Use completion-complete-and-exit.

2013-09-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* dired-x.el (dired-mark-sexp): Bind the vars lexically rather
	than dynamically.

2013-09-06  Juri Linkov  <juri@jurta.org>

	* info.el (Info-display-images-node): When image file doesn't exist
	display text version of the image if it's provided in the Info file.
	Otherwise, display the location of missing image from SRC attribute.
	Add help-echo text property from ALT attribute.  (Bug#15279)

2013-09-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* abbrev.el (edit-abbrevs-mode-map): Rename from edit-abbrevs-map.
	(edit-abbrevs-mode): Use define-derived-mode.

	* epa.el (epa--encode-coding-string, epa--decode-coding-string)
	(epa--select-safe-coding-system, epa--derived-mode-p): Make it obvious
	that it's defined.
	(epa-key-list-mode, epa-key-mode, epa-info-mode):
	Use define-derived-mode.

	* epg.el (epg-start-encrypt): Minor CSE simplification.

2013-09-06  William Xu  <william.xwl@gmail.com>

	* arc-mode.el: Add support for 7za (bug#15264).
	(archive-7z-program): New var.
	(archive-zip-extract, archive-zip-expunge, archive-zip-update)
	(archive-zip-update-case, archive-7z-extract, archive-7z-expunge)
	(archive-7z-update, archive-zip-extract, archive-7z-summarize): Use it.

2013-09-06  Michael Albinus  <michael.albinus@gmx.de>

	Remove URL syntax.

	* net/tramp.el (tramp-syntax, tramp-prefix-format)
	(tramp-postfix-method-format, tramp-prefix-ipv6-format)
	(tramp-postfix-ipv6-format, tramp-prefix-port-format)
	(tramp-postfix-host-format, tramp-file-name-regexp)
	(tramp-completion-file-name-regexp)
	(tramp-completion-dissect-file-name)
	(tramp-handle-substitute-in-file-name): Remove 'url case.
	(tramp-file-name-regexp-url)
	(tramp-completion-file-name-regexp-url): Remove constants.

2013-09-06  Glenn Morris  <rgm@gnu.org>

	* replace.el (replace-string): Doc fix re start/end.  (Bug#15275)

2013-09-05  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Move "Perl-ish
	keywords" below "here-doc beginnings" (Bug#15270).

2013-09-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (pop): Use `car-safe'.
	* emacs-lisp/byte-opt.el (byte-optimize-form-code-walker): Remove hack
	to detect unused `pop' return value.

	* progmodes/python.el (python-nav-beginning-of-block): Remove unused
	var `block-regexp'.
	(python-nav--forward-sexp): Remove unused var `re-search-fn'.
	(python-fill-string): Remove unused var `marker'.
	(python-skeleton-add-menu-items): Remove unused var `items'.

	* international/mule-cmds.el: Require CL.
	(find-coding-systems-for-charsets): Avoid add-to-list.
	(sanitize-coding-system-list): New function, extracted from
	select-safe-coding-system-interactively.
	(select-safe-coding-system-interactively): Use it.
	(read-input-method-name): Accept symbols for `default'.

	* emacs-lisp/advice.el (defadvice): Add indent rule.

2013-09-05  Daniel Hackney  <dan@haxney.org>

	* dired-x.el:
	* net/ange-ftp.el:
	* net/browse-url.el:
	* net/dbus.el:
	* net/eudc.el:
	* net/eudcb-ldap.el:
	* net/eww.el:
	* net/imap.el:
	* printing.el:
	* vc/ediff-diff.el:
	* vc/ediff-init.el:
	* vc/ediff-merg.el:
	* vc/ediff-mult.el:
	* vc/ediff-util.el:
	* vc/ediff-wind.el:
	* vc/ediff.el:
	* vc/emerge.el:
	* vc/pcvs.el:
	* vc/vc-annotate.el: Prefix unused arguments with `_' to silence
	byte compiler.  Remove some unused let-bound variables.

2013-09-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cconv.el: Use `car-safe' rather than `car' to access
	a "ref-cell", since it gets better optimized (bug#14883).

2013-09-05  Glenn Morris  <rgm@gnu.org>

	* progmodes/cc-awk.el (c-forward-sws): Declare.

2013-09-04  Glenn Morris  <rgm@gnu.org>

	* generic-x.el [rul-generic-mode]: Require cc-mode.
	(c++-mode-syntax-table): Declare.
	(rul-generic-mode-syntax-table): Init in the defvar.

2013-09-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-dispatcher.el (vc-run-delayed): New macro.
	(vc-do-command, vc-set-async-update):
	* vc/vc-mtn.el (vc-mtn-dir-status):
	* vc/vc-hg.el (vc-hg-dir-status, vc-hg-dir-status-files)
	(vc-hg-pull, vc-hg-merge-branch):
	* vc/vc-git.el (vc-git-dir-status-goto-stage, vc-git-pull)
	(vc-git-merge-branch):
	* vc/vc-cvs.el (vc-cvs-print-log, vc-cvs-dir-status)
	(vc-cvs-dir-status-files):
	* vc/vc-bzr.el (vc-bzr-pull, vc-bzr-merge-branch, vc-bzr-dir-status)
	(vc-bzr-dir-status-files):
	* vc/vc-arch.el (vc-arch-dir-status): Use vc-run-delayed.
	* vc/vc-annotate.el: Use lexical-binding.
	(vc-annotate-display-select, vc-annotate): Use vc-run-delayed.
	(vc-sentinel-movepoint): Declare.
	(vc-annotate): Don't use `goto-line'.
	* vc/vc.el (vc-diff-internal): Prefer a closure to `(lambda...).
	(vc-diff-internal, vc-log-internal-common): Use vc-run-delayed.
	(vc-sentinel-movepoint): Declare.
	* vc/vc-svn.el: Use lexical-binding.
	(vc-svn-dir-status, vc-svn-dir-status-files): Use vc-run-delayed.
	* vc/vc-sccs.el:
	* vc/vc-rcs.el: Use lexical-binding.

	* autorevert.el (auto-revert-notify-handler): Explicitly ignore
	`deleted'.  Don't drop errors silently.

	* emacs-lisp/gv.el (gv-get): Warn about CL-compiled places.

2013-09-04  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc.el (vc-ignore): Rewrite.
	(vc-default-ignore): New function.
	(vc-default-ignore-completion-table): Use find-ignore-file.

	* vc/vc-bzr.el (vc-bzr-ignore, vc-bzr-ignore-completion-table):
	* vc/vc-git.el (vc-git-ignore, vc-git-ignore-completion-table):
	* vc/vc-hg.el (vc-hg-ignore, vc-hg-ignore-completion-table):
	Remove.  Most code moved to vc.el.

2013-09-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* net/tramp-gvfs.el (tramp-gvfs-mount-spec, tramp-synce-list-devices):
	* net/tramp-smb.el (tramp-smb-get-file-entries):
	* net/tramp-sh.el (tramp-sh-handle-insert-directory)
	(tramp-compute-multi-hops): Fix misuses of `add-to-list'.

	* net/eww.el (eww-display-raw): Remove unused argument `charset'.
	Update call to it.
	(eww-change-select): Remove unused var `properties'.
	(eww-make-unique-file-name): Remove unused var `base'.

	* finder.el (finder-compile-keywords): Don't mess with windows.

	* calculator.el (calculator-funcall): Fix typo in last change.

	* vc/vc-git.el (vc-git-checkin): Make it possible to commit a merge.

	* emacs-lisp/package.el (package-activate-1): Don't let a missing
	<pkg>-autoloads.el file stop us.

	* net/tramp.el (with-parsed-tramp-file-name): Silence compiler
	warnings, and factor out common code.

2013-09-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-calculate-indent): Consider
	two-character operators and whether the character preceding them
	changes their meaning (Bug#15208).

2013-09-02  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	Format code sent to Python shell for robustness.
	* progmodes/python.el (python-shell-buffer-substring):
	New function.
	(python-shell-send-region, python-shell-send-buffer): Use it.

2013-09-02  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-compat.el (tramp-compat-user-error): Move it ...
	* net/tramp.el (tramp-user-error): ... here.
	(tramp-find-method, tramp-check-proper-host)
	(tramp-dissect-file-name, tramp-debug-message)
	(tramp-handle-shell-command):
	* net/tramp-adb.el (tramp-adb-handle-shell-command):
	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler): Adapt callees.

	* net/tramp-cache.el (tramp-cache-print): Don't print text properties.

2013-09-02  Martin Rudalics  <rudalics@gmx.at>

	* avoid.el (mouse-avoidance-point-position)
	(mouse-avoidance-too-close-p): Handle case where posn-at-point
	returns nil.

2013-09-02  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-shell-completion-get-completions):
	Drop use of deleted `comint-last-prompt-overlay'.
	(python-nav-if-name-main): New command.

2013-09-01  Glenn Morris  <rgm@gnu.org>

	* Makefile.in (setwins, setwins_almost, setwins_for_subdirs):
	Avoid leading space in $wins.  Otherwise the sed command used by
	eg compile-main ends up containing "/*.el".  (Bug#15170)

	* frame.el (frame-background-mode): Doc fix.  (Bug#15226)

2013-08-30  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-recompile-directory):
	Fix is-this-a-directory logic.  (Bug#15220)

2013-08-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/css-mode.el: Use SMIE.
	(css-smie-grammar): New var.
	(css-smie--forward-token, css-smie--backward-token)
	(css-smie-rules): New functions.
	(css-mode): Use them.
	(css-navigation-syntax-table): Remove var.
	(css-backward-sexp, css-forward-sexp, css-indent-calculate-virtual)
	(css-indent-calculate, css-indent-line): Remove functions.

	Misc changes to reduce use of `(lambda...); and other cleanups.
	* cus-edit.el: Use lexical-binding.
	(customize-push-and-save, customize-apropos)
	(custom-buffer-create-internal): Use closures.
	* progmodes/bat-mode.el (bat-mode-syntax-table): "..." are strings.
	* progmodes/ada-xref.el: Use setq.
	* net/tramp.el (with-tramp-progress-reporter): Avoid setq.
	* dframe.el: Use lexical-binding.
	(dframe-frame-mode): Fix calling convention for hooks.  Use a closure.
	* speedbar.el (speedbar-frame-mode): Adjust call accordingly.
	* descr-text.el: Use lexical-binding.
	(describe-text-widget, describe-text-sexp, describe-property-list):
	Use closures.
	* comint.el (comint-history-isearch-push-state): Use a closure.
	* calculator.el: Use lexical-binding.
	(calculator-number-to-string): Make it work with lexical-binding.
	(calculator-funcall): Same and use cl-letf.

	* emacs-lisp/lisp.el (lisp--company-doc-buffer)
	(lisp--company-doc-string, lisp--company-location): New functions.
	(lisp-completion-at-point): Use them to improve Company support.

	* progmodes/ruby-mode.el (ruby-smie-grammar): Add rule for formal
	params of lambda expressions.
	(ruby-smie--implicit-semi-p): Refine rule (bug#15208).
	(ruby-smie--opening-pipe-p): New function.
	(ruby-smie--forward-token, ruby-smie--backward-token): Handle Ruby
	symbols and matched |...| for formal params.
	(ruby-smie-rules): Don't let the formal params of a "do" prevent it
	from being treated as hanging.  Handle "rescue".

2013-08-29  Glenn Morris  <rgm@gnu.org>

	* progmodes/cc-engine.el (c-pull-open-brace):
	Move definition before use.

2013-08-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-macs.el (cl-defsubst): Make it clear that args
	are immutable.  Don't use `unsafe' any more.
	(cl--defsubst-expand): Don't substitute at the same time as keeping
	a residual unused let-binding.  Don't use `unsafe' any more.

2013-08-29  Glenn Morris  <rgm@gnu.org>

	* calendar/cal-china.el (calendar-chinese-year-cache):
	Recenter on 2015.

	* nxml/nxml-util.el (nxml-debug-clear-inside):
	Use cl-loop rather than loop.

	* net/eww.el (eww-mode-map): Lower-case menu bar entries look bad.

	* progmodes/sh-script.el (sh-builtins) <bash>: Add some bash4-isms.

2013-08-28  Glenn Morris  <rgm@gnu.org>

	* progmodes/antlr-mode.el: No need to require cc-mode twice.

	* progmodes/cc-bytecomp.el (cc-require): Handle uncompiled case.

	* progmodes/cc-mode.el (c-define-abbrev-table): Handle NAME unbound.

2013-08-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (repeat-complex-command--called-interactively-skip):
	New function.
	(repeat-complex-command): Use it (bug#14136).

	* progmodes/cc-mode.el: Minor cleanup of var declarations.
	(c-define-abbrev-table): Add `doc' argument.
	(c-mode-abbrev-table, c++-mode-abbrev-table)
	(objc-mode-abbrev-table, java-mode-abbrev-table)
	(idl-mode-abbrev-table, pike-mode-abbrev-table)
	(awk-mode-abbrev-table): Use it.
	(c-mode-syntax-table, c-mode-map, c++-mode-syntax-table)
	(c++-mode-map, objc-mode-syntax-table, objc-mode-map)
	(java-mode-syntax-table, java-mode-map, idl-mode-syntax-table)
	(idl-mode-map, pike-mode-syntax-table, pike-mode-map, awk-mode-map):
	Move initialization into the declaration; and remove any
	autoload cookie.

	* epg.el (epg--process-filter): Use with-current-buffer, save-excursion
	and dynamic let binding.

	* vc/smerge-mode.el: Remove redundant :group args.

	* emacs-lisp/package.el (package-activate-1): Don't add unnecessarily
	to load-path.

2013-08-28  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-reread-key-sequence-naturally): Use non-nil
	arg DONT-DOWNCASE-LAST of `read-key-sequence'.
	(isearch-other-meta-char): Handle an undefined shifted printing
	character by downshifting it.  (Bug#15200)

2013-08-28  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-search): Change regexp error message for
	non-regexp searches.  (Bug#15166)

2013-08-28  Paul Eggert  <eggert@cs.ucla.edu>

	* Makefile.in (SHELL): Now @SHELL@, not /bin/sh,
	for portability to hosts where /bin/sh has problems.

2013-08-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cconv.el (cconv--analyse-function): Improve warning.

2013-08-27  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-other-meta-char): Don't store kmacro commands
	in the keyboard macro.  (Bug#15126)

2013-08-27  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-quote-char): Comment out converting unibyte
	to multibyte, thus syncing with its `quoted-insert' counterpart.
	(Bug#15166)

2013-08-27  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-use-some-window): Add missing
	argument in call of get-largest-window (Bug#15185).
	Reported by Stephen Leake.

2013-08-27  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/package.el (package-buffer-info): Fix message typo.

2013-08-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/python.el (python-font-lock-keywords): Don't return nil
	from a matcher-function unless there's no more matches (bug#15161).

2013-08-26  Michael Albinus  <michael.albinus@gmx.de>

	* minibuffer.el: Revert change from 2013-08-20.

	* net/tramp.el (tramp-find-method, tramp-find-user): Mark result
	with text property `tramp-default', if appropriate.
	(tramp-check-proper-host): New defun.
	(tramp-dissect-file-name): Do not check hostname.  Revert change
	of 2013-03-18.
	(tramp-backtrace): Make VEC-OR-PROC optional.

	* net/tramp-adb.el (tramp-adb-maybe-open-connection):
	* net/tramp-gvfs.el (tramp-gvfs-maybe-open-connection):
	* net/tramp-sh.el (tramp-maybe-open-connection):
	* net/tramp-smb.el (tramp-smb-maybe-open-connection):
	Apply `tramp-check-proper-host'.

2013-08-26  Tassilo Horn  <tsdh@gnu.org>

	* epa-hook.el (epa-file-encrypt-to): Quote `safe-local-variable'
	lambda expression in order to have `describe-variable' display it.

2013-08-26  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-verify-visited-file-modtime):
	BUF can be optional.  (Bug#15186)

2013-08-25  Xue Fuqiao  <xfq.free@gmail.com>

	* progmodes/flymake.el (flymake-get-real-file-name-function):
	Fix broken customization.  (Bug#15184)

2013-08-25  Alan Mackenzie  <acm@muc.de>

	Improve indentation of bracelists defined by macros (without "=").

	* progmodes/cc-engine.el (c-inside-bracelist-p): When a macro
	expansion begins with "{", regard it as bracelist when it doesn't
	contain a ";".

	Parse C++ inher-intro when there's a template split over 2 lines.

	* progmodes/cc-engine.el (c-guess-basic-syntax CASE 5C): Code more
	rigorously the search for "class" etc. followed by ":".

	* progmodes/cc-langs.el (c-opt-<>-sexp-key): Make the value for
	random languages a regexp which never matches rather than nil.

	Handle "/"s more accurately in test for virtual semicolons (AWK Mode).

	* progmodes/cc-awk.el (c-awk-one-line-possibly-open-string-re)
	(c-awk-regexp-one-line-possibly-open-char-list-re)
	(c-awk-one-line-possibly-open-regexp-re)
	(c-awk-one-line-non-syn-ws*-re): Remove.
	(c-awk-possibly-open-string-re, c-awk-non-/-syn-ws*-re)
	(c-awk-space*-/-re, c-awk-space*-regexp-/-re)
	(c-awk-space*-unclosed-regexp-/-re): New constants.
	(c-awk-at-vsemi-p): Reformulate better to recognize "/"s which
	aren't regexp delimiters.

	* progmodes/cc-engine.el (c-crosses-statement-barrier-p): Add in
	handling for a rare situation in AWK Mode involving unterminated
	strings/regexps.

2013-08-23  Glenn Morris  <rgm@gnu.org>

	* files.el (auto-mode-alist): Use sh-mode for .bash_history.

	* files.el (interpreter-mode-alist): Use tcl-mode for expect scripts.

	* files.el (create-file-buffer): If the result would begin with
	spaces, prepend a "|" instead of removing them.  (Bug#15162)

2013-08-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/fill.el (fill-match-adaptive-prefix): Don't throw away
	text-properties (bug#15155).

	* calc/calc-keypd.el (calc-keypad-execute): `x-flush-mouse-queue' doesn't
	exist any more.
	(calc-keypad-redraw): Remove unused var `pad'.
	(calc-keypad-press): Remove unused var `menu'.

2013-08-23  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-pop-up-frame):
	Call pop-up-frame-function with BUFFER current so `make-frame' will
	use it as the new frame's buffer (Bug#15133).

2013-08-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* calendar/timeclock.el: Minor cleanups.
	(timeclock-ask-before-exiting, timeclock-use-display-time):
	Use `symbol'.
	(timeclock-modeline-display): Define as alias before the
	actual definition.
	(timeclock-mode-line-display): Use define-minor-mode.
	(timeclock-day-list-template): Make it a function, add an argument.
	(timeclock-day-list-required, timeclock-day-list-length)
	(timeclock-day-list-debt, timeclock-day-list-span)
	(timeclock-day-list-break): Adjust calls accordingly.

2013-08-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/pp.el (pp-eval-expression, pp-macroexpand-expression):
	Use read--expression so that completion works again.

2013-08-21  Sam Steingold  <sds@gnu.org>

	Add rudimentary inferior shell interaction
	* progmodes/sh-script.el (sh-shell-process): New buffer-local variable.
	(sh-set-shell): Reset it.
	(sh-show-shell, sh-cd-here, sh-send-line-or-region-and-step):
	New commands (bound to C-c C-z, C-c C-d, and C-c C-n).

2013-08-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* align.el: Use lexical-binding.
	(align-region): Simplify accordingly.

2013-08-20  Michael Albinus  <michael.albinus@gmx.de>

	* minibuffer.el (completion--sifn-requote): Bind `non-essential'.

	* rfn-eshadow.el (rfn-eshadow-update-overlay): Move binding of
	`non-essential' up.

2013-08-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el:
	* net/tramp-adb.el:
	* net/tramp-cmds.el:
	* net/tramp-ftp.el:
	* net/tramp-gvfs.el:
	* net/tramp-gw.el:
	* net/tramp-sh.el: Don't wrap external variable declarations by
	`eval-when-compile'.

2013-08-16  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-rescale-image): Use ImageMagick even for GIFs
	now that Emacs supports ImageMagick animations.

2013-08-16  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cmds.el (top): Don't declare `buffer-name'.
	(tramp-append-tramp-buffers): Rewrite buffer local variables part.

2013-08-16  Martin Rudalics  <rudalics@gmx.at>

	* window.el (mouse-autoselect-window-select): Do autoselect when
	mouse pointer is on margin.

2013-08-16  William Parsons  <wbparsons@alum.mit.edu>  (tiny change)

	* net/ange-ftp.el (ange-ftp-skip-msgs): Add 500 EPSV.  (Bug#1972)

2013-08-16  Glenn Morris  <rgm@gnu.org>

	* net/ange-ftp.el (ange-ftp-good-msgs, ange-ftp-get-pwd):
	Handle "Remote Directory" response of some clients.  (Bug#15058)

	* emacs-lisp/bytecomp.el (byte-compile-make-variable-buffer-local):
	Tweak warning.  (Bug#14926)

	* menu-bar.el (send-mail-item-name, read-mail-item-name): Remove.
	(menu-bar-tools-menu): Simplify news and mail items.  (Bug#15095)

	* image-mode.el (image-mode-map): Add menu items to reverse,
	increase, decrease, reset animation speed.
	(image--set-speed, image-increase-speed, image-decrease-speed)
	(image-reverse-speed, image-reset-speed): New functions.
	(image-mode-map): Add bindings for speed commands.

	* image.el (image-animate-get-speed, image-animate-set-speed):
	New functions.
	(image-animate-timeout): Respect image :speed property.

2013-08-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/debug.el (debugger-setup-buffer): Put point on the
	previous line (bug#15101).
	(debugger-eval-expression, debugger-record-expression):
	Use read--expression (bug#15102).

2013-08-15  Michael Albinus  <michael.albinus@gmx.de>

	Remove byte compiler warnings, visible when compiling with
	`byte-compile-force-lexical-warnings' set to t.

	* net/tramp.el (tramp-debug-message, tramp-message, tramp-error)
	(tramp-error-with-buffer): Rename ARGS to ARGUMENTS and BUFFER to BUF.
	(tramp-handle-unhandled-file-name-directory)
	(tramp-handle-file-notify-add-watch, tramp-action-login)
	(tramp-action-succeed, tramp-action-permission-denied)
	(tramp-action-terminal, tramp-action-process-alive): Prefix unused
	arguments with "_".

	* net/tramp-adb.el (tramp-adb-parse-device-names)
	(tramp-adb-handle-insert-directory, tramp-adb-handle-delete-file)
	(tramp-adb-handle-copy-file): Prefix unused arguments with "_".
	(tramp-adb-handle-file-truename): Remove unused arguments.

	* net/tramp-cache.el (tramp-flush-directory-property)
	(tramp-flush-connection-property, tramp-list-connections)
	(tramp-parse-connection-properties): Prefix unused arguments with "_".

	* net/tramp-compat.el (tramp-compat-make-temp-file):
	Rename FILENAME to F.

	* net/tramp-gvfs.el (tramp-gvfs-handle-file-notify-add-watch)
	(tramp-gvfs-handle-write-region, tramp-bluez-parse-device-names)
	(tramp-zeroconf-parse-workstation-device-names)
	(tramp-zeroconf-parse-webdav-device-names)
	(tramp-synce-parse-device-names): Prefix unused arguments with "_".

	* net/tramp-gw.el (tramp-gw-gw-proc-sentinel)
	(tramp-gw-aux-proc-sentinel): Prefix unused arguments with "_".

	* net/tramp-sh.el (tramp-sh-handle-file-truename): Remove unused
	arguments.
	(tramp-sh-handle-copy-file, tramp-sh-handle-dired-compress-file)
	(tramp-sh-handle-insert-file-contents-literally)
	(tramp-sh-handle-file-notify-add-watch): Prefix unused arguments
	with "_".
	(tramp-do-copy-or-rename-file, tramp-barf-if-no-shell-prompt):
	Remove unused variables.

	* net/tramp-smb.el (tramp-smb-handle-copy-directory)
	(tramp-smb-handle-copy-file, tramp-smb-handle-delete-file)
	(tramp-smb-read-file-entry): Prefix unused arguments with "_".

	* net/tramp-uu.el (tramp-uu-b64-alphabet, tramp-uu-b64-char-to-byte):
	Make them a defconst.
	(tramp-uuencode-region): Remove unused variable.

2013-08-14  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--prop-setter): New function.
	(frameset-prop): Add gv-setter declaration.
	(frameset-filter-minibuffer): Deal with the case that the minibuffer
	parameter was already set in FILTERED.  Doc fix.
	(frameset--record-minibuffer-relationships): Allow saving a
	minibufferless frame without its corresponding minibuffer frame.
	(frameset--reuse-frame): Accept a match from an orphaned minibufferless
	frame, if the frame id matches.
	(frameset--minibufferless-last-p): Sort non-orphaned minibufferless
	frames before orphaned ones.
	(frameset-restore): Warn about orphaned windows, instead of error out.

2013-08-14  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-make-atom): Don't overwrite parameter
	already present.
	(display-buffer-in-atom-window): Handle special case where we
	split an already atomic window.
	(window--major-non-side-window, display-buffer-in-side-window)
	(window--side-check): Ignore minibuffer window when walking
	window tree.
	(window-deletable-p): Return 'frame only if no other frame uses
	our minibuffer window.
	(record-window-buffer): Run buffer-list-update-hook.
	(split-window): Make sure window--check-frame won't destroy an
	existing atomic window in case the new window gets nested
	inside.
	(display-buffer-at-bottom): Ignore minibuffer window when
	walking window tree.  Don't split a side window.
	(pop-to-buffer): Don't set-buffer here, the select-window call
	should do that.
	(mouse-autoselect-window-select): Autoselect only if we are in the
	text portion of the window.

2013-08-13  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-parse-image-data): New function to grab both the
	data itself and the Content-Type.
	(shr-put-image): Use it.

	* net/eww.el (eww-display-image): Ditto.

	* image.el (image-content-type-suffixes): New variable.

2013-08-13  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-imenu--build-tree)
	(python-imenu--put-parent): Simplify and Fix (GH bug 146).

2013-08-13  Xue Fuqiao  <xfq.free@gmail.com>

	* simple.el (backward-word): Mention the optional argument.

2013-08-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* frameset.el (frameset--make): Rename constructor from make-frameset.
	(frameset-p, frameset-valid-p): Don't autoload.
	(frameset-valid-p): Use normal accessors.

2013-08-13  Glenn Morris  <rgm@gnu.org>

	* progmodes/compile.el (compile-command): Tweak example in doc.
	* obsolete/scribe.el (scribe-mode):
	* progmodes/mixal-mode.el (mixal-mode): Quote buffer name.  (Bug#15053)

	* mail/feedmail.el (feedmail-confirm-outgoing)
	(feedmail-display-full-frame, feedmail-deduce-bcc-where): Fix types.

	* cus-start.el (truncate-partial-width-windows): Fix type.

	* emulation/viper-init.el (viper-search-scroll-threshold): Fix type.

	* net/shr.el (shr-table-horizontal-line): Fix custom type.

2013-08-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/timer.el (timer--time-setter): New function.
	(timer--time): Use it as gv-setter.

	* emacs-lisp/gv.el (gv-define-simple-setter): Output warning when
	setter is not a symbol.

2013-08-12  Grégoire Jadi  <daimrod@gmail.com>

	* mail/sendmail.el (sendmail-send-it): Don't kill the error buffer
	if sending fails.  This makes debugging easier.

2013-08-12  Juanma Barranquero  <lekktu@gmail.com>

	* xml.el (xml-parse-tag-1): Use looking-at (this reverts change in
	2013-08-11T00:07:48Z!lekktu@gmail.com, which breaks the test suite).
	https://lists.gnu.org/archive/html/emacs-devel/2013-08/msg00263.html

2013-08-12  Eli Zaretskii  <eliz@gnu.org>

	* term/w32-win.el (dynamic-library-alist): Add DLLs for zlib.

2013-08-12  Glenn Morris  <rgm@gnu.org>

	* format.el (format-annotate-function):
	Handle read-only text properties in the source.  (Bug#14887)

2013-08-11  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-display-html): Ignore coding system errors.
	One web site uses "utf-8lias" as the coding system.

2013-08-11  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-valid-p): Fix check; STATES can indeed be nil.

2013-08-10  Juanma Barranquero  <lekktu@gmail.com>

	* tutorial.el (tutorial--describe-nonstandard-key): Use string-match-p.
	(tutorial--detailed-help): Remove unused local variables.
	(tutorial--save-tutorial-to): Use ignore-errors.
	(help-with-tutorial): Use looking-at-p.

	* view.el (view-buffer-other-window, view-buffer-other-frame):
	Mark unused arguments.

	* woman.el (woman-parse-colon-path, woman-parse-colon-path)
	(woman-select-symbol-fonts, woman, woman-find-file)
	(woman-insert-file-contents, woman-non-underline-faces):
	Use string-match-p.
	(woman1-unquote): Move declaration.

	* xml.el (xml-parse-tag-1, xml-parse-string): Use looking-at-p.
	(xml-parse-dtd): Use looking-at-p, string-match-p.  Mark unused
	argument.  Remove unused local variable.
	(xml-parse-elem-type): Use string-match-p.
	(xml-substitute-numeric-entities): Use ignore-errors.

	* calculator.el (calculator): Mark unused argument.
	(calculator-paste, calculator-quit, calculator-integer-p):
	Use ignore-errors.
	(calculator-string-to-number, calculator-decimal, calculator-exp)
	(calculator-op-or-exp): Use string-match-p.

	* dired.el (dired-buffer-more-recently-used-p): Declare.
	(dired-insert-set-properties, dired-insert-old-subdirs):
	Use ignore-errors.

	* dired-aux.el (dired-compress): Use ignore-errors.
	(dired-do-chxxx, dired-do-chmod, dired-trample-file-versions)
	(dired-do-async-shell-command, dired-do-shell-command)
	(dired-shell-stuff-it, dired-compress-file, dired-insert-subdir)
	(dired-insert-subdir-validate): Use string-match-p.
	(dired-map-dired-file-lines, dired-subdir-hidden-p): Use looking-at-p.
	(dired-add-entry): Use string-match-p, looking-at-p.
	(dired-insert-subdir-newpos): Remove unused local variable.

	* filenotify.el (file-notify-callback): Remove unused local variable.

	* filesets.el (filesets-error): Mark unused argument.
	(filesets-which-command-p, filesets-filter-dir-names)
	(filesets-directory-files, filesets-get-external-viewer)
	(filesets-ingroup-get-data): Use string-match-p.

	* find-file.el (ff-other-file-name, ff-other-file-name)
	(ff-find-the-other-file, ff-cc-hh-converter):
	Remove unused local variables.
	(ff-get-file-name): Use string-match-p.
	(ff-all-dirs-under): Use ignore-errors.

	* follow.el (follow-comint-scroll-to-bottom): Mark unused argument.
	(follow-select-if-visible): Remove unused local variable.

	* forms.el (read-file-filter): Move declaration.
	(forms--make-format, forms--make-parser, forms-insert-record):
	Quote function with #'.
	(forms--update): Use string-match-p.  Quote function with #'.

	* help-mode.el (help-dir-local-var-def): Mark unused argument.
	(help-make-xrefs): Use looking-at-p.
	(help-xref-on-pp): Use looking-at-p, ignore-errors.

	* ibuffer.el (ibuffer-ext-visible-p): Declare.
	(ibuffer-confirm-operation-on): Use string-match-p.

	* msb.el (msb-item-handler, msb-dired-item-handler):
	Mark unused arguments.

	* ses.el (ses-decode-cell-symbol)
	(ses-kill-override): Remove unused local variable.
	(ses-create-cell-variable, ses-relocate-formula): Use string-match-p.
	(ses-load): Use ignore-errors, looking-at-p.
	(ses-jump-safe): Use ignore-errors.
	(ses-export-tsv, ses-export-tsf, ses-unsafe): Mark unused arguments.

	* tabify.el (untabify, tabify): Mark unused arguments.

	* thingatpt.el (thing-at-point--bounds-of-well-formed-url):
	Mark unused argument.
	(bounds-of-thing-at-point, thing-at-point-bounds-of-list-at-point)
	(thing-at-point-newsgroup-p, form-at-point): Use ignore-errors.

	* emacs-lisp/timer.el (timer--time): Define setter with
	gv-define-setter to avoid deprecation warning.

	* completion.el: Remove stuff unused since revno:3176 (1993-05-27).
	(*record-cmpl-statistics-p*): Remove (was commented out).
	(cmpl-statistics-block): Remove (body was commented out).
	All callers changed.
	(add-completions-from-buffer, load-completions-from-file):
	Remove unused variables.

2013-08-09  Juanma Barranquero  <lekktu@gmail.com>

	* filecache.el (file-cache-delete-file-list):
	Print message only when told so.
	(file-cache-files-matching): Use #' in mapconcat argument.

	* ffap.el (ffap-url-at-point): Fix reference to variable
	thing-at-point-default-mail-uri-scheme.

2013-08-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (define-error): New function.
	* progmodes/ada-xref.el (ada-error-file-not-found): Rename from
	error-file-not-found and define with define-error.
	* emacs-lisp/cl-lib.el (cl-assertion-failed): Move here from subr.el
	and define with define-error.
	* userlock.el (file-locked, file-supersession):
	* simple.el (mark-inactive):
	* progmodes/js.el (js-moz-bad-rpc, js-js-error):
	* progmodes/ada-mode.el (ada-mode-errors):
	* play/life.el (life-extinct):
	* nxml/xsd-regexp.el (xsdre-invalid-regexp, xsdre-parse-error):
	* nxml/xmltok.el (xmltok-markup-declaration-parse-error):
	* nxml/rng-util.el (rng-error):
	* nxml/rng-uri.el (rng-uri-error):
	* nxml/rng-match.el (rng-compile-error):
	* nxml/rng-cmpct.el (rng-c-incorrect-schema):
	* nxml/nxml-util.el (nxml-error, nxml-file-parse-error):
	* nxml/nxml-rap.el (nxml-scan-error):
	* nxml/nxml-outln.el (nxml-outline-error):
	* net/soap-client.el (soap-error):
	* net/gnutls.el (gnutls-error):
	* net/ange-ftp.el (ftp-error):
	* mpc.el (mpc-proc-error):
	* json.el (json-error, json-readtable-error, json-unknown-keyword)
	(json-number-format, json-string-escape, json-string-format)
	(json-key-format, json-object-format):
	* jka-compr.el (compression-error):
	* international/quail.el (quail-error):
	* international/kkc.el (kkc-error):
	* emacs-lisp/ert.el (ert-test-failed):
	* calc/calc.el (calc-error, inexact-result, math-overflow)
	(math-underflow):
	* bookmark.el (bookmark-error-no-filename):
	* epg.el (epg-error): Define with define-error.

	* time.el (display-time-event-handler)
	(display-time-next-load-average): Don't call sit-for since it seems
	unnecessary (bug#15045).

	* emacs-lisp/checkdoc.el: Remove redundant :group keywords.
	Use #' instead of ' to quote functions.
	(checkdoc-output-mode): Use setq-local.
	(checkdoc-spellcheck-documentation-flag, checkdoc-ispell-lisp-words)
	(checkdoc-verb-check-experimental-flag, checkdoc-proper-noun-regexp)
	(checkdoc-common-verbs-regexp): Mark safe-local-variable (bug#15010).
	(checkdoc-ispell, checkdoc-ispell-current-buffer)
	(checkdoc-ispell-interactive, checkdoc-ispell-message-interactive)
	(checkdoc-ispell-message-text, checkdoc-ispell-start)
	(checkdoc-ispell-continue, checkdoc-ispell-comments)
	(checkdoc-ispell-defun): Remove unused arg `take-notes'.

	* ido.el (ido-completion-help): Fix up compiler warning.

2013-08-09  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-p): Add autoload cookie.
	(frameset--jump-to-register): New function, based on code moved from
	register.el.
	(frameset-to-register): Move from register.el.  Adapt to `registerv'.

	* register.el (frameset-frame-id, frameset-frame-with-id, frameset-p)
	(frameset-restore, frameset-save, frameset-session-filter-alist):
	Remove declarations.
	(register-alist): Doc fix.
	(frameset-to-register): Move to frameset.el.
	(jump-to-register, describe-register-1): Remove frameset-specific code.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* allout-widgets.el (allout-widgets-pre-command-business)
	(allout-widgets-post-command-business)
	(allout-widgets-after-change-handler)
	(allout-decorate-item-and-context, allout-set-boundary-marker)
	(allout-body-modification-handler)
	(allout-graphics-modification-handler): Mark ignored arguments.
	(allout-widgets-post-command-business)
	(allout-widgets-exposure-change-processor)
	(allout-widgets-exposure-undo-processor)
	(allout-decorate-item-and-context, allout-redecorate-visible-subtree)
	(allout-parse-item-at-point, allout-decorate-item-guides)
	(allout-decorate-item-cue, allout-item-span): Remove unused variables.
	* allout.el (epa-passphrase-callback-function): Declare.
	(allout-overlay-insert-in-front-handler)
	(allout-overlay-interior-modification-handler)
	(allout-isearch-end-handler, allout-chart-siblings)
	(allout-up-current-level, allout-end-of-level, allout-reindent-body)
	(allout-yank-processing, allout-process-exposed)
	(allout-latex-verb-quote, allout-latexify-one-item, outlineify-sticky)
	(allout-latex-verbatim-quote-curr-line): Remove unused variables.
	* emacs-lisp/lisp-mode.el (lisp-eval-defun, last-sexp-toggle-display)
	(lisp-indent-defform): Mark ignored arguments.
	(lisp-indent-line): Mark ignored arguments.  Remove unused variables.
	(calculate-lisp-indent): Remove unused variables.
	* international/characters.el (indian-2-column, arabic-2-column)
	(tibetan): Mark ignored arguments.
	(use-cjk-char-width-table): Mark ignored arguments.
	Remove unused variables.
	* international/fontset.el (build-default-fontset-data)
	(x-compose-font-name, create-fontset-from-fontset-spec):
	Mark ignored arguments.
	(fontset-plain-name): Remove unused variables.
	* international/mule.el (charset-id, charset-bytes, generic-char-p)
	(keyboard-coding-system): Mark ignored arguments.
	(find-auto-coding): Remove unused variables.  Use `ignore-errors'.
	* help.el (resize-temp-buffer-window):
	* window.el (display-buffer-in-major-side-window)
	(display-buffer-in-side-window, display-buffer-in-previous-window):
	Remove unused variables.
	* isearch.el (isearch-forward-symbol):
	* version.el (emacs-bzr-version-bzr):
	* international/mule-cmds.el (current-language-environment):
	* term/common-win.el (x-handle-iconic, x-handle-geometry)
	(x-handle-display):
	* term/pc-win.el (x-list-fonts, x-display-planes)
	(x-display-color-cells, x-server-max-request-size, x-server-vendor)
	(x-server-version, x-display-screens, x-display-mm-height)
	(x-display-mm-width, x-display-backing-store, x-display-visual-class)
	(x-selection-owner-p, x-own-selection-internal)
	(x-disown-selection-internal, x-get-selection-internal)
	(msdos-initialize-window-system):
	* term/tty-colors.el (tty-color-alist, tty-color-clear):
	* term/x-win.el (x-handle-no-bitmap-icon):
	* vc/vc-hooks.el (vc-mode, vc-default-make-version-backups-p)
	(vc-default-find-file-hook, vc-default-extra-menu):
	Mark ignored arguments.

2013-08-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-debugger): Use edebug-eval to run the
	break-condition in the context of the debugged code (bug#12685).

2013-08-08  Christopher Schmidt  <christopher@ch.ristopher.com>

	* comint.el:
	Do not use an overlay to highlight the last prompt.  (Bug#14744)
	(comint-mode): Make comint-last-prompt buffer local.
	(comint-last-prompt): New variable.
	(comint-last-prompt-overlay): Remove.  Superseded by
	comint-last-prompt.
	(comint-snapshot-last-prompt, comint-output-filter):
	Use comint-last-prompt.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-valid-p): Check vector length.  Doc fix.
	(frameset-save): Check validity of the resulting frameset.

2013-08-08  Xue Fuqiao  <xfq.free@gmail.com>

	* ido.el (ido-record-command): Add doc string.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset): Do not disable creation of the default
	frameset-p predicate.  Doc fix.
	(frameset-valid-p): New function, copied from the old predicate-p.
	Add additional checks.
	(frameset-restore): Check with frameset-valid-p.
	(frameset-p, frameset-version, frameset-timestamp, frameset-app)
	(frameset-name, frameset-description, frameset-properties)
	(frameset-states): Add docstring.
	(frameset-session-filter-alist, frameset-persistent-filter-alist)
	(frameset-filter-alist): Doc fixes.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-p, frameset-prop): Doc fixes.

2013-08-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/bytecomp.el (byte-compile-function-warn): New function,
	extracted from byte-compile-callargs-warn and byte-compile-normal-call.
	(byte-compile-callargs-warn, byte-compile-function-form): Use it.
	(byte-compile-normal-call): Remove obsolescence check.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-restore): Doc fix.

	* register.el (frameset-frame-id, frameset-frame-with-id)
	(frameset-p, frameset-restore, frameset-save): Declare.
	(register-alist): Document framesets.
	(frameset-session-filter-alist): Declare.
	(frameset-to-register): New function.
	(jump-to-register): Implement jumping to framesets.  Doc fix.
	(describe-register-1): Describe framesets.

	* bindings.el (ctl-x-r-map): Bind ?f to frameset-to-register.

2013-08-07  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-save-frameset): Use new frameset-save args.
	Use lexical-binding.

	* frameset.el (frameset): Use type vector, not list (incompatible
	change).  Do not declare a new constructor, use the default one.
	Upgrade suggested properties `app', `name' and `desc' to slots `app',
	`name' and `description', respectively, and add read-only slot
	`timestamp'.  Doc fixes.
	(frameset-copy, frameset-persistent-filter-alist)
	(frameset-filter-alist, frameset-switch-to-gui-p)
	(frameset-switch-to-tty-p, frameset-filter-tty-to-GUI)
	(frameset-filter-sanitize-color, frameset-filter-minibuffer)
	(frameset-filter-iconified, frameset-keep-original-display-p):
	Doc fixes.
	(frameset-filter-shelve-param, frameset-filter-unshelve-param):
	Rename from frameset-filter-(save|restore)-param.  All callers changed.
	Doc fix.
	(frameset-p): Adapt to change to vector and be more thorough.
	Change arg name to OBJECT.  Doc fix.
	(frameset-prop): Rename arg PROP to PROPERTY.  Doc fix.
	(frameset-session-filter-alist): Rename from frameset-live-filter-alist.
	All callers changed.
	(frameset-frame-with-id): Rename from frameset-locate-frame-id.
	All callers changed.
	(frameset--record-minibuffer-relationships): Rename from
	frameset--process-minibuffer-frames.  All callers changed.
	(frameset-save): Add new keyword arguments APP, NAME and DESCRIPTION.
	Use new default constructor (again).  Doc fix.
	(frameset--find-frame-if): Rename from `frameset--find-frame'.
	All callers changed.
	(frameset--reuse-frame): Rename arg FRAME-CFG to PARAMETERS.
	(frameset--initial-params): Rename arg FRAME-CFG to PARAMETERS.
	Doc fix.
	(frameset--restore-frame): Rename args FRAME-CFG and WINDOW-CFG to
	PARAMETERS and WINDOW-STATE, respectively.
	(frameset-restore): Add new keyword argument PREDICATE.
	Reset frameset--target-display to nil.  Doc fix.

2013-08-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/bat-mode.el (bat--syntax-propertize): New var.
	(bat-mode): Use it.
	(bat-mode-syntax-table): Mark \n as end-of-comment.
	(bat-font-lock-keywords): Remove comment rule.

	* progmodes/bat-mode.el: Rename from dos.el.  Use "bat-" prefix.
	(dos-mode-help): Remove.  Use describe-mode (C-h m) instead.

	* emacs-lisp/bytecomp.el: Check existence of f in #'f.
	(byte-compile-callargs-warn): Use `push'.
	(byte-compile-arglist-warn): Ignore higher-order "calls".
	(byte-compile-file-form-autoload): Use `pcase'.
	(byte-compile-function-form): If quoting a symbol, check that it exists.

2013-08-07  Eli Zaretskii  <eliz@gnu.org>

	* progmodes/dos.el (dos-font-lock-keywords): Rename LINUX to UNIX
	and add a few popular commands found in batch files.
	(dos, dos-label-face, dos-cmd-help, dos-run, dos-run-args)
	(dos-mode): Doc fixes.

2013-08-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/dos.el (auto-mode-alist): Add entries for dos-mode.
	(dos-mode): Use setq-local.  Add space after "rem".
	(dos-mode-syntax-table): Don't use "w" for symbol chars.
	(dos-font-lock-keywords): Try to adjust font-lock rules accordingly.

2013-08-07  Arni Magnusson  <arnima@hafro.is>

	* progmodes/dos.el: New file.
	* generic-x.el (bat-generic-mode): Redefine as an obsolete alias to
	dos-mode.

2013-08-06  Glenn Morris  <rgm@gnu.org>

	* calendar/calendar.el: Add new faces, and day-header-array.
	(calendar-weekday-header, calendar-weekend-header)
	(calendar-month-header): New faces.
	(calendar-day-header-construct): New function.
	(calendar-day-header-width): Also :set calendar-day-header-array.
	(calendar-american-month-header, calendar-european-month-header)
	(calendar-iso-month-header): Use calendar- faces.
	(calendar-generate-month):
	Use calendar-day-header-array for day headers; apply faces to them.
	(calendar-mode): Check calendar-font-lock-keywords non-nil.
	(calendar-abbrev-construct): Add optional maxlen argument.
	(calendar-day-name-array): Doc fix.
	(calendar-day-name-array, calendar-abbrev-length)
	(calendar-day-abbrev-array):
	Also :set calendar-day-header-array, and maybe redraw.
	(calendar-day-header-array): New option.  (Bug#15007)
	(calendar-font-lock-keywords): Set to nil and make obsolete.
	(calendar-day-name): Add option to use header array.

2013-08-06  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-render-td): Remove debugging.
	(shr-render-td): Make width computation consistent by defaulting
	all zero-width columns to 10 characters.  This may not be optimal,
	but it's at least consistent.
	(shr-make-table-1): Redo last change to fix the real problem in
	colspan handling.

2013-08-06  Dmitry Antipov  <dmantipov@yandex.ru>

	* files.el (cache-long-line-scans):
	Make obsolete alias to `cache-long-scans'.

2013-08-06  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset, frameset-filter-alist)
	(frameset-filter-params, frameset-save, frameset--reuse-frame)
	(frameset--minibufferless-last-p, frameset-restore): Doc fixes.
	(frameset-compute-pos): Rename from frameset--compute-pos,
	and add docstring.
	(frameset-move-onscreen): Use frameset-compute-pos.
	Most changes suggested by Drew Adams <drew.adams@oracle.com>.

	* find-lisp.el (find-lisp-line-indent, find-lisp-find-dired-filter):
	Fix typos in docstrings.

2013-08-06  Dmitry Antipov  <dmantipov@yandex.ru>

	* frame.el (get-other-frame): Tiny cleanup.

2013-08-06  Juanma Barranquero  <lekktu@gmail.com>

	* vc/vc.el (vc-default-ignore-completion-table):
	Silence byte-compiler warning.

	* frameset.el (frameset-p): Don't check non-nullness of the `properties'
	slot, which can indeed be nil.
	(frameset-live-filter-alist, frameset-persistent-filter-alist):
	Move entry for `left' from persistent to live filter alist.
	(frameset-filter-alist, frameset--minibufferless-last-p, frameset-save):
	Doc fixes.
	(frameset-filter-params): When restoring a frame, copy items added to
	`filtered', to avoid unwittingly modifying the original parameters.
	(frameset-move-onscreen): Rename from frameset--move-onscreen.  Doc fix.
	(frameset--restore-frame): Fix reference to frameset-move-onscreen.

	* dired.el (dired-insert-directory): Revert change in 2013-06-21T12:24:37Z!lekktu@gmail.com
	to use looking-at-p instead of looking-at.  (Bug#15028)

2013-08-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	Revert introduction of isearch-filter-predicates (bug#14714).
	Rely on add-function instead.
	* isearch.el (isearch-filter-predicates): Rename it back to
	isearch-filter-predicate.
	(isearch-message-prefix): Use advice-function-mapc and advice
	properties to get the isearch-message-prefix.
	(isearch-search, isearch-lazy-highlight-search): Revert to funcall
	instead of run-hook-with-args-until-failure.
	(isearch-filter-visible): Not obsolete any more.
	* loadup.el: Preload nadvice.
	* replace.el (perform-replace): Revert to funcall
	instead of run-hook-with-args-until-failure.
	* wdired.el (wdired-change-to-wdired-mode): Use add-function.
	* dired-aux.el (dired-isearch-filenames-mode): Rename from
	dired-isearch-filenames-toggle; make it into a proper minor mode.
	Use add/remove-function.
	(dired-isearch-filenames-setup, dired-isearch-filenames-end):
	Call the minor-mode rather than add/remove-hook.
	(dired-isearch-filter-filenames):
	Remove isearch-message-prefix property.
	* info.el (Info--search-loop): New function, extracted from Info-search.
	Funcall isearch-filter-predicate instead of
	run-hook-with-args-until-failure isearch-filter-predicates.
	(Info-search): Use it.
	(Info-mode): Use isearch-filter-predicate instead of
	isearch-filter-predicates.

2013-08-05  Dmitry Antipov  <dmantipov@yandex.ru>

	Do not call to `selected-window' where it is assumed by default.
	Affected functions are `window-minibuffer-p', `window-dedicated-p',
	`window-hscroll', `window-width', `window-height', `window-buffer',
	`window-frame', `window-start', `window-point', `next-window'
	and `window-display-table'.
	* abbrev.el (abbrev--default-expand):
	* bs.el (bs--show-with-configuration):
	* buff-menu.el (Buffer-menu-mouse-select):
	* calc/calc.el (calc):
	* calendar/calendar.el (calendar-generate-window):
	* calendar/diary-lib.el (diary-simple-display, diary-show-all-entries)
	(diary-make-entry):
	* comint.el (send-invisible, comint-dynamic-complete-filename)
	(comint-dynamic-simple-complete, comint-dynamic-list-completions):
	* completion.el (complete):
	* dabbrev.el (dabbrev-expand, dabbrev--make-friend-buffer-list):
	* disp-table.el (describe-current-display-table):
	* doc-view.el (doc-view-insert-image):
	* ebuff-menu.el (Electric-buffer-menu-mouse-select):
	* ehelp.el (with-electric-help):
	* emacs-lisp/easy-mmode.el (easy-mmode-define-navigation):
	* emacs-lisp/edebug.el (edebug-two-window-p, edebug-pop-to-buffer):
	* emacs-lisp/helper.el (Helper-help-scroller):
	* emulation/cua-base.el (cua--post-command-handler-1):
	* eshell/esh-mode.el (eshell-output-filter):
	* ffap.el (ffap-gnus-wrapper):
	* help-macro.el (make-help-screen):
	* hilit-chg.el (highlight-compare-buffers):
	* hippie-exp.el (hippie-expand, try-expand-dabbrev-visible):
	* hl-line.el (global-hl-line-highlight):
	* icomplete.el (icomplete-simple-completing-p):
	* isearch.el (isearch-done):
	* jit-lock.el (jit-lock-stealth-fontify):
	* mail/rmailsum.el (rmail-summary-scroll-msg-up):
	* mouse-drag.el (mouse-drag-should-do-col-scrolling):
	* mpc.el (mpc-tagbrowser, mpc):
	* net/rcirc.el (rcirc-any-buffer):
	* play/gomoku.el (gomoku-max-width, gomoku-max-height):
	* play/landmark.el (landmark-max-width, landmark-max-height):
	* play/zone.el (zone):
	* progmodes/compile.el (compilation-goto-locus):
	* progmodes/ebrowse.el (ebrowse-view/find-file-and-search-pattern):
	* progmodes/etags.el (find-tag-other-window):
	* progmodes/fortran.el (fortran-column-ruler):
	* progmodes/gdb-mi.el (gdb-mouse-toggle-breakpoint-fringe):
	* progmodes/verilog-mode.el (verilog-point-text):
	* reposition.el (reposition-window):
	* rot13.el (toggle-rot13-mode):
	* server.el (server-switch-buffer):
	* shell.el (shell-dynamic-complete-command)
	(shell-dynamic-complete-environment-variable):
	* simple.el (insert-buffer, set-selective-display)
	(delete-completion-window):
	* speedbar.el (speedbar-timer-fn, speedbar-center-buffer-smartly)
	(speedbar-recenter):
	* startup.el (fancy-splash-head):
	* textmodes/ispell.el (ispell-command-loop):
	* textmodes/makeinfo.el (makeinfo-compilation-sentinel-region):
	* tutorial.el (help-with-tutorial):
	* vc/add-log.el (add-change-log-entry):
	* vc/compare-w.el (compare-windows):
	* vc/ediff-help.el (ediff-indent-help-message):
	* vc/ediff-util.el (ediff-setup-control-buffer, ediff-position-region):
	* vc/ediff-wind.el (ediff-skip-unsuitable-frames)
	(ediff-setup-control-frame):
	* vc/emerge.el (emerge-position-region):
	* vc/pcvs-util.el (cvs-bury-buffer):
	* window.el (walk-windows, mouse-autoselect-window-select):
	* winner.el (winner-set-conf, winner-undo): Related users changed.

2013-08-05  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--set-id): Doc fix.
	(frameset-frame-id, frameset-frame-id-equal-p)
	(frameset-locate-frame-id): New functions.
	(frameset--process-minibuffer-frames, frameset--reuse-frame)
	(frameset-restore): Use them.

2013-08-05  Dmitry Antipov  <dmantipov@yandex.ru>

	Do not call to `selected-frame' where it is assumed by default.
	Affected functions are `raise-frame', `redraw-frame',
	`frame-first-window', `frame-terminal' and `delete-frame'.
	* calendar/appt.el (appt-disp-window):
	* epg.el (epg-wait-for-completion):
	* follow.el (follow-delete-other-windows-and-split)
	(follow-avoid-tail-recenter):
	* international/mule.el (set-terminal-coding-system):
	* mail/rmail.el (rmail-mail-return):
	* net/newst-plainview.el (newsticker--buffer-set-uptodate):
	* progmodes/f90.el (f90-add-imenu-menu):
	* progmodes/idlw-toolbar.el (idlwave-toolbar-toggle):
	* server.el (server-switch-buffer):
	* simple.el (delete-completion-window):
	* talk.el (talk):
	* term/xterm.el (terminal-init-xterm-modify-other-keys)
	(xterm-turn-on-modify-other-keys, xterm-remove-modify-other-keys):
	* vc/ediff-util.el (ediff-status-info, ediff-show-diff-output):
	* vc/ediff.el (ediff-documentation): Related users changed.
	* frame.el (selected-terminal): Remove the leftover.

2013-08-05  Glenn Morris  <rgm@gnu.org>

	* calendar/calendar.el (calendar-generate-month):
	Fix for calendar-column-width != 1 + calendar-day-digit-width.
	(calendar-generate-month, calendar-font-lock-keywords):
	Fix for calendar-day-header-width > length of any day name.

2013-08-05  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-clear): Use new name of sort predicate.

	* frameset.el (frameset): Add docstring.  Move :version property to its
	own `version' slot.
	(frameset-copy): Rename from copy-frameset.
	(frameset-p): Check more thoroughly.
	(frameset-prop): Do not check for :version, which is no longer a prop.
	(frameset-live-filter-alist, frameset-persistent-filter-alist):
	Use new :never value instead of t.
	(frameset-filter-alist): Expand and clarify docstring.
	(frameset-filter-tty-to-GUI, frameset-filter-sanitize-color)
	(frameset-filter-minibuffer, frameset-filter-save-param)
	(frameset-filter-restore-param, frameset-filter-iconified):
	Add pointer to docstring of frameset-filter-alist.
	(frameset-filter-params): Rename filter values to be more meaningful:
	:never instead of t, and reverse the meanings of :save and :restore.
	(frameset--process-minibuffer-frames): Clarify error message.
	(frameset-save): Avoid unnecessary and confusing call to framep.
	Use new BOA constructor for framesets.
	(frameset--reuse-list): Doc fix.
	(frameset--restore-frame): Rename from frameset--get-frame.  Doc fix.
	(frameset--minibufferless-last-p): Rename from frameset--sort-states.
	(frameset-minibufferless-first-p): Doc fix.
	Rename from frameset-sort-frames-for-deletion.
	(frameset-restore): Doc fixes.  Use new function names.
	Most changes suggested by Drew Adams <drew.adams@oracle.com>.

2013-08-04  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-forces-onscreen)
	(desktop-restore-reuses-frames): Document :keyword constant values.
	(desktop-filter-parameters-alist): Remove, now identical to
	frameset-filter-alist.
	(desktop--filter-tty*): Remove, moved to frameset.el.
	(desktop-save-frameset, desktop-restore-frameset):
	Do not pass :filters argument.

	* frameset.el (frameset-live-filter-alist)
	(frameset-persistent-filter-alist): New variables.
	(frameset-filter-alist): Use them.  Add autoload cookie.
	(frameset-filter-tty-to-GUI): Move from desktop.el and rename.
	(frameset--set-id, frameset--reuse-frame): Rename `frame-id' to
	`frameset--id' (it's supposed to be internal to frameset.el).
	(frameset--process-minibuffer-frames): Ditto.  Doc fix.
	(frameset--initial-params): New function.
	(frameset--get-frame): Use it.  Doc fix.
	(frameset--move-onscreen): Accept new PRED value for FORCE-ONSCREEN.
	Accept :all, not 'all.
	(frameset-restore): Add new predicate values for FORCE-ONSCREEN and
	FORCE-DISPLAY.  Use :keywords for constant arguments to avoid collision
	with fbound symbols.  Fix frame id matching, and remove matching ids if
	the frame being restored is deleted.  Obey :delete.

2013-08-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (macrop): New function.
	(text-clone--maintaining): New var.
	(text-clone--maintain): Rename from text-clone-maintain.  Use it
	instead of inhibit-modification-hooks.

	* emacs-lisp/nadvice.el (advice--normalize): For aliases to macros, use
	a proxy, so as handle autoloads and redefinitions of the target.
	(advice--defalias-fset, advice-remove): Use advice--symbol-function.

	* emacs-lisp/pcase.el (pcase-mutually-exclusive-predicates):
	Remove bogus (arrayp . stringp) pair.  Add entries for `vectorp'.
	(pcase--mutually-exclusive-p): New function.
	(pcase--split-consp): Use it.
	(pcase--split-pred): Use it.  Optimize the case where `pat' is a qpat
	mutually exclusive with the current predicate.

	* emacs-lisp/edebug.el (edebug-lookup-function): Remove function.
	(edebug-macrop): Remove.  Use `macrop' instead.
	* emacs-lisp/advice.el (ad-subr-p): Remove.  Use `subrp' instead.
	(ad-macro-p):
	* eshell/esh-cmd.el (eshell-macrop):
	* apropos.el (apropos-macrop): Remove.  Use `macrop' instead.

2013-08-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice-function-mapc): Rename from advice-mapc.
	(advice-mapc): New function, using it.
	(advice-function-member-p): New function.
	(advice--normalize): Store the cdr in advice--saved-rewrite since
	that's the part that will be changed.
	(advice--symbol-function): New function.
	(advice-remove): Handle removal before the function is defined.
	Adjust to new advice--saved-rewrite.
	(advice-member-p): Use advice-function-member-p and
	advice--symbol-function.

2013-08-04  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-p, frameset-save): Fix autoload cookies.
	(frameset-filter-minibuffer): Doc fix.
	(frameset-restore): Fix autoload cookie.  Fix typo in docstring.
	(frameset--set-id, frameset--process-minibuffer-frames)
	(frameset-restore): Rename parameter `frameset-id' to `frame-id'.
	(frameset--reuse-frame): Pass correct frame-id to frameset--find-frame.

	* desktop.el (desktop-clear): Only delete frames when called
	interactively and desktop-restore-frames is non-nil.  Doc fix.
	(desktop-read): Set desktop-saved-frameset to nil.

2013-08-04  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc.el (vc-ignore): Rewrite.
	(vc-default-ignore-completion-table, vc--read-lines)
	(vc--add-line, vc--remove-regexp): New functions.

	* vc/vc-svn.el (vc-svn-ignore): Doc fix.
	(vc-svn-ignore-completion-table): New function.

	* vc/vc-hg.el (vc-hg-ignore): Rewrite.
	(vc-hg-ignore-completion-table)
	(vc-hg-find-ignore-file): New functions.

	* vc/vc-git.el (vc-git-ignore): Rewrite.
	(vc-git-ignore-completion-table)
	(vc-git-find-ignore-file): New functions.

	* vc/vc-dir.el (vc-dir-menu-map): Add menu for vc-dir-ignore.

	* vc/vc-bzr.el (vc-bzr-ignore): Rewrite.
	(vc-bzr-ignore-completion-table)
	(vc-bzr-find-ignore-file): New functions.

2013-08-03  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-prop): New function and setter.
	(frameset-save): Do not modify frame list passed by the caller.

2013-08-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-desc-from-define): Ignore unknown keys.

2013-08-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/easy-mmode.el (define-globalized-minor-mode)
	(easy-mmode-define-navigation): Avoid ((lambda (..) ..) ...).

	* custom.el (custom-initialize-default, custom-initialize-set)
	(custom-initialize-reset, custom-initialize-changed): Affect the
	toplevel-default-value (bug#6275, bug#14586).
	* emacs-lisp/advice.el (ad-compile-function): Undo previous workaround
	for bug#6275.

2013-08-02  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/lisp-mode.el (lisp-imenu-generic-expression):
	Add cl-def* expressions.

	* frameset.el (frameset-filter-params): Fix order of arguments.

2013-08-02  Juanma Barranquero  <lekktu@gmail.com>

	Move code related to saving frames to frameset.el.
	* desktop.el: Require frameset.
	(desktop-restore-frames): Doc fix.
	(desktop-restore-reuses-frames): Rename from
	desktop-restoring-reuses-frames.
	(desktop-saved-frameset): Rename from desktop-saved-frame-states.
	(desktop-clear): Clear frames too.
	(desktop-filter-parameters-alist): Set from frameset-filter-alist.
	(desktop--filter-tty*, desktop-save, desktop-read):
	Use frameset functions.
	(desktop-before-saving-frames-functions, desktop--filter-*-color)
	(desktop--filter-minibuffer, desktop--filter-restore-desktop-parm)
	(desktop--filter-save-desktop-parm, desktop--filter-iconified-position)
	(desktop-restore-in-original-display-p, desktop--filter-frame-parms)
	(desktop--process-minibuffer-frames, desktop-save-frames)
	(desktop--reuse-list, desktop--compute-pos, desktop--move-onscreen)
	(desktop--find-frame, desktop--select-frame, desktop--make-frame)
	(desktop--sort-states, desktop-restoring-frames-p)
	(desktop-restore-frames): Remove.  Most code moved to frameset.el.
	(desktop-restoring-frameset-p, desktop-restore-frameset)
	(desktop--check-dont-save, desktop-save-frameset): New functions.
	(desktop--app-id): New constant.
	(desktop-first-buffer, desktop-buffer-ok-count)
	(desktop-buffer-fail-count): Move before first use.
	* frameset.el: New file.

2013-08-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files.el: Use lexical-binding.
	(dir-locals-read-from-file): Remove unused `err' variable.
	(hack-dir-local-variables--warned-coding): New var.
	(hack-dir-local-variables): Use it to avoid repeated warnings.
	(make-backup-file-name--default-function): New function.
	(make-backup-file-name-function): Use it as default.
	(buffer-stale--default-function): New function.
	(buffer-stale-function): Use it as default.
	(revert-buffer-insert-file-contents--default-function): New function.
	(revert-buffer-insert-file-contents-function): Use it as default.
	(insert-directory): Avoid add-to-list.

	* autorevert.el (auto-revert-handler): Simplify.
	Use buffer-stale--default-function.

2013-08-01  Tassilo Horn  <tsdh@gnu.org>

	* speedbar.el (speedbar-query-confirmation-method): Doc fix.

	* whitespace.el (whitespace-ensure-local-variables): New function.
	(whitespace-cleanup-region): Call it.
	(whitespace-turn-on): Call it.

2013-08-01  Michael Albinus  <michael.albinus@gmx.de>

	Complete file name handlers.

	* net/tramp.el (tramp-handle-set-visited-file-modtime)
	(tramp-handle-verify-visited-file-modtime)
	(tramp-handle-file-notify-rm-watch): New functions.
	(tramp-call-process): Do not bind `default-directory'.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	Order alphabetically.
	<access-file, add-name-to-file, dired-call-process>:
	<dired-compress-file, file-acl, file-notify-rm-watch>:
	<file-ownership-preserved-p, file-selinux-context>:
	<make-directory-internal, make-symbolic-link, set-file-acl>:
	<set-file-selinux-context, set-visited-file-modtime>:
	<verify-visited-file-modtime>: Add handler.
	(tramp-adb-handle-write-region): Apply `set-visited-file-modtime'.

	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist)
	<file-notify-add-watch, file-notify-rm-watch>:
	<set-file-times, set-visited-file-modtime>:
	<verify-visited-file-modtime>: Add handler.
	(with-tramp-gvfs-error-message)
	(tramp-gvfs-handle-set-visited-file-modtime)
	(tramp-gvfs-fuse-file-name): Remove.
	(tramp-gvfs-handle-file-notify-add-watch)
	(tramp-gvfs-file-gvfs-monitor-file-process-filter): New defuns.
	(tramp-gvfs-handle-write-region): Fix error in moving tmpfile.

	* net/tramp-sh.el (tramp-sh-file-name-handler-alist):
	Order alphabetically.
	<file-notify-rm-watch>: Use default Tramp handler.
	<executable-find>: Remove private handler.
	(tramp-do-copy-or-rename-file-out-of-band): Do not bind
	`default-directory'.
	(tramp-sh-handle-executable-find)
	(tramp-sh-handle-file-notify-rm-watch): Remove functions.
	(tramp-sh-file-gvfs-monitor-dir-process-filter)
	(tramp-sh-file-inotifywait-process-filter, tramp-set-remote-path):
	Do not use `format' in `tramp-message'.

	* net/tramp-smb.el (tramp-smb-file-name-handler-alist)
	<file-notify-rm-watch, set-visited-file-modtime>:
	<verify-visited-file-modtime>: Add handler.
	(tramp-smb-call-winexe): Do not bind `default-directory'.

2013-08-01  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-hooks.el (vc-menu-map): Fix menu entry for vc-ignore.

2013-07-31  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/log-view.el (log-view-diff): Extract `log-view-diff-common',
	use it.
	(log-view-diff-changeset): Same.
	(log-view-diff-common): Call backend command `previous-revision'
	to find out the previous revision, in both cases.  Swap the
	variables `to' and `fr', so that `fr' usually refers to the
	earlier revision (Bug#14989).

2013-07-31  Kan-Ru Chen  <kanru@kanru.info>

	* ibuf-ext.el (ibuffer-filter-by-filename):
	Make it work with dired buffers too.

2013-07-31  Dmitry Antipov  <dmantipov@yandex.ru>

	* emacs-lisp/re-builder.el (reb-color-display-p):
	* files.el (save-buffers-kill-terminal):
	* net/browse-url.el (browse-url):
	* server.el (server-save-buffers-kill-terminal):
	* textmodes/reftex-toc.el (reftex-toc, reftex-toc-revert):
	Prefer nil to selected-frame for the first arg of frame-parameter.

2013-07-31  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-hooks.el (vc-menu-map): Add menu entry for vc-ignore.

2013-07-30  Stephen Berman  <stephen.berman@gmx.net>

	* minibuffer.el (completion--twq-all): Try and preserve each
	completion's case choice (bug#14907).

2013-07-30  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/network-stream.el (open-network-stream): Mention the new
	:nogreeting parameter.
	(network-stream-open-starttls): Use the :nogreeting parameter
	(bug#14938).

	* net/shr.el (shr-mouse-browse-url): Remove and use `shr-browse-url'.

	* net/eww.el (eww-setup-buffer): Switching to the buffer seems
	more natural than popping.

	* net/shr.el (shr-urlify): Put `follow-link' on URLs (bug#14815).
	(shr-urlify): Highlight under mouse.

2013-07-30  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-hooks.el (vc-prefix-map): Add key binding for vc-ignore.

	* vc/vc-dir.el (vc-dir-mode-map): Change key binding for vc-dir-ignore.

	* vc/vc-svn.el (vc-svn-ignore): Remove `interactive'.  Use `*vc*'
	buffer for output.

	* vc/vc-hg.el (vc-hg-ignore): Remove `interactive'.  Do not assume
	point-min==1.  Fix search string.  Fix parentheses missing.

	* vc/vc-git.el (vc-git-ignore): Remove `interactive'.  Do not
	assume point-min==1.  Fix search string.  Fix parentheses missing.

	* vc/vc-cvs.el (vc-cvs-ignore): Remove `interactive'.

	* vc/vc-bzr.el (vc-bzr-ignore): Remove `interactive'.  Use `*vc*'
	buffer for output.

2013-07-29  Eli Zaretskii  <eliz@gnu.org>

	* frame.el (frame-notice-user-settings): Avoid inflooping when the
	initial frame is minibuffer-less.  (Bug#14841)

2013-07-29  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-use-ssh-controlmaster-options): New customer
	option.

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-out-of-band)
	(tramp-maybe-open-connection): Use it.

2013-07-28  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--make-frame): Include `minibuffer' in the
	minimal set of parameters passed when creating a frame, because
	the minibuffer status of a frame cannot be changed later.

2013-07-28  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-rename-file): Fix incorrect use of
	replace-regexp-in-string and inadvertent omissions in previous change.
	(todo-filter-items): Ensure only file names are comma-separated in
	name of filtered items buffer.

2013-07-28  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el: Optionally force offscreen frames back onscreen.
	(desktop-restoring-reuses-frames): New option.
	(desktop--compute-pos, desktop--move-onscreen): New functions.
	(desktop--make-frame): Use desktop--move-onscreen.

2013-07-27  Alan Mackenzie  <acm@muc.de>

	Fontify a Java generic method as a function.
	* progmodes/cc-langs.el (c-recognize-<>-arglists): Set the Java
	value to t.

2013-07-27  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Add command to rename todo files.
	(todo-rename-file): New command.
	(todo-key-bindings-t): Add key binding for it.  Change the
	bindings of todo-filter-regexp-items(-multifile) to use `x'
	instead of `r', since the latter is better suited to the new
	renaming command.

2013-07-27  Alan Mackenzie  <acm@muc.de>

	Make Java try-with-resources statement parse properly.
	* progmodes/cc-langs.el (c-block-stmt-1-2-kwds)
	(c-block-stmt-1-2-key): New language constants/variables.
	* progmodes/cc-engine.el (c-beginning-of-statement-1)
	(c-after-conditional): Adapt to deal with c-block-stmt-1-2-key.
	* progmodes/cc-fonts.el (c-font-lock-declarations): Adapt to deal
	with c-block-stmt-1-2-key.

2013-07-27  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--make-frame): Apply most frame parameters after
	creating the frame to force (partially or totally) offscreen frames to
	be restored as such.

2013-07-26  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-dir.el (vc-dir-mode-map): Add binding for vc-root-diff.
	(Bug#14948)

2013-07-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--called-interactively-skip): Use the new
	`base' arg of backtrace-frame.

2013-07-26  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (list-processes): Doc fix.

2013-07-26  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--select-frame):
	Try harder to reuse existing frames.

2013-07-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el: Use backtrace-eval to handle lexical variables.
	(edebug-eval): Use backtrace-eval.
	(edebug--display, edebug--recursive-edit): Don't let-bind the
	edebug-outer-* vars that keep track of variables we locally let-bind.
	(edebug-outside-excursion): Don't restore outside values of locally
	let-bound vars.
	(edebug--display): Use user-error.
	(cl-lexical-debug, cl-debug-env): Remove.

2013-07-26  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-frames): Call `sit-for' once all frames
	are restored to be sure that they are visible before deleting any
	remaining ones.

2013-07-26  Matthias Meulien  <orontee@gmail.com>

	* vc/vc-dir.el (vc-dir-mode-map): Add binding for
	vc-print-root-log.  (Bug#14948)

2013-07-26  Richard Stallman  <rms@gnu.org>

	Add aliases for encrypting mail.
	* epa.el (epa-mail-aliases): New option.
	* epa-mail.el (epa-mail-encrypt): Rewrite to be callable from programs.
	Bind inhibit-read-only so read-only text doesn't ruin everything.
	(epa-mail-default-recipients): New subroutine broken out.
	Handle epa-mail-aliases.

2013-07-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	Add support for lexical variables to the debugger's `e' command.
	* emacs-lisp/debug.el (debug): Don't let-bind the debugger-outer-*
	vars, except for debugger-outer-match-data.
	(debugger-frame-number): Move check for "on a function call" from
	callers into it.  Add `skip-base' argument.
	(debugger-frame, debugger-frame-clear): Simplify accordingly.
	(debugger-env-macro): Only reset the state stored in non-variables,
	i.e. current-buffer and match-data.
	(debugger-eval-expression): Rewrite using backtrace-eval.
	* subr.el (internal--called-interactively-p--get-frame): Remove.
	(called-interactively-p):
	* emacs-lisp/edebug.el (edebug--called-interactively-skip): Use the new
	`base' arg of backtrace-frame instead.

2013-07-26  Glenn Morris  <rgm@gnu.org>

	* align.el (align-regexp): Doc fix.  (Bug#14857)
	(align-region): Explicit error if subexpression missing/does not match.

	* simple.el (global-visual-line-mode):
	Do not duplicate the mode lighter.  (Bug#14858)

2013-07-25  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer): In display-buffer bind
	split-window-keep-point to t, bug#14829.

2013-07-25  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el: Rename internal "desktop-X" frame params to "desktop--X".
	(desktop-filter-parameters-alist, desktop--filter-restore-desktop-parm)
	(desktop--filter-save-desktop-parm, desktop--process-minibuffer-frames)
	(desktop--select-frame, desktop--sort-states, desktop-restore-frames):
	Change accordingly.
	(desktop--select-frame, desktop--sort-states, desktop-restore-frames):
	Use pcase-let, pcase-let* to deobfuscate access to desktop--mini values.

2013-07-25  Glenn Morris  <rgm@gnu.org>

	* dired-x.el (dired-mark-extension): Convert comment to doc string.

2013-07-25  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--make-frame): Do not pass the `fullscreen'
	parameter to modify-frame-parameters if the value has not changed;
	this is a workaround for bug#14949.
	(desktop--make-frame): On cl-delete-if call, check parameter name,
	not full parameter.

2013-07-30  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc.el (vc-ignore): New function.

	* vc/vc-svn.el (vc-svn-ignore): New function.

	* vc/vc-hg.el (vc-hg-ignore): New function.

	* vc/vc-git.el (vc-git-ignore): New function.

	* vc/vc-dir.el (vc-dir-mode-map): Add key binding for vc-dir-ignore
	(vc-dir-ignore): New function.

	* vc/vc-cvs.el (vc-cvs-ignore): New function.
	(cvs-append-to-ignore): Move here from pcvs.el.

	* vc/vc-bzr.el (vc-bzr-ignore): New function.

	* vc/pcvs.el (vc-cvs): Require 'vc-cvs.

2013-07-24  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restoring-frames-p): Return a true boolean.
	(desktop-restore-frames): Warn when deleting an existing frame failed.

2013-07-24  Glenn Morris  <rgm@gnu.org>

	* ffap.el (ffap-machine-p): Handle "not known" response.  (Bug#14929)

2013-07-24  Michael Albinus  <michael.albinus@gmx.de>

	* filenotify.el (file-notify-supported-p):
	* net/tramp-sh.el (tramp-sh-handle-file-notify-supported-p):
	Remove functions.

	* autorevert.el (auto-revert-use-notify)
	(auto-revert-notify-add-watch):
	* net/tramp.el (tramp-file-name-for-operation):
	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist):
	* net/tramp-sh.el (tramp-sh-file-name-handler-alist):
	* net/tramp-smb.el (tramp-smb-file-name-handler-alist):
	Remove `file-notify-supported-p' entry.

2013-07-24  Glenn Morris  <rgm@gnu.org>

	* printing.el: Replace all uses of deleted ps-windows-system,
	ps-lp-system, ps-flatten-list with lpr- versions.

2013-07-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/pcase.el (pcase--u1): Verify if self-quoting values can be
	checked with memq (bug#14935).

	* files.el (revert-buffer-function): Use a non-nil default.
	(revert-buffer-preserve-modes): Declare var to
	provide access to the `preserve-modes' argument.
	(revert-buffer): Let-bind it.
	(revert-buffer--default): New function, extracted from revert-buffer.

2013-07-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* lpr.el: Signal print errors more prominently.
	(print-region-function): Don't default to nil.
	(lpr-print-region): New function, extracted from print-region-1.
	Check lpr's return value and signal an error in case of problem.
	(print-region-1): Use it.
	* ps-print.el (ps-windows-system, ps-lp-system): Remove.  Use the lpr-*
	versions instead.
	(ps-printer-name): Default to nil.
	(ps-printer-name-option): Default to lpr-printer-switch.
	(ps-print-region-function): Don't default to nil.
	(ps-postscript-code-directory): Simplify default.
	(ps-do-despool): Use lpr-print-region to properly check the outcome.
	(ps-string-list, ps-eval-switch, ps-flatten-list)
	(ps-flatten-list-1): Remove.
	(ps-multibyte-buffer): Avoid setq.
	* dos-w32.el (direct-print-region-helper): Use proper regexp operators.
	(print-region-function, ps-print-region-function): Don't set them here.

2013-07-24  Xue Fuqiao  <xfq.free@gmail.com>

	* ido.el (ido-fractionp, ido-cache-ftp-work-directory-time)
	(ido-max-prospects, ido-mode, ido-max-file-prompt-width)
	(ido-unc-hosts-cache, ido-max-directory-size, ido-max-dir-file-cache)
	(ido-decorations): Doc fix.

	* ansi-color.el: Fix old URL.

2013-07-23  Michael R. Mauger  <michael@mauger.com>

	* progmodes/sql.el: Version 3.3
	(sql-product-alist): Improve oracle :prompt-cont-regexp.
	(sql-starts-with-prompt-re, sql-ends-with-prompt-re): New functions.
	(sql-interactive-remove-continuation-prompt): Rewrite, use
	functions above.  Fix continuation prompt and complete output line
	handling.
	(sql-redirect-one, sql-execute): Use `read-only-mode' on
	redirected output buffer.
	(sql-mode): Restore deleted code (Bug#13591).

2013-07-23  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-clear, desktop-list*): Fix previous change.

2013-07-23  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-handle-file-notify-add-watch): New defun.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist):
	* net/tramp-smb.el (tramp-smb-file-name-handler-alist): Use it.

2013-07-23  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-clear): Simplify; remove useless checks
	against invalid buffer names.
	(desktop-list*): Use cl-list*.
	(desktop-buffer-info, desktop-create-buffer): Simplify.

2013-07-23  Leo Liu  <sdl.web@gmail.com>

	* bookmark.el (bookmark-make-record): Restore NAME as a default
	value.  (Bug#14933)

2013-07-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/autoload.el (autoload--setup-output): New function,
	extracted from autoload--insert-text.
	(autoload--insert-text): Remove.
	(autoload--print-cookie-text): New function, extracted from
	autoload--insert-cookie-text.
	(autoload--insert-cookie-text): Remove.
	(autoload-generate-file-autoloads): Adjust calls accordingly.

	* winner.el (winner-hook-installed-p): Remove.
	(winner-mode): Simplify accordingly.

	* subr.el (add-to-list): Fix compiler-macro when `append' is
	not constant.  Don't use `cl-member' for the base case.

	* progmodes/subword.el: Fix boundary case (bug#13758).
	(subword-forward-regexp): Make it a constant.  Wrap optional \\W in its
	own group.
	(subword-backward-regexp): Make it a constant.
	(subword-forward-internal): Don't treat a trailing capital as the
	beginning of a word.

2013-07-22  Ari Roponen  <ari.roponen@gmail.com>  (tiny change)

	* emacs-lisp/package.el (package-menu-mode): Don't modify the
	global value of tabulated-list-revert-hook (bug#14930).

2013-07-22  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el: Require 'cl-lib.
	(desktop-before-saving-frames-functions): New hook.
	(desktop--process-minibuffer-frames): Set desktop-mini parameter only
	for frames being saved.  Rename from desktop--save-minibuffer-frames.
	(desktop-save-frames): Run hook desktop-before-saving-frames-functions.
	Do not save frames with non-nil `desktop-dont-save' parameter.
	Filter out deleted frames.
	(desktop--find-frame): Use cl-find-if.
	(desktop--select-frame): Use cl-(first|second|third) to access values
	of desktop-mini.
	(desktop--make-frame): Use cl-delete-if.
	(desktop--sort-states): Fix sorting of minibuffer-owning frames.
	(desktop-restore-frames): Use cl-(first|second|third) to access values
	of desktop-mini.  Look for visible frame at the end, not while
	restoring frames.

	* dired-x.el (dired-mark-unmarked-files, dired-virtual)
	(dired-guess-default, dired-mark-sexp, dired-filename-at-point):
	Use string-match-p, looking-at-p (bug#14927).

2013-07-21  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-saved-frame-states):
	Rename from desktop--saved-states; all users changed.
	(desktop-save-frames): Rename from desktop--save-frames.
	Do not save state to desktop file.
	(desktop-save): Save desktop-saved-frame-states to desktop file
	and reset to nil.
	(desktop-restoring-frames-p): New function.
	(desktop-restore-frames): Use it.  Rename from desktop--restore-frames.
	(desktop-read): Use desktop-restoring-frames-p.  Do not try to fix
	buffer-lists when restoring frames.  Suggested by Martin Rudalics.

	* desktop.el: Correctly restore iconified frames.
	(desktop--filter-iconified-position): New function.
	(desktop-filter-parameters-alist): Add entries for `top' and `left'.

2013-07-20  Glenn Morris  <rgm@gnu.org>

	* progmodes/gdb-mi.el (gdb-delete-handler, gdb-stopped):
	Let `message' do the formatting.
	(def-gdb-preempt-display-buffer): Add explicit format.

	* image-dired.el (image-dired-track-original-file):
	Use with-current-buffer.
	(image-dired-track-thumbnail): Use with-current-buffer.
	Avoid changing point of wrong window.

	* image-dired.el (image-dired-track-original-file):
	Avoid changing point of wrong window.  (Bug#14909)

2013-07-20  Richard Copley  <rcopley@gmail.com>  (tiny change)

	* progmodes/gdb-mi.el (gdb-done-or-error):
	Guard against "%" in gdb output.  (Bug#14127)

2013-07-20  Andreas Schwab  <schwab@linux-m68k.org>

	* progmodes/sh-script.el (sh-read-variable): Remove interactive spec.
	(Bug#14826)

	* international/mule.el (coding-system-iso-2022-flags): Fix last
	change.

2013-07-20  Kenichi Handa  <handa@gnu.org>

	* international/mule.el (coding-system-iso-2022-flags):
	Add `8-bit-level-4'.  (Bug#8522)

2013-07-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-mouse-browse-url): New command and keystroke
	(bug#14815).

	* net/eww.el (eww-process-text-input): Allow inputting when the
	point is at the start of the line, as the properties aren't
	front-sticky.

	* net/shr.el (shr-make-table-1): Ensure that we don't infloop on
	degenerate widths.

2013-07-19  Richard Stallman  <rms@gnu.org>

	* epa.el (epa-popup-info-window): Doc fix.

	* subr.el (split-string): New arg TRIM.

2013-07-18  Juanma Barranquero  <lekktu@gmail.com>

	* frame.el (blink-cursor-timer-function, blink-cursor-suspend):
	Add check for W32 (followup to 2013-07-16T11:41:06Z!jan.h.d@swipnet.se).

2013-07-18  Michael Albinus  <michael.albinus@gmx.de>

	* filenotify.el (file-notify--library): Rename from
	`file-notify-support'.  Do not autoload.  Adapt all uses.
	(file-notify-supported-p): New defun.

	* autorevert.el (auto-revert-use-notify):
	Use `file-notify-supported-p' instead of `file-notify-support'.
	Adapt docstring.
	(auto-revert-notify-add-watch): Use `file-notify-supported-p'.

	* net/tramp.el (tramp-file-name-for-operation):
	Add `file-notify-supported-p'.

	* net/tramp-sh.el (tramp-sh-handle-file-notify-supported-p):
	New defun.
	(tramp-sh-file-name-handler-alist): Add it as handler for
	`file-notify-supported-p '.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist):
	* net/tramp-smb.el (tramp-smb-file-name-handler-alist):
	Add `ignore' as handler for `file-notify-*' functions.

2013-07-17  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial, line-move): Don't start vscroll or
	scroll-up if the current line is not taller than the window.
	(Bug#14881)

2013-07-16  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Do not
	highlight question marks in the method names as strings.
	(ruby-block-beg-keywords): Inline.
	(ruby-font-lock-keyword-beg-re): Extract from
	`ruby-font-lock-keywords'.

2013-07-16  Jan Djärv  <jan.h.d@swipnet.se>

	* frame.el (blink-cursor-blinks): New defcustom.
	(blink-cursor-blinks-done): New defvar.
	(blink-cursor-start): Set blink-cursor-blinks-done to 1.
	(blink-cursor-timer-function): Check if number of blinks has been
	done on X and NS.
	(blink-cursor-suspend, blink-cursor-check): New defuns.

2013-07-15  Glenn Morris  <rgm@gnu.org>

	* edmacro.el (edmacro-format-keys): Fix previous change.

2013-07-15  Paul Eggert  <eggert@cs.ucla.edu>

	* shell.el (explicit-bash-args): Remove obsolete hack for Bash 1.x.
	The hack didn't work outside English locales anyway.

2013-07-15  Juanma Barranquero  <lekktu@gmail.com>

	* simple.el (define-alternatives): Rename from alternatives-define,
	per RMS' suggestion.

2013-07-14  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-frames): Change default to t.
	(desktop-restore-in-current-display): Now offer more options.
	(desktop-restoring-reuses-frames): New customization option.
	(desktop--saved-states): Doc fix.
	(desktop-filter-parameters-alist): New variable, renamed and expanded
	from desktop--excluded-frame-parameters.
	(desktop--target-display): New variable.
	(desktop-switch-to-gui-p, desktop-switch-to-tty-p)
	(desktop--filter-tty*, desktop--filter-*-color)
	(desktop--filter-minibuffer, desktop--filter-restore-desktop-parm)
	(desktop--filter-save-desktop-parm)
	(desktop-restore-in-original-display-p): New functions.
	(desktop--filter-frame-parms): Use new desktop-filter-parameters-alist.
	(desktop--save-minibuffer-frames): New function, inspired by a similar
	function from Martin Rudalics.
	(desktop--save-frames): Call it; play nice with desktop-globals-to-save.
	(desktop--restore-in-this-display-p): Remove.
	(desktop--find-frame): Rename from desktop--find-frame-in-display
	and add predicate argument.
	(desktop--make-full-frame): Remove, integrated into desktop--make-frame.
	(desktop--reuse-list): New variable.
	(desktop--select-frame, desktop--make-frame, desktop--sort-states):
	New functions.
	(desktop--restore-frames): Add support for "minibuffer-special" frames.

2013-07-14  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-vc-registered): Use `ignore-error'.

2013-07-13  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Highlight conversion methods on Kernel.

2013-07-13  Alan Mackenzie  <acm@muc.de>

	* progmodes/cc-engine.el (c-forward-decl-or-cast-1): Label CASE 13
	and comment it out.  This out-commenting enables certain C++
	declarations to be parsed correctly.

2013-07-13  Eli Zaretskii  <eliz@gnu.org>

	* international/mule.el (define-coding-system): Doc fix.

	* simple.el (default-font-height): Don't call font-info if the
	frame's default font didn't change since the frame was created.
	(Bug#14838)

2013-07-13  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-file-name): Guard against non-symbol value.

2013-07-13  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-imenu--build-tree): Fix corner case
	in nested defuns.

2013-07-13  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-exhibit): Handle ido-enter-matching-directory before
	ido-set-matches call.  (Bug#6852)

2013-07-12  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-percent-literals-beg-re)
	(ruby-syntax-expansion-allowed-p): Support array of symbols, for
	Ruby 2.0.
	(ruby-font-lock-keywords): Distinguish calls to functions with
	module-like names from module references.  Highlight character
	literals.

2013-07-12  Sergio Durigan Junior  <sergiodj@riseup.net>  (tiny change)

	* progmodes/gdb-mi.el (gdb-strip-string-backslash): New function.
	(gdb-send): Handle continued commands.  (Bug#14847)

2013-07-12  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--v2s): Remove unused local variable.
	(desktop-save-buffer): Make defvar-local; adjust docstring.
	(desktop-auto-save-timeout, desktop-owner): Use ignore-errors.
	(desktop-clear, desktop-save-buffer-p): Use string-match-p.

2013-07-12  Andreas Schwab  <schwab@linux-m68k.org>

	* emacs-lisp/map-ynp.el (map-y-or-n-p): Fix last change.

2013-07-12  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (next-line, previous-line): Document TRY-VSCROLL and ARG.
	(Bug#14842)

2013-07-12  Glenn Morris  <rgm@gnu.org>

	* doc-view.el: Require cl-lib at runtime too.
	(doc-view-remove-if): Remove.
	(doc-view-search-next-match, doc-view-search-previous-match):
	Use cl-remove-if.

	* edmacro.el: Require cl-lib at runtime too.
	(edmacro-format-keys, edmacro-parse-keys): Use cl-mismatch, cl-subseq.
	(edmacro-mismatch, edmacro-subseq): Remove.

	* shadowfile.el: Require cl-lib.
	(shadow-remove-if): Remove.
	(shadow-set-cluster, shadow-shadows-of-1, shadow-remove-from-todo):
	Use cl-remove-if.

	* wid-edit.el: Require cl-lib.
	(widget-choose): Use cl-remove-if.
	(widget-remove-if): Remove.

	* progmodes/ebrowse.el: Require cl-lib at runtime too.
	(ebrowse-delete-if-not): Remove.
	(ebrowse-browser-buffer-list, ebrowse-member-buffer-list)
	(ebrowse-tree-buffer-list, ebrowse-same-tree-member-buffer-list):
	Use cl-delete-if-not.

2013-07-12  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/cl-macs.el (cl-multiple-value-bind, cl-multiple-value-setq)
	(cl-the, cl-declare, cl-defstruct): Fix typos in docstrings.

2013-07-12  Leo Liu  <sdl.web@gmail.com>

	* ido.el (dired-do-copy, dired): Set 'ido property.  (Bug#11954)

2013-07-11  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/edebug.el: Require cl-lib at run-time too.
	(edebug-gensym-index, edebug-gensym):
	Remove reimplementation of cl-gensym.
	(edebug-make-enter-wrapper, edebug-make-form-wrapper): Use cl-gensym.

	* thumbs.el: Require cl-lib at run-time too.
	(thumbs-gensym-counter, thumbs-gensym):
	Remove reimplementation of cl-gensym.
	(thumbs-temp-file): Use cl-gensym.

	* emacs-lisp/ert.el: Require cl-lib at runtime too.
	(ert--cl-do-remf, ert--remprop, ert--remove-if-not)
	(ert--intersection, ert--set-difference, ert--set-difference-eq)
	(ert--union, ert--gensym-counter, ert--gensym-counter)
	(ert--coerce-to-vector, ert--remove*, ert--string-position)
	(ert--mismatch, ert--subseq): Remove reimplementations of cl funcs.
	(ert-make-test-unbound, ert--expand-should-1)
	(ert--expand-should, ert--should-error-handle-error)
	(should-error, ert--explain-equal-rec)
	(ert--plist-difference-explanation, ert-select-tests)
	(ert--make-stats, ert--remove-from-list, ert--string-first-line):
	Use cl-lib functions rather than reimplementations.

2013-07-11  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-methods): Extend docstring.
	(tramp-connection-timeout): New defcustom.
	(tramp-error-with-buffer): Reset timestamp only when appropriate.
	(with-tramp-progress-reporter): Simplify.
	(tramp-process-actions): Improve messages.

	* net/tramp-gvfs.el (tramp-gvfs-maybe-open-connection):
	* net/tramp-sh.el (tramp-maybe-open-connection):
	Use `tramp-connection-timeout'.
	(tramp-methods) <su, sudo, ksu>: Add method specific timeouts.
	(Bug#14808)

2013-07-11  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-file-name): Conform to the requirements of
	read-file-name.  (Bug#11861)
	(ido-read-directory-name): Conform to the requirements of
	read-directory-name.

2013-07-11  Juanma Barranquero  <lekktu@gmail.com>

	* subr.el (delay-warning): New function.

2013-07-10  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (default-line-height): New function.
	(line-move-partial, line-move): Use it instead of computing the
	line height inline.
	(line-move-partial): Always compute ROWH.  If the last line is
	partially-visible, but its text is completely visible, allow
	cursor to enter such a partially-visible line.

2013-07-10  Michael Albinus  <michael.albinus@gmx.de>

	Improve error messages.  (Bug#14808)

	* net/tramp.el (tramp-current-connection): New defvar, moved from
	tramp-sh.el.
	(tramp-message-show-progress-reporter-message): Remove, not
	needed anymore.
	(tramp-error-with-buffer): Show message in minibuffer.
	Discard input before waiting.  Reset connection timestamp.
	(with-tramp-progress-reporter): Improve messages.
	(tramp-process-actions): Use progress reporter.  Delete process in
	case of error.  Improve messages.

	* net/tramp-sh.el (tramp-barf-if-no-shell-prompt): Use condition-case.
	Call `tramp-error-with-buffer' with vector and buffer.
	(tramp-current-connection): Remove.
	(tramp-maybe-open-connection): The car of
	`tramp-current-connection' are the first 3 slots of the vector.

2013-07-10  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine3-indent-line): Do not indent
	inside continued strings.

2013-07-10  Paul Eggert  <eggert@cs.ucla.edu>

	Timestamp fixes for undo (Bug#14824).
	* files.el (clear-visited-file-modtime): Move here from fileio.c.

2013-07-10  Leo Liu  <sdl.web@gmail.com>

	* files.el (require-final-newline): Allow safe local value.
	(Bug#14834)

2013-07-09  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-directory-name): Handle fallback.
	(ido-read-file-name): Update DIR to ido-current-directory.
	(Bug#1516)
	(ido-add-virtual-buffers-to-list): Robustify.  (Bug#14552)

2013-07-09  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Remove extra
	"autoload".  Remove "warn lower camel case" section, previously
	commented out.  Highlight negation char.  Do not highlight the
	target in singleton method definitions.

2013-07-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* faces.el (tty-setup-hook): Declare the hook.

	* emacs-lisp/pcase.el (pcase--split-pred): Add `vars' argument to try
	and detect when a guard/pred depends on local vars (bug#14773).
	(pcase--u1): Adjust caller.

2013-07-08  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial, line-move): Account for
	line-spacing.
	(line-move-partial): Avoid setting vscroll when the last
	partially-visible line in window is of default height.

2013-07-08  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-map): Reinstate the `u' key binding, since it's
	been used a while.

2013-07-07  Juanma Barranquero  <lekktu@gmail.com>

	* subr.el (read-quoted-char): Remove unused local variable `char'.

2013-07-07  Michael Kifer  <kifer@cs.stonybrook.edu>

	* vc/ediff.el (ediff-version): Version update.
	(ediff-files-command, ediff3-files-command, ediff-merge-command)
	(ediff-merge-with-ancestor-command, ediff-directories-command)
	(ediff-directories3-command, ediff-merge-directories-command)
	(ediff-merge-directories-with-ancestor-command): New functions.
	All are command-line interfaces to ediff: to facilitate calling
	Emacs with the appropriate ediff functions invoked.

	* emulation/viper-cmd.el (viper-del-forward-char-in-insert):
	New function.
	(viper-save-kill-buffer): Check if buffer is modified.

	* emulation/viper.el (viper-version): Version update.
	(viper-emacs-state-mode-list): Add egg-status-buffer-mode.

2013-07-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* faces.el (tty-run-terminal-initialization): Run new tty-setup-hook.
	* emulation/viper-cmd.el (viper-envelop-ESC-key): Remove function.
	(viper-intercept-ESC-key): Simplify.
	* emulation/viper-keym.el (viper-ESC-key): Make it a constant,
	don't use kbd.
	* emulation/viper.el (viper--tty-ESC-filter, viper--lookup-key)
	(viper-catch-tty-ESC, viper-uncatch-tty-ESC)
	(viper-setup-ESC-to-escape): New functions.
	(viper-go-away, viper-set-hooks): Call viper-setup-ESC-to-escape.
	(viper-set-hooks): Do not modify flyspell-mode-hook.  (Bug#13793)

2013-07-07  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (default-font-height, window-screen-lines):
	New functions.
	(line-move, line-move-partial): Use them instead of
	frame-char-height and window-text-height.  This makes scrolling
	text smoother when the buffer's default face uses a font that is
	different from the frame's default font.

2013-07-06  Jan Djärv  <jan.h.d@swipnet.se>

	* files.el (write-file): Do not display confirm dialog for NS,
	it does its own dialog, which can't be canceled (Bug#14578).

2013-07-06  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial): Adjust the row returned by
	posn-at-point for the current window-vscroll.  (Bug#14567)

2013-07-06  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-file-gvfs-monitor-dir-process-filter)
	(tramp-sh-file-inotifywait-process-filter): Handle file names with
	spaces.

2013-07-06  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-state-put-stale-windows): New variable.
	(window--state-put-2): Save list of windows without matching buffer.
	(window-state-put): Remove "bufferless" windows if possible.

2013-07-06  Juanma Barranquero  <lekktu@gmail.com>

	* simple.el (alternatives-define): Remove leftover :group keyword.
	Tweak docstring.

2013-07-06  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-use-virtual-buffers): Allow new value 'auto.
	(ido-enable-virtual-buffers): New variable.
	(ido-buffer-internal, ido-toggle-virtual-buffers)
	(ido-make-buffer-list): Use it.
	(ido-exhibit): Support turning on and off virtual buffers
	automatically.

2013-07-06  Juanma Barranquero  <lekktu@gmail.com>

	* simple.el (alternatives-define): New macro.

2013-07-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (read-quoted-char): Use read-key.
	(sit-for): Let read-event decode tty input (bug#14782).

2013-07-05  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Add handling of file deletion, both by
	mode command and externally.  Fix various related bugs.
	Clarify Commentary and improve some documentation strings and code.
	(todo-delete-file): New command.
	(todo-check-file): New function.
	(todo-show): Handle external deletion of the file we're trying to
	show (bug#14688).  Replace called-interactively-p by an optional
	prefix argument to avoid problematic interaction with catch form
	when byte compiled (bug#14702).
	(todo-quit): Handle external deletion of the archive's todo file.
	Make sure the buffer that was visiting the archive file is still
	live before trying to bury it.
	(todo-category-completions): Handle external deletion of any
	category completion files.
	(todo-jump-to-category, todo-basic-insert-item): Recalculate list
	of todo files, in case of external deletion.
	(todo-add-file): Replace unnecessary setq by let-binding.
	(todo-find-archive): Check whether there are any archives.
	Replace unnecessary setq by let-binding.
	(todo-archive-done-item): Use find-file-noselect to get the
	archive buffer whether or not the archive already exists.
	Remove superfluous code.  Use file size instead of buffer-file-name to
	check if the archive is new; if it is, update list of archives.
	(todo-default-todo-file): Allow nil to be a valid value for when
	there are no todo files.
	(todo-reevaluate-default-file-defcustom): Use corrected definition
	of todo-default-todo-file.
	(todo-key-bindings-t+a+f): Add key binding for todo-delete-file.
	(todo-delete-category, todo-show-categories-table)
	(todo-category-number): Clarify comment.
	(todo-filter-items): Clarify documentation string.
	(todo-show-current-file, todo-display-as-todo-file)
	(todo-reset-and-enable-done-separator): Tweak documentation string.
	(todo-done-separator): Make separator length window-width, since
	bug#2749 is now fixed.

2013-07-05  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-notify-add-watch):
	Support both "gvfs-monitor-dir" and "inotifywait".
	(tramp-sh-file-inotifywait-process-filter): Rename from
	`tramp-sh-file-notify-process-filter'.
	(tramp-sh-file-gvfs-monitor-dir-process-filter)
	(tramp-get-remote-gvfs-monitor-dir): New defuns.

2013-07-05  Leo Liu  <sdl.web@gmail.com>

	* autoinsert.el (auto-insert-alist): Default to lexical-binding.

2013-07-04  YAMAMOTO Mitsuharu  <mituharu@math.s.chiba-u.ac.jp>

	* frame.el (display-pixel-height, display-pixel-width)
	(display-mm-height, display-mm-width): Mention behavior on
	multi-monitor setups in docstrings.
	(w32-display-monitor-attributes-list): Declare function.
	(display-monitor-attributes-list): Use it.

2013-07-04  Michael Albinus  <michael.albinus@gmx.de>

	* filenotify.el: New package.

	* autorevert.el (top): Require filenotify.el.
	(auto-revert-notify-enabled): Remove.  Use `file-notify-support'
	instead.
	(auto-revert-notify-rm-watch, auto-revert-notify-add-watch)
	(auto-revert-notify-handler): Use `file-notify-*' functions.

	* subr.el (file-notify-handle-event): Move function to filenotify.el.

	* net/tramp.el (tramp-file-name-for-operation):
	Handle `file-notify-add-watch' and `file-notify-rm-watch'.

	* net/tramp-sh.el (tramp-sh-file-name-handler-alist): Add handler
	for `file-notify-add-watch' and `file-notify-rm-watch'.
	(tramp-process-sentinel): Improve trace.
	(tramp-sh-handle-file-notify-add-watch)
	(tramp-sh-file-notify-process-filter)
	(tramp-sh-handle-file-notify-rm-watch)
	(tramp-get-remote-inotifywait): New defuns.

2013-07-03  Juri Linkov  <juri@jurta.org>

	* buff-menu.el (Buffer-menu-multi-occur): Add args and move the
	call of `occur-read-primary-args' to interactive spec.

	* ibuffer.el (ibuffer-mode-map): Bind "M-s a C-o" to
	`ibuffer-do-occur' like in buff-menu.el.  (Bug#14673)

2013-07-03  Matthias Meulien  <orontee@gmail.com>

	* buff-menu.el (Buffer-menu-mode-map): Bind "M-s a C-o" to
	`Buffer-menu-multi-occur'.  Add it to the menu.
	(Buffer-menu-mode): Document it in docstring.
	(Buffer-menu-multi-occur): New command.  (Bug#14673)

2013-07-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Highlight more
	keywords and built-ins.

2013-07-03  Glenn Morris  <rgm@gnu.org>

	* subr.el (y-or-n-p): Handle empty prompts.  (Bug#14770)

	Make info-xref checks case-sensitive by default
	* info.el (Info-find-node, Info-find-in-tag-table)
	(Info-find-node-in-buffer, Info-find-node-2, Info-goto-node):
	Add option for exact case matching of nodes.
	* info-xref.el (info-xref): New custom group.
	(info-xref-case-fold): New option.
	(info-xref-goto-node-p): Pass info-xref-case-fold to Info-goto-node.

2013-07-03  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-delete-file-at-head): Respect delete-by-moving-to-trash.

2013-07-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-move-to-block): When we're at a
	middle of block statement initially, lower the depth.  Remove
	FIXME comment, not longer valid.  Remove middle of block statement
	detection, no need to do that anymore since we've been using
	`ruby-parse-region' here.

2013-07-02  Jan Djärv  <jan.h.d@swipnet.se>

	* term/ns-win.el (display-format-alist): Use .* (Bug#14765).

2013-07-01  Katsumi Yamaoka  <yamaoka@jpl.org>

	* wid-edit.el (widget-default-get): Don't modify widget (Bug#14738).

2013-07-01  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-frames): Rename from desktop-save-windows.
	(desktop-restore-in-current-display): New customization option.
	(desktop--excluded-frame-parameters): Add `font'.
	(desktop--save-frames): Rename from desktop--save-windows.
	(desktop--restore-in-this-display-p): New function.
	(desktop--make-full-frame): Remove unwanted width/height from
	full(width|height) frames.
	(desktop--restore-frames): Rename from desktop--restore-windows.
	Obey desktop-restore-current-display.  Do not delete old frames or
	select a new frame unless we were able to restore at least one frame.

2013-06-30  Michal Nazarewicz  <mina86@mina86.com>

	* files.el (find-file-noselect): Simplify conditional expression.

	* textmodes/remember.el (remember-append-to-file):
	Don't mix `find-buffer-visiting' and `get-file-buffer'.

	Add `remember-notes' function to store random notes across Emacs
	restarts.
	* textmodes/remember.el (remember-data-file): Add :set callback to
	affect notes buffer (if any).
	(remember-notes): New command.
	(remember-notes-buffer-name, bury-remember-notes-on-kill):
	New defcustoms for the `remember-notes' function.
	(remember-notes-save-and-bury-buffer): New command.
	(remember-notes-mode-map): New variable.
	(remember-mode): New minor mode.
	(remember-notes--kill-buffer-query): New function.
	* startup.el (initial-buffer-choice): Add notes to custom type.

2013-06-30  Eli Zaretskii  <eliz@gnu.org>

	* bindings.el (right-char, left-char): Don't call sit-for, this is
	no longer needed.  Use arithmetic comparison only for numerical
	arguments.

	* international/mule-cmds.el (select-safe-coding-system):
	Handle the case of FROM being a string correctly.  (Bug#14755)

2013-06-30  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-make-table-1): Add a sanity check that allows
	progression on degenerate tables.
	(shr-rescale-image): ImageMagick animated images currently don't work.

2013-06-30  Juanma Barranquero  <lekktu@gmail.com>

	Some fixes and improvements for desktop frame restoration.
	It is still experimental and disabled by default.
	* desktop.el (desktop--save-windows): Put the selected frame at
	the head of the list.
	(desktop--make-full-frame): New function.
	(desktop--restore-windows): Try to re-select the frame that was
	selected upon saving.  Do not abort if some frames fail to restore,
	just show an error message and continue.  Set up maximized frames
	so they have default non-maximized dimensions.

2013-06-30  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-propertize-function):
	Don't start heredoc inside a string or comment.

2013-06-29  Eli Zaretskii  <eliz@gnu.org>

	* bindings.el (visual-order-cursor-movement): New defcustom.
	(right-char, left-char): Provide visual-order cursor motion by
	calling move-point-visually.  Update the doc strings.

2013-06-28  Kenichi Handa  <handa@gnu.org>

	* international/mule.el (define-coding-system): New coding system
	properties :inhibit-null-byte-detection,
	:inhibit-iso-escape-detection, and :prefer-utf-8.
	(set-buffer-file-coding-system): If :charset-list property of
	CODING-SYSTEM is `emacs', do not check if CODING-SYSTEM is
	appropriate for setting.

	* international/mule-cmds.el (select-safe-coding-system):
	If DEFAULT-CODING-SYSTEM is prefer-utf-8 and the buffer contains
	multibyte characters, return utf-8 (or one of its siblings).

	* international/mule-conf.el (prefer-utf-8): New coding system.
	(file-coding-system-alist): Use prefer-utf-8 as default for Elisp
	files.

2013-06-28  Ivan Kanis  <ivan@kanis.fr>

	* net/shr.el (shr-render-region): New function.

	* net/eww.el: Autoload `eww-browse-url'.

2013-06-27  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Adapt to `package-desc-version' being a list.
	Use `package--ac-desc-version' to retrieve version from a package
	archive element.

2013-06-27  Juanma Barranquero  <lekktu@gmail.com>

	New experimental feature to save&restore window and frame setup.
	* desktop.el (desktop-save-windows): New defcustom.
	(desktop--saved-states): New var.
	(desktop--excluded-frame-parameters): New defconst.
	(desktop--filter-frame-parms, desktop--find-frame-in-display)
	(desktop--restore-windows, desktop--save-windows): New functions.
	(desktop-save): Call `desktop--save-windows'.
	(desktop-read): Call `desktop--restore-windows'.

2013-06-27  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (add-face-text-property): Remove compat definition.

2013-06-27  Stephen Berman  <stephen.berman@gmx.net>

	* info.el (Info-try-follow-nearest-node): Move search for footnote
	above search for node name to prevent missing a footnote (bug#14717).

2013-06-27  Stephen Berman  <stephen.berman@gmx.net>

	* obsolete/otodo-mode.el: Add obsolescence info to file header.

2013-06-27  Leo Liu  <sdl.web@gmail.com>

	* net/eww.el (eww-read-bookmarks): Check file size.

2013-06-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--defalias-fset): Move advice back to
	advice--pending if newdef is nil or an autoload (bug#13820).
	(advice-mapc): New function.

2013-06-26  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-mode): Undo isn't necessary in eww buffers,
	probably.
	(eww-mode-map): Add a menu bar.
	(eww-add-bookmark): New command.
	(eww-bookmark-mode): New mode and commands.
	(eww-add-bookmark): Remove newlines from the title.
	(eww-bookmark-browse): Don't bug out if it's the only window.

2013-06-26  Glenn Morris  <rgm@gnu.org>

	* htmlfontify.el (hfy-triplet): Handle unspecified-fg, bg.
	(hfy-size): Handle ttys.  (Bug#14668)

	* info-xref.el: Update for Texinfo 5 change in *note format.
	(info-xref-node-re, info-xref-note-re): New constants.
	(info-xref-check-buffer): Use info-xref-note-re.

2013-06-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (set-variable): Use read-from-minibuffer (bug#14710).

	* emacs-lisp/package.el (package--add-to-archive-contents): Add missing
	nil terminate the loop (bug#14718).

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el: Rework history traversal.  When going forward/back,
	put these actions into the history, too, so that they can be
	replayed.
	(eww-render): Move the history reset to the correct buffer.

2013-06-25  Juri Linkov  <juri@jurta.org>

	* files-x.el (modify-dir-local-variable): Change the header comment
	in the file with directory local variables.  (Bug#14692)

	* files-x.el (read-file-local-variable-value): Add `default'.
	(Bug#14710)

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-make-unique-file-name): Create a unique file
	name before saving to entering `y' accidentally asynchronously.

2013-06-25  Ivan Kanis  <ivan@kanis.fr>

	* net/eww.el (eww-download): New command and keystroke.

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-copy-page-url): Change name of command.

	* net/shr.el (shr-map): Change `shr-copy-url' from `u' to `w' to
	be more consistent with Info and dired.

	* net/eww.el (eww-mode-map): Ditto.

2013-06-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el: Use lexical-binding.  Include obsolete
	packages from archives.
	(package-archive-contents): Change format; include obsolete packages.
	(package-desc): Use `dir' to mark builtin packages.
	(package--from-builtin): Set the `dir' field to `builtin'.
	(generated-autoload-file, version-control): Declare.
	(package-compute-transaction): Change first arg and return value to be
	lists of package-descs.  Adjust to new package-archive-contents format.
	(package--add-to-archive-contents): Adjust to new
	package-archive-contents format.
	(package-download-transaction): Arg is now a list of package-descs.
	(package-install): If `pkg' is a package name, pass it as
	a requirement, so it is subject to the usual (e.g. disabled) checks.
	(describe-package): Accept package-desc as well.
	(describe-package-1): Describe a specific package-desc.  Add links to
	other package-descs for the same package name.
	(package-menu-describe-package): Pass the actual package-desc.
	(package-menu-mode): Add to tabulated-list-revert-hook so revert-buffer
	works correctly.
	(package-desc-status): New function.
	(package-menu--refresh): New function, extracted
	from package-menu--generate.
	(package-menu--generate): Use it.
	(package-delete): Update package-alist.
	(package-menu-execute): Don't call package-initialize.

	* progmodes/idlw-toolbar.el, progmodes/idlw-shell.el,
	progmodes/idlw-help.el, progmodes/idlw-complete-structtag.el,
	progmodes/ebnf-yac.el, progmodes/ebnf-otz.el, progmodes/ebnf-iso.el,
	progmodes/ebnf-ebx.el, progmodes/ebnf-dtd.el, progmodes/ebnf-bnf.el,
	progmodes/ebnf-abn.el, emacs-lisp/package-x.el, emacs-lisp/cl-seq.el,
	emacs-lisp/cl-macs.el: Neuter the "Version:" header.

2013-06-25  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--state-get-1): Workaround for bug#14527.
	https://lists.gnu.org/archive/html/emacs-devel/2013-06/msg00941.html

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-back-url): Implement the history by stashing all
	the data into a list.
	(eww-forward-url): Allow going forward in the history, too.

2013-06-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files-x.el (read-file-local-variable-value): Use read-from-minibuffer
	for values and use read--expression for expressions (bug#14710).
	(read-file-local-variable): Avoid setq.
	(read-file-local-variable-mode): Use minor-mode-list.

2013-06-25  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* textmodes/bibtex.el (bibtex-generate-url-list): Add support
	for DOI URLs.

2013-06-25  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* textmodes/bibtex.el (bibtex-mode, bibtex-set-dialect):
	Update imenu-support when dialect changes.

2013-06-25  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-internal): Allow forward slash on windows.

2013-06-24  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww): Start of strings is \\`, not ^.

2013-06-24  Ivan Kanis  <ivan@kanis.fr>

	* net/shr.el (shr-browse-url): Fix interactive spec.

	* net/eww.el (eww): Add a trailing slash to domain names.

2013-06-24  Juanma Barranquero  <lekktu@gmail.com>

	* faces.el (face-spec-recalc): Revert part of 2013-06-23T20:29:18Z!lekktu@gmail.com (bug#14705).

2013-06-24  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-browse-url): Use an external browser if given a
	prefix.

	* net/eww.el (eww-external-browser): Move to shr.

2013-06-24  Ivan Kanis  <ivan@kanis.fr>

	* net/eww.el (eww): Work more correctly for file: URLs.
	(eww-detect-charset): Allow quoted charsets.
	(eww-yank-page-url): New command and keystroke.

2013-06-24  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-make-context): Check if PROTOCOL is valid; embed the
	file name of gpg executable.
	(epg-context-program): New function.
	(epg-context-home-directory): New function.
	(epg-context-set-program): New function.
	(epg-context-set-home-directory): New function.
	(epg--start): Use `epg-context-program' instead of
	'epg-gpg-program'.
	(epg--list-keys-1): Likewise.

2013-06-24  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-internal): Fix bug#14620.

2013-06-23  Juanma Barranquero  <lekktu@gmail.com>

	* faces.el (face-documentation): Simplify.
	(read-face-attribute, tty-find-type, x-resolve-font-name):
	Use `string-match-p'.
	(list-faces-display): Use `string-match-p'.  Simplify.
	(face-spec-recalc): Check face to avoid face alias loops.
	(read-color): Use `string-match-p' and non-capturing parenthesis.

2013-06-23  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-rescale-image): Use the new
	:max-width/:max-height functionality.

2013-06-23  Ivan Kanis  <ivan@kanis.fr>

	* net/eww.el (eww-search-prefix): New variable.
	(eww): Use it.
	(eww-external-browser): New variable.
	(eww-mode-map): New keystroke.
	(eww-browse-with-external-browser): New command.

	* net/eww.el: Bind `C-c C-c' to "submit" in all form keymaps.

2013-06-23  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/tabulated-list.el (tabulated-list-init-header):
	Don't skip aligning the next header field when padding is 0;
	otherwise, field width is not respected unless the title is as
	wide as the field.

2013-06-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-el-version): Remove.
	(package-process-define-package): Fix inf-loop.
	(package-install): Allow symbols as arguments again.

2013-06-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Move `catch',
	add some more keyword-like methods.
	https://lists.gnu.org/archive/html/emacs-devel/2013-06/msg00911.html

2013-06-22  Juanma Barranquero  <lekktu@gmail.com>

	* bs.el (bs-buffer-show-mark): Make defvar-local.
	(bs-mode): Use setq-local.

	* emacs-lock.el (emacs-lock-mode, emacs-lock--old-mode)
	(emacs-lock--try-unlocking): Make defvar-local.

2013-06-22  Glenn Morris  <rgm@gnu.org>

	* play/cookie1.el (cookie-apropos): Minor simplification.

	* progmodes/gdb-mi.el (gdb-mapcar*): Remove, replace with cl-mapcar.

2013-06-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (auto-mode-alist): Do not use
	`regexp-opt', it breaks the build during dumping.

2013-06-21  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Highlight keyword-like methods on Kernel and Module with
	font-lock-builtin-face.
	(auto-mode-alist): Consolidate different entries into one regexp
	and add more *file-s.

2013-06-21  Stephen Berman  <stephen.berman@gmx.net>

	* obsolete/otodo-mode.el: Move and rename from calendar/todo-mode.el.

	* calendar/diary-lib.el (diary-goto-entry-function): New variable.
	(diary-entry): Use it in the action of this button type instead of
	diary-goto-entry.

	* calendar/todo-mode.el: New version.
	(todo-add-category): Append new category to end of file and give
	it the highest number, instead of putting it at the beginning and
	giving it 0.  Incorporate noninteractive functionality.
	(todo-forward-category): Adapt to 1-based category numbering.
	Allow skipping over archived categories.
	(todo-backward-category): Derive from todo-forward-category.
	(todo-backward-item, todo-forward-item): Make noninteractive and
	delegate interactive part to new commands.  Make sensitive to done items.
	(todo-categories): Make value an alist of category names and
	vectors of item counts.
	(todo-category-beg): Make a defconst.
	(todo-category-number): Use 1 instead of 0 as initial value.
	(todo-category-select): Make sensitive to overlays, optional item
	highlighting and done items.
	(todo-delete-item): Make sensitive to overlays and marked and done items.
	(todo-edit-item): Make sensitive to overlays and editing of
	date/time header optional.  Add format checks.
	(todo-edit-multiline): Rename to todo-edit-multiline-item.  Make a
	no-op if point is not on an item.  Advertise using todo-edit-quit.
	(todo-edit-mode): Make sensitive to new format, font-locking, and
	multiple todo files.
	(todo-insert-item, todo-insert-item-here): Derive from
	todo-basic-insert-item and extend functionality.
	(todo-item-end, todo-item-start): Make sensitive to done items.
	(todo-item-string): Don't return text properties.  Restore point.
	(todo-jump-to-category): Make sensitive to multiple todo files and
	todo archives.  Use extended category completion.
	(todo-lower-item, todo-raise-item): Rename to *-priority and
	derive from todo-set-item-priority.
	(todo-mode): Derive from special-mode.  Make sensitive to new
	format, font-locking and multiple todo files.  Make read-only.
	(todo-mode-map): Don't suppress digit keys, so they can supply
	prefix arguments.  Add many new key bindings.
	(todo-prefix): Insert as an overlay instead of file text.
	Change semantics from diary date expression to purely visual mark.
	(todo-print): Rename to todo-print-buffer.  Make buffer display
	features printable.  Remove option to restrict number of items
	printed.  Add option to print to file.
	(todo-print-function): Rename to todo-print-buffer-function.
	(todo-quit): Extend to handle exiting new todo modes.
	(todo-remove-item): Make sensitive to overlays.
	(todo-save): Extend to buffers of filtered items.
	(todo-show): Make sensitive to done items, multiple todo files and
	new todo modes.  Offer to convert legacy todo file before creating
	first new todo file.
	(todo-show-priorities): Rename to todo-top-priorities.
	Change semantics of value 0.
	(todo-top-priorities): Rename to todo-filter-top-priorities,
	derive from todo-filter-items and extend functionality.
	(todo-save-top-priorities): Rename to todo-save-filtered-items-buffer
	and extend functionality to other types of filtered items.
	(todo-add-item-non-interactively, todo-ask-p, todo-cat-slct)
	(todo-category-end, todo-category-sep, todo-cats, todo-cmd-back)
	(todo-cmd-done, todo-cmd-edit, todo-cmd-forw, todo-cmd-inst)
	(todo-cmd-kill, todo-cmd-lowr, todo-cmd-next, todo-cmd-prev)
	(todo-cmd-rais, todo-cmd-save, todo-completing-read, todo-cp)
	(todo-edit-mode-hook, todo-entry-prefix-function)
	(todo-entry-timestamp-initials, todo-file-do, todo-file-done)
	(todo-file-item, todo-file-top, todo-header, todo-initial-setup)
	(todo-initials, todo-insert-threshold, todo-item-string-start)
	(todo-line-string, todo-menu, todo-mode-hook)
	(todo-more-important-p, todo-previous-answer, todo-previous-line)
	(todo-print-priorities, todo-remove-separator)
	(todo-save-top-priorities-too, todo-string-count-lines)
	(todo-string-multiline-p, todo-time-string-format)
	(todo-tmp-buffer-name): Remove.
	(todo-add-file, todo-archive-done-item, todo-choose-archive)
	(todo-convert-legacy-files, todo-copy-item, todo-delete-category)
	(todo-edit-category-diary-inclusion)
	(todo-edit-category-diary-nonmarking, todo-edit-done-item-comment)
	(todo-edit-file, todo-edit-item-date-day)
	(todo-edit-item-date-day-name, todo-edit-item-date-from-calendar)
	(todo-edit-item-date-month, todo-edit-item-date-to-today)
	(todo-edit-item-date-year, todo-edit-item-diary-inclusion)
	(todo-edit-item-diary-nonmarking, todo-edit-item-header)
	(todo-edit-item-time, todo-edit-quit, todo-filter-diary-items)
	(todo-filter-diary-items-multifile, todo-filter-regexp-items)
	(todo-filter-regexp-items-multifile, todo-filter-top-priorities)
	(todo-filter-top-priorities-multifile, todo-find-archive)
	(todo-find-filtered-items-file, todo-go-to-source-item)
	(todo-insert-item-from-calendar, todo-item-done, todo-item-undone)
	(todo-jump-to-archive-category, todo-lower-category)
	(todo-mark-category, todo-marked-item-p, todo-merge-category)
	(todo-move-category, todo-move-item, todo-next-button)
	(todo-next-item, todo-padded-string, todo-powerset)
	(todo-previous-button, todo-previous-item)
	(todo-print-buffer-to-file, todo-raise-category)
	(todo-rename-category, todo-repair-categories-sexp, todo-search)
	(todo-set-category-number, todo-set-item-priority)
	(todo-set-top-priorities-in-category)
	(todo-set-top-priorities-in-file, todo-show-categories-table)
	(todo-sort-categories-alphabetically-or-numerically)
	(todo-sort-categories-by-archived, todo-sort-categories-by-diary)
	(todo-sort-categories-by-done, todo-sort-categories-by-todo)
	(todo-toggle-item-header, todo-toggle-item-highlighting)
	(todo-toggle-mark-item, todo-toggle-prefix-numbers)
	(todo-toggle-view-done-items, todo-toggle-view-done-only)
	(todo-unarchive-items, todo-unmark-category): New commands.
	(todo-absolute-file-name, todo-add-to-buffer-list)
	(todo-adjusted-category-label-length, todo-basic-edit-item-header)
	(todo-basic-insert-item, todo-category-completions)
	(todo-category-number, todo-category-string-matcher-1)
	(todo-category-string-matcher-2, todo-check-filtered-items-file)
	(todo-check-format, todo-clear-matches)
	(todo-comment-string-matcher, todo-convert-legacy-date-time)
	(todo-current-category, todo-date-string-matcher)
	(todo-define-insertion-command, todo-diary-expired-matcher)
	(todo-diary-goto-entry, todo-diary-item-p)
	(todo-diary-nonmarking-matcher, todo-display-as-todo-file)
	(todo-display-categories, todo-display-sorted, todo-done-item-p)
	(todo-done-item-section-p, todo-done-separator)
	(todo-done-string-matcher, todo-files, todo-filter-items)
	(todo-filter-items-1, todo-filter-items-filename, todo-find-item)
	(todo-gen-arglists, todo-get-count, todo-get-overlay, todo-indent)
	(todo-insert-category-line, todo-insert-item-from-calendar)
	(todo-insert-sort-button, todo-insert-with-overlays)
	(todo-insertion-command-name, todo-insertion-key-bindings)
	(todo-label-to-key, todo-longest-category-name-length)
	(todo-make-categories-list, todo-mode-external-set)
	(todo-mode-line-control, todo-modes-set-1, todo-modes-set-2)
	(todo-modes-set-3, todo-multiple-filter-files)
	(todo-nondiary-marker-matcher, todo-prefix-overlays)
	(todo-read-category, todo-read-date, todo-read-dayname)
	(todo-read-file-name, todo-read-time)
	(todo-reevaluate-category-completions-files-defcustom)
	(todo-reevaluate-default-file-defcustom)
	(todo-reevaluate-filelist-defcustoms)
	(todo-reevaluate-filter-files-defcustom)
	(todo-reset-and-enable-done-separator, todo-reset-comment-string)
	(todo-reset-done-separator, todo-reset-done-separator-string)
	(todo-reset-done-string, todo-reset-global-current-todo-file)
	(todo-reset-highlight-item, todo-reset-nondiary-marker)
	(todo-reset-prefix, todo-set-categories)
	(todo-set-date-from-calendar, todo-set-show-current-file)
	(todo-set-top-priorities, todo-short-file-name)
	(todo-show-current-file, todo-sort, todo-time-string-matcher)
	(todo-total-item-counts, todo-update-buffer-list)
	(todo-update-categories-display, todo-update-categories-sexp)
	(todo-update-count, todo-validate-name, todo-y-or-n-p):
	New functions.
	(todo-archive-mode, todo-categories-mode, todo-filtered-items-mode):
	New major modes.
	(todo-categories, todo-display, todo-edit, todo-faces)
	(todo-filtered): New defgroups.
	(todo-archived-only, todo-button, todo-category-string, todo-date)
	(todo-diary-expired, todo-done, todo-done-sep, todo-comment)
	(todo-mark, todo-nondiary, todo-prefix-string, todo-search)
	(todo-sorted-column, todo-time, todo-top-priority): New deffaces.
	(todo-add-item-if-new-category, todo-always-add-time-string)
	(todo-categories-align, todo-categories-archived-label)
	(todo-categories-category-label, todo-categories-diary-label)
	(todo-categories-done-label, todo-categories-number-separator)
	(todo-categories-todo-label, todo-categories-totals-label)
	(todo-category-completions-files, todo-completion-ignore-case)
	(todo-default-todo-file, todo-diary-nonmarking, todo-directory)
	(todo-done-separator-string, todo-done-string)
	(todo-files-function, todo-filter-done-items, todo-filter-files)
	(todo-highlight-item, todo-include-in-diary, todo-indent-to-here)
	(todo-initial-category, todo-initial-file, todo-item-mark)
	(todo-legacy-date-time-regexp, todo-mode-line-function)
	(todo-nondiary-marker, todo-number-prefix)
	(todo-print-buffer-function, todo-show-current-file)
	(todo-show-done-only, todo-show-first, todo-show-with-done)
	(todo-skip-archived-categories, todo-top-priorities-overrides)
	(todo-undo-item-omit-comment, todo-use-only-highlighted-region)
	(todo-visit-files-commands, todo-wrap-lines, todo-y-with-space):
	New defcustoms.
	(todo-category-done, todo-date-pattern, todo-date-string-start)
	(todo-diary-items-buffer, todo-done-string-start)
	(todo-filtered-items-buffer, todo-item-start)
	(todo-month-abbrev-array, todo-month-name-array)
	(todo-nondiary-end, todo-nondiary-start, todo-regexp-items-buffer)
	(todo-top-priorities-buffer): New defconsts.
	(todo-archive-mode-map, todo-archives, todo-categories-mode-map)
	(todo-categories-with-marks, todo-category-string-face)
	(todo-comment-face, todo-comment-string, todo-current-todo-file)
	(todo-date-face, todo-date-from-calendar, todo-descending-counts)
	(todo-diary-expired-face, todo-done-face, todo-done-sep-face)
	(todo-done-separator, todo-edit-buffer, todo-edit-mode-map)
	(todo-file-buffers, todo-files, todo-filtered-items-mode-map)
	(todo-font-lock-keywords, todo-global-current-todo-file)
	(todo-insertion-commands, todo-insertion-commands-arg-key-list)
	(todo-insertion-commands-args)
	(todo-insertion-commands-args-genlist)
	(todo-insertion-commands-names, todo-insertion-map)
	(todo-key-bindings-t, todo-key-bindings-t+a)
	(todo-key-bindings-t+a+f, todo-key-bindings-t+f, todo-mode-map)
	(todo-multiple-filter-files, todo-multiple-filter-files-widget)
	(todo-nondiary-face, todo-print-buffer, todo-time-face)
	(todo-visited): New variables.

2013-06-21  Glenn Morris  <rgm@gnu.org>

	* play/cookie1.el (cookie-apropos): Add optional display argument.
	* obsolete/yow.el (apropos-zippy): Use cookie-apropos.
	(psychoanalyze-pinhead): Use cookie-doctor.

2013-06-21  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/package.el (tar-get-file-descriptor)
	(tar--extract): Declare.

2013-06-21  Eduard Wiebe  <usenet@pusto.de>

	Extend flymake's warning predicate to be a function (bug#14217).
	* progmodes/flymake.el (flymake-warning-predicate): New.
	(flymake-parse-line): Use it.
	(flymake-warning-re): Make obsolete alias to
	`flymake-warning-predicate'.

2013-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-alist): Include obsolete packages.
	(package-obsolete-list): Remove.
	(package-activate): Remove min-version argument.  Add `force' argument.
	Adjust to new package-alist format.
	(package-mark-obsolete): Remove.
	(package-unpack): Force reload of the package's autoloads.
	(package-installed-p): Check builtins if the installed package is not
	recent enough.
	(package-initialize): Don't reset package-obsolete-list.
	Don't specify which package version to activate.
	(package-process-define-package, describe-package-1)
	(package-menu--generate): Adjust to new package-alist format.

2013-06-21  Juanma Barranquero  <lekktu@gmail.com>

	* allout-widgets.el (allout-widgets-mode-off)
	(allout-widgets-mode-on, allout-widgets-pre-command-business)
	(allout-widgets-post-command-business)
	(allout-widgets-after-copy-or-kill-function)
	(allout-widgets-after-undo-function, allout-test-range-overlaps)
	(allout-decorate-item-and-context)
	(allout-graphics-modification-handler): Fix typos in docstrings.
	(allout-get-or-create-parent-widget): Use `looking-at-p'.

	* cmuscheme.el (scheme-start-file): Doc fix.
	(inferior-scheme-mode, switch-to-scheme): Fix typos in docstrings.
	(scheme-input-filter): Use `string-match-p'.

	* composite.el (compose-gstring-for-terminal): Fix typo in docstring.

	* dired-x.el: Use Dired consistently in docstrings.

	* dired.el: Use Dired consistently in docstrings.
	(dired-readin, dired-mode): Use `setq-local'.
	(dired-switches-alist): Make defvar-local.
	(dired-buffers-for-dir): Use `zerop'.
	(dired-safe-switches-p, dired-switches-escape-p)
	(dired-insert-old-subdirs, dired-move-to-end-of-filename)
	(dired-glob-regexp, dired-in-this-tree, dired-goto-file-1)
	(dired-sort-set-mode-line, dired-sort-toggle, dired-sort-R-check)
	(dired-goto-next-nontrivial-file): Use `string-match-p'.
	(dired-align-file, dired-insert-directory, dired-mark-files-in-region)
	(dired-toggle-marks, dired-mark-files-containing-regexp)
	(dired-mark-symlinks, dired-mark-directories, dired-mark-executables)
	(dired-flag-auto-save-files, dired-flag-backup-files):
	Use `looking-at-p'.
	(dired-mark-files-regexp, dired-build-subdir-alist):
	Use `string-match-p', `looking-at-p'.

	* dos-w32.el (untranslated-canonical-name, untranslated-file-p)
	(direct-print-region-helper): Use `string-match-p'.

2013-06-21  Leo Liu  <sdl.web@gmail.com>

	* comint.el (comint-redirect-results-list-from-process):
	Fix infinite loop.

2013-06-21  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-update-header-line-format): Quote % characters.

2013-06-21  Glenn Morris  <rgm@gnu.org>

	* play/cookie1.el (cookie): New custom group.
	(cookie-file): New option.
	(cookie-check-file): New function.
	(cookie): Make it interactive.  Make start and end messages optional.
	Interactively, display the result.  Default to cookie-file.
	(cookie-insert): Default to cookie-file.
	(cookie-snarf): Make start and end messages optional.
	Default to cookie-file.  Use with-temp-buffer.
	(cookie-read): Rename from read-cookie.
	Make start and end messages optional.  Default to cookie-file.
	(cookie-shuffle-vector): Rename from shuffle-vector.  Use dotimes.
	Do not autoload it.
	(cookie-apropos, cookie-doctor): New functions, copied from yow.el
	* obsolete/yow.el (read-zippyism): Use new name for read-cookie.

2013-06-21  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode): Backward compatibility fix.

2013-06-21  Glenn Morris  <rgm@gnu.org>

	* font-lock.el (lisp-font-lock-keywords-2): Add with-eval-after-load.

2013-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>
	    Daniel Hackney  <dan@haxney.org>

	* emacs-lisp/package.el: Use tar-mode rather than tar executable.
	Consolidate the single-file vs tarball code.
	(package-desc-suffix): New function.
	(package-desc-full-name): Don't bother inlining it.
	(package-load-descriptor): Return the new package-desc.
	(package-mark-obsolete): Remove unused arg `package'.
	(package-unpack): Make it work for single files as well.
	Make it update package-alist.
	(package--make-autoloads-and-stuff): Rename from
	package--make-autoloads-and-compile.  Don't compile any more.
	(package--compile): New function.
	(package-generate-description-file): New function, extracted from
	package-unpack-single.
	(package-unpack-single): Remove.
	(package--with-work-buffer): Add indentation and debugging info.
	(package-download-single): Remove.
	(package-install-from-archive): Rename from package-download-tar, make
	it take a pkg-desc, and make it work for single files as well.
	(package-download-transaction): Simplify.
	(package-tar-file-info): Remove `file' arg.  Rewrite not to use an
	external tar program.
	(package-install-from-buffer): Remove `pkg-desc' argument.
	Use package-tar-file-info for tar-mode buffers.
	(package-install-file): Simplify accordingly.
	(package-archive-base): Change to take a pkg-desc.
	* tar-mode.el (tar--check-descriptor): New function, extracted from
	tar-get-descriptor.
	(tar-get-descriptor): Use it.
	(tar-get-file-descriptor): New function.
	(tar--extract): New function, extracted from tar-extract.
	(tar--extract): Use it.
	* emacs-lisp/package-x.el (package-upload-file): Decode the file, in
	case the summary uses non-ascii.  Adjust to new calling convention of
	package-tar-file-info.

2013-06-21  Leo Liu  <sdl.web@gmail.com>

	* comint.el (comint-redirect-results-list-from-process):
	Fix random delay.  (Bug#14681)

2013-06-21  Juanma Barranquero  <lekktu@gmail.com>

	* profiler.el (profiler-format-number): Use log, not log10.

2013-06-20  Juanma Barranquero  <lekktu@gmail.com>

	* term/x-win.el (emacs-session-filename): Use `locate-user-emacs-file'.

2013-06-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-loaddefs.el: Don't version-control any more.
	* emacs-lisp/cl-lib.el: Load cl-macs when cl-loaddefs is not
	yet available.
	* Makefile.in (AUTOGEN_VCS): Move cl-loaddefs.el...
	(AUTOGENEL): ... here.
	* emacs-lisp/cl-macs.el (cl--sublis): New function.
	(cl--defsubst-expand): Use it.

2013-06-20  Paul Eggert  <eggert@cs.ucla.edu>

	* subr.el (log10): Move here from C code, and declare as obsolete.
	All uses of (log10 X) replaced with (log X 10).

2013-06-20  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/tabulated-list.el (tabulated-list-format): Fix typo.
	Declare with `defvar-local'.
	(tabulated-list-use-header-line, tabulated-list-entries)
	(tabulated-list-padding, tabulated-list-printer)
	(tabulated-list-sort-key): Declare with `defvar-local'.
	(tabulated-list-init-header, tabulated-list-print-fake-header):
	Use `setq-local'.

2013-06-20  Michael Albinus  <michael.albinus@gmx.de>

	* arc-mode.el (archive-mode): Add `archive-write-file' to
	`write-contents-functions' also for remote files.  (Bug#14652)

2013-06-20  Juanma Barranquero  <lekktu@gmail.com>

	* cus-edit.el (custom-commands): Fix typos.
	(custom-display): Fix tooltip text.
	(custom-magic-alist, custom-filter-face-spec, custom-group-members):
	Fix typos in docstrings.
	(custom--initialize-widget-variables, Custom-mode): Use `setq-local'.
	(custom-unlispify-menu-entry, custom-magic-value-create)
	(custom-add-see-also, custom-group-value-create): Use ?\s.
	(custom-guess-type, customize-apropos, editable-field)
	(custom-face-value-create): Use `string-match-p'.
	(custom-save-variables, custom-save-faces): Use `looking-at-p'.

	* custom.el (custom-load-symbol): Use `string-match-p'.

	* ansi-color.el: Convert to lexical binding.
	(ansi-colors): Fix URL.
	(ansi-color-context, ansi-color-context-region): Use defvar-local.
	(ansi-color-apply-sequence, ansi-color-map): Fix typos in docstrings.
	(ansi-color-make-color-map): Rename local var ansi-color-map to map.

2013-06-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-process-text-input): Display passwords as asterisks.

	* net/shr.el (shr-make-table-1): Protect against invalid column-spans.

2013-06-19  Tom Tromey  <tromey@redhat.com>

	* net/eww.el (eww-top-url): Remove.
	(eww-home-url, eww-start-url, eww-contents-url): New defvars.
	(eww-render): Set new variables.  Don't set eww-top-url.
	(eww-handle-link): Handle "prev", "home", and "contents".
	Downcase the rel text.
	(eww-top-url): Choose best top URL.

2013-06-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el: Rewrite to implement form elements "by hand" instead of
	relying in widget.el.  Using widget.el leads to too many
	user interface inconsistencies.
	(eww-self-insert): Implement entering commands in text fields.
	(eww-process-text-input): New function to make text input field editing
	work.
	(eww-submit): Rewrite to use the new-style form methods.
	(eww-select-display): Display the correct selected item.
	(eww-change-select): Implement changing the select value.
	(eww-toggle-checkbox): Implement radio/checkboxes.
	(eww-update-field): Fix compilation error.
	(eww-tag-textarea): Implement <textarea>.

	* net/shr.el (shr-urlify): Use `keymap' instead of `local-map' so that
	we don't shadow mode-specific bindings.

	* net/eww.el (eww-browse-url): Don't push stuff onto history if there's
	nothing to push.

	* net/shr.el (shr-map): Bind [down-mouse-1] to browse URLs.

2013-06-19  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/eieio.el (defclass): Make it eval-and-compile once more.

2013-06-19  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el (tramp-adb-get-toolbox): Remove function, it is
	not needed.

	* net/tramp-sh.el (tramp-find-shell): Don't set "busybox" property.

2013-06-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/browse-url.el (browse-url-browser-function):
	`eww-browse-url' has the right calling signature, `eww' does not.

2013-06-19  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-file-form-autoload):
	Only eval autoloaded macros.
	(byte-compile-autoload): Only give the macro warning for macros.

	* progmodes/cperl-mode.el (ps-bold-faces, ps-italic-faces)
	(ps-underlined-faces): Declare.

	* progmodes/idlwave.el (func-menu): Only set it up on XEmacs.
	(speedbar-add-supported-extension): Declare.

	* international/titdic-cnv.el (tit-process-header, miscdic-convert):
	Don't include a date stamp in the header of the generated file;
	it leads to needless differences between output files.

2013-06-19  Michael Albinus  <michael.albinus@gmx.de>

	* net/secrets.el (secrets-struct-secret-content-type):
	Replace check of introspection data by a test call of "CreateItem".
	Some servers do not offer introspection.

2013-06-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-pair-mode): Improve interaction with
	electric-layout-mode.
	(electric-pair-default-inhibit): Don't assume (eq char (char-before)).
	(electric-pair-syntax): Use text-mode-syntax-table in comments
	and strings.
	(electric-pair--insert): New function.
	(electric-pair-post-self-insert-function): Use it and
	electric--after-char-pos.

2013-06-19  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-help): Fix regexp.

2013-06-18  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-make-table-1): Implement <td rowspan>.
	(shr-table-horizontal-line): Allow nil as a value, and change the
	default.
	(shr-insert-table-ruler): Respect the nil value.

2013-06-18  Tom Tromey  <tromey@barimba>

	* net/eww.el (eww-next-url, eww-previous-url, eww-up-url, eww-top-url):
	New defvars.
	(eww-open-file): New defun.
	(eww-render): Initialize new variables.
	(eww-display-html): Handle "link" and "a".
	(eww-handle-link, eww-tag-link, eww-tag-a): New defuns.
	(eww-mode-map): Move "p" to "l".  Bind "p", "n", "t", and "u".
	(eww-back-url): Rename from eww-previous-url.
	(eww-next-url, eww-previous-url, eww-up-url, eww-top-url):
	New defuns.

2013-06-18  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-before-regexp-re):
	Distinguish ternary operator tokens from slash symbol and slash
	char literal.

2013-06-18  Juanma Barranquero  <lekktu@gmail.com>

	Convert symbol prettification into minor mode and global minor mode.

	* progmodes/prog-mode.el (prettify-symbols-alist): Rename from
	`prog-prettify-symbols', and make a local defvar instead of defcustom.
	(prettify-symbols--keywords): Rename from
	`prog-prettify-symbols-alist' and make a local defvar.
	(prettify-symbols--compose-symbol): Rename from
	`prog--prettify-font-lock-compose-symbol'.
	(prettify-symbols--make-keywords): Rename from
	`prog-prettify-font-lock-symbols-keywords' and simplify.
	(prog-prettify-install): Remove.
	(prettify-symbols-mode): New minor mode, based on
	`prog-prettify-install'.
	(turn-on-prettify-symbols-mode): New function.
	(global-prettify-symbols-mode): New globalized minor mode.

	* emacs-lisp/lisp-mode.el (lisp-mode-variables):
	* progmodes/cfengine.el (cfengine3-mode):
	* progmodes/perl-mode.el (perl-mode): Don't call
	`prog-prettify-install'; set `prettify-symbols-alist' instead.

2013-06-18  Juri Linkov  <juri@jurta.org>

	* files-x.el (modify-file-local-variable-message): New function.
	(modify-file-local-variable)
	(modify-file-local-variable-prop-line): Add arg INTERACTIVE
	and call `modify-file-local-variable-message' when it's non-nil.
	(add-file-local-variable, delete-file-local-variable)
	(add-file-local-variable-prop-line)
	(delete-file-local-variable-prop-line): Add arg INTERACTIVE
	and use it.  (Bug#9820)

2013-06-18  Juri Linkov  <juri@jurta.org>

	* emulation/vi.el (vi-shell-op):
	* emulation/vip.el (vip-execute-com, ex-command):
	* emulation/viper-cmd.el (viper-exec-bang):
	* emulation/viper-ex.el (ex-command): Add non-nil arg REPLACE to
	the call of `shell-command-on-region'.  (Bug#14637)

	* simple.el (shell-command-on-region): Doc fix.

2013-06-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-custom.el: Remove misleading Version: header
	(bug#14633).

2013-06-18  Glenn Morris  <rgm@gnu.org>

	* net/eww.el, net/shr.el, net/shr-color.el: Move here from gnus/.

	* newcomment.el (comment-search-forward, comment-search-backward):
	Doc fix.  (Bug#14376)

2013-06-18  Juanma Barranquero  <lekktu@gmail.com>

	* face-remap.el (buffer-face-toggle): Fix typo in docstring.
	(buffer-face-mode-invoke): Doc fix.

2013-06-18  Matthias Meulien  <orontee@gmail.com>

	* tabify.el (untabify, tabify): With prefix, apply to entire buffer.
	<https://lists.gnu.org/archive/html/emacs-devel/2013-03/msg00545.html>

2013-06-18  Glenn Morris  <rgm@gnu.org>

	* generic-x.el (bat-generic-mode, rc-generic-mode, rul-generic-mode):
	Replace obsolete function generic-make-keywords with its expansion.

	* progmodes/python.el (ffap-alist): Declare.

	* textmodes/reftex.el (bibtex-mode-map): Declare.

2013-06-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el: Update package-alist after install (bug#14632).
	(package-unpack, package-unpack-single): Return the pkg-dir.
	(package-download-transaction): Use it to update package-alist.

2013-06-17  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/browse-url.el (browse-url-browser-function): Add `eww' as a
	possible choice.

2013-06-17  Juri Linkov  <juri@jurta.org>

	* net/webjump.el (webjump-sample-sites): Add DuckDuckGo.

2013-06-17  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-load-descriptor):
	Remove `with-syntax-table' call, `read' doesn't need it.
	https://lists.gnu.org/archive/html/emacs-devel/2013-06/msg00539.html

2013-06-17  Juanma Barranquero  <lekktu@gmail.com>

	* startup.el (command-line): Expand package name returned by
	`package--description-file' (bug#14639).

2013-06-17  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-load-descriptor): Do not call
	`emacs-lisp-mode', just use its syntax table.

2013-06-17  Juanma Barranquero  <lekktu@gmail.com>

	* progmodes/prog-mode.el (prog-prettify-install): Add `composition' to
	`font-lock-extra-managed-props' if any prettifying keyword is added.
	(prog--prettify-font-lock-compose-symbol): Use ?\s instead of ?\ .
	(prog-mode): Use `setq-local'.

2013-06-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/characters.el (standard-case-table): Set syntax of ?»
	and ?« to punctuation.

2013-06-16  Juanma Barranquero  <lekktu@gmail.com>

	* progmodes/prog-mode.el (prog--prettify-font-lock-compose-symbol):
	Save relevant match data before calling `syntax-ppss' (bug#14595).

2013-06-15  Juri Linkov  <juri@jurta.org>

	* files-x.el (modify-file-local-variable-prop-line): Add local
	variables to the end of the existing comment on the first line.
	Use `file-auto-mode-skip' to skip interpreter magic line,
	and also skip XML declaration.

2013-06-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* startup.el (package--builtin-versions): New var.
	(package-subdirectory-regexp): Remove.
	(package--description-file): Hard code its value instead.

	* emacs-lisp/package.el: Don't activate packages older than builtin.
	(package-obsolete-list): Rename from package-obsolete-alist, and make
	it into a simple list of package-desc.
	(package-strip-version): Remove.
	(package-built-in-p): Use package--builtin-versions.
	(package-mark-obsolete): Simplify.
	(package-process-define-package): Mark it obsolete if older than the
	builtin version.
	(package-handle-response): Use line-end-position.
	(package-read-archive-contents, package--download-one-archive):
	Simplify.
	(package--add-to-archive-contents): Skip if older than the builtin or
	installed version.
	(package-menu-describe-package): Fix last change.
	(package-list-unversioned): New var.
	(package-menu--generate): Use it.

	* emacs-lisp/autoload.el: Manage package--builtin-versions.
	(autoload--insert-text, autoload--insert-cookie-text): New functions.
	(autoload-builtin-package-versions): New variable.
	(autoload-generate-file-autoloads): Use them.
	Remove the list of autoloaded functions/macros from the
	(autoload...) comments.

	* Makefile.in (autoloads): Set autoload-builtin-package-versions.

2013-06-15  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial): Don't jump to the next screen
	line as soon as it becomes visible.  Instead, continue enlarging
	the vscroll until the portion of a tall screen line that's left on
	display is about the height of the frame's default font.
	(Bug#14567)

2013-06-15  Glenn Morris  <rgm@gnu.org>

	* vc/vc-dispatcher.el (vc-compilation-mode): Avoid making
	compilation-error-regexp-alist void, or local while let-bound.

	* progmodes/make-mode.el (makefile-mode-syntax-table):
	Treat "=" as punctuation.  (Bug#14614)

2013-06-15  Juanma Barranquero  <lekktu@gmail.com>

	* help-fns.el (describe-variable):
	Add extra line for permanent-local variables.

2013-06-15  Simen Heggestøyl  <simenheg@ifi.uio.no>  (tiny change)

	* progmodes/scheme.el (scheme-font-lock-keywords-2):
	Add export, import, library.  (Bug#9164)
	(library): Set indent function.

2013-06-14  Glenn Morris  <rgm@gnu.org>

	* term/xterm.el (xterm--query):
	Stop after first matching handler.  (Bug#14615)

2013-06-14  Ivan Kanis  <ivan@kanis.fr>

	Add support for dired in saveplace.
	* dired.el (dired-initial-position-hook): New variable.
	(dired-initial-position): Call hook to place cursor position.
	* saveplace.el (save-place-to-alist): Add dired position.
	(save-place-dired-hook): New function.

2013-06-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (eval-after-load, set-temporary-overlay-map): Use indirection
	through a symbol rather than letrec.

	* emacs-lisp/package.el: Don't recompute dir.  Use pkg-descs more.
	(package-desc): Add `dir' field.
	(package-desc-full-name): New function.
	(package-load-descriptor): Combine the two arguments.  Don't use `load'.
	(package-maybe-load-descriptor): Remove.
	(package-load-all-descriptors): Just call package-load-descriptor.
	(package--disabled-p): New function.
	(package-desc-vers, package-desc-doc): Remove aliases.
	(package--dir): Remove function.
	(package-activate): Check if a package is disabled.
	(package-process-define-package): New function, extracted from
	define-package.
	(define-package): Turn into a place holder.
	(package-unpack-single, package-tar-file-info):
	Use package--description-file.
	(package-compute-transaction): Use package--disabled-p.
	(package-download-transaction): Don't call
	package-maybe-load-descriptor since they're all loaded anyway.
	(package-install): Change argument to be a pkg-desc.
	(package-delete): Use a single pkg-desc argument.
	(describe-package-1): Use package-desc-dir instead of package--dir.
	Use package-desc property instead of package-symbol.
	(package-install-button-action): Adjust accordingly.
	(package--push): Rewrite.
	(package-menu--print-info): Adjust accordingly.  Change the ID format
	to be a pkg-desc.
	(package-menu-describe-package, package-menu-get-status)
	(package-menu--find-upgrades, package-menu-mark-upgrades)
	(package-menu-execute, package-menu--name-predicate):
	Adjust accordingly.
	* startup.el (package--description-file): New function.
	(command-line): Use it.
	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Use package-desc-version.

	* emacs-lisp/bytecomp.el (byte-compile-force-lexical-warnings): New var.
	(byte-compile-preprocess): Use it.
	(byte-compile-file-form-defalias): Try a bit harder to use macros we
	can't quite recognize.
	(byte-compile-add-to-list): Remove.
	* emacs-lisp/cconv.el (cconv-warnings-only): New function.
	(cconv-closure-convert): Add assertion.

	* emacs-lisp/map-ynp.el: Use lexical-binding.
	(map-y-or-n-p): Remove unused vars `tail' and `object'.
	Factor out some repeated code.

2013-06-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (with-eval-after-load): New macro.
	(eval-after-load): Allow form to be a function.
	take advantage of lexical-binding.
	(do-after-load-evaluation): Use dolist and adjust to new format.
	* simple.el (bad-packages-alist): Use dolist and with-eval-after-load.

2013-06-13  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Display "symbol " and other search
	modes from `isearch-message-prefix' in the *Help* buffer.

	* isearch.el (isearch-query-replace): Add " symbol" and other
	possible search modes from `isearch-message-prefix' to the prompt.
	(isearch-occur): Use `with-isearch-suspended' to not exit Isearch
	when reading a regexp to collect.

2013-06-13  Juri Linkov  <juri@jurta.org>

	* isearch.el (word-search-regexp): Match whitespace if the search
	string begins or ends in whitespace.  The LAX arg is applied to
	both ends of the search string.  Use `regexp-quote' and explicit
	\< and \> instead of \b.  Use \` and \' instead of ^ and $.
	(isearch-symbol-regexp): Sync with `word-search-regexp' where word
	boundaries are replaced with symbol boundaries, and characters
	between symbols match non-word non-symbol syntax.  (Bug#14602)

2013-06-13  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-del-char): Don't exceed the length of
	`isearch-string' by the prefix arg.  (Bug#14563)

2013-06-13  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-yank-word, isearch-yank-line)
	(isearch-char-by-name, isearch-quote-char)
	(isearch-printing-char, isearch-process-search-char):
	Add optional count prefix arg.  (Bug#14563)

	* international/isearch-x.el
	(isearch-process-search-multibyte-characters):
	Add optional count prefix arg.

2013-06-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (internal-push-keymap, internal-pop-keymap): New functions.
	(set-temporary-overlay-map): Use them (bug#14095); and take advantage of
	lexical-binding.

2013-06-13  Vitalie Spinu  <spinuvit@gmail.com>

	* subr.el (set-temporary-overlay-map): Add on-exit argument.

2013-06-13  Glenn Morris  <rgm@gnu.org>

	* startup.el (tty-handle-args):
	Don't just discard "--" and anything after.  (Bug#14608)

	* emacs-lisp/lisp.el (forward-sexp, backward-sexp): Doc fixes.

2013-06-13  Michael Albinus  <michael.albinus@gmx.de>

	Implement changes in Secret Service API.  Make it backward compatible.
	* net/secrets.el (secrets-struct-secret-content-type): New defonst.
	(secrets-create-item): Use it.  Prefix properties with interface.

2013-06-13  Michael Hoffman  <9qobl2n02@sneakemail.com>  (tiny change)

	* term.el (term-suppress-hard-newline): New option.  (Bug#12017)
	(term-emulate-terminal): Respect term-suppress-hard-newline.

2013-06-13  E Sabof  <esabof@gmail.com>  (tiny change)

	* image-dired.el (image-dired-dired-toggle-marked-thumbs):
	Only remove a `thumb-file' overlay.  (Bug#14548)

2013-06-12  Grégoire Jadi  <daimrod@gmail.com>

	* mail/reporter.el (reporter-submit-bug-report):
	Handle missing package-name.  (Bug#14600)

2013-06-12  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* textmodes/reftex-cite.el (reftex-cite-regexp-hist)
	(reftex-citation-prompt, reftex-default-bibliography)
	(reftex-bib-or-thebib, reftex-get-bibfile-list)
	(reftex-pop-to-bibtex-entry, reftex-extract-bib-entries)
	(reftex-bib-sort-author, reftex-bib-sort-year)
	(reftex-bib-sort-year-reverse, reftex-get-crossref-alist)
	(reftex-extract-bib-entries-from-thebibliography)
	(reftex-get-bibkey-default, reftex-get-bib-names)
	(reftex-parse-bibtex-entry, reftex-get-bib-field)
	(reftex-format-bib-entry, reftex-parse-bibitem)
	(reftex-format-bibitem, reftex-do-citation)
	(reftex-figure-out-cite-format, reftex-offer-bib-menu)
	(reftex-restrict-bib-matches, reftex-extract-bib-file)
	(reftex-insert-bib-matches, reftex-format-citation)
	(reftex-make-cite-echo-string, reftex-bibtex-selection-callback)
	(reftex-create-bibtex-file): Add docstrings, mostly by converting
	existing comments into docstrings.

2013-06-12  Xue Fuqiao  <xfq.free@gmail.com>

	* ibuf-ext.el (ibuffer-mark-help-buffers): Doc fix.

2013-06-12  Andreas Schwab  <schwab@suse.de>

	* international/mule.el (auto-coding-alist): Use utf-8-emacs-unix
	for auto-save files.

2013-06-12  Glenn Morris  <rgm@gnu.org>

	* ido.el (ido-delete-ignored-files): Remove.
	(ido-wide-find-dirs-or-files, ido-make-file-list-1):
	Go back to calling ido-ignore-item-p directly.

2013-06-12  Eyal Lotem  <eyal.lotem@gmail.com>  (tiny change)

	* ido.el (ido-wide-find-dirs-or-files): Respect ido-case-fold.

	* ido.el (ido-delete-ignored-files): New function,
	split from ido-make-file-list-1.
	(ido-wide-find-dirs-or-files): Maybe ignore files.  (Bug#13003)
	(ido-make-file-list-1): Use ido-delete-ignored-files.

2013-06-12  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup)
	(inferior-octave-completion-table)
	(inferior-octave-track-window-width-change)
	(octave-eldoc-function-signatures, octave-help)
	(octave-find-definition): Use single quoted strings.
	(inferior-octave-startup-args): Change default value.
	(inferior-octave-startup): Do not hard code "-i" and
	"--no-line-editing".
	(inferior-octave-resync-dirs): Add optional arg NOERROR.
	(inferior-octave-directory-tracker): Use it.
	(octave-goto-function-definition): Robustify.
	(octave-help): Support highlighting operators in 'See also'.
	(octave-find-definition): Find subfunctions only in Octave mode.

2013-06-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help-fns.el (help-fns--compiler-macro): If the handler function is
	named, then put a link to it.
	* help-mode.el (help-function-cmacro): Adjust regexp for cl-lib names.
	* emacs-lisp/cl-macs.el (cl--compiler-macro-typep): New function.
	(cl-typep): Use it.
	(cl-eval-when): Simplify debug spec.
	(cl-define-compiler-macro): Use eval-and-compile.  Give a name to the
	compiler-macro function instead of setting `compiler-macro-file'.

2013-06-12  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-cvs.el (vc-cvs-stay-local): Doc fix.
	* vc/vc-hooks.el (vc-stay-local): Doc fix.

2013-06-12  Stefan Monnier  <monnier@iro.umontreal.ca>
	    Daniel Hackney  <dan@haxney.org>

	First part of Daniel Hackney's patch to package.el.
	* emacs-lisp/package.el: Use defstruct.
	(package-desc): New, main struct.
	(package--bi-desc, package--ac-desc): New structs, used to describe the
	format in external files.
	(package-desc-vers): Replace with package-desc-version accessor.
	(package-desc-doc): Replace with package-desc-summary accessor.
	(package-activate-1): Remove `package' arg since the pkg-vec now
	includes the name.
	(define-package): Use package-desc-from-define.
	(package-unpack-single): Change file-name arg to be a symbol.
	(package--add-to-archive-contents): Use package-desc-create and new
	accessor functions to package--ac-desc.
	(package-buffer-info, package-tar-file-info): Return a package-desc.
	(package-install-from-buffer): Remove `type' argument.  Change pkg-info
	arg to be a package-desc.
	(package-install-file): Adjust accordingly.  Use \' to match EOS.
	(package--from-builtin): New function.
	(describe-package-1, package-menu--generate): Use it.
	(package--make-autoloads-and-compile): Change name arg to be a symbol.
	(package-generate-autoloads): Idem and return the name of the file.
	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Change pkg-info arg to be a package-desc.
	Use package-make-ac-desc.
	(package-upload-file): Use \' to match EOS.
	* finder.el (finder-compile-keywords): Use package-make-builtin.

2013-06-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc.el (vc-deduce-fileset): Change error message.
	(vc-read-backend): New function.
	(vc-next-action): Use it.

	* subr.el (function-arity): Remove (mistakenly added) (bug#14590).

	* progmodes/prolog.el (prolog-make-keywords-regexp): Remove.
	(prolog-font-lock-keywords): Use regexp-opt instead.
	Don't manually highlight strings.
	(prolog-mode-variables): Simplify comment-start-skip.
	(prolog-consult-compile): Use display-buffer.  Remove unused old-filter.

	* emacs-lisp/generic.el (generic--normalise-comments)
	(generic-set-comment-syntax, generic-set-comment-vars): New functions.
	(generic-mode-set-comments): Use them.
	(generic-bracket-support): Use setq-local.
	(generic-make-keywords-list): Declare obsolete.

2013-06-11  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/lisp-mode.el (lisp-mode-variables):
	Prettify after setting font-lock-defaults.  (Bug#14574)

2013-06-11  Juanma Barranquero  <lekktu@gmail.com>

	* replace.el (query-replace, occur-read-regexp-defaults-function)
	(replace-search):
	* subr.el (declare-function, number-sequence, local-set-key)
	(substitute-key-definition, locate-user-emacs-file)
	(with-silent-modifications, split-string, eval-after-load):
	Fix typos, remove unneeded backslashes and reflow some docstrings.

2013-06-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/mule-conf.el (file-coding-system-alist): Use utf-8 as
	default for Elisp files.

2013-06-11  Glenn Morris  <rgm@gnu.org>

	* vc/log-view.el (log-view-mode-map): Inherit from special-mode-map,
	although define-derived-mode was doing this anyway.  (Bug#14583)

2013-06-10  Juanma Barranquero  <lekktu@gmail.com>

	* allout.el (allout-encryption-plaintext-sanitization-regexps):
	Fix make-variable-buffer-local call to refer to the correct variable.

2013-06-10  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-term.el (eshell-visual-commands)
	(eshell-visual-subcommands, eshell-visual-options):
	Add summary line to docstrings.  Add cross-references.

2013-06-10  Glenn Morris  <rgm@gnu.org>

	* epa.el (epa-read-file-name): New function.  (Bug#14510)
	(epa-decrypt-file): Make plain-file optional.  Use epa-read-file-name.

2013-06-09  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-term.el (eshell-visual-command-p): Fix bug that caused
	output redirection to be ignored with visual commands.

2013-06-09  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-term.el (eshell-visual-command-p): New function.
	(eshell-term-initialize): Move long lambda to separate function
	eshell-visual-command-p.
	* eshell/em-dirs.el (eshell-dirs-initialize):
	* eshell/em-script.el (eshell-script-initialize):
	Add missing #' to lambda.

2013-06-08  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-add-log-current-defun): New function.
	(octave-mode): Set add-log-current-defun-function.
	(octave-goto-function-definition): Do not move point if not found.
	(octave-find-definition): Enhance to try subfunctions first.

2013-06-08  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-char-before)
	(byte-compile-backward-char, byte-compile-backward-word):
	Improve previous change, to handle non-explicit nil.

2013-06-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el: Improve show-paren-mode behavior.
	(smie--opener/closer-at-point): New function.
	(smie--matching-block-data): Use it.  Don't match from right after an
	opener or right before a closer.  Obey smie-blink-matching-inners.
	Don't signal a mismatch for repeated inners like "switch..case..case".

2013-06-07  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode): Set comment-use-global-state
	to t.  (Bug#14303)
	(octave-function-header-regexp): Fix.  (Bug#14570)
	(octave-help-mode-finish-hook, octave-help-mode-finish):
	Remove.  Just use temp-buffer-show-hook.

	* newcomment.el (comment-search-backward): Revert last change.
	(Bug#14434)

	* emacs-lisp/smie.el (smie--matching-block-data): Minor simplification.

2013-06-07  Eli Zaretskii  <eliz@gnu.org>

	* Makefile.in (TAGS TAGS-LISP): Pass the (long) list of *.el files
	through xargs, to avoid failure due to MS-Windows limitations on
	command-line length.

2013-06-06  Glenn Morris  <rgm@gnu.org>

	* font-lock.el (lisp-font-lock-keywords-2):
	Treat user-error like error.

	* emacs-lisp/bytecomp.el (byte-compile-char-before)
	(byte-compile-backward-char, byte-compile-backward-word):
	Handle explicit nil arguments.  (Bug#14565)

2013-06-05  Alan Mackenzie  <acm@muc.de>

	* isearch.el (isearch-allow-prefix): New user option.
	(isearch-other-meta-char): Don't exit isearch when a prefix
	argument is typed whilst `isearch-allow-prefix' is non-nil.
	(Bug#9706)

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* autorevert.el (auto-revert-notify-handler): Use memq.
	Hide assertion failure.

	* skeleton.el: Use cl-lib.
	(skeleton-further-elements): Use defvar-local.
	(skeleton-insert): Use cl-progv.

2013-06-05  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/prog-mode.el (prog-prettify-symbols)
	(prog-prettify-install): Update docstrings.

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el: Move all the prog-mode code to prog-mode.el.
	* progmodes/prog-mode.el: New file.
	* loadup.el: Add prog-mode.el.

2013-06-05  Teodor Zlatanov  <tzz@lifelogs.com>

	* simple.el (prog-prettify-symbols): Add version.
	(prog-prettify-install): Add convenience function to prettify symbols.

	* progmodes/perl-mode.el (perl--augmented-font-lock-keywords)
	(perl--augmented-font-lock-keywords-1)
	(perl--augmented-font-lock-keywords-2, perl-mode): Remove unneeded
	variables and use it.

	* progmodes/cfengine.el (cfengine3--augmented-font-lock-keywords)
	(cfengine3-mode): Remove unneeded variable and use it.

	* emacs-lisp/lisp-mode.el (lisp--augmented-font-lock-keywords)
	(lisp--augmented-font-lock-keywords-1)
	(lisp--augmented-font-lock-keywords-2, lisp-mode-variables):
	Remove unneeded variables and use it.

2013-06-05  João Távora  <joaotavora@gmail.com>

	* net/tls.el (open-tls-stream): Remove unneeded buffer contents up
	to point when opening the connection.  (Bug#14380)

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (load-history-regexp, load-history-filename-element)
	(eval-after-load, after-load-functions, do-after-load-evaluation)
	(eval-next-after-load, display-delayed-warnings)
	(collapse-delayed-warnings, delayed-warnings-hook): Move after the
	definition of save-match-data.
	(overriding-local-map): Remove accidental obsolescence declaration.

	* emacs-lisp/edebug.el (edebug-result): Move before first use.

2013-06-05  Teodor Zlatanov  <tzz@lifelogs.com>

	Generalize symbol prettify support to prog-mode and implement it
	for perl-mode, cfengine3-mode, and emacs-lisp-mode.
	* simple.el (prog-prettify-symbols-alist, prog-prettify-symbols)
	(prog--prettify-font-lock-compose-symbol)
	(prog-prettify-font-lock-symbols-keywords): New variables and
	functions to support symbol prettification.
	* emacs-lisp/lisp-mode.el (lisp--augmented-font-lock-keywords)
	(lisp--augmented-font-lock-keywords-1)
	(lisp--augmented-font-lock-keywords-2, lisp-mode-variables)
	(lisp--prettify-symbols-alist): Implement prettify of lambda.
	* progmodes/cfengine.el (cfengine3--augmented-font-lock-keywords)
	(cfengine3--prettify-symbols-alist, cfengine3-mode):
	Implement prettify of -> => :: strings.
	* progmodes/perl-mode.el (perl-prettify-symbols)
	(perl--font-lock-compose-symbol)
	(perl--font-lock-symbols-keywords): Move to prog-mode.
	(perl--prettify-symbols-alist): Prettify -> => :: strings.
	(perl-font-lock-keywords-1)
	(perl-font-lock-keywords-2): Remove explicit prettify support.
	(perl--augmented-font-lock-keywords)
	(perl--augmented-font-lock-keywords-1)
	(perl--augmented-font-lock-keywords-2, perl-mode):
	Implement prettify support.

2013-06-05  Leo Liu  <sdl.web@gmail.com>

	Re-implement SMIE matching block highlight using
	show-paren-data-function.  (Bug#14395)
	* emacs-lisp/smie.el (smie-matching-block-highlight)
	(smie--highlight-matching-block-overlay)
	(smie--highlight-matching-block-lastpos)
	(smie-highlight-matching-block)
	(smie-highlight-matching-block-mode): Remove.
	(smie--matching-block-data-cache): New variable.
	(smie--matching-block-data): New function.
	(smie-setup): Use smie--matching-block-data for
	show-paren-data-function.

	* progmodes/octave.el (octave-mode-menu): Fix.
	(octave-find-definition): Skip garbage lines.

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	Fix compilation error with simultaneous dynamic+lexical scoping.
	Add warning when a defvar appears after the first let-binding.
	* emacs-lisp/bytecomp.el (byte-compile-lexical-variables): New var.
	(byte-compile-close-variables): Initialize it.
	(byte-compile--declare-var): New function.
	(byte-compile-file-form-defvar)
	(byte-compile-file-form-define-abbrev-table)
	(byte-compile-file-form-custom-declare-variable): Use it.
	(byte-compile-make-lambda-lexenv): Change the argument.  Simplify.
	(byte-compile-lambda): Share call to byte-compile-arglist-vars.
	(byte-compile-bind): Handle dynamic bindings that shadow
	lexical bindings.
	(byte-compile-unbind): Make arg non-optional.
	(byte-compile-let): Simplify.
	* emacs-lisp/cconv.el (byte-compile-lexical-variables): Declare var.
	(cconv--analyse-function, cconv-analyse-form): Populate it.
	Protect byte-compile-bound-variables to limit the scope of defvars.
	(cconv-analyse-form): Add missing rule for (defvar <foo>).
	Remove unneeded rule for `declare'.

	* emacs-lisp/cl-macs.el (cl--compiler-macro-adjoin): Use macroexp-let2
	so as to avoid depending on cl-adjoin at run-time.
	* emacs-lisp/cl-lib.el (cl-pushnew): Use backquotes.

	* emacs-lisp/macroexp.el (macroexp--compiling-p): New function.
	(macroexp--warn-and-return): Use it.

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el: Convert to lexical binding.
	(overriding-local-map): Make obsolete.
	(add-to-list): Doc fix.  Add compiler macro.
	(read-key): Swap values of local maps.

2013-06-05  Leo Liu  <sdl.web@gmail.com>

	* eshell/esh-mode.el (eshell-mode): Fix key bindings.

2013-06-04  Leo Liu  <sdl.web@gmail.com>

	* progmodes/compile.el (compile-goto-error): Add optional arg NOMSG.
	(compilation-auto-jump): Suppress the "Mark set" message to give
	way to exit message.

2013-06-04  Alan Mackenzie  <acm@muc.de>

	Remove faulty optimization from indentation calculation.
	* progmodes/cc-engine.el (c-guess-basic-syntax): Don't calculate
	search limit based on 2000 characters back from indent-point.

2013-06-03  Tassilo Horn  <tsdh@gnu.org>

	* eshell/em-term.el (cl-lib): Require `cl-lib'.

2013-06-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp.el: Use lexical-binding.
	(lisp--local-variables-1, lisp--local-variables): New functions.
	(lisp--local-variables-completion-table): New var.
	(lisp-completion-at-point): Use it complete let-bound vars.

	* emacs-lisp/lisp-mode.el (eval-sexp-add-defvars): Expand macros
	eagerly (bug#14422).

2013-06-03  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-notify-enabled)
	(auto-revert-notify-rm-watch, auto-revert-notify-add-watch)
	(auto-revert-notify-event-p, auto-revert-notify-event-file-name)
	(auto-revert-notify-handler): Handle also gfilenotify.

	* subr.el (file-notify-handle-event): New defun.  Replacing ...
	(inotify-event-p, inotify-handle-event, w32notify-handle-event):
	Remove.

2013-06-03  Juri Linkov  <juri@jurta.org>

	* bindings.el (search-map): Bind `highlight-symbol-at-point' to
	`M-s h .'.  (Bug#14427)

	* hi-lock.el (highlight-symbol-at-point): New alias for the new
	command `hi-lock-face-symbol-at-point'.
	(hi-lock-face-symbol-at-point): New command.
	(hi-lock-map): Bind `highlight-symbol-at-point' to `C-x w .'.
	(hi-lock-menu): Add `highlight-symbol-at-point'.
	(hi-lock-mode): Doc fix.

	* isearch.el (isearch-forward-symbol-at-point): New command.
	(search-map): Bind `isearch-forward-symbol-at-point' to `M-s .'.
	(isearch-highlight-regexp): Add a regexp which matches
	words/symbols for word/symbol mode.

	* subr.el (find-tag-default-bounds): New function with the body
	mostly moved from `find-tag-default'.
	(find-tag-default): Move most code to `find-tag-default-bounds',
	call it and apply `buffer-substring-no-properties' afterwards.

2013-06-03  Tassilo Horn  <tsdh@gnu.org>

	* eshell/em-term.el (eshell-term-initialize):
	Use `cl-intersection' rather than `intersection'.

2013-06-02  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/log-view.el: Doc fix.
	(log-view-mode-map): Copy keymap from `special-mode-map'.

2013-06-02  Eric Ludlam  <zappo@gnu.org>

	* emacs-lisp/eieio.el (eieio--defalias, eieio-hook)
	(eieio-error-unsupported-class-tags, eieio-skip-typecheck)
	(eieio-optimize-primary-methods-flag, eieio-initializing-object)
	(eieio-unbound, eieio-default-superclass)
	(eieio--define-field-accessors, method-static, method-before)
	(method-primary, method-after, method-num-lists)
	(method-generic-before, method-generic-primary)
	(method-generic-after, method-num-slots)
	(eieio-specialized-key-to-generic-key)
	(eieio--check-type, class-v, class-p)
	(eieio-class-name, define-obsolete-function-alias)
	(eieio-class-parents-fast, eieio-class-children-fast)
	(same-class-fast-p, class-constructor, generic-p)
	(generic-primary-only-p, generic-primary-only-one-p)
	(class-option-assoc, class-option, eieio-object-p)
	(class-abstract-p, class-method-invocation-order)
	(eieio-defclass-autoload-map, eieio-defclass-autoload)
	(eieio-class-un-autoload, eieio-defclass)
	(eieio-eval-default-p, eieio-perform-slot-validation-for-default)
	(eieio-add-new-slot, eieio-copy-parents-into-subclass)
	(eieio--defgeneric-init-form, eieio-defgeneric-form)
	(eieio-defgeneric-reset-generic-form)
	(eieio-defgeneric-form-primary-only)
	(eieio-defgeneric-reset-generic-form-primary-only)
	(eieio-defgeneric-form-primary-only-one)
	(eieio-defgeneric-reset-generic-form-primary-only-one)
	(eieio-unbind-method-implementations)
	(eieio--defmethod, eieio--typep)
	(eieio-perform-slot-validation, eieio-validate-slot-value)
	(eieio-validate-class-slot-value, eieio-barf-if-slot-unbound)
	(eieio-oref, eieio-oref-default, eieio-default-eval-maybe)
	(eieio-oset, eieio-oset-default, eieio-slot-originating-class-p)
	(eieio-slot-name-index, eieio-class-slot-name-index)
	(eieio-set-defaults, eieio-initarg-to-attribute)
	(eieio-attribute-to-initarg, eieio-c3-candidate)
	(eieio-c3-merge-lists, eieio-class-precedence-c3)
	(eieio-class-precedence-dfs, eieio-class-precedence-bfs)
	(eieio-class-precedence-list, eieio-generic-call-methodname)
	(eieio-generic-call-arglst, eieio-generic-call-key)
	(eieio-generic-call-next-method-list)
	(eieio-pre-method-execution-functions, eieio-generic-call)
	(eieio-generic-call-primary-only, eieiomt-method-list)
	(eieiomt-optimizing-obarray, eieiomt-install)
	(eieiomt-add, eieiomt-next, eieiomt-sym-optimize)
	(eieio-generic-form, eieio-defmethod, make-obsolete)
	(eieio-defgeneric, make-obsolete): Move to eieio-core.el.
	(defclass): Remove `eval-and-compile' from macro.
	(call-next-method, shared-initialize): Instead of using
	`scoped-class' variable, use new eieio--scoped-class, and
	eieio--with-scoped-class.
	(initialize-instance): Rename local variable 'scoped-class' to
	'this-class' to remove ambiguitity from old global.

	* emacs-lisp/eieio-core.el: New file.  Derived from key parts of
	eieio.el.
	(eieio--scoped-class-stack): New variable.
	(eieio--scoped-class): New fcn.
	(eieio--with-scoped-class): New scoping macro.
	(eieio-defclass): Use pushnew instead of add-to-list.
	(eieio-defgeneric-form-primary-only-one, eieio-oset-default)
	(eieio-slot-name-index, eieio-set-defaults, eieio-generic-call)
	(eieio-generic-call-primary-only, eieiomt-add): Instead of using
	`scoped-class' variable, use new eieio--scoped-class, and
	eieio--with-scoped-class.

	* emacs-lisp/eieio-base.el (cl-lib): Require during compile.

2013-06-02  Tassilo Horn  <tsdh@gnu.org>

	* eshell/esh-ext.el (eshell-external-command): Pass args to
	`eshell-find-interpreter'.
	(eshell-find-interpreter): Add new second parameter ARGS.

	* eshell/em-script.el (eshell-script-initialize): Add second arg
	to the function added as MATCH to `eshell-interpreter-alist'.

	* eshell/em-dirs.el (eshell-dirs-initialize): Add second arg to
	the function added as MATCH to `eshell-interpreter-alist'.

	* eshell/em-term.el (eshell-visual-subcommands): New defcustom.
	(eshell-visual-options): New defcustom.
	(eshell-escape-control-x): Adapt docstring.
	(eshell-term-initialize): Test `eshell-visual-subcommands' and
	`eshell-visual-options' in addition to `eshell-visual-commands'.
	(eshell-exec-visual): Pass args to `eshell-find-interpreter'.

2013-06-01  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-block-enders): Add break,
	continue and raise keywords.

2013-06-01  Glenn Morris  <rgm@gnu.org>

	* pcmpl-gnu.el (pcomplete/tar): Check obsolete variable is bound.

	Plain (f)boundp silences compilation warnings since Emacs 22.1.
	* progmodes/cc-cmds.el (delete-forward-p):
	* progmodes/cc-defs.el (buffer-syntactic-context-depth):
	* progmodes/cc-engine.el (buffer-syntactic-context):
	* progmodes/cc-fonts.el (face-property-instance):
	* progmodes/cc-mode.el (set-keymap-parents):
	* progmodes/cc-vars.el (get-char-table): No need for cc-bytecomp-defun.
	* progmodes/cc-defs.el (c-set-region-active, c-beginning-of-defun-1)
	* progmodes/cc-mode.el (c-make-inherited-keymap): Use plain fboundp.
	* progmodes/cc-defs.el (zmacs-region-stays, zmacs-regions)
	(lookup-syntax-properties): Remove unecessary cc-bytecomp-defvar.

	* progmodes/cc-vars.el (other): Emacs has this widget since
	at least 21.1, so don't (re)define it.

	* eshell/em-cmpl.el (eshell-cmpl-initialize):
	Replace the obsolete alias pcomplete-arg-quote-list.

2013-06-01  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode-syntax-table): Give `.'
	punctuation syntax.
	(inferior-octave-minimal-columns)
	(inferior-octave-last-column-width): New variables.
	(inferior-octave-track-window-width-change): New function.
	(inferior-octave-mode): Adjust column width so that Octave output,
	for example from 'ls', can fit into the window nicely.

2013-05-31  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-expansion-allowed-p):
	Highlight expansions inside regexp literals.

2013-05-31  Glenn Morris  <rgm@gnu.org>

	* obsolete/sym-comp.el (symbol-complete):
	Replace obsolete completion-annotate-function.

	* progmodes/cc-vars.el (c-make-macro-with-semi-re): Silence compiler.

2013-05-31  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-expansion-allowed-p):
	New function, checks if point is inside a literal that allows
	expression expansion.
	(ruby-syntax-propertize-expansion): Use it.
	(ruby-syntax-propertize-function): Bind `case-fold-search' to nil
	around the body.

2013-05-30  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-mode-map): Bind `isearch-toggle-invisible'
	to "\M-si".
	(isearch-invisible): New variable.
	(isearch-forward): Doc fix.
	(isearch-mode): Set `isearch-invisible'
	to the value of `search-invisible'.
	(isearch-toggle-case-fold): Doc fix.
	(isearch-toggle-invisible): New command.
	(isearch-query-replace): Let-bind `search-invisible'
	to the value of `isearch-invisible'.
	(isearch-search): Use `isearch-invisible' instead of
	`search-invisible'.  Let-bind `search-invisible'
	to the value of `isearch-invisible'.  (Bug#11378)

2013-05-30  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Avoid `isearch-range-invisible'
	call when `query-flag' is nil and `search-invisible' is non-nil.
	(Bug#11746)

2013-05-30  Glenn Morris  <rgm@gnu.org>

	* progmodes/gdb-mi.el (gdb-wait-for-pending): Fix typo.

	* progmodes/cc-bytecomp.el (cc-bytecomp-noruntime-functions): New.
	(cc-require): Suppress spurious "noruntime" warnings.
	(cc-require-when-compile): Use fboundp, for sake of compiler.

	* progmodes/cc-mode.el: Move load of cc-vars before that of
	cc-langs (which in turn loads cc-vars), to quieten compiler.

2013-05-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* paren.el: Simplify the code.
	(show-paren-mode): Always start the timer.
	(show-paren--idle-timer): Rename from show-paren-idle-timer.
	(show-paren--overlay, show-paren--overlay-1): Rename from
	show-paren-overlay and show-paren-overlay-1, and initialize to an
	overlay rather than to nil.
	(show-paren-function): Misc cleanup and simplifications.

2013-05-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* paren.el (show-paren-data-function): New hook.
	(show-paren--default): New function, extracted from show-paren-function.
	(show-paren-function): Use show-paren-data-function.

2013-05-30  Glenn Morris  <rgm@gnu.org>

	* ielm.el (ielm-map, ielm-complete-symbol):
	Use completion-at-point rather than obsolete functions.
	(inferior-emacs-lisp-mode): Doc fix.
	Set completion-at-point-functions, rather than
	comint-dynamic-complete-functions.

	* eshell/em-cmpl.el (eshell-complete-lisp-symbol): New function.
	(eshell-cmpl-initialize, eshell-complete-parse-arguments):
	Replace obsolete lisp-complete-symbol with eshell-complete-lisp-symbol.

	* image.el (image-animated-p): Tweak definition.

	* net/rlogin.el (rlogin-program, rlogin-explicit-args): Default to ssh.
	(rlogin-process-connection-type): Tweak default.  Add set-after.
	(rlogin-host): Doc fix.
	(rlogin): Tweak prompt.
	(rlogin-tab-or-complete): Use completion-at-point rather than alias.

	* net/net-utils.el (nslookup-mode-map, ftp-mode-map):
	* progmodes/tcl.el (inferior-tcl-mode-map):
	Use completion-at-point rather than obsolete alias.

	* emacs-lisp/eieio.el (eieio-eval-default-p): Move before use.

	* minibuffer.el (read-file-name-completion-ignore-case):
	Move before completion--in-region, for eager macro expansion.

2013-05-29  Juri Linkov  <juri@jurta.org>

	* replace.el (occur-engine): Rename `globalcount' to `global-lines'
	for total count of matching lines.  Add `global-matches' for total
	count of matches.  Rename `matches' to `lines' for count of
	matching lines.  Add `matches' for count of matches.
	Rename `lines' to `curr-line' for line count.  Rename `prev-lines'
	to `prev-line' for line number of prev match endpt.
	Increment `matches' for every match.  Print the number of
	matching lines in the header.
	(occur-context-lines): Rename `lines' to `curr-line'.
	Rename `prev-lines' to `prev-line'.  (Bug#14017)

2013-05-29  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Add `skip-read-only-count',
	`skip-filtered-count', `skip-invisible-count' let-bound to 0.
	Increment them for corresponding conditions and report the number
	of skipped occurrences in the final message.  (Bug#11746)
	(query-replace, query-replace-regexp, query-replace-regexp-eval)
	(replace-string, replace-regexp): Doc fix.

2013-05-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/trace.el (trace--read-args): Provide a default.

	* emacs-lisp/lisp-mode.el (lisp-mode-shared-map): Inherit from
	prog-mode-map (bug#14504).

2013-05-29  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-comment): Tweak regexps.
	(octave-help): Small simplification.

	* emacs-lisp/smie.el (smie-highlight-matching-block): Always turn
	off the highlight first.

2013-05-29  Glenn Morris  <rgm@gnu.org>

	* progmodes/idlwave.el (idlwave-concatenate-rinfo-lists):
	Handle idlwave-last-system-routine-info-cons-cell being nil.

	* progmodes/idlwave.el (idlwave-scan-user-lib-files)
	(idlwave-write-paths): Simplify via with-temp-buffer.

	* emulation/cua-gmrk.el: Also load cua-base, cua-rect at run time.
	* emulation/cua-rect.el: Also load cua-base at run time.

	* progmodes/cperl-mode.el (imenu-choose-buffer-index)
	(file-of-tag, etags-snarf-tag, etags-goto-tag-location): Declare.
	(cperl-imenu-on-info): Require imenu.

2013-05-28  Alan Mackenzie  <acm@muc.de>

	Handle "capitalised keywords" correctly.
	* progmodes/cc-mode.el (c-after-change): Bind case-fold-search to nil.

2013-05-28  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-unix.el: Add -r option to cp.

2013-05-28  Glenn Morris  <rgm@gnu.org>

	* vc/vc-arch.el (vc-exec-after): Declare.
	(vc-switches): Autoload.
	* vc/vc-bzr.el: No need to require vc when compiling.
	(vc-exec-after, vc-set-async-update, vc-default-dir-printer)
	(vc-resynch-buffer, vc-dir-refresh): Declare.
	(vc-setup-buffer, vc-switches): Autoload.
	* vc/vc-cvs.el (vc-exec-after, vc-coding-system-for-diff)
	(vc-resynch-buffer): Declare.
	(vc-switches, vc-default-revert, vc-version-backup-file): Autoload.
	* vc/vc-dir.el (desktop-missing-file-warning): Declare.
	* vc/vc-git.el (vc-exec-after, vc-set-async-update)
	(grep-read-regexp, grep-read-files, grep-expand-template)
	(vc-dir-refresh): Declare.
	(vc-setup-buffer, vc-switches, vc-resynch-buffer): Autoload.
	* vc/vc-hg.el (vc-exec-after, vc-set-async-update): Declare.
	(vc-setup-buffer, vc-switches, vc-do-async-command): Autoload.
	* vc/vc-mtn.el (vc-exec-after): Declare.
	(vc-switches): Autoload.
	* vc/vc-rcs.el (vc-expand-dirs, vc-switches)
	(vc-tag-precondition, vc-buffer-sync, vc-rename-master): Autoload.
	(vc-file-tree-walk): Declare.
	* vc/vc-sccs.el (vc-file-tree-walk): Declare.
	(vc-expand-dirs, vc-switches, vc-setup-buffer, vc-delistify)
	(vc-tag-precondition, vc-rename-master): Autoload.
	* vc/vc-svn.el (vc-exec-after): Declare.
	(vc-switches, vc-setup-buffer): Autoload.
	* obsolete/vc-mcvs.el (vc-checkout, vc-switches, vc-default-revert):
	Autoload.
	(vc-resynch-buffer): Declare.

	* obsolete/fast-lock.el (byte-compile-warnings):
	Don't warn about obsolete features in this obsolete file.

	* progmodes/cc-vars.el (c-macro-names-with-semicolon):
	Move definition before use.

	* play/dunnet.el (byte-compile-warnings): Don't disable them all.
	(dun-unix-verbs): Remove dun-zippy.
	(dun-zippy): Remove function.

	* emacs-lisp/bytecomp.el (byte-compile-warnings): Doc fix.

2013-05-27  Juri Linkov  <juri@jurta.org>

	* replace.el (replace-search): New function with code moved out
	from `perform-replace'.
	(replace-highlight, replace-dehighlight): Move function definitions
	up closer to `replace-search'.  (Bug#11746)

2013-05-27  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Ignore invisible matches.
	In addition to checking `query-replace-skip-read-only', also
	filter out matches by calling `run-hook-with-args-until-failure'
	on `isearch-filter-predicates', and also check `search-invisible'
	for t or call `isearch-range-invisible'.
	(replace-dehighlight): Call `isearch-clean-overlays'.  (Bug#11746)

2013-05-27  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-filter-predicates): Rename from
	`isearch-filter-predicate'.  Doc fix.  (Bug#11378)
	(isearch-message-prefix): Display text from the property
	`isearch-message-prefix' of the currently active filters.
	(isearch-search): Don't compare `isearch-filter-predicate' with
	`isearch-filter-visible'.  Call `run-hook-with-args-until-failure'
	on `isearch-filter-predicates'.  Also check `search-invisible' for t
	or call `isearch-range-invisible'.
	(isearch-filter-visible): Make obsolete.
	(isearch-lazy-highlight-search):
	Call `run-hook-with-args-until-failure' on
	`isearch-filter-predicates' and use `isearch-range-invisible'.

	* info.el (Info-search): Call `run-hook-with-args-until-failure' on
	`isearch-filter-predicates' instead of `funcall'ing
	`isearch-filter-predicate'.
	(Info-mode): Set `Info-isearch-filter' to
	`isearch-filter-predicates' instead of `isearch-filter-predicate'.

	* dired-aux.el (dired-isearch-filter-predicate-orig):
	Remove variable.
	(dired-isearch-filenames-toggle, dired-isearch-filenames-setup)
	(dired-isearch-filenames-end): Add and remove
	`dired-isearch-filter-filenames' in `isearch-filter-predicates'
	instead of changing the value of `isearch-filter-predicate'.
	Rebind `dired-isearch-filenames-toggle' from "\M-sf" to "\M-sff".
	(dired-isearch-filter-filenames): Don't use `isearch-filter-visible'.
	Put property `isearch-message-prefix' to "filename " on
	`dired-isearch-filter-filenames'.

	* wdired.el (wdired-change-to-wdired-mode):
	Add `isearch-filter-predicates' to `wdired-isearch-filter-read-only'
	locally instead of changing `isearch-filter-predicate'.
	(wdired-isearch-filter-read-only): Don't use `isearch-filter-visible'.

2013-05-27  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-git.el (vc-git-working-revision): When in detached mode,
	return the commit hash (Bug#14459).  Also set the
	`vc-git-detached' property.
	(vc-git--rev-parse): Extract from `vc-git-previous-revision'.
	(vc-git-mode-line-string): Use the same help-echo format whether
	in detached mode or not, because we know the actual revision now.
	When in detached mode, shorten the revision to 7 chars.

2013-05-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/easy-mmode.el (define-minor-mode):
	* emacs-lisp/derived.el (define-derived-mode): Always defvar the
	mode hook and provide a docstring.

2013-05-27  Alan Mackenzie  <acm@muc.de>

	Remove spurious syntax-table text properties inserted by C-y.
	* progmodes/cc-mode.el (c-after-change): Also clear hard
	syntax-table property with value nil.

2013-05-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus-call-method): Let-bind `inhibit-redisplay'
	when reading the events; the buffer layout shall not be changed.

2013-05-27  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-directory-tracker-resync):
	New variable.
	(inferior-octave-directory-tracker): Automatically re-sync
	default-directory.
	(octave-help): Improve handling of 'See also'.

2013-05-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* doc-view.el: Minor naming convention tweaks.
	(desktop-buffer-mode-handlers): Don't add to it repeatedly.

	* image-mode.el (image-mode-reapply-winprops): Call image-mode-winprops
	even if there's no `display' property yet (bug#14435).

2013-05-25  Eli Zaretskii  <eliz@gnu.org>

	* subr.el (unmsys--file-name): Rename from reveal-filename.

	* Makefile.in (custom-deps, finder-data, autoloads)
	($(MH_E_DIR)/mh-loaddefs.el, $(TRAMP_DIR)/tramp-loaddefs.el)
	($(CAL_DIR)/cal-loaddefs.el, $(CAL_DIR)/diary-loaddefs.el)
	($(CAL_DIR)/hol-loaddefs.el): All users changed.

2013-05-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp.el (lisp-completion-at-point): Don't use
	error-completion on the first 2 args of condition-case (bug#14446).
	Don't burp at EOB.

2013-05-25  Leo Liu  <sdl.web@gmail.com>

	* comint.el (comint-previous-matching-input): Do not flood the
	*Messages* buffer with trivial messages.

2013-05-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/flymake.el (flymake-nop): Don't return a string.
	(flymake-set-at): Fix typo.

	* simple.el (read--expression): New function, extracted from
	eval-expression.  Set completion-at-point-functions (bug#14465).
	(eval-expression, eval-minibuffer): Use it.

2013-05-25  Xue Fuqiao  <xfq.free@gmail.com>

	* progmodes/flymake.el (flymake-save-buffer-in-file)
	(flymake-makehash, flymake-posn-at-point-as-event, flymake-nop)
	(flymake-selected-frame, flymake-log, flymake-ins-after)
	(flymake-set-at, flymake-get-buildfile-from-cache)
	(flymake-add-buildfile-to-cache, flymake-clear-buildfile-cache)
	(flymake-find-possible-master-files, flymake-save-buffer-in-file):
	Refine the doc string.
	(flymake-get-file-name-mode-and-masks): Reformat.
	(flymake-get-real-file-name-function): Fix a minor bug.

2013-05-24  Juri Linkov  <juri@jurta.org>

	* progmodes/grep.el (grep-mode-font-lock-keywords):
	Support =linenumber= format used by git-grep for lines with
	function names.  (Bug#13549)

2013-05-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/octave.el (octave-smie-rules): Return nil rather than
	0 after a semi-colon; it works better for smie-auto-fill.
	(octave--indent-new-comment-line): New function.
	(octave-indent-new-comment-line): Use it (indirectly).
	(octave-mode): Don't disable smie-auto-fill.  Use add-function to
	modify comment-line-break-function.

	* emacs-lisp/smie.el (smie-auto-fill): Rework to be more robust.
	(smie-setup): Use add-function to set it.

2013-05-24  Sam Steingold  <sds@gnu.org>

	* sort.el (delete-duplicate-lines): Accept an optional `keep-blanks'
	argument (before the `interactive' argument).

2013-05-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* image-mode.el (image-mode-winprops): Add winprops to
	image-mode-winprops-alist before running
	image-mode-new-window-functions.
	* doc-view.el (doc-view-new-window-function): Don't delay
	doc-view-goto-page via timers (bug#14435).

2013-05-24  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el: Integrate with desktop.el.  (Bug#14435)
	(doc-view-desktop-save-buffer): New function.
	(doc-view-restore-desktop-buffer): New function.
	(desktop-buffer-mode-handlers):
	Add `doc-view-restore-desktop-buffer' as desktop.el buffer mode
	handler.
	(doc-view-mode): Set `doc-view-desktop-save-buffer' as custom
	`desktop-save-buffer' function.

2013-05-24  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-gvfs.el (tramp-gvfs-enabled): New defconst.
	(tramp-gvfs-file-name-handler): Raise a user error when
	`tramp-gvfs-enabled' is nil.
	(top): Register signals only when `tramp-gvfs-enabled' is non-nil.
	Do not raise a user error when loading package.  (Bug#14447)

	* net/xesam.el: Move to obsolete/.

2013-05-24  Glenn Morris  <rgm@gnu.org>

	* font-lock.el (lisp-font-lock-keywords-2): Add with-coding-priority.

	* emacs-lisp/chart.el (chart-sort): Replace obsolete `object-name'.

	* progmodes/cperl-mode.el (cperl-mode): Use fboundp.
	(Info-find-node, Man-getpage-in-background): Declare.

	* mail/unrmail.el (unrmail):
	Replace obsolete detect-coding-with-priority.

	* net/socks.el (socks-split-string): Use this rather than split-string.
	(socks-nslookup-host): Update for above change.
	(dynamic-choice, s5-dynamic-choice-match)
	(s5-dynamic-choice-match-inline, s5-widget-value-create):
	Comment out unused code.

	* tooltip.el (tooltip-use-echo-area): Warn only on 'set.
	* progmodes/gud.el (gud-gdb-completion-function): Move before use.
	(gud-tooltip-echo-area): Make obsolete.
	(gud-tooltip-process-output, gud-tooltip-tips): Also check tooltip-mode.

	* progmodes/js.el (js--optimize-arglist): Declare.

	* progmodes/ruby-mode.el (ruby-syntax-propertize-expansion): Declare.

	* progmodes/which-func.el (ediff-window-A, ediff-window-B)
	(ediff-window-C): Declare.

	* obsolete/pgg-gpg.el, obsolete/pgg-pgp.el, obsolete/pgg-pgp5.el:
	Tweak requires to silence compiler.

	* obsolete/sym-comp.el: No need to load hipper-exp when compiling.
	(he-search-string, he-tried-table, he-expand-list)
	(he-init-string, he-string-member, he-substitute-string)
	(he-reset-string): Declare.

	* obsolete/options.el (list-options): Use custom-variable-p,
	rather than obsolete alias.

2013-05-23  Sam Steingold  <sds@gnu.org>

	* simple.el (shell-command-on-region): Pass the `replace' argument
	down to `call-process-region' to comply with the doc as reported on
	<http://stackoverflow.com/questions/16720458/emacs-noninteractive-call-to-shell-command-on-region-always-deletes-region>

2013-05-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-indent-forward-token)
	(smie-indent-backward-token): Handle string tokens (bug#14381).

2013-05-23  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* ielm.el (ielm-menu): New menu.
	(inferior-emacs-lisp-mode): Set comment-start.

2013-05-23  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* textmodes/reftex.el (reftex-ref-style-toggle):
	Fix deactivate action.

	* textmodes/reftex-vars.el (reftex-ref-style-alist):
	Add cleveref macros.

	* textmodes/reftex-parse.el (reftex-locate-bibliography-files):
	Accept options for bibliography commands.
	* textmodes/reftex-vars.el (reftex-bibliography-commands):
	Add addbibresource.  Basic Biblatex support.

2013-05-23  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-gvfs.el (top):
	* net/xesam.el (xesam-dbus-unique-names): Suppress D-Bus errors
	when loading package.  (Bug#14447)

2013-05-23  Glenn Morris  <rgm@gnu.org>

	* progmodes/js.el: No need to load comint when compiling.
	(ring-insert, comint-send-string, comint-send-input)
	(comint-last-input-end, ido-chop): Declare.

	* vc/ediff-diff.el, vc/ediff-merg.el: Require ediff-util at run-time.
	* vc/ediff-mult.el: Adjust requires.
	(ediff-directories-internal, ediff-directory-revisions-internal)
	(ediff-patch-file-internal): Declare.
	* vc/ediff-ptch.el: Adjust requires.
	(ediff-use-last-dir, ediff-buffers-internal): Declare.
	(ediff-find-file): Autoload.
	* vc/ediff-util.el: No need to load ediff when compiling.
	(ediff-regions-internal): Declare.
	* vc/ediff-wind.el: Adjust requires.
	(ediff-compute-toolbar-width): Define when compiling.
	(ediff-setup-control-buffer, ediff-make-bottom-toolbar): Declare.
	* vc/ediff.el: No need to load dired, ediff-ptch when compiling.
	(dired-get-filename, dired-get-marked-files)
	(ediff-last-dir-patch, ediff-patch-default-directory)
	(ediff-get-patch-buffer, ediff-dispatch-file-patching-job)
	(ediff-patch-buffer-internal): Declare.

	* emacs-lisp/checkdoc.el: No need to load ispell when compiling.
	(ispell-process, ispell-buffer-local-words, lm-summary)
	(lm-section-start, lm-section-end): Declare.
	(checkdoc-ispell-init): Simplify.

	* progmodes/vera-mode.el (he-init-string, he-dabbrev-beg)
	(he-string-member, he-reset-string, he-substitute-string): Declare.

	* eshell/em-ls.el: Adjust requires.
	(eshell-glob-regexp): Declare.
	* eshell/em-tramp.el: Adjust requires.
	(eshell-parse-command): Autoload.
	* eshell/em-xtra.el: Adjust requires.
	(eshell-parse-command): Autoload.
	* eshell/esh-ext.el: Adjust requires.
	(eshell-parse-command, eshell-close-handles): Autoload.
	* eshell/esh-io.el: Adjust requires.
	(eshell-output-filter): Autoload.
	* eshell/esh-util.el: No need to load tramp when compiling.
	(tramp-file-name-structure, ange-ftp-ls, ange-ftp-file-modtime):
	Declare.
	(eshell-parse-ange-ls): Require ange-ftp and tramp.
	* eshell/em-alias.el, eshell/em-banner.el, eshell/em-basic.el:
	* eshell/em-cmpl.el, eshell/em-glob.el, eshell/em-pred.el:
	* eshell/em-prompt.el, eshell/em-rebind.el, eshell/em-smart.el:
	* eshell/em-term.el, eshell/esh-arg.el, eshell/esh-mode.el:
	* eshell/esh-opt.el, eshell/esh-proc.el:
	* eshell/esh-var.el: Adjust requires.
	* eshell/eshell.el: Do not require esh-util twice.
	(eshell-add-input-to-history): Declare.
	(eshell-command): Check history module is active before using it.

	* eshell/em-ls.el (eshell-ls-dir): Fix -A handling.

2013-05-22  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup): Fix bug#14433.

2013-05-22  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-notify-add-watch)
	(auto-revert-notify-handler): Add `attrib' for the inotify case,
	it indicates changes in file modification time.

2013-05-22  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-file-form-autoload):
	Always delete the autoloaded function from the noruntime and
	unresolved functions lists.

	* allout.el: No need to load epa, epg, overlay when compiling.
	(epg-context-set-passphrase-callback, epg-list-keys)
	(epg-decrypt-string, epg-encrypt-string, epg-user-id-string)
	(epg-key-user-id-list): Declare.

	* emulation/viper-cmd.el (viper-set-searchstyle-toggling-macros)
	(viper-set-parsing-style-toggling-macro)
	(viper-set-emacs-state-searchstyle-macros):
	Use called-interactively-p on Emacs.
	(viper-looking-back): Make it an obsolete alias.  Update callers.
	* emulation/viper-ex.el: Load viper-keym, not viper-cmd.
	Use looking-back rather than viper-looking-back.
	(viper-tmp-insert-at-eob, viper-enlarge-region)
	(viper-read-string-with-history, viper-register-to-point)
	(viper-append-to-register, viper-change-state-to-vi)
	(viper-backward-char-carefully, viper-forward-char-carefully)
	(viper-Put-back, viper-put-back, viper-add-newline-at-eob-if-necessary)
	(viper-change-state-to-emacs): Declare.
	* emulation/viper-macs.el: Load viper-mous, viper-ex, not viper-cmd.
	(viper-change-state-to-insert, viper-change-state-to-vi): Declare.
	* emulation/viper-mous.el: Do not load viper-cmd.
	(viper-backward-char-carefully, viper-forward-char-carefully)
	(viper-forward-word, viper-adjust-window): Declare.

	* vc/ediff.el (ediff-version): Use called-interactively-p on Emacs.

	* progmodes/idlw-help.el (idlwave-help-fontify):
	Use called-interactively-p.

	* term/w32console.el (w32-get-console-codepage)
	(w32-get-console-output-codepage): Declare.

	* dframe.el (x-sensitive-text-pointer-shape, x-pointer-shape):
	Remove unnecessary declarations.
	(dframe-message): Doc fix.

	* info.el (dframe-select-attached-frame, dframe-current-frame):
	Declare.

	* speedbar.el (speedbar-message): Make it an obsolete alias.
	Update all callers.
	(speedbar-with-attached-buffer)
	(speedbar-maybee-jump-to-attached-frame): Make these aliases obsolete.
	(speedbar-with-writable): Use backquote.
	* emacs-lisp/eieio-opt.el (eieio-describe-class-sb):
	* emacs-lisp/eieio-speedbar.el (eieio-speedbar-handle-click):
	Use dframe-with-attached-buffer, dframe-maybee-jump-to-attached-frame
	rather than speedbar- aliases.
	* mail/rmail.el: Load dframe rather than speedbar when compiling.
	(speedbar-make-specialized-keymap, speedbar-insert-button)
	(dframe-select-attached-frame, dframe-maybee-jump-to-attached-frame)
	(speedbar-do-function-pointer): Declare.
	(rmail-speedbar-button, rmail-speedbar-find-file)
	(rmail-speedbar-move-message):
	Use dframe-with-attached-buffer rather than speedbar- alias.
	* progmodes/gud.el: Load dframe rather than speedbar when compiling.
	(dframe-message, speedbar-make-specialized-keymap)
	(speedbar-add-expansion-list, speedbar-mode-functions-list)
	(speedbar-make-tag-line, speedbar-remove-localized-speedbar-support)
	(speedbar-insert-button, dframe-select-attached-frame)
	(dframe-maybee-jump-to-attached-frame)
	(speedbar-change-initial-expansion-list)
	(speedbar-previously-used-expansion-list-name): Declare.
	(gud-speedbar-item-info, gud-gdb-goto-stackframe):
	Use dframe-message, dframe-with-attached-buffer rather than
	speedbar- aliases.
	(gud-sentinel): Silence compiler.
	* progmodes/vhdl-mode.el (speedbar-refresh)
	(speedbar-do-function-pointer, speedbar-add-supported-extension)
	(speedbar-add-mode-functions-list, speedbar-make-specialized-keymap)
	(speedbar-change-initial-expansion-list, speedbar-add-expansion-list)
	(speedbar-extension-list-to-regex, speedbar-directory-buttons)
	(speedbar-file-lists, speedbar-make-tag-line)
	(speedbar-line-directory, speedbar-goto-this-file)
	(speedbar-center-buffer-smartly, speedbar-change-expand-button-char)
	(speedbar-delete-subblock, speedbar-position-cursor-on-line)
	(speedbar-make-button, speedbar-reset-scanners)
	(speedbar-files-item-info, speedbar-line-text)
	(speedbar-find-file-in-frame, speedbar-set-timer)
	(dframe-maybee-jump-to-attached-frame, speedbar-line-file): Declare.
	(speedbar-with-writable): Do not (re)define it.
	(vhdl-speedbar-find-file): Use dframe-maybee-jump-to-attached-frame
	rather than speedbar- alias.

2013-05-21  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode-menu): Update and re-organize
	menu items.
	(octave-mode): Tweak fill-nobreak-predicate.
	(inferior-octave-startup): Check process to avoid infinite loop.
	(inferior-octave): Pop to buffer first to show abornmal process
	exit information.

2013-05-21  Glenn Morris  <rgm@gnu.org>

	* printing.el (pr-menu-bar): Define when compiling.

2013-05-21  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-auto-fill): Remove.
	(octave-indent-new-comment-line): Improve.
	(octave-mode): Use auto fill mode through
	comment-line-break-function and fill-nobreak-predicate.
	(octave-goto-function-definition): Support DEFUN_DLD.
	(octave-beginning-of-defun): Small tweak.
	(octave-help): Show parent directory.

2013-05-21  Glenn Morris  <rgm@gnu.org>

	* files.el (dired-unmark):
	* progmodes/gud.el (gdb-input): Update declarations.

	* calculator.el (electric, ehelp): No need to load when compiling.
	(Electric-command-loop, electric-describe-mode): Declare.

	* doc-view.el (doc-view-current-converter-processes): Move before use.

	* emacs-lisp/easy-mmode.el (define-globalized-minor-mode):
	Move MODE-set-explicitly definition before use.

	* international/mule-diag.el (mule-diag):
	Don't use obsolete window-system-version.

	* mail/feedmail.el (smtpmail): No need to load when compiling.
	(smtpmail-via-smtp, smtpmail-smtp-server): Declare.

	* mail/mail-utils.el (rfc822): No need to load when compiling.
	(rfc822-addresses): Autoload it.
	(mail-strip-quoted-names): Trivial simplification.

	* mail/rmail.el (rmail-mime-message-p, rmail-mime-toggle-raw): Declare.
	(rmail-retry-failure): Don't assume that rmail-mime-feature == rmailmm.

	* net/snmp-mode.el (tempo): Don't duplicate requires.

	* progmodes/prolog.el (info): No need to load when compiling.
	(comint): Require before shell requires it.
	(Info-goto-node): Autoload it.
	(Info-follow-nearest-node): Declare.
	(prolog-help-info, prolog-goto-predicate-info): No need to require info.

	* textmodes/artist.el (picture-mode-exit): Declare.

	* textmodes/reftex-parse.el (reftex-parse-from-file):
	Trivial rewrite so the compiler can parse it better.

2013-05-20  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-help-mode-map)
	(octave-help-mode-finish-hook): New variables.
	(octave-help-mode, octave-help-mode-finish): New functions.
	(octave-help): Use octave-help-mode.

2013-05-20  Glenn Morris  <rgm@gnu.org>

	* format-spec.el (format-spec): Allow spec chars with nil.  (Bug#14420)

2013-05-19  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-expression-expansion-re): Allow to
	start at point, so that expansion starting right after opening
	slash in a regexp is recognized.
	(ruby-syntax-before-regexp-re): New defvar, extracted from
	ruby-syntax-propertize-function.  Since the value of this regexp
	is looked up at runtime now, we should be able to turn
	`ruby-syntax-methods-before-regexp' into a defcustom later.
	(ruby-syntax-propertize-function): Split regexp matching into two
	parts, for opening and closing slashes.  That allows us to skip
	over string interpolations and support multiline regexps.
	Don't call `ruby-syntax-propertize-expansions', instead use another rule
	for them, which calls `ruby-syntax-propertize-expansion'.
	(ruby-syntax-propertize-expansions): Move `remove-text-properties'
	call to `ruby-syntax-propertize-function'.
	(ruby-syntax-propertize-expansion): Extracted from
	`ruby-syntax-propertize-expansions'.  Handles one expansion.
	(ruby-syntax-propertize-percent-literal): Leave point right after
	the percent symbol, so that the expression expansion rule can
	propertize the contents.
	(ruby-syntax-propertize-heredoc): Leave point at bol following the
	heredoc openers.
	(ruby-syntax-propertize-expansions): Remove.

2013-05-18  Juri Linkov  <juri@jurta.org>

	* man.el (Man-default-man-entry): Remove `-' from the end
	of the default value.  (Bug#14400)

2013-05-18  Glenn Morris  <rgm@gnu.org>

	* comint.el (comint-password-prompt-regexp):
	Allow "password for XXX" where XXX contains colons (eg https://...).

2013-05-18  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup): Use OCTAVE_SRCDIR
	instead.  Include "--no-gui" to prevent hangs for Octave > 3.7.
	(octave-source-directories): Don't check process.
	(octave-source-directories, octave-find-definition): Doc fix.

2013-05-18  Glenn Morris  <rgm@gnu.org>

	* progmodes/vhdl-mode.el (vhdl-mode-map-init):
	Remove backspace/delete bindings.  (Bug#14392)

	* cus-dep.el (custom-make-dependencies): Sort the output.
	(custom-versions-load-alist): Convert comment to doc.

2013-05-17  Leo Liu  <sdl.web@gmail.com>

	* newcomment.el (comment-search-backward): Stricter in finding
	comment start.  (Bug#14303)

	* progmodes/octave.el (octave-comment-start): Remove the SPC char.
	(octave-comment-start-skip): Properly anchored.

2013-05-17  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/smie.el (smie-highlight-matching-block-mode):
	Clean up when turned off.  (Bug#14395)
	(smie--highlight-matching-block-overlay): No longer buffer-local.
	(smie-highlight-matching-block): Adjust.

2013-05-17  Paul Eggert  <eggert@cs.ucla.edu>

	Doc string fix for "nanoseconds" (Bug#14406).
	* emacs-lisp/timer.el (timer-relative-time, timer-inc-time):
	Fix doc string typo that had "nanoseconds" instead of "microseconds".

2013-05-17  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-units.el (math-extract-units): Preserve powers
	of units.

2013-05-17  Leo Liu  <sdl.web@gmail.com>

	* subr.el (delete-consecutive-dups): New function.
	* ido.el (ido-set-matches-1): Use it.
	* progmodes/octave.el (inferior-octave-completion-table): Use it.
	* ido.el (ido-remove-consecutive-dups): Remove.

2013-05-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/f90.el (f90-keywords-re, f90-keywords-level-3-re)
	(f90-hpf-keywords-re, f90-constants-re): Use \\_< rather than
	regexp-opt's `words'.

2013-05-16  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/smie.el (smie-matching-block-highlight): New face.
	(smie--highlight-matching-block-overlay)
	(smie--highlight-matching-block-lastpos)
	(smie--highlight-matching-block-timer): New variables.
	(smie-highlight-matching-block): New function.
	(smie-highlight-matching-block-mode): New minor mode.  (Bug#14395)
	(smie-setup): Conditionally enable smie-blink-matching-open.

2013-05-16  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode r840.
	* progmodes/verilog-mode.el (verilog-mode-version)
	(verilog-mode-release-date): Update.
	(verilog-auto-lineup, verilog-auto-reset): Doc fixes.
	(verilog-sig-tieoff): Fix string error on
	AUTORESET with colon define, bug594.  Reported by Andrew Hou.
	(verilog-read-decls): Fix parameters confusing
	AUTOINST interfaces, bug565.  Reported by Leith Johnson.

2013-05-16  Eli Zaretskii  <eliz@gnu.org>

	* subr.el (reveal-filename): New function.

	* loadup.el: Compute Emacs executable versions on MS-Windows,
	where executables have the .exe extension.  Add a hard link
	emacs-XX.YY.ZZ.exe on MS-Windows.

	* Makefile.in (XARGS_LIMIT): New variable.
	(custom-deps, finder-data, autoloads)
	($(MH_E_DIR)/mh-loaddefs.el, $(TRAMP_DIR)/tramp-loaddefs.el)
	($(CAL_DIR)/cal-loaddefs.el, $(CAL_DIR)/diary-loaddefs.el)
	($(CAL_DIR)/hol-loaddefs.el): Use reveal-filename.
	(compile-main): Limit xargs according to $(XARGS_LIMIT).

2013-05-16  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-defun): Mark obsolete.
	(octave-mode-menu, octave-mode-map): Remove its uses.

2013-05-16  Reto Zimmermann  <reto@gnu.org>

	Sync with upstream vhdl mode v3.34.2.
	* progmodes/vhdl-mode.el: Use `push' throughout.
	(vhdl-version, vhdl-time-stamp, vhdl-doc-release-notes): Update.
	(vhdl-compiler-alist): Replace "\t\n" by "\\t\\n".
	Add IBM & Quartus compiler.  Enhance entry for ADVance MS compiler.
	(vhdl-actual-generic-name): New option to derive actual generic name.
	(vhdl-port-paste-signals): Replace formal by actual generics.
	(vhdl-beautify): New name for old group vhdl-align.  Update users.
	(vhdl-beautify-options): New option.
	(vhdl-last-input-event): New compat alias.  Use throughout.
	(vhdl-goto-line): Replace user level function `goto-line'.
	(vhdl-mode-map): Add bindings for vhdl-fix-statement-region,
	vhdl-fix-statement-buffer.
	(vhdl-create-mode-menu): Add some entries.
	(vhdl-align-region-groups): Respect vhdl-beautify-options.
	(vhdl-align-inline-comment-region-1): Handle "--" inside string.
	(vhdl-fixup-whitespace-region): Handle symbols at EOL.
	(vhdl-fix-statement-region, vhdl-fix-statement-buffer): New commands,
	to force statements on one line.
	(vhdl-remove-trailing-spaces-region):
	New, split from vhdl-remove-trailing-spaces.
	(vhdl-beautify-region): Fix statements, trailing spaces, ^M character.
	Respect vhdl-beautify-options.
	(vhdl-update-sensitivity-list-buffer): If non-interactive save buffer.
	(vhdl-update-sensitivity-list): Not add with index if exists without.
	Not include array index with signal.  Ignore keywords in comments.
	(vhdl-get-visible-signals): Regexp tweaks.
	(vhdl-template-component-inst): Handle empty library.
	(vhdl-template-type): Add template for 'enum' type.
	(vhdl-port-paste-generic-map, vhdl-port-paste-constants):
	Use vhdl-replace-string.
	(vhdl-port-paste-signals): Use vhdl-prepare-search-1.
	(vhdl-speedbar-mode-map): Rename from vhdl-speedbar-key-map.
	(vhdl-speedbar-initialize): Update for above name change.
	(vhdl-compose-wire-components): Fix in handling of constants.
	(vhdl-error-regexp-emacs-alist): New variable.
	(vhdl-error-regexp-add-emacs): New function;
	adds support for new compile.el (Emacs 22+)
	(vhdl-generate-makefile-1): Change target order for single lib. units.
	Allow use of absolute file names.

2013-05-16  Leo Liu  <sdl.web@gmail.com>

	* simple.el (prog-indent-sexp): Indent enclosing defun.

2013-05-15  Glenn Morris  <rgm@gnu.org>

	* cus-start.el (show-trailing-whitespace): Move to editing basics.
	* faces.el (trailing-whitespace): Don't use whitespace-faces group.
	* obsolete/old-whitespace.el (whitespace-faces): Remove group.
	(whitespace-highlight): Move to whitespace group.

	* comint.el (comint-source):
	* pcmpl-linux.el (pcmpl-linux):
	* shell.el (shell-faces):
	* eshell/esh-opt.el (eshell-opt):
	* international/ccl.el (ccl): Remove empty custom groups.

	* completion.el (dynamic-completion-mode):
	* jit-lock.el (jit-lock-debug-mode):
	* minibuffer.el (completion-in-region-mode):
	* type-break.el (type-break-mode-line-message-mode)
	(type-break-query-mode):
	* emulation/tpu-edt.el (tpu-edt-mode):
	* progmodes/subword.el (global-subword-mode, global-superword-mode):
	* progmodes/vhdl-mode.el (vhdl-electric-mode, vhdl-stutter-mode):
	* term/vt100.el (vt100-wide-mode): Specify explicit :group.

	* term/xterm.el (xterm): Change parent group to terminals.

	* master.el (master): Remove empty custom group.
	(master-mode): Remove unused :group argument.
	* textmodes/refill.el (refill): Remove empty custom group.
	(refill-mode): Remove unused :group argument.

	* textmodes/rst.el (rst-compile-toolsets): Use rst-compile group.

	* cus-dep.el: Provide a feature.
	(custom-make-dependencies): Ignore dotfiles (dir-locals).
	Don't mistakenly ignore files whose basenames match a basename
	from preloaded-file-list (eg cedet/ede/simple.el).
	Add a fallback method for getting :group.

2013-05-15  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-char-by-name): Rename from
	`isearch-insert-char-by-name'.  Doc fix.
	(isearch-forward): Mention `isearch-char-by-name' in
	the docstring.  (Bug#13348)

	* isearch.el (minibuffer-local-isearch-map): Bind "\r" to
	`exit-minibuffer' instead of
	`isearch-nonincremental-exit-minibuffer'.
	(isearch-edit-string): Remove mention of
	`isearch-nonincremental-exit-minibuffer' from docstring.
	(isearch-nonincremental-exit-minibuffer): Mark as obsolete.
	(isearch-forward-exit-minibuffer)
	(isearch-reverse-exit-minibuffer): Add docstring.  (Bug#13348)

2013-05-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* loadup.el: Just use unversioned DOC.

	* nxml/nxml-mode.el: Treat unclosed <[[, <?, comment, and other
	literals as extending to EOB.
	(nxml-last-fontify-end): Remove unused variable.
	(nxml-after-change1): Use with-silent-modifications.
	(nxml-extend-after-change-region): Simplify.
	(nxml-extend-after-change-region1): Remove function.
	(nxml-after-change1): Don't adjust for dependent regions.
	(nxml-fontify-matcher): Simplify.
	* nxml/xmltok.el (xmltok-dependent-regions): Remove variable.
	(xmltok-add-dependent): Remove function.
	(xmltok-scan-after-lt, xmltok-scan-after-processing-instruction-open)
	(xmltok-scan-after-comment-open, xmltok-scan-prolog-literal)
	(xmltok-scan-prolog-after-processing-instruction-open): Treat
	unclosed <[[, <?, comment, and other literals as extending to EOB.
	* nxml/rng-valid.el (rng-mark-xmltok-dependent-regions)
	(rng-mark-xmltok-dependent-region, rng-dependent-region-changed):
	Remove functions.
	(rng-do-some-validation-1): Don't mark dependent regions.
	* nxml/nxml-rap.el (nxml-adjust-start-for-dependent-regions)
	(nxml-mark-parse-dependent-regions, nxml-mark-parse-dependent-region)
	(nxml-clear-dependent-regions): Remove functions.
	(nxml-scan-after-change, nxml-scan-prolog, nxml-tokenize-forward)
	(nxml-ensure-scan-up-to-date):
	Don't clear&mark dependent regions.

2013-05-15  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-goto-function-definition):
	Improve and fix callers.

2013-05-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-extra.el (cl-getf): Return the proper value in
	the setter (bug#14387).

	* progmodes/f90.el (f90-blocks-re): Include the terminating \> in the
	surrounding group (bug#14402).

2013-05-14  Juri Linkov  <juri@jurta.org>

	* subr.el (find-tag-default-as-regexp): Return nil if `tag' is nil.
	(Bug#14390)

2013-05-14  Glenn Morris  <rgm@gnu.org>

	* progmodes/f90.el (f90-imenu-generic-expression):
	Fix typo in 2013-05-08 change.  (Bug#14402)

2013-05-14  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el (gdb-running, gdb-starting):
	Remove signals for which replies are never received.

2013-05-14  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el: Fix non-responsive gud commands (bug#13845)
	(gdb-handler-alist, gdb-handler-number): Remove variables.
	(gdb-handler-list): New variable.
	(gdb-add-handler, gdb-delete-handler, gdb-get-handler-function)
	(gdb-pending-handler-p, gdb-handle-reply)
	(gdb-remove-all-pending-triggers): New functions.
	(gdb-discard-unordered-replies): New defcustom.
	(gdb-handler): New defstruct.
	(gdb-wait-for-pending): Fix invalid backquote.  Use gdb-handler-list.
	instead of gdb-pending-triggers.  Update docstring.
	(gdb-init-1): Remove dead variables.  Initialize gdb-handler-list.
	(gdb-speedbar-update, gdb-speedbar-timer-fn, gdb-var-update)
	(gdb-var-update-handler, def-gdb-auto-update-trigger)
	(def-gdb-auto-update-handler, gdb-get-changed-registers)
	(gdb-changed-registers-handler, gdb-get-main-selected-frame)
	(gdb-frame-handler): Pending triggers are now automatically managed.
	(def-gdb-trigger-and-handler, def-gdb-auto-update-handler):
	Remove argument.
	(gdb-input): Automatically handles pending triggers.  Update docstring.
	(gdb-resync): Replace gdb-pending-triggers by gdb-handler-list.
	(gdb-thread-exited, gdb-thread-selected, gdb-register-names-handler):
	Update comments.
	(gdb-done-or-error): Now use gdb-handle-reply.

2013-05-14  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el (gdb-input): Include token numbers in
	gdb-debug-log.

2013-05-14  Glenn Morris  <rgm@gnu.org>

	* subr.el (user-emacs-directory-warning): New option.
	(locate-user-emacs-file): Handle non-accessible .emacs.d.  (Bug#13930)

2013-05-14  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords): Fix error
	during redisplay.
	(octave-goto-function-definition, octave-find-definition): Minor tweaks.
	(octave-font-lock-texinfo-comment): Fix invalid search bound
	error: wrong side of point.

2013-05-14  Glenn Morris  <rgm@gnu.org>

	* progmodes/flymake.el (flymake-xml-program): New option.
	(flymake-xml-init): Use it.

	* term/xterm.el: Provide a feature.

	* term/sup-mouse.el: Move to obsolete/.  Provide a feature.

2013-05-13  Glenn Morris  <rgm@gnu.org>

	* cus-dep.el (defcustom-mh, defgroup-mh, defface-mh):
	Add compat aliases as a hack workaround.  (Bug#14384)

2013-05-13  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-comment): Fix indentation for
	###, and %!.
	(octave-mode-map): Bind octave-indent-defun to C-c C-q instead of
	C-M-q.
	(octave-comment-start-skip): Include %!.
	(octave-mode): Set comment-start-skip to octave-comment-start-skip.

2013-05-12  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup): Store the value
	of __octave_srcdir__ for octave-source-directories.
	(inferior-octave-check-process): New function refactored out of
	inferior-octave-send-list-and-digest.
	(octave-source-directories)
	(octave-find-definition-filename-function): New variables.
	(octave-source-directories)
	(octave-find-definition-default-filename): New functions.
	(octave-find-definition): Improve to find functions implemented in C++.

2013-05-12  Glenn Morris  <rgm@gnu.org>

	* calendar/diary-lib.el (diary-outlook-format-1):
	Don't include dayname in the output.  (Bug#14349)

2013-05-11  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/autoload.el (generated-autoload-load-name): Doc fix.

	* cus-dep.el (custom-make-dependencies): Only use safe local variables.
	Treat cc-provide like provide.

2013-05-11  Kevin Ryde  <user42@zip.com.au>

	* cus-dep.el (custom-make-dependencies):
	Use generated-autoload-load-name for the sake of files such
	such cedet/semantic/bovine/c.el, where the base file name
	is not in load-path.  (Bug#5277)

2013-05-11  Glenn Morris  <rgm@gnu.org>

	* dos-vars.el, emacs-lisp/cl-indent.el, emulation/tpu-extras.el:
	Provide features.

2013-05-11  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-comment): Improve.
	(octave-eldoc-message-style, octave-eldoc-cache): New variables.
	(octave-eldoc-function-signatures, octave-eldoc-function):
	New functions.
	(octave-mode, inferior-octave-mode): Add eldoc support.

2013-05-11  Richard Stallman  <rms@gnu.org>

	* epa.el (epa-decrypt-file): Take output file name as argument
	and read it using `interactive'.

2013-05-11  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-beginning-of-line)
	(octave-end-of-line): Check before using up-list because it jumps
	out of more syntactic constructs since moving to smie.
	(octave-indent-comment): New function.
	(octave-mode): Use it in smie-indent-functions.  (Bug#14350)
	(octave-begin-keywords, octave-end-keywords)
	(octave-reserved-words, octave-smie-bnf-table)
	(octave-smie-rules): Add new keywords from Octave 3.6.4.

2013-05-11  Glenn Morris  <rgm@gnu.org>

	* faces.el (internal-face-x-get-resource):
	* frame.el (ns-display-monitor-attributes-list):
	* calc/calc-aent.el (math-to-radians-2):
	* emacs-lisp/package.el (tar-header-name, tar-header-link-type):
	Fix declarations.

	* calc/calc-menu.el: Make it loadable in isolation.

	* net/eudcb-bbdb.el: Make it loadable without bbdb.
	(eudc-bbdb-filter-non-matching-record, eudc-bbdb-extract-phones)
	(eudc-bbdb-extract-addresses, eudc-bbdb-format-record-as-result)
	(eudc-bbdb-query-internal): Require 'bbdb.

	* lpr.el (lpr-headers-switches):
	* emacs-lisp/testcover.el (testcover-compose-functions): Fix :type.

	* progmodes/sql.el (sql-login-params): Fix and improve :type.

	* emulation/edt-mapper.el: In batch mode, error rather than hang.

	* term.el (term-set-escape-char): Make it idempotent.

2013-05-10  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-completion-table):
	No longer a function and all uses changed.  Use cache to speed up
	completion due to bug#11906.
	(octave-beginning-of-defun): Re-write to be more general.

2013-05-10  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/cl-macs.el (cl-loop): Doc fix.

2013-05-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* comint.el (comint-redirect-send-command-to-process): Use :around
	rather than :override for comint-redirect-filter.
	(comint-redirect-filter): Add the corresponding `orig-filter' argument.
	Call it instead of comint-redirect-original-filter-function (which
	is gone).  Reported by Juanma Barranquero <lekktu@gmail.com>.

2013-05-09  Jan Djärv  <jan.h.d@swipnet.se>

	* frame.el (display-monitor-attributes-list): Add NS case.
	(ns-display-monitor-attributes-list): Declare.

2013-05-09  Ulrich Mueller  <ulm@gentoo.org>

	* descr-text.el (describe-char): Fix %d/%x typo.  (Bug#14360)

2013-05-09  Glenn Morris  <rgm@gnu.org>

	* international/fontset.el (vertical-centering-font-regexp):
	Set standard-value.

	* tar-mode.el (tar-superior-buffer, tar-superior-descriptor): Add doc.

	* bookmark.el (bookmark-search-delay):
	* cus-start.el (vertical-centering-font-regexp):
	* ps-mule.el (ps-mule-font-info-database-default):
	* ps-print.el (ps-default-fg, ps-default-bg):
	* type-break.el (type-break-good-break-interval):
	* whitespace.el (whitespace-indentation-regexp)
	(whitespace-space-after-tab-regexp):
	* emacs-lisp/testcover.el (testcover-1value-functions)
	(testcover-noreturn-functions, testcover-progn-functions)
	(testcover-prog1-functions):
	* emulation/viper-init.el (viper-emacs-state-cursor-color):
	* eshell/em-glob.el (eshell-glob-translate-alist):
	* play/tetris.el (tetris-tty-colors):
	* progmodes/cpp.el (cpp-face-default-list):
	* progmodes/flymake.el (flymake-allowed-file-name-masks):
	* progmodes/idlw-help.el (idlwave-help-browser-generic-program)
	(idlwave-help-browser-generic-args):
	* progmodes/make-mode.el (makefile-special-targets-list):
	* progmodes/python.el (python-shell-virtualenv-path):
	* progmodes/verilog-mode.el (verilog-active-low-regexp)
	(verilog-auto-input-ignore-regexp, verilog-auto-inout-ignore-regexp)
	(verilog-auto-output-ignore-regexp, verilog-auto-tieoff-ignore-regexp)
	(verilog-auto-unused-ignore-regexp, verilog-typedef-regexp):
	* textmodes/reftex-vars.el (reftex-format-label-function):
	* textmodes/remember.el (remember-diary-file): Fix custom types.

	* jka-cmpr-hook.el (jka-compr-mode-alist-additions): Fix typo.
	Add :version.

2013-05-09  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-completion-at-point):
	Restore file completion.  (Bug#14300)
	(inferior-octave-startup): Fix incorrect highlighting for the
	first prompt.

2013-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ruby-mode.el: First cut at SMIE support.
	(ruby-use-smie): New var.
	(ruby-smie-grammar): New constant.
	(ruby-smie--bosp, ruby-smie--implicit-semi-p)
	(ruby-smie--forward-token, ruby-smie--backward-token)
	(ruby-smie-rules): New functions.
	(ruby-mode-variables): Setup SMIE if applicable.

2013-05-08  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-visual): Signal beginning/end of buffer
	only if vertical-motion moved less than it was requested.  Avoids
	silly incorrect error messages when there are display strings with
	multiple newlines at EOL.

2013-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/vera-mode.el (vera-underscore-is-part-of-word):
	* progmodes/prolog.el (prolog-underscore-wordchar-flag)
	(prolog-char-quote-workaround):
	* progmodes/cperl-mode.el (cperl-under-as-char):
	* progmodes/vhdl-mode.el (vhdl-underscore-is-part-of-word):
	Mark as obsolete.
	(vhdl-mode-syntax-table, vhdl-mode-ext-syntax-table): Initialize in
	their declaration.
	(vhdl-mode-syntax-table-init): Remove.

	* progmodes/m4-mode.el (m4-mode-syntax-table): Add comment on
	last change.

	* progmodes/ld-script.el (ld-script-mode-syntax-table): Use symbol
	syntax for "_".
	(ld-script-font-lock-keywords):
	Change regexps to use things like \_< and \_>.

	* progmodes/f90.el (f90-mode-syntax-table): Use symbol syntax for "_".
	Change all regexps to use things like \_< and \_>.

	* progmodes/autoconf.el (autoconf-definition-regexp)
	(autoconf-font-lock-keywords, autoconf-current-defun-function):
	Handle a _ with symbol syntax.
	(autoconf-mode): Don't change the syntax-table for imenu and font-lock.

	* progmodes/ada-mode.el (ada-mode-abbrev-table):
	Consolidate declaration.
	(ada-mode-syntax-table, ada-mode-symbol-syntax-table): Initialize in
	the declaration.
	(ada-create-syntax-table): Remove.
	(ada-capitalize-word): Don't mess with the syntax of "_" since it
	already has the right syntax nowadays.
	(ada-goto-next-word): Don't change the syntax of "_".

	* font-lock.el (lisp-font-lock-keywords-2): Don't highlight obsolete
	with-wrapper-hook.

2013-05-08  Sam Steingold  <sds@gnu.org>

	* thingatpt.el (thing-at-point): Accept optional second argument
	NO-PROPERTIES to strip the text properties from the return value.
	* net/browse-url.el (browse-url-url-at-point): Pass NO-PROPERTIES
	to `thing-at-point' instead of stripping the properties ourselves.
	Also, when `thing-at-point' fails to find a url, prepend "http://"
	to the filename at point on the assumption that the user is
	pointing at something like gnu.org/gnu.

2013-05-08  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/bytecomp.el (byte-compile-insert-header):
	* faces.el (crm-separator):
	Silence byte-compiler.

	* progmodes/gud.el (gdb-speedbar-auto-raise, gud-tooltip-mode)
	(tool-bar-map): Remove unneeded defvars.

2013-05-08  Leo Liu  <sdl.web@gmail.com>

	Re-work a fix for bug#10994 based on Le Wang's patch.
	* ido.el (ido-remove-consecutive-dups): New helper.
	(ido-completing-read): Use it.
	(ido-chop): Revert fix for bug#10994.

2013-05-08  Adam Spiers  <emacs@adamspiers.org>

	* cus-edit.el (custom-save-variables):
	Pretty-print long values.  (Bug#14187)

2013-05-08  Glenn Morris  <rgm@gnu.org>

	* progmodes/m4-mode.el (m4-program): Assume it is in PATH.
	(m4-mode-syntax-table): Init in the defvar.
	(m4-mode-abbrev-table): Let define-derived-mode define it.

2013-05-08  Tom Tromey  <tromey@redhat.com>

	* progmodes/m4-mode.el (m4-mode-syntax-table):
	Do not treat "_" as word constituent.  (Bug#14167)

2013-05-07  Glenn Morris  <rgm@gnu.org>

	* eshell/em-hist.el (eshell-isearch-map): Initialize in the defvar.
	Remove explicit eshell-isearch-cancel-map.

	* progmodes/f90.el (f90-smart-end-names): New option.
	(f90-smart-end): Doc fix.
	(f90-end-block-optional-name): New constant.
	(f90-block-match): Respect f90-smart-end-names.

2013-05-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/octave.el (octave-smie-forward-token): Be more careful
	about implicit semi-colons (bug#14218).

2013-05-07  YAMAMOTO Mitsuharu  <mituharu@math.s.chiba-u.ac.jp>

	* frame.el (display-monitor-attributes-list)
	(frame-monitor-attributes): New functions.

2013-05-06  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-syntax-propertize-function): Change
	\'s syntax to escape when inside double-quoted strings.  (Bug#14332)
	(octave-font-lock-keywords): Use octave-operator-regexp.
	(octave-completion-at-point): Rename from
	octave-completion-at-point-function.
	(inferior-octave-directory-tracker): Robustify.
	(octave-text-functions): Remove and fix its uses.  No such things
	any more.

2013-05-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/trace.el (trace--display-buffer): New function.
	(trace-make-advice): Use it.

2013-05-06  Juri Linkov  <juri@jurta.org>

	* emacs-lisp/lisp-mode.el (eval-defun-2): Doc fix.  (Bug#14344)
	(eval-defun-2, eval-defun, eval-last-sexp, eval-last-sexp-1):
	Doc fix.
	(emacs-lisp-mode-map): Replace "minibuffer" with "echo area"
	in the help string.  (Bug#12985)

2013-05-06  Kelly Dean  <kellydeanch@yahoo.com>  (tiny change)

	* simple.el (shell-command-on-region): Doc fix.  (Bug#14279)

2013-05-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/perl-mode.el: Add support for here documents.
	(perl-syntax-propertize-function): Match here-doc markers.
	(perl-syntax-propertize-special-constructs): Find their end.
	(perl-imenu-generic-expression): Use [:alnum:].

	* emacs-lisp/nadvice.el (advice--member-p): Return the advice if found.
	(advice--add-function): Refresh the advice if already present
	(bug#14317).

2013-05-06  Ivan Andrus  <darthandrus@gmail.com>

	* find-file.el (cc-other-file-alist): Add ".m" for ObjC.  (Bug#14339)

2013-05-06  Glenn Morris  <rgm@gnu.org>

	* w32-fns.el (w32-charset-info-alist): Declare.

	* eshell/em-cmpl.el: Simply require pcomplete; eg we use a bunch
	of its defcustom properties.
	(eshell-cmpl-initialize): No need to load pcomplete.

	* generic-x.el: No need to require comint when compiling.

	* net/eudc-export.el: Make it loadable without bbdb.
	(top-level): Use require rather than load-library.
	(eudc-create-bbdb-record, eudc-bbdbify-phone)
	(eudc-batch-export-records-to-bbdb)
	(eudc-insert-record-at-point-into-bbdb, eudc-try-bbdb-insert):
	Require bbdb.

2013-05-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/octave.el (octave-texinfo-font-lock-keywords): Remove.
	(octave-font-lock-texinfo-comment): Use texinfo-font-lock-keywords with
	some tweaks, instead.

2013-05-05  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords)
	(octave-font-lock-texinfo-comment): Adjust for the byte-compiler.
	(inferior-octave-send-list-and-digest): Improve error message.
	(octave-mode, inferior-octave-mode): Use setq-local.
	(octave-help): Set info-lookup-mode.

2013-05-05  Richard Stallman  <rms@gnu.org>

	* vc/compare-w.el (compare-windows-whitespace):
	Treat no-break space as whitespace.

	* mail/rmailsum.el (rmail-summary-rmail-update):
	Detect empty summary and don't change selected message.
	(rmail-summary-goto-msg): Likewise.

	* mail/rmailsum.el (rmail-new-summary, rmail-new-summary-1):
	Doc fixes, rename args.

2013-05-05  Alan Mackenzie  <acm@muc.de>

	* progmodes/cc-defs.el (c-version): Increment to 5.32.5.

2013-05-05  Juri Linkov  <juri@jurta.org>

	* info.el (Info-read-subfile): Use (point-min) instead of (point)
	to not add the length of the summary segment to the return value.
	(Bug#14125)

2013-05-05  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-strip-ctrl-g)
	(inferior-octave-output-filter): Remove.
	(octave-send-region, inferior-octave-startup): Fix callers.
	(inferior-octave-mode-map): Don't use comint-dynamic-complete.
	(octave-binary-file-extensions): New user variable.
	(octave-find-definition): Confirm if opening binary files.
	(octave-help-file): Use octave-find-definition to get the binary
	confirmation.
	(octave-help): Adjust for octave-help-file change.

2013-05-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/pascal.el (pascal-font-lock-keywords): Use backquotes.
	Merge the two entries that handle function definitions.
	(pascal--syntax-propertize): New const.
	(pascal-mode): Use it.  Use setq-local.

2013-05-04  Glenn Morris  <rgm@gnu.org>

	* calendar/diary-lib.el (diary-from-outlook-function): New variable.
	(diary-from-outlook): Respect diary-from-outlook-function.

2013-05-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (read-expression-map): Use completion-at-point (bug#14255).
	Move the declaration from C.
	(read-minibuffer, eval-minibuffer): Move from C.
	(completion-setup-function): Avoid minibuffer-completion-contents.

2013-05-03  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords): Do not
	dehighlight 'end' in comments or strings.
	(octave-completing-read, octave-goto-function-definition):
	New helpers.
	(octave-help-buffer): New user variable.
	(octave-help-file, octave-help-function): New button types.
	(octave-help): New command and bind it to C-h ;.
	(octave-find-definition): New command and bind it to M-.
	(user-error): Alias to error if not defined.

2013-05-02  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode-syntax-table): Correct syntax
	for \.  (bug#14332)
	(octave-font-lock-keywords): Include [ and {.

2013-05-02  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup-file): Change default.
	(inferior-octave): Remove calling comint-mode and return the buffer.
	(inferior-octave-startup): Cosmetic changes.

2013-05-02  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-syntax-propertize-function):
	Include the case when ' is at line beginning.  (Bug#14336)

2013-05-02  Glenn Morris  <rgm@gnu.org>

	* vc/vc-dir.el (vc-dir-mode): Don't autoload it for everyone.
	* desktop.el (vc-dir-mode): Just autoload it here.

2013-05-02  Alan Mackenzie  <acm@muc.de>

	Eliminate variable c-standard-font-lock-fontify-region-function.
	* progmodes/cc-mode.el
	(c-standard-font-lock-fontify-region-function): Remove.
	(c-font-lock-fontify-region, c-after-font-lock-init): Adapt.

2013-05-01  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el: Compatible with older emacs-24 releases.
	(inferior-octave-has-built-in-variables): Remove.  Built-in
	variables were removed from Octave in 2007.
	(inferior-octave-startup): Fix uses.
	(comint-line-beginning-position): Remove compatibility code for
	emacs 21.

2013-05-01  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-forward, isearch-mode): Doc fix.  (Bug#13923)

2013-05-01  Juri Linkov  <juri@jurta.org>

	* comint.el (comint-previous-matching-input): Don't print message
	"History item: %d" when `isearch-mode' is active.
	(comint-history-isearch-message): Print message "History item: %d"
	when `comint-input-ring-index' is not empty and this function is
	called from `isearch-update' with a nil `ellipsis'.  (Bug#13223)

2013-05-01  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-abbrev-table): Remove abbrev
	definitions.  Use completion-at-point to insert keywords.
	(octave-abbrev-start): Remove.
	(inferior-octave-mode, octave-mode): Use :abbrev-table instead.

2013-04-30  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-prompt-read-only): Fix last
	change.

2013-04-30  Alan Mackenzie  <acm@muc.de>

	Handle arbitrarily long C++ member initialization lists.
	* progmodes/cc-engine.el (c-back-over-member-initializers):
	new function.
	(c-guess-basic-syntax): New CASE 5R (extracted from 5B) to handle
	(most) member init lists.

2013-04-30  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (inferior-octave-prompt-read-only): New user
	variable.

2013-04-30  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-variables): Remove.  No builtin
	variables any more.  All converted to functions.
	(octave-font-lock-keywords, octave-completion-at-point-function):
	Fix uses.
	(octave-font-lock-texinfo-comment): New user variable.
	(octave-texinfo-font-lock-keywords): New variable for texinfo
	comment block.
	(octave-function-comment-block): New face.
	(octave-font-lock-texinfo-comment): New function.
	(octave-mode): Font lock texinfo comment block.

2013-04-29  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords): Handle 'end' in
	indexing expression.
	(octave-continuation-string): Do not use \.
	(inferior-octave-complete-impossible): Remove.
	(inferior-octave-completion-table)
	(inferior-octave-completion-at-point): Remove its uses.
	(inferior-octave-startup): completion_matches was introduced to
	Octave in 1996 so safe to assume it.
	(octave-function-file-comment): Improve to follow how Octave does it.
	(octave-update-function-file-comment): Tweak.

2013-04-29  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup-hook): Obsolete.
	(inferior-octave-startup): Remove inferior-octave-startup-hook.
	(octave-function-file-comment): Fix typo.
	(octave-sync-function-file-names): Use read-char-choice.

2013-04-28  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc.el (math-normalize): Don't set `math-normalize-error'
	to t for the less important warnings.

2013-04-27  Darren Hoo  <darren.hoo@gmail.com>  (tiny change)

	* isearch.el (isearch-fail-pos): Check for empty `cmds'.  (Bug#14268)

2013-04-27  Glenn Morris  <rgm@gnu.org>

	* vc/log-view.el (log-view-current-entry):
	Treat "---" separator lines as part of the following rev.  (Bug#14169)

2013-04-27  Juri Linkov  <juri@jurta.org>

	* subr.el (read-number): Doc fix about using it by interactive
	code letter `n'.  (Bug#14254)

2013-04-27  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-auto-save-timeout): New option.
	(desktop-file-checksum): New variable.
	(desktop-save): Add optional arg `auto-save' and don't auto-save
	if nothing changed.
	(desktop-auto-save-timer): New variable.
	(desktop-auto-save, desktop-auto-save-set-timer): New functions.
	(after-init-hook): Call `desktop-auto-save-set-timer'.
	Suggested by Reuben Thomas <rrt@sc3d.org> in
	<https://lists.gnu.org/archive/html/emacs-devel/2013-04/msg00327.html>.

2013-04-27  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-function-file-p)
	(octave-skip-comment-forward, octave-function-file-comment)
	(octave-update-function-file-comment): New functions.
	(octave-mode-map): Bind C-c ; to
	octave-update-function-file-comment.
	(octave-mode-menu): Add octave-update-function-file-comment.
	(octave-mode, inferior-octave-mode): Fix doc-string.
	(octave-insert-defun): Conform to Octave's coding convention.
	(Bug#14285)

	* files.el (basic-save-buffer): Don't let errors in
	before-save-hook prevent saving buffer.

2013-04-20  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Use completing-read if arg multiple
	is nil.

2013-04-27  Ingo Lohmar  <i.lohmar@gmail.com>  (tiny change)

	* ls-lisp.el (ls-lisp-insert-directory): If no files are
	displayed, move point to after the totals line.
	See https://lists.gnu.org/archive/html/emacs-devel/2013-04/msg00677.html
	for the details.

2013-04-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-autoload-ensure-default-file):
	Add current dir to the load-path.
	(package-generate-autoloads): Don't rely on
	autoload-ensure-default-file.

2013-04-26  Reuben Thomas  <rrt@sc3d.org>

	* textmodes/remember.el (remember-store-in-files): Document that
	the file name format is passed to `format-time-string'.

2013-04-26  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-sync-function-file-names): New function.
	(octave-mode): Use it in before-save-hook.

2013-04-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/tabulated-list.el (tabulated-list-mode): Disable undo
	(bug#14274).

	* progmodes/octave.el (octave-smie-forward-token): Properly skip
	\n and comment, even if it's not an implicit ; (bug#14218).

2013-04-26  Glenn Morris  <rgm@gnu.org>

	* subr.el (read-number): Once more use `read' rather than
	`string-to-number', to trap non-numeric input.  (Bug#14254)

2013-04-26  Erik Charlebois  <erikcharlebois@gmail.com>

	* emacs-lisp/syntax.el (syntax-propertize-multiline):
	Use `syntax-multiline' text property consistently instead of
	`font-lock-multiline'.  (Bug#14237)

2013-04-26  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/shadow.el (list-load-path-shadows):
	No longer necessary to check for duplicate simple.el, since
	2012-07-07 change to init_lread to not include installation lisp
	directories in load-path when running uninstalled.  (Bug#14270)

2013-04-26  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-submit-bug-report): Obsolete.
	(octave-mode, inferior-octave-mode): Use setq-local.
	(octave-not-in-string-or-comment-p): Rename to
	octave-in-string-or-comment-p.
	(octave-in-comment-p, octave-in-string-p)
	(octave-in-string-or-comment-p): Replace defsubst with defun.

2013-04-25  Paul Eggert  <eggert@cs.ucla.edu>

	* Makefile.in (distclean): Remove $(lisp)/loaddefs.el~.

2013-04-25  Bastien Guerry  <bzg@gnu.org>

	* textmodes/remember.el (remember-data-directory)
	(remember-directory-file-name-format): Fix custom types.

2013-04-25  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-completion-at-point-function):
	Make use of inferior octave process.
	(octave-initialize-completions): Remove.
	(inferior-octave-completion-table): New function.
	(inferior-octave-completion-at-point): Use it.
	(octave-completion-alist): Remove.

2013-04-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/opascal.el: Use font-lock and syntax-propertize.
	(opascal-mode-syntax-table): New var.
	(opascal-literal-kind, opascal-is-literal-end)
	(opascal-literal-token-at): Rewrite.
	(opascal--literal-start-re, opascal-font-lock-keywords)
	(opascal--syntax-propertize): New constants.
	(opascal-font-lock-defaults): Adjust.
	(opascal-mode): Use them.  Set comment-<foo> variables as well.
	(delphi-comment-face, opascal-comment-face, delphi-string-face)
	(opascal-string-face, delphi-keyword-face, opascal-keyword-face)
	(delphi-other-face, opascal-other-face): Remove face variables.
	(opascal-save-state): Remove macro.
	(opascal-fontifying-progress-step): Remove constant.
	(opascal--ignore-changes): Remove var.
	(opascal-set-token-property, opascal-parse-next-literal)
	(opascal-is-stable-literal, opascal-complete-literal)
	(opascal-is-literal-start, opascal-face-of)
	(opascal-parse-region, opascal-parse-region-until-stable)
	(opascal-fontify-region, opascal-after-change)
	(opascal-debug-show-is-stable, opascal-debug-unparse-buffer)
	(opascal-debug-parse-region, opascal-debug-parse-window)
	(opascal-debug-parse-buffer, opascal-debug-fontify-window)
	(opascal-debug-fontify-buffer): Remove.
	(opascal-debug-mode-map): Adjust accordingly.

2013-04-25  Leo Liu  <sdl.web@gmail.com>

	Merge octave-mod.el and octave-inf.el into octave.el with some
	cleanups.
	* progmodes/octave.el: New file renamed from octave-mod.el.
	* progmodes/octave-inf.el: Merged into octave.el.
	* progmodes/octave-mod.el: Renamed to octave.el.

2013-04-25  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el
	(reftex-label-ignored-macros-and-environments): New defcustom.

	* textmodes/reftex-parse.el (reftex-parse-from-file): Use it.

2013-04-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-indent--hanging-p): Don't burp at EOB.
	(smie-indent-keyword): Improve the check to ensure that the next
	comment is really on the same line.
	(smie-indent-comment): Don't align with a subsequent closer (or eob).

	* progmodes/octave-mod.el (octave-smie-forward-token): Only emit
	semi-colons if the line is not otherwise empty (bug#14218).

2013-04-25  Glenn Morris  <rgm@gnu.org>

	* vc/vc-bzr.el (vc-bzr-print-log): Tweak LIMIT = 1 case.

2013-04-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/opascal.el (opascal-set-token-property): Rename from
	opascal-set-text-properties and only set `token' (bug#14134).
	Suggested by Erik Knowles <eknowles@geosystemsoftware.com>.
	(opascal-literal-text-properties): Remove.
	(opascal-parse-next-literal, opascal-debug-unparse-buffer):
	Adjust callers.

2013-04-24  Reuben Thomas  <rrt@sc3d.org>

	* textmodes/remember.el (remember-handler-functions): Add an
	option for a new handler `remember-store-in-files'.
	(remember-data-directory, remember-directory-file-name-format):
	New options.
	(remember-store-in-files): New function to store remember notes
	as separate files within a directory.

2013-04-24  Magnus Henoch  <magnus.henoch@gmail.com>

	* progmodes/compile.el (compilation-next-error-function):
	Pass "formats" to compilation-find-file (bug#11777).

2013-04-24  Glenn Morris  <rgm@gnu.org>

	* vc/vc-bzr.el (vc-bzr-print-log):
	* vc/vc-hg.el (vc-hg-print-log):
	* vc/vc-svn.el (vc-svn-print-log):
	Fix START-REVISION with LIMIT != 1.  (Bug#14168)

	* vc/vc-bzr.el (vc-bzr-print-log):
	* vc/vc-cvs.el (vc-cvs-print-log):
	* vc/vc-git.el (vc-git-print-log):
	* vc/vc-hg.el (vc-hg-print-log):
	* vc/vc-mtn.el (vc-mtn-print-log):
	* vc/vc-rcs.el (vc-rcs-print-log):
	* vc/vc-sccs.el (vc-sccs-print-log):
	* vc/vc-svn.el (vc-svn-print-log):
	* vc/vc.el (vc-print-log-internal): Doc fixes.

2013-04-23  Glenn Morris  <rgm@gnu.org>

	* startup.el (normal-no-mouse-startup-screen, normal-about-screen):
	Remove venerable code attempting to avoid substitute-command-keys.

2013-04-23  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (reftex-label-regexps):
	Call `reftex-compile-variables' after changes to this variable.

2013-04-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* jit-lock.el: Fix signals in jit-lock-force-redisplay (bug#13542).
	Use lexical-binding.
	(jit-lock-force-redisplay): Use markers, check buffer's continued
	existence and beware narrowed buffers.
	(jit-lock-fontify-now): Adjust call accordingly.

2013-04-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (minibuffer-completion-contents): Fix obsolescence info
	to avoid misleading the user.

2013-04-22  Leo Liu  <sdl.web@gmail.com>

	* info-look.el: Prefer latex2e.info.  (Bug#14240)

2013-04-22  Michael Albinus  <michael.albinus@gmx.de>

	Fix pack/unpack coding.  Reported by David Smith <davidsmith@acm.org>.

	* net/tramp-compat.el (tramp-compat-call-process): Move function ...
	* net/tramp.el (tramp-call-process): ... here.
	(tramp-set-completion-function, tramp-parse-putty):
	* net/tramp-adb.el (tramp-adb-execute-adb-command):
	* net/tramp-gvfs.el (tramp-gvfs-send-command):
	* net/tramp-sh.el (tramp-sh-handle-set-file-times)
	(tramp-set-file-uid-gid, tramp-sh-handle-write-region)
	(tramp-call-local-coding-command): Use `tramp-call-process'
	instead of `tramp-compat-call-process'.

	* net/tramp-sh.el (tramp-perl-pack, tramp-perl-unpack): New defconst.
	(tramp-local-coding-commands, tramp-remote-coding-commands): Use them.
	(tramp-sh-handle-file-local-copy, tramp-sh-handle-write-region)
	(tramp-find-inline-compress): Improve traces.
	(tramp-maybe-send-script): Check for Perl binary.
	(tramp-get-inline-coding): Do not redirect STDOUT for local decoding.

2013-04-22  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-context-pinentry-mode): New function.
	(epg-context-set-pinentry-mode): New function.
	(epg--start): Pass --pinentry-mode option to gpg command.

2013-04-21  Xue Fuqiao  <xfq.free@gmail.com>

	* comint.el (comint-dynamic-complete-functions, comint-mode-map):
	`comint-dynamic-complete' is obsolete since 24.1, replaced by
	`completion-at-point'.  (Bug#13774)

	* startup.el (normal-no-mouse-startup-screen): Bug fix, the
	default key binding for `describe-distribution' has been moved to
	`C-h C-o'.  (Bug#13970)

2013-04-21  Glenn Morris  <rgm@gnu.org>

	* vc/vc.el (vc-print-log-setup-buttons, vc-print-log-internal):
	Add doc strings.
	(vc-print-log): Clarify interactive prompt.

2013-04-20  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-insert-header):
	No longer include timestamp etc information.

2013-04-20  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Bug fix, return just one face if arg
	multiple is nil.  (Bug#14209)

2013-04-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--where-alist): Add :override.
	(remove-function): Autoload.

	* comint.el (comint-redirect-original-filter-function): Remove.
	(comint-redirect-cleanup, comint-redirect-send-command-to-process):
	* vc/vc-cvs.el (vc-cvs-annotate-process-filter)
	(vc-cvs-annotate-command):
	* progmodes/octave-inf.el (inferior-octave-send-list-and-digest):
	* progmodes/prolog.el (prolog-consult-compile):
	* progmodes/gdb-mi.el (gdb, gdb--check-interpreter):
	Use add/remove-function instead.
	* progmodes/gud.el (gud-tooltip-original-filter): Remove.
	(gud-tooltip-process-output, gud-tooltip-tips):
	Use add/remove-function instead.
	* progmodes/xscheme.el (xscheme-previous-process-state): Remove.
	(scheme-interaction-mode, exit-scheme-interaction-mode):
	Use add/remove-function instead.

	* vc/vc-dispatcher.el: Use lexical-binding.
	(vc--process-sentinel): Rename from vc-process-sentinel.
	Change last arg to be the code to run.  Don't use vc-previous-sentinel
	and vc-sentinel-commands any more.
	(vc-exec-after): Allow code to be a function.  Use add/remove-function.
	(compilation-error-regexp-alist, view-old-buffer-read-only): Declare.

2013-04-19  Masatake YAMATO  <yamato@redhat.com>

	* progmodes/sh-script.el (sh-imenu-generic-expression):
	Handle function names with a single character.  (Bug#14111)

2013-04-19  Dima Kogan  <dima@secretsauce.net>  (tiny change)

	* progmodes/gud.el (gud-perldb-marker-filter): Understand position info
	for subroutines defined in an eval (bug#14182).

2013-04-19  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* bookmark.el (bookmark-completing-read): Improve handling of empty
	string (bug#14176).

2013-04-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-dispatcher.el (vc-do-command): Get rid of default sentinel msg.

2013-04-19  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	New faster Imenu implementation (bug#14058).
	* progmodes/python.el (python-imenu-prev-index-position)
	(python-imenu-format-item-label-function)
	(python-imenu-format-parent-item-label-function)
	(python-imenu-format-parent-item-jump-label-function):
	New vars.
	(python-imenu-format-item-label)
	(python-imenu-format-parent-item-label)
	(python-imenu-format-parent-item-jump-label)
	(python-imenu--put-parent, python-imenu--build-tree)
	(python-imenu-create-index, python-imenu-create-flat-index)
	(python-util-popn): New functions.
	(python-mode): Set imenu-create-index-function to
	python-imenu-create-index.

2013-04-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* winner.el (winner-active-region): Use region-active-p, activate-mark
	and deactivate-mark (bug#14225).

	* simple.el (deactivate-mark): Don't inline it.

2013-04-18  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-remote-process-environment): Add "TMOUT=0".

2013-04-18  Tassilo Horn  <tsdh@gnu.org>

	* files.el (auto-mode-alist): Delete OpenDocument and StarOffice
	file extensions from the archive-mode entry in order to prefer
	doc-view-mode-maybe with archive-mode as fallback (bug#14188).

2013-04-18  Leo Liu  <sdl.web@gmail.com>

	* bindings.el (help-event-list): Add ?\?.

2013-04-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (with-wrapper-hook): Declare obsolete.
	* simple.el (filter-buffer-substring-function): New hook.
	(filter-buffer-substring): Use it.
	(filter-buffer-substring-functions): Mark obsolete.
	* minibuffer.el (completion-in-region-function): New hook.
	(completion-in-region): Use it.
	(completion-in-region-functions): Mark obsolete.
	* mail/mailabbrev.el (mail-abbrevs-setup): Use abbrev-expand-function.
	* abbrev.el (abbrev-expand-function): New hook.
	(expand-abbrev): Use it.
	(abbrev-expand-functions): Mark obsolete.
	* emacs-lisp/nadvice.el (advice--where-alist): Add :filter-args
	and :filter-return.

2013-04-17  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-nav--syntactically): Fix cornercases
	and do not care about match data.

2013-04-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp.el (lisp-completion-at-point): Provide specialized
	completion tables when completing error conditions and
	`declare' arguments.
	(lisp-complete-symbol, field-complete): Mark as obsolete.
	(check-parens): Unmatched parens are user errors.
	* minibuffer.el (minibuffer-completion-contents): Mark as obsolete.

2013-04-17  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/flyspell.el (flyspell-check-pre-word-p): Return nil if
	command changed buffer (ie. `flyspell-pre-buffer' is not current
	buffer), which prevents making decisions based on invalid value of
	`flyspell-pre-point' in the wrong buffer.  Most notably, this used to
	cause an error when `flyspell-pre-point' was nil after switching
	buffers.
	(flyspell-post-command-hook): No longer needs to change buffers when
	checking pre-word.  While at it remove unnecessary progn.

2013-04-17  Nicolas Richard  <theonewiththeevillook@yahoo.fr>  (tiny change)

	* textmodes/ispell.el (ispell-add-per-file-word-list):
	Fix `flyspell-correct-word-before-point' error when accepting
	words and `coment-padding' is an integer by using
	`comment-normalize-vars' (Bug #14214).

2013-04-17  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	New defun movement commands.
	* progmodes/python.el (python-nav--syntactically)
	(python-nav--forward-defun, python-nav-backward-defun)
	(python-nav-forward-defun): New functions.

2013-04-17  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-syntax--context-compiler-macro): New defun.
	(python-syntax-context): Use named compiler-macro for backwards
	compatibility with Emacs 24.x.

2013-04-17  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave-mod.el (octave-mode-map): Fix key binding to
	octave-hide-process-buffer.

2013-04-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-hg.el (vc-hg-annotate-re): Disallow ": " in file names
	(bug#14216).

2013-04-17  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el (gdbmi-bnf-incomplete-record-result):
	Fix adjustment of offset when receiving incomplete responses from GDB
	(bug#14129).

2013-04-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/python.el (python-mode-skeleton-abbrev-table): Rename from
	python-mode-abbrev-table.
	(python-skeleton-define): Adjust accordingly.
	(python-mode-abbrev-table): New table that inherits from it so that
	python-skeleton-autoinsert does not affect non-skeleton abbrevs.

	* abbrev.el (abbrev--symbol): New function, extracted from abbrev-symbol.
	(abbrev-symbol): Use it.
	(abbrev--before-point): Use it since we already handle inheritance.

2013-04-16  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave-mod.el (octave-mode-map): Remove redundant key
	binding to info-lookup-symbol.

2013-04-16  Juanma Barranquero  <lekktu@gmail.com>

	* minibuffer.el (completion--twq-all):
	* term/ns-win.el (ns-initialize-window-system):
	* term/w32-win.el (w32-initialize-window-system): Silence byte-compiler.

2013-04-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (add-function): Default simple vars to their
	global bindings.

	* doc-view.el (doc-view-start-process): Handle url-handler directories.

2013-04-15  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-beginning-of-defun)
	(ruby-end-of-defun, ruby-move-to-block): Bind `case-fold-search'
	to nil.
	(ruby-end-of-defun): Remove the unused arg, change the docstring
	to reflect that this function is only used as the value of
	`end-of-defun-function'.
	(ruby-beginning-of-defun): Remove "top-level" from the docstring,
	to reflect an earlier change that beginning/end-of-defun functions
	jump between methods in a class definition, as well as top-level
	functions.

2013-04-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (minibuffer-complete): Don't just scroll
	a *Completions* that's been iconified.
	(minibuffer-force-complete): Make sure repetitions do cycle when going
	through completion-in-region -> minibuffer-complete.

2013-04-15  Alan Mackenzie  <acm@muc.de>

	Correct the placement of c-cpp-delimiters when there're #s not at
	col 0.

	* progmodes/cc-langs.el (c-anchored-cpp-prefix): Reformulate and
	place a submatch around the #.
	* progmodes/cc-mode.el(c-neutralize-syntax-in-and-mark-CPP):
	Start a search at BOL.  Put the c-cpp-delimiter category text propertiy
	on the #, not BOL.

2013-04-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el: Properly test names when adding advice.
	(advice--member-p): New arg `name'.
	(advice--add-function, advice-member-p): Use it (bug#14202).

2013-04-15  Filipp Gunbin  <fgunbin@fastmail.fm>

	Reformulate java imenu-generic-expression.
	The old expression contained ill formed regexps.

	* progmodes/cc-menus.el (cc-imenu-java-ellipsis-regexp)
	(cc-imenu-java-type-spec-regexp, cc-imenu-java-comment-regexp)
	(cc-imenu-java-method-arg-regexp): New defconsts.
	(cc-imenu-java-build-type-args-regex): New defun.
	(cc-imenu-java-generic-expression): Fix, to remove "ambiguous"
	handling of spaces in the regexp.

2013-03-15  Agustín Martín Domingo  <agustin.martin@hispalinux.es>

	* textmodes/ispell.el (ispell-command-loop): Remove
	flyspell highlight of a word when ispell accepts it (bug #14178).

2013-04-15  Michael Albinus  <michael.albinus@gmx.de>

	* net/ange-ftp.el (ange-ftp-run-real-handler-orig): New defun,
	uses code from the previous `ange-ftp-run-real-handler'.
	(ange-ftp-run-real-handler): Set it to `tramp-run-real-handler'
	only in case that function exist.  This is needed for proper
	unloading of Tramp.

2013-04-15  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (reftex-label-regexps): New defcustom.

	* textmodes/reftex.el (reftex-compile-variables): Use it.

2013-04-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files.el (normal-mode): Only use default major-mode if no other mode
	was specified.

	* emacs-lisp/trace.el (trace-values): New function.

	* files.el: Allow : in local variables (bug#14089).
	(hack-local-variable-regexp): New var.
	(hack-local-variables-prop-line, hack-local-variables): Use it.

2013-04-13  Roland Winkler  <winkler@gnu.org>

	* textmodes/bibtex.el (bibtex-search-entries): Bug fix.  Use match
	data before it gets modified by bibtex-beginning-of-entry.

2013-04-13  Roland Winkler  <winkler@gnu.org>

	* textmodes/bibtex.el (bibtex-url): Doc fix.

2013-04-13  Roland Winkler  <winkler@gnu.org>

	* textmodes/bibtex.el (bibtex-initialize): If the current buffer
	does not visit a BibTeX file, exclude it from the list of buffers
	returned by bibtex-initialize.

2013-04-13  Stephen Berman  <stephen.berman@gmx.net>

	* window.el (split-window): Remove interactive form, since as a
	command this function is a special case of split-window-below.
	Correct doc string.

2013-04-12  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Do not override value of arg default.
	Allow single faces and strings as default values.  Remove those
	elements from return value that are not faces.
	(describe-face): Simplify.
	(face-at-point): New optional args thing and multiple so that this
	function can provide the same functionality previously provided by
	read-face-name.
	(make-face-bold, make-face-unbold, make-face-italic)
	(make-face-unitalic, make-face-bold-italic, invert-face)
	(modify-face, read-face-and-attribute): Use face-at-point.

	* cus-edit.el (customize-face, customize-face-other-window)
	* cus-theme.el (custom-theme-add-face)
	* face-remap.el (buffer-face-set)
	* facemenu.el (facemenu-set-face): Use face-at-point.

2013-04-12  Michael Albinus  <michael.albinus@gmx.de>

	* info.el (Info-file-list-for-emacs): Add "tramp" and "dbus".

2013-04-10  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-cite.el (reftex-parse-bibtex-entry): Don't cut
	off leading { and trailing } from field values.

2013-04-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/timer.el (timer--check): New function.
	(timer--time, timer-set-function, timer-event-handler): Use it.
	(timer-set-idle-time): Simplify.
	(timer--activate): CSE.
	(timer-event-handler): Give more info in error message.
	(internal-timer-start-idle): New function, moved from C.

	* mpc.el (mpc-proc): Add `restart' argument.
	(mpc-proc-cmd): Use it.
	(mpc--status-timer-run): Also catch signals from `mpc-proc'.
	(mpc-status-buffer-show, mpc-tagbrowser-dir-toggle): Call `mpc-proc'
	less often.

2013-04-10  Masatake YAMATO  <yamato@redhat.com>

	* progmodes/sh-script.el: Implement `sh-mode' own
	`add-log-current-defun-function' (bug#14112).
	(sh-current-defun-name): New function.
	(sh-mode): Use the function.

2013-04-09  Bastien Guerry  <bzg@gnu.org>

	* simple.el (choose-completion-string): Fix docstring (bug#14163).

2013-04-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-mode): Fix typo (bug#14144).

	* emacs-lisp/timer.el (timer-event-handler): Don't retrigger a canceled
	timer (bug#14156).

2013-04-07  Nic Ferrier  <nferrier@ferrier.me.uk>

	* emacs-lisp/ert.el (should, should-not, should-error): Add edebug
	declaration.

2013-04-07  Leo Liu  <sdl.web@gmail.com>

	* pcmpl-x.el: New file.

2013-04-06  Dmitry Antipov  <dmantipov@yandex.ru>

	Do not set x-display-name until X connection is established.
	This is needed to prevent from weird situation described at
	<https://lists.gnu.org/archive/html/emacs-devel/2013-04/msg00212.html>.
	* frame.el (make-frame): Set x-display-name after call to
	window system initialization function, not before.
	* term/x-win.el (x-initialize-window-system): Add optional
	display argument and use it.
	* term/w32-win.el (w32-initialize-window-system):
	* term/ns-win.el (ns-initialize-window-system):
	* term/pc-win.el (msdos-initialize-window-system):
	Add compatible optional display argument.

2013-04-06  Eli Zaretskii  <eliz@gnu.org>

	* files.el (normal-backup-enable-predicate): On MS-Windows and
	MS-DOS compare truenames of temporary-file-directory and of the
	file, so that 8+3 aliases (usually found in $TEMP on Windows)
	don't fail comparison by compare-strings.  Also, compare file
	names case-insensitively on MS-Windows and MS-DOS.

2013-04-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-compute-transaction): Fix last fix.
	Suggested by Donald Curtis <dcurtis@coe.edu> (bug#14082).

2013-04-05  Dmitry Gutov  <dgutov@yandex.ru>

	* whitespace.el (whitespace-color-on, whitespace-color-off):
	Only call `font-lock-fontify-buffer' when `font-lock-mode' is on.

2013-04-05  Jacek Chrząszcz  <chrzaszcz@mimuw.edu.pl>  (tiny change)

	* ispell.el (ispell-set-spellchecker-params):
	Really set `ispell-args' for all equivs.

2013-04-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ido.el (ido-completions): Use extra elements of ido-decorations
	(bug#14143).
	(ido-decorations): Update docstring.

2013-04-05  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-mode, auto-revert-tail-mode)
	(global-auto-revert-mode): Let-bind `auto-revert-use-notify' to
	nil during initialization, in order not to miss changes since the
	file was opened.  (Bug#14140)

2013-04-05  Leo Liu  <sdl.web@gmail.com>

	* kmacro.el (kmacro-call-macro): Fix bug#14135.

2013-04-05  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-units.el (calc-convert-units): Rewrite conditional.

2013-04-04  Glenn Morris  <rgm@gnu.org>

	* electric.el (electric-pair-inhibit-predicate): Add :version.

2013-04-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-compute-transaction): Fix ordering
	when a package is required several times (bug#14082).

2013-04-04  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Behave as promised by the docstring.
	Assume that arg default is a list of faces.
	(describe-face): Call read-face-name with list of default faces.

2013-04-04  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* bookmark.el: Fix deletion of bookmarks (bug#13972).
	(bookmark-bmenu-list): Don't toggle filenames if alist is empty.
	(bookmark-bmenu-execute-deletions): Only skip first line if it's
	the header.
	(bookmark-exit-hook-internal): Save even if list is empty.

2013-04-04  Yann Hodique  <yann.hodique@gmail.com>  (tiny change)

	* emacs-lisp/package.el (package-pinned-packages): New var.
	(package--add-to-archive-contents): Obey it (bug#14118).

2013-04-03  Alan Mackenzie  <acm@muc.de>

	Handle `parse-partial-sexp' landing inside a comment opener (Bug#13244).
	Also adapt to the new values of element 7 of a parse state.

	* progmodes/cc-engine.el (c-state-pp-to-literal): New optional
	parameter `not-in-delimiter'.  Handle being inside comment opener.
	(c-invalidate-state-cache-1): Reckon with an extra "invalid"
	character in case we're typing a '*' after a '/'.
	(c-literal-limits): Handle the awkward "not-in-delimiter" cond arm
	instead by passing the parameter to c-state-pp-to-literal.

	* progmodes/cc-fonts.el (c-font-lock-doc-comments): New handling
	for elt. 7 of a parse state.

2013-04-01  Paul Eggert  <eggert@cs.ucla.edu>

	Use UTF-8 for most files with non-ASCII characters (Bug#13936).
	* international/latin1-disp.el, international/mule-util.el:
	* language/cyril-util.el, language/european.el, language/ind-util.el:
	* language/lao-util.el, language/thai.el, language/tibet-util.el:
	* language/tibetan.el, language/viet-util.el:
	Switch from iso-2022-7bit to utf-8 or (if needed) utf-8-emacs.

2013-04-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-pair-inhibit-predicate): New var (bug#14000).
	(electric-pair-post-self-insert-function): Use it.
	(electric-pair-default-inhibit): New function, extracted from
	electric-pair-post-self-insert-function.

2013-03-31  Roland Winkler  <winkler@gnu.org>

	* emacs-lisp/crm.el (completing-read-multiple): Doc fix.

2013-03-31  Stefan Monnier  <monnier@iro.umontreal.ca>

	* hi-lock.el (hi-lock-mode): Cleanup after revert-buffer (bug#13891).

2013-03-30  Fabián Ezequiel Gallina  <fabian@anue.biz>

	Un-indent after "pass" and "return" statements (Bug#13888)
	* progmodes/python.el (python-indent-block-enders): New var.
	(python-indent-calculate-indentation): Use it.

2013-03-30  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-drop-volume-letter): Make it an ordinary
	defun.  Defining it as defalias could introduce too eager
	byte-compiler optimization.  (Bug#14030)

2013-03-30  Chong Yidong  <cyd@gnu.org>

	* iswitchb.el (iswitchb-read-buffer): Fix typo.

2013-03-30  Leo Liu  <sdl.web@gmail.com>

	* kmacro.el (kmacro-call-macro): Add optional arg MACRO.
	(kmacro-execute-from-register): Pass the keyboard macro to
	kmacro-call-macro or repeating won't work correctly.

2013-03-30  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/subword.el: Back to using `forward-symbol'.

	* subr.el (forward-whitespace, forward-symbol)
	(forward-same-syntax): Move from thingatpt.el.

2013-03-29  Leo Liu  <sdl.web@gmail.com>

	* kmacro.el (kmacro-to-register): New command.
	(kmacro-execute-from-register): New function.
	(kmacro-keymap): Bind to 'x'.  (Bug#14071)

2013-03-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mpc.el: Use defvar-local and setq-local.
	(mpc--proc-connect): Connection failures are not bugs.
	(mpc-mode-map): `follow-link' only applies to the buffer's content.
	(mpc-volume-map): Bind to the up-events.

2013-03-29  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/subword.el (superword-mode): Use `forward-sexp'
	instead of `forward-symbol'.

2013-03-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-mode): Make it a minor mode.
	(edebug--recursive-edit): Use it.
	(edebug-kill-buffer): Don't let-bind kill-buffer-hook.
	(edebug-temp-display-freq-count): Don't let-bind buffer-read-only.

2013-03-28  Leo Liu  <sdl.web@gmail.com>

	* vc/vc-bzr.el (vc-bzr-revert): Don't backup.  (Bug#14066)

2013-03-27  Eli Zaretskii  <eliz@gnu.org>

	* facemenu.el (list-colors-callback): New defvar.
	(list-colors-redisplay): New function.
	(list-colors-display): Install list-colors-redisplay as the
	revert-buffer-function.  (Bug#14063)

2013-03-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (completion-pcm--merge-completions): Make sure prefixes
	and suffixes don't overlap (bug#14061).

	* case-table.el: Use lexical-binding.
	(case-table-get-table): New function.
	(get-upcase-table): Use it.  Mark as obsolete.  Adjust callers.

2013-03-27  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/subword.el: Add `superword-mode' to do word motion
	over symbol_words (parallels and leverages `subword-mode' which
	does word motion inside MixedCaseWords).

2013-03-27  Aidan Gauland  <aidalgol@no8wireless.co.nz>

	* eshell/em-unix.el: Move su and sudo to...
	* eshell/em-tramp.el: ...Eshell tramp module.

2013-03-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* desktop.el (desktop--v2s): Rename from desktop-internal-v2s.
	Change return value to be a sexp.  Delay `get-buffer' to after
	restoring the desktop (bug#13951).

2013-03-26  Leo Liu  <sdl.web@gmail.com>

	* register.el: Move semantic tag handling back to
	cedet/semantic/senator.el.  (Bug#14052)

2013-03-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* eshell/em-prompt.el (eshell-emit-prompt): Make sure we can't insert
	into the prompt either (bug#13963).

2013-03-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* font-lock.el (lisp-font-lock-keywords-2): Don't highlight the "error"
	part of "(error-foo)".

2013-03-24  Juri Linkov  <juri@jurta.org>

	* replace.el (list-matching-lines-prefix-face): New defcustom.
	(occur-1): Pass `list-matching-lines-prefix-face' to the function
	`occur-engine' if `face-differs-from-default-p' returns t.
	(occur-engine): Add `,' inside backquote construct to evaluate
	`prefix-face'.  Propertize the prefix with the `prefix-face' face.
	Pass `prefix-face' to the functions `occur-context-lines' and
	`occur-engine-add-prefix'.
	(occur-engine-add-prefix, occur-context-lines): Add optional arg
	`prefix-face' and propertize the prefix with `prefix-face'.
	(Bug#14017)

2013-03-24  Leo Liu  <sdl.web@gmail.com>

	* nxml/rng-valid.el (rng-validate-while-idle)
	(rng-validate-quick-while-idle): Guard against deleted buffer.
	(Bug#13999)

	* emacs-lisp/edebug.el (edebug-mode): Make sure edebug-kill-buffer
	is the last entry in kill-buffer-hook.

	* files.el (kill-buffer-hook): Doc fix.

2013-03-23  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/lisp-mode.el (emacs-lisp-docstring-fill-column):
	Make it safe-local.

	* vc/diff-mode.el (diff-mode-shared-map): Unbind "/" (Bug#14034).

2013-03-23  Leo Liu  <sdl.web@gmail.com>

	* nxml/nxml-util.el (nxml-with-unmodifying-text-property-changes):
	Remove.

	* nxml/rng-valid.el (rng-validate-mode)
	(rng-after-change-function, rng-do-some-validation):
	* nxml/rng-maint.el (rng-validate-buffer):
	* nxml/nxml-rap.el (nxml-tokenize-forward, nxml-ensure-scan-up-to-date):
	* nxml/nxml-outln.el (nxml-show-all, nxml-set-outline-state):
	* nxml/nxml-mode.el (nxml-mode, nxml-degrade, nxml-after-change)
	(nxml-extend-after-change-region): Use with-silent-modifications.

	* nxml/rng-nxml.el (rng-set-state-after): Do not let-bind
	timer-idle-list.

	* nxml/rng-valid.el (rng-validate-while-idle-continue-p)
	(rng-next-error-1, rng-previous-error-1): Do not let-bind
	timer-idle-list.  (Bug#13999)

2013-03-23  Juri Linkov  <juri@jurta.org>

	* info.el (info-index-match): New face.
	(Info-index, Info-apropos-matches): Add a nested subgroup to the
	main pattern and add text properties with the new face to matches
	in index entries relative to the beginning of the index entry.
	(Bug#14015)

2013-03-21  Eric Ludlam  <zappo@gnu.org>

	* emacs-lisp/eieio-datadebug.el (data-debug/eieio-insert-slots):
	Inhibit read only while inserting objects.

2013-03-22  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el: Update docs to mention
	`cfengine-auto-mode'.  Use \_> and \_< instead of \> and \< for
	symbol motion.  Remove "_" from the word syntax.

2013-03-21  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine-common-syntax): Add "_" to word
	syntax for both `cfengine2-mode' and `cfengine3-mode'.

2013-03-20  Juri Linkov  <juri@jurta.org>

	* info.el (Info-next-reference-or-link)
	(Info-prev-reference-or-link): New functions.
	(Info-next-reference, Info-prev-reference): Use them.
	(Info-try-follow-nearest-node): Handle footnote navigation.
	(Info-fontify-node): Fontify footnotes.  (Bug#13989)

2013-03-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (posn-point, posn-string): Fix it here instead (bug#13979).
	* mouse.el (mouse-on-link-p): Undo scroll-bar fix.

2013-03-20  Paul Eggert  <eggert@cs.ucla.edu>

	Suppress unnecessary non-ASCII chatter during build process.
	* international/ja-dic-cnv.el (skkdic-collect-okuri-nasi)
	(batch-skkdic-convert): Suppress most of the chatter.
	It's not needed so much now that machines are faster,
	and its non-ASCII component was confusing; see Dmitry Gutov in
	<https://lists.gnu.org/archive/html/emacs-devel/2013-03/msg00508.html>.

2013-03-20  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-chop): Fix bug#10994.

2013-03-19  Dmitry Gutov  <dgutov@yandex.ru>

	* whitespace.el (whitespace-font-lock, whitespace-font-lock-mode):
	Remove vars.
	(whitespace-color-on, whitespace-color-off):
	Use `font-lock-fontify-buffer' (Bug#13817).

2013-03-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el (mouse--down-1-maybe-follows-link): Fix follow-link
	remapping in mode-line.
	(mouse-on-link-p): Also check [mode-line follow-link] bindings.

2013-03-19  Dmitry Gutov  <dgutov@yandex.ru>

	* whitespace.el (whitespace-color-on): Use `prepend' OVERRIDE
	value for `whitespace-line' face (Bug#13875).
	(whitespace-font-lock-keywords): Change description.
	(whitespace-color-on): Don't save `font-lock-keywords' value, save
	the constructed keywords instead.
	(whitespace-color-off): Use `font-lock-remove-keywords' (Bug#13817).

2013-03-19  Leo Liu  <sdl.web@gmail.com>

	* progmodes/compile.el (compilation-display-error): New command.
	(compilation-mode-map, compilation-minor-mode-map): Bind it to
	C-o.  (Bug#13992)

2013-03-18  Paul Eggert  <eggert@cs.ucla.edu>

	* term/x-win.el (x-keysym-pair): Add a Fixme (Bug#13936).

2013-03-18  Jan Djärv  <jan.h.d@swipnet.se>

	* mouse.el (mouse-on-link-p): Check for scroll bar (Bug#13979).

2013-03-18  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-compat.el (tramp-compat-user-error): New defun.

	* net/tramp-adb.el (tramp-adb-handle-shell-command):
	* net/tramp-gvfs.el (top):
	* net/tramp.el (tramp-find-method, tramp-dissect-file-name)
	(tramp-handle-shell-command): Use it.
	(tramp-dissect-file-name): Raise an error when hostname is a
	method name, and neither method nor user is specified.

	* net/trampver.el: Update release number.

2013-03-18  Leo Liu  <sdl.web@gmail.com>

	Make sure eldoc can be turned off properly.
	* emacs-lisp/eldoc.el (eldoc-schedule-timer): Conditionalize on
	eldoc-mode.
	(eldoc-display-message-p): Revert last change.
	(eldoc-display-message-no-interference-p)
	(eldoc-print-current-symbol-info): Tweak.

2013-03-18  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el (doc-view-new-window-function): Check the new window
	overlay's display property instead the char property of the
	buffer's first char.  Use `with-selected-window' instead of
	`save-window-excursion' with `select-window'.
	(doc-view-document->bitmap): Check the current doc-view overlay's
	display property instead the char property of the buffer's first char.

2013-03-18  Paul Eggert  <eggert@cs.ucla.edu>

	Automate the build of ja-dic.el (Bug#13984).
	* international/ja-dic-cnv.el (skkdic-convert): Remove the annotations
	from the input, rather than assume that it's been done for us by the
	SKK script unannotate.awk.  Switch ja-dic.el to UTF-8.  Don't put
	the current date into a ja-dic.el comment, as that complicates
	regression testing.

2013-03-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* whitespace.el: Fix double evaluation.
	(whitespace-space, whitespace-hspace, whitespace-tab)
	(whitespace-newline, whitespace-trailing, whitespace-line)
	(whitespace-space-before-tab, whitespace-indentation)
	(whitespace-empty, whitespace-space-after-tab): Turn defcustoms into
	obsolete defvars.
	(whitespace-hspace-regexp): Fix regexp for emacs-unicode.
	(whitespace-color-on): Use a single font-lock-add-keywords call.
	Fix double-evaluation of face variables.

2013-03-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el (tramp-adb-parse-device-names):
	Use `start-process' instead of `call-process'.  Otherwise, the
	function might be blocked under MS Windows.  (Bug#13299)

2013-03-17  Leo Liu  <sdl.web@gmail.com>

	Extend eldoc to display info in the mode-line.  (Bug#13978)
	* emacs-lisp/eldoc.el (eldoc-post-insert-mode): New minor mode.
	(eldoc-mode-line-string): New variable.
	(eldoc-minibuffer-message): New function.
	(eldoc-message-function): New variable.
	(eldoc-message): Use it.
	(eldoc-display-message-p)
	(eldoc-display-message-no-interference-p):
	Support eldoc-post-insert-mode.

	* simple.el (eval-expression-minibuffer-setup-hook): New hook.
	(eval-expression): Run it.

2013-03-17  Roland Winkler  <winkler@gnu.org>

	* emacs-lisp/crm.el (completing-read-multiple): Ignore empty
	strings in the list of return values.

2013-03-17  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-ext.el (math-read-number-fancy): Check for an explicit
	radix before checking for HMS forms.

2013-03-16  Leo Liu  <sdl.web@gmail.com>

	* progmodes/scheme.el: Add indentation and font-locking for λ.
	(Bug#13975)

2013-03-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-auto-fill): Don't inf-loop if there's no
	token before point (bug#13942).

2013-03-16  Leo Liu  <sdl.web@gmail.com>

	* thingatpt.el (end-of-sexp): Fix bug#13952.  Use syntax-after.

2013-03-16  Eli Zaretskii  <eliz@gnu.org>

	* startup.el (command-line-normalize-file-name): Fix handling of
	backslashes in DOS and Windows file names.  Reported by Xue Fuqiao
	<xfq.free@gmail.com> in
	https://lists.gnu.org/archive/html/help-gnu-emacs/2013-03/msg00245.html.

2013-03-15  Michael Albinus  <michael.albinus@gmx.de>

	Sync with Tramp 2.2.7.

	* net/trampver.el: Update release number.

2013-03-14  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el: Fix bug#13887.
	(doc-view-insert-image): Don't modify overlay associated to
	non-live windows, and implement horizontal centering of image in
	case it's smaller than the window.
	(doc-view-new-window-function): Force redisplay of new windows on
	doc-view buffers.

2013-03-13  Karl Fogel  <kfogel@red-bean.com>

	* saveplace.el (save-place-alist-to-file): Don't sort
	`save-place-alist', just pretty-print it (bug#13882).

2013-03-13  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-insert-directory):
	Check whether `default-file-name-coding-system' is bound.
	It isn't in XEmacs.

2013-03-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/byte-run.el (defun-declarations-alist): Don't use
	backquotes for `obsolete' (bug#13929).

	* international/mule.el (find-auto-coding): Include file name in
	obsolescence warning (bug#13922).

2013-03-12  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine-parameters-indent): New variable
	for CFEngine 3-specific indentation.
	(cfengine3-indent-line): Use it.  Fix up category regex.
	(cfengine3-font-lock-keywords): Add bundle and namespace characters.

2013-03-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* type-break.el (type-break-file-name):
	* textmodes/remember.el (remember-data-file):
	* strokes.el (strokes-file):
	* shadowfile.el (shadow-initialize):
	* saveplace.el (save-place-file):
	* ps-bdf.el (bdf-cache-file):
	* progmodes/idlwave.el (idlwave-config-directory):
	* net/quickurl.el (quickurl-url-file):
	* international/kkc.el (kkc-init-file-name):
	* ido.el (ido-save-directory-list-file):
	* emulation/viper.el (viper-custom-file-name):
	* emulation/vip.el (vip-startup-file):
	* calendar/todo-mode.el (todo-file-do, todo-file-done, todo-file-top):
	* calendar/timeclock.el (timeclock-file): Use locate-user-emacs-file.

2013-03-12  Paul Eggert  <eggert@cs.ucla.edu>

	Switch encodings of tutorials, thai-word to UTF-8 (Bug#13880).
	* language/thai-word.el: Switch to UTF-8.

See ChangeLog.16 for earlier changes.

;; Local Variables:
;; coding: utf-8
;; End:

  Copyright (C) 2011-2017 Free Software Foundation, Inc.

  This file is part of GNU Emacs.

  GNU Emacs is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  GNU Emacs is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with GNU Emacs.  If not, see <https://www.gnu.org/licenses/>.
