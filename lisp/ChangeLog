2013-08-26  Tassilo Horn  <tsdh@gnu.org>

	* epa-hook.el (epa-file-encrypt-to): Quote `safe-local-variable'
	lambda expression in order to have `describe-variable' display it.

2013-08-26  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-verify-visited-file-modtime):
	BUF can be optional.  (Bug#15186)

2013-08-25  Xue Fuqiao  <xfq.free@gmail.com>

	* progmodes/flymake.el (flymake-get-real-file-name-function):
	Fix broken customization.  (Bug#15184)

2013-08-25  Alan Mackenzie  <acm@muc.de>

	Improve indentation of bracelists defined by macros (without "=").

	* progmodes/cc-engine.el (c-inside-bracelist-p): When a macro
	expansion begins with "{", regard it as bracelist when it doesn't
	contain a ";".

	Parse C++ inher-intro when there's a template split over 2 lines.

	* progmodes/cc-engine.el (c-guess-basic-syntax CASE 5C): Code more
	rigorously the search for "class" etc. followed by ":".

	* progmodes/cc-langs.el (c-opt-<>-sexp-key): Make the value for
	random languages a regexp which never matches rather than nil.

	Handle "/"s more accurately in test for virtual semicolons (AWK Mode).

	* progmodes/cc-awk.el (c-awk-one-line-possibly-open-string-re)
	(c-awk-regexp-one-line-possibly-open-char-list-re)
	(c-awk-one-line-possibly-open-regexp-re)
	(c-awk-one-line-non-syn-ws*-re): Remove.
	(c-awk-possibly-open-string-re, c-awk-non-/-syn-ws*-re)
	(c-awk-space*-/-re, c-awk-space*-regexp-/-re)
	(c-awk-space*-unclosed-regexp-/-re): New constants.
	(c-awk-at-vsemi-p): Reformulate better to recognize "/"s which
	aren't regexp delimiters.

	* progmodes/cc-engine.el (c-crosses-statement-barrier-p): Add in
	handling for a rare situation in AWK Mode involving unterminated
	strings/regexps.

2013-08-23  Glenn Morris  <rgm@gnu.org>

	* files.el (auto-mode-alist): Use sh-mode for .bash_history.

	* files.el (interpreter-mode-alist): Use tcl-mode for expect scripts.

	* files.el (create-file-buffer): If the result would begin with
	spaces, prepend a "|" instead of removing them.  (Bug#15162)

2013-08-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* textmodes/fill.el (fill-match-adaptive-prefix): Don't throw away
	text-properties (bug#15155).

	* calc/calc-keypd.el (calc-keypad-execute): `x-flush-mouse-queue' doesn't
	exist any more.
	(calc-keypad-redraw): Remove unused var `pad'.
	(calc-keypad-press): Remove unused var `menu'.

2013-08-23  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer-pop-up-frame):
	Call pop-up-frame-function with BUFFER current so `make-frame' will
	use it as the new frame's buffer (Bug#15133).

2013-08-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* calendar/timeclock.el: Minor cleanups.
	(timeclock-ask-before-exiting, timeclock-use-display-time):
	Use `symbol'.
	(timeclock-modeline-display): Define as alias before the
	actual definition.
	(timeclock-mode-line-display): Use define-minor-mode.
	(timeclock-day-list-template): Make it a function, add an argument.
	(timeclock-day-list-required, timeclock-day-list-length)
	(timeclock-day-list-debt, timeclock-day-list-span)
	(timeclock-day-list-break): Adjust calls accordingly.

2013-08-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/pp.el (pp-eval-expression, pp-macroexpand-expression):
	Use read--expression so that completion works again.

2013-08-21  Sam Steingold  <sds@gnu.org>

	Add rudimentary inferior shell interaction
	* progmodes/sh-script.el (sh-shell-process): New buffer-local variable.
	(sh-set-shell): Reset it.
	(sh-show-shell, sh-cd-here, sh-send-line-or-region-and-step):
	New commands (bound to C-c C-z, C-c C-d, and C-c C-n).

2013-08-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* align.el: Use lexical-binding.
	(align-region): Simplify accordingly.

2013-08-20  Michael Albinus  <michael.albinus@gmx.de>

	* minibuffer.el (completion--sifn-requote): Bind `non-essential'.

	* rfn-eshadow.el (rfn-eshadow-update-overlay): Move binding of
	`non-essential' up.

2013-08-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el:
	* net/tramp-adb.el:
	* net/tramp-cmds.el:
	* net/tramp-ftp.el:
	* net/tramp-gvfs.el:
	* net/tramp-gw.el:
	* net/tramp-sh.el: Don't wrap external variable declarations by
	`eval-when-compile'.

2013-08-16  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-rescale-image): Use ImageMagick even for GIFs
	now that Emacs supports ImageMagick animations.

2013-08-16  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-cmds.el (top): Don't declare `buffer-name'.
	(tramp-append-tramp-buffers): Rewrite buffer local variables part.

2013-08-16  Martin Rudalics  <rudalics@gmx.at>

	* window.el (mouse-autoselect-window-select): Do autoselect when
	mouse pointer is on margin.

2013-08-16  William Parsons  <wbparsons@alum.mit.edu>  (tiny change)

	* net/ange-ftp.el (ange-ftp-skip-msgs): Add 500 EPSV.  (Bug#1972)

2013-08-16  Glenn Morris  <rgm@gnu.org>

	* net/ange-ftp.el (ange-ftp-good-msgs, ange-ftp-get-pwd):
	Handle "Remote Directory" response of some clients.  (Bug#15058)

	* emacs-lisp/bytecomp.el (byte-compile-make-variable-buffer-local):
	Tweak warning.  (Bug#14926)

	* menu-bar.el (send-mail-item-name, read-mail-item-name): Remove.
	(menu-bar-tools-menu): Simplify news and mail items.  (Bug#15095)

	* image-mode.el (image-mode-map): Add menu items to reverse,
	increase, decrease, reset animation speed.
	(image--set-speed, image-increase-speed, image-decrease-speed)
	(image-reverse-speed, image-reset-speed): New functions.
	(image-mode-map): Add bindings for speed commands.

	* image.el (image-animate-get-speed, image-animate-set-speed):
	New functions.
	(image-animate-timeout): Respect image :speed property.

2013-08-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/debug.el (debugger-setup-buffer): Put point on the
	previous line (bug#15101).
	(debugger-eval-expression, debugger-record-expression):
	Use read--expression (bug#15102).

2013-08-15  Michael Albinus  <michael.albinus@gmx.de>

	Remove byte compiler warnings, visible when compiling with
	`byte-compile-force-lexical-warnings' set to t.

	* net/tramp.el (tramp-debug-message, tramp-message, tramp-error)
	(tramp-error-with-buffer): Rename ARGS to ARGUMENTS and BUFFER to BUF.
	(tramp-handle-unhandled-file-name-directory)
	(tramp-handle-file-notify-add-watch, tramp-action-login)
	(tramp-action-succeed, tramp-action-permission-denied)
	(tramp-action-terminal, tramp-action-process-alive): Prefix unused
	arguments with "_".

	* net/tramp-adb.el (tramp-adb-parse-device-names)
	(tramp-adb-handle-insert-directory, tramp-adb-handle-delete-file)
	(tramp-adb-handle-copy-file): Prefix unused arguments with "_".
	(tramp-adb-handle-file-truename): Remove unused arguments.

	* net/tramp-cache.el (tramp-flush-directory-property)
	(tramp-flush-connection-property, tramp-list-connections)
	(tramp-parse-connection-properties): Prefix unused arguments with "_".

	* net/tramp-compat.el (tramp-compat-make-temp-file):
	Rename FILENAME to F.

	* net/tramp-gvfs.el (tramp-gvfs-handle-file-notify-add-watch)
	(tramp-gvfs-handle-write-region, tramp-bluez-parse-device-names)
	(tramp-zeroconf-parse-workstation-device-names)
	(tramp-zeroconf-parse-webdav-device-names)
	(tramp-synce-parse-device-names): Prefix unused arguments with "_".

	* net/tramp-gw.el (tramp-gw-gw-proc-sentinel)
	(tramp-gw-aux-proc-sentinel): Prefix unused arguments with "_".

	* net/tramp-sh.el (tramp-sh-handle-file-truename): Remove unused
	arguments.
	(tramp-sh-handle-copy-file, tramp-sh-handle-dired-compress-file)
	(tramp-sh-handle-insert-file-contents-literally)
	(tramp-sh-handle-file-notify-add-watch): Prefix unused arguments
	with "_".
	(tramp-do-copy-or-rename-file, tramp-barf-if-no-shell-prompt):
	Remove unused variables.

	* net/tramp-smb.el (tramp-smb-handle-copy-directory)
	(tramp-smb-handle-copy-file, tramp-smb-handle-delete-file)
	(tramp-smb-read-file-entry): Prefix unused arguments with "_".

	* net/tramp-uu.el (tramp-uu-b64-alphabet, tramp-uu-b64-char-to-byte):
	Make them a defconst.
	(tramp-uuencode-region): Remove unused variable.

2013-08-14  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--prop-setter): New function.
	(frameset-prop): Add gv-setter declaration.
	(frameset-filter-minibuffer): Deal with the case that the minibuffer
	parameter was already set in FILTERED.  Doc fix.
	(frameset--record-minibuffer-relationships): Allow saving a
	minibufferless frame without its corresponding minibuffer frame.
	(frameset--reuse-frame): Accept a match from an orphaned minibufferless
	frame, if the frame id matches.
	(frameset--minibufferless-last-p): Sort non-orphaned minibufferless
	frames before orphaned ones.
	(frameset-restore): Warn about orphaned windows, instead of error out.

2013-08-14  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-make-atom): Don't overwrite parameter
	already present.
	(display-buffer-in-atom-window): Handle special case where we
	split an already atomic window.
	(window--major-non-side-window, display-buffer-in-side-window)
	(window--side-check): Ignore minibuffer window when walking
	window tree.
	(window-deletable-p): Return 'frame only if no other frame uses
	our minibuffer window.
	(record-window-buffer): Run buffer-list-update-hook.
	(split-window): Make sure window--check-frame won't destroy an
	existing atomic window in case the new window gets nested
	inside.
	(display-buffer-at-bottom): Ignore minibuffer window when
	walking window tree.  Don't split a side window.
	(pop-to-buffer): Don't set-buffer here, the select-window call
	should do that.
	(mouse-autoselect-window-select): Autoselect only if we are in the
	text portion of the window.

2013-08-13  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-parse-image-data): New function to grab both the
	data itself and the Content-Type.
	(shr-put-image): Use it.

	* net/eww.el (eww-display-image): Ditto.

	* image.el (image-content-type-suffixes): New variable.

2013-08-13  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-imenu--build-tree)
	(python-imenu--put-parent): Simplify and Fix (GH bug 146).

2013-08-13  Xue Fuqiao  <xfq.free@gmail.com>

	* simple.el (backward-word): Mention the optional argument.

2013-08-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* frameset.el (frameset--make): Rename constructor from make-frameset.
	(frameset-p, frameset-valid-p): Don't autoload.
	(frameset-valid-p): Use normal accessors.

2013-08-13  Glenn Morris  <rgm@gnu.org>

	* progmodes/compile.el (compile-command): Tweak example in doc.
	* obsolete/scribe.el (scribe-mode):
	* progmodes/mixal-mode.el (mixal-mode): Quote buffer name.  (Bug#15053)

	* mail/feedmail.el (feedmail-confirm-outgoing)
	(feedmail-display-full-frame, feedmail-deduce-bcc-where): Fix types.

	* cus-start.el (truncate-partial-width-windows): Fix type.

	* emulation/viper-init.el (viper-search-scroll-threshold): Fix type.

	* net/shr.el (shr-table-horizontal-line): Fix custom type.

2013-08-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/timer.el (timer--time-setter): New function.
	(timer--time): Use it as gv-setter.

	* emacs-lisp/gv.el (gv-define-simple-setter): Output warning when
	setter is not a symbol.

2013-08-12  Grégoire Jadi  <daimrod@gmail.com>

	* mail/sendmail.el (sendmail-send-it): Don't kill the error buffer
	if sending fails.  This makes debugging easier.

2013-08-12  Juanma Barranquero  <lekktu@gmail.com>

	* xml.el (xml-parse-tag-1): Use looking-at (this reverts change in
	2013-08-11T00:07:48Z!lekktu@gmail.com, which breaks the test suite).
	https://lists.gnu.org/archive/html/emacs-devel/2013-08/msg00263.html

2013-08-12  Eli Zaretskii  <eliz@gnu.org>

	* term/w32-win.el (dynamic-library-alist): Add DLLs for zlib.

2013-08-12  Glenn Morris  <rgm@gnu.org>

	* format.el (format-annotate-function):
	Handle read-only text properties in the source.  (Bug#14887)

2013-08-11  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-display-html): Ignore coding system errors.
	One web site uses "utf-8lias" as the coding system.

2013-08-11  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-valid-p): Fix check; STATES can indeed be nil.

2013-08-10  Juanma Barranquero  <lekktu@gmail.com>

	* tutorial.el (tutorial--describe-nonstandard-key): Use string-match-p.
	(tutorial--detailed-help): Remove unused local variables.
	(tutorial--save-tutorial-to): Use ignore-errors.
	(help-with-tutorial): Use looking-at-p.

	* view.el (view-buffer-other-window, view-buffer-other-frame):
	Mark unused arguments.

	* woman.el (woman-parse-colon-path, woman-parse-colon-path)
	(woman-select-symbol-fonts, woman, woman-find-file)
	(woman-insert-file-contents, woman-non-underline-faces):
	Use string-match-p.
	(woman1-unquote): Move declaration.

	* xml.el (xml-parse-tag-1, xml-parse-string): Use looking-at-p.
	(xml-parse-dtd): Use looking-at-p, string-match-p.  Mark unused
	argument.  Remove unused local variable.
	(xml-parse-elem-type): Use string-match-p.
	(xml-substitute-numeric-entities): Use ignore-errors.

	* calculator.el (calculator): Mark unused argument.
	(calculator-paste, calculator-quit, calculator-integer-p):
	Use ignore-errors.
	(calculator-string-to-number, calculator-decimal, calculator-exp)
	(calculator-op-or-exp): Use string-match-p.

	* dired.el (dired-buffer-more-recently-used-p): Declare.
	(dired-insert-set-properties, dired-insert-old-subdirs):
	Use ignore-errors.

	* dired-aux.el (dired-compress): Use ignore-errors.
	(dired-do-chxxx, dired-do-chmod, dired-trample-file-versions)
	(dired-do-async-shell-command, dired-do-shell-command)
	(dired-shell-stuff-it, dired-compress-file, dired-insert-subdir)
	(dired-insert-subdir-validate): Use string-match-p.
	(dired-map-dired-file-lines, dired-subdir-hidden-p): Use looking-at-p.
	(dired-add-entry): Use string-match-p, looking-at-p.
	(dired-insert-subdir-newpos): Remove unused local variable.

	* filenotify.el (file-notify-callback): Remove unused local variable.

	* filesets.el (filesets-error): Mark unused argument.
	(filesets-which-command-p, filesets-filter-dir-names)
	(filesets-directory-files, filesets-get-external-viewer)
	(filesets-ingroup-get-data): Use string-match-p.

	* find-file.el (ff-other-file-name, ff-other-file-name)
	(ff-find-the-other-file, ff-cc-hh-converter):
	Remove unused local variables.
	(ff-get-file-name): Use string-match-p.
	(ff-all-dirs-under): Use ignore-errors.

	* follow.el (follow-comint-scroll-to-bottom): Mark unused argument.
	(follow-select-if-visible): Remove unused local variable.

	* forms.el (read-file-filter): Move declaration.
	(forms--make-format, forms--make-parser, forms-insert-record):
	Quote function with #'.
	(forms--update): Use string-match-p.  Quote function with #'.

	* help-mode.el (help-dir-local-var-def): Mark unused argument.
	(help-make-xrefs): Use looking-at-p.
	(help-xref-on-pp): Use looking-at-p, ignore-errors.

	* ibuffer.el (ibuffer-ext-visible-p): Declare.
	(ibuffer-confirm-operation-on): Use string-match-p.

	* msb.el (msb-item-handler, msb-dired-item-handler):
	Mark unused arguments.

	* ses.el (ses-decode-cell-symbol)
	(ses-kill-override): Remove unused local variable.
	(ses-create-cell-variable, ses-relocate-formula): Use string-match-p.
	(ses-load): Use ignore-errors, looking-at-p.
	(ses-jump-safe): Use ignore-errors.
	(ses-export-tsv, ses-export-tsf, ses-unsafe): Mark unused arguments.

	* tabify.el (untabify, tabify): Mark unused arguments.

	* thingatpt.el (thing-at-point--bounds-of-well-formed-url):
	Mark unused argument.
	(bounds-of-thing-at-point, thing-at-point-bounds-of-list-at-point)
	(thing-at-point-newsgroup-p, form-at-point): Use ignore-errors.

	* emacs-lisp/timer.el (timer--time): Define setter with
	gv-define-setter to avoid deprecation warning.

	* completion.el: Remove stuff unused since revno:3176 (1993-05-27).
	(*record-cmpl-statistics-p*): Remove (was commented out).
	(cmpl-statistics-block): Remove (body was commented out).
	All callers changed.
	(add-completions-from-buffer, load-completions-from-file):
	Remove unused variables.

2013-08-09  Juanma Barranquero  <lekktu@gmail.com>

	* filecache.el (file-cache-delete-file-list):
	Print message only when told so.
	(file-cache-files-matching): Use #' in mapconcat argument.

	* ffap.el (ffap-url-at-point): Fix reference to variable
	thing-at-point-default-mail-uri-scheme.

2013-08-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (define-error): New function.
	* progmodes/ada-xref.el (ada-error-file-not-found): Rename from
	error-file-not-found and define with define-error.
	* emacs-lisp/cl-lib.el (cl-assertion-failed): Move here from subr.el
	and define with define-error.
	* userlock.el (file-locked, file-supersession):
	* simple.el (mark-inactive):
	* progmodes/js.el (js-moz-bad-rpc, js-js-error):
	* progmodes/ada-mode.el (ada-mode-errors):
	* play/life.el (life-extinct):
	* nxml/xsd-regexp.el (xsdre-invalid-regexp, xsdre-parse-error):
	* nxml/xmltok.el (xmltok-markup-declaration-parse-error):
	* nxml/rng-util.el (rng-error):
	* nxml/rng-uri.el (rng-uri-error):
	* nxml/rng-match.el (rng-compile-error):
	* nxml/rng-cmpct.el (rng-c-incorrect-schema):
	* nxml/nxml-util.el (nxml-error, nxml-file-parse-error):
	* nxml/nxml-rap.el (nxml-scan-error):
	* nxml/nxml-outln.el (nxml-outline-error):
	* net/soap-client.el (soap-error):
	* net/gnutls.el (gnutls-error):
	* net/ange-ftp.el (ftp-error):
	* mpc.el (mpc-proc-error):
	* json.el (json-error, json-readtable-error, json-unknown-keyword)
	(json-number-format, json-string-escape, json-string-format)
	(json-key-format, json-object-format):
	* jka-compr.el (compression-error):
	* international/quail.el (quail-error):
	* international/kkc.el (kkc-error):
	* emacs-lisp/ert.el (ert-test-failed):
	* calc/calc.el (calc-error, inexact-result, math-overflow)
	(math-underflow):
	* bookmark.el (bookmark-error-no-filename):
	* epg.el (epg-error): Define with define-error.

	* time.el (display-time-event-handler)
	(display-time-next-load-average): Don't call sit-for since it seems
	unnecessary (bug#15045).

	* emacs-lisp/checkdoc.el: Remove redundant :group keywords.
	Use #' instead of ' to quote functions.
	(checkdoc-output-mode): Use setq-local.
	(checkdoc-spellcheck-documentation-flag, checkdoc-ispell-lisp-words)
	(checkdoc-verb-check-experimental-flag, checkdoc-proper-noun-regexp)
	(checkdoc-common-verbs-regexp): Mark safe-local-variable (bug#15010).
	(checkdoc-ispell, checkdoc-ispell-current-buffer)
	(checkdoc-ispell-interactive, checkdoc-ispell-message-interactive)
	(checkdoc-ispell-message-text, checkdoc-ispell-start)
	(checkdoc-ispell-continue, checkdoc-ispell-comments)
	(checkdoc-ispell-defun): Remove unused arg `take-notes'.

	* ido.el (ido-completion-help): Fix up compiler warning.

2013-08-09  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-p): Add autoload cookie.
	(frameset--jump-to-register): New function, based on code moved from
	register.el.
	(frameset-to-register): Move from register.el.  Adapt to `registerv'.

	* register.el (frameset-frame-id, frameset-frame-with-id, frameset-p)
	(frameset-restore, frameset-save, frameset-session-filter-alist):
	Remove declarations.
	(register-alist): Doc fix.
	(frameset-to-register): Move to frameset.el.
	(jump-to-register, describe-register-1): Remove frameset-specific code.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* allout-widgets.el (allout-widgets-pre-command-business)
	(allout-widgets-post-command-business)
	(allout-widgets-after-change-handler)
	(allout-decorate-item-and-context, allout-set-boundary-marker)
	(allout-body-modification-handler)
	(allout-graphics-modification-handler): Mark ignored arguments.
	(allout-widgets-post-command-business)
	(allout-widgets-exposure-change-processor)
	(allout-widgets-exposure-undo-processor)
	(allout-decorate-item-and-context, allout-redecorate-visible-subtree)
	(allout-parse-item-at-point, allout-decorate-item-guides)
	(allout-decorate-item-cue, allout-item-span): Remove unused variables.
	* allout.el (epa-passphrase-callback-function): Declare.
	(allout-overlay-insert-in-front-handler)
	(allout-overlay-interior-modification-handler)
	(allout-isearch-end-handler, allout-chart-siblings)
	(allout-up-current-level, allout-end-of-level, allout-reindent-body)
	(allout-yank-processing, allout-process-exposed)
	(allout-latex-verb-quote, allout-latexify-one-item, outlineify-sticky)
	(allout-latex-verbatim-quote-curr-line): Remove unused variables.
	* emacs-lisp/lisp-mode.el (lisp-eval-defun, last-sexp-toggle-display)
	(lisp-indent-defform): Mark ignored arguments.
	(lisp-indent-line): Mark ignored arguments.  Remove unused variables.
	(calculate-lisp-indent): Remove unused variables.
	* international/characters.el (indian-2-column, arabic-2-column)
	(tibetan): Mark ignored arguments.
	(use-cjk-char-width-table): Mark ignored arguments.
	Remove unused variables.
	* international/fontset.el (build-default-fontset-data)
	(x-compose-font-name, create-fontset-from-fontset-spec):
	Mark ignored arguments.
	(fontset-plain-name): Remove unused variables.
	* international/mule.el (charset-id, charset-bytes, generic-char-p)
	(keyboard-coding-system): Mark ignored arguments.
	(find-auto-coding): Remove unused variables.  Use `ignore-errors'.
	* help.el (resize-temp-buffer-window):
	* window.el (display-buffer-in-major-side-window)
	(display-buffer-in-side-window, display-buffer-in-previous-window):
	Remove unused variables.
	* isearch.el (isearch-forward-symbol):
	* version.el (emacs-bzr-version-bzr):
	* international/mule-cmds.el (current-language-environment):
	* term/common-win.el (x-handle-iconic, x-handle-geometry)
	(x-handle-display):
	* term/pc-win.el (x-list-fonts, x-display-planes)
	(x-display-color-cells, x-server-max-request-size, x-server-vendor)
	(x-server-version, x-display-screens, x-display-mm-height)
	(x-display-mm-width, x-display-backing-store, x-display-visual-class)
	(x-selection-owner-p, x-own-selection-internal)
	(x-disown-selection-internal, x-get-selection-internal)
	(msdos-initialize-window-system):
	* term/tty-colors.el (tty-color-alist, tty-color-clear):
	* term/x-win.el (x-handle-no-bitmap-icon):
	* vc/vc-hooks.el (vc-mode, vc-default-make-version-backups-p)
	(vc-default-find-file-hook, vc-default-extra-menu):
	Mark ignored arguments.

2013-08-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-debugger): Use edebug-eval to run the
	break-condition in the context of the debugged code (bug#12685).

2013-08-08  Christopher Schmidt  <christopher@ch.ristopher.com>

	* comint.el:
	Do not use an overlay to highlight the last prompt.  (Bug#14744)
	(comint-mode): Make comint-last-prompt buffer local.
	(comint-last-prompt): New variable.
	(comint-last-prompt-overlay): Remove.  Superseded by
	comint-last-prompt.
	(comint-snapshot-last-prompt, comint-output-filter):
	Use comint-last-prompt.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-valid-p): Check vector length.  Doc fix.
	(frameset-save): Check validity of the resulting frameset.

2013-08-08  Xue Fuqiao  <xfq.free@gmail.com>

	* ido.el (ido-record-command): Add doc string.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset): Do not disable creation of the default
	frameset-p predicate.  Doc fix.
	(frameset-valid-p): New function, copied from the old predicate-p.
	Add additional checks.
	(frameset-restore): Check with frameset-valid-p.
	(frameset-p, frameset-version, frameset-timestamp, frameset-app)
	(frameset-name, frameset-description, frameset-properties)
	(frameset-states): Add docstring.
	(frameset-session-filter-alist, frameset-persistent-filter-alist)
	(frameset-filter-alist): Doc fixes.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-p, frameset-prop): Doc fixes.

2013-08-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/bytecomp.el (byte-compile-function-warn): New function,
	extracted from byte-compile-callargs-warn and byte-compile-normal-call.
	(byte-compile-callargs-warn, byte-compile-function-form): Use it.
	(byte-compile-normal-call): Remove obsolescence check.

2013-08-08  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-restore): Doc fix.

	* register.el (frameset-frame-id, frameset-frame-with-id)
	(frameset-p, frameset-restore, frameset-save): Declare.
	(register-alist): Document framesets.
	(frameset-session-filter-alist): Declare.
	(frameset-to-register): New function.
	(jump-to-register): Implement jumping to framesets.  Doc fix.
	(describe-register-1): Describe framesets.

	* bindings.el (ctl-x-r-map): Bind ?f to frameset-to-register.

2013-08-07  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-save-frameset): Use new frameset-save args.
	Use lexical-binding.

	* frameset.el (frameset): Use type vector, not list (incompatible
	change).  Do not declare a new constructor, use the default one.
	Upgrade suggested properties `app', `name' and `desc' to slots `app',
	`name' and `description', respectively, and add read-only slot
	`timestamp'.  Doc fixes.
	(frameset-copy, frameset-persistent-filter-alist)
	(frameset-filter-alist, frameset-switch-to-gui-p)
	(frameset-switch-to-tty-p, frameset-filter-tty-to-GUI)
	(frameset-filter-sanitize-color, frameset-filter-minibuffer)
	(frameset-filter-iconified, frameset-keep-original-display-p):
	Doc fixes.
	(frameset-filter-shelve-param, frameset-filter-unshelve-param):
	Rename from frameset-filter-(save|restore)-param.  All callers changed.
	Doc fix.
	(frameset-p): Adapt to change to vector and be more thorough.
	Change arg name to OBJECT.  Doc fix.
	(frameset-prop): Rename arg PROP to PROPERTY.  Doc fix.
	(frameset-session-filter-alist): Rename from frameset-live-filter-alist.
	All callers changed.
	(frameset-frame-with-id): Rename from frameset-locate-frame-id.
	All callers changed.
	(frameset--record-minibuffer-relationships): Rename from
	frameset--process-minibuffer-frames.  All callers changed.
	(frameset-save): Add new keyword arguments APP, NAME and DESCRIPTION.
	Use new default constructor (again).  Doc fix.
	(frameset--find-frame-if): Rename from `frameset--find-frame.
	All callers changed.
	(frameset--reuse-frame): Rename arg FRAME-CFG to PARAMETERS.
	(frameset--initial-params): Rename arg FRAME-CFG to PARAMETERS.
	Doc fix.
	(frameset--restore-frame): Rename args FRAME-CFG and WINDOW-CFG to
	PARAMETERS and WINDOW-STATE, respectively.
	(frameset-restore): Add new keyword argument PREDICATE.
	Reset frameset--target-display to nil.  Doc fix.

2013-08-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/bat-mode.el (bat--syntax-propertize): New var.
	(bat-mode): Use it.
	(bat-mode-syntax-table): Mark \n as end-of-comment.
	(bat-font-lock-keywords): Remove comment rule.

	* progmodes/bat-mode.el: Rename from dos.el.  Use "bat-" prefix.
	(dos-mode-help): Remove.  Use describe-mode (C-h m) instead.

	* emacs-lisp/bytecomp.el: Check existence of f in #'f.
	(byte-compile-callargs-warn): Use `push'.
	(byte-compile-arglist-warn): Ignore higher-order "calls".
	(byte-compile-file-form-autoload): Use `pcase'.
	(byte-compile-function-form): If quoting a symbol, check that it exists.

2013-08-07  Eli Zaretskii  <eliz@gnu.org>

	* progmodes/dos.el (dos-font-lock-keywords): Rename LINUX to UNIX
	and add a few popular commands found in batch files.
	(dos, dos-label-face, dos-cmd-help, dos-run, dos-run-args)
	(dos-mode): Doc fixes.

2013-08-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/dos.el (auto-mode-alist): Add entries for dos-mode.
	(dos-mode): Use setq-local.  Add space after "rem".
	(dos-mode-syntax-table): Don't use "w" for symbol chars.
	(dos-font-lock-keywords): Try to adjust font-lock rules accordingly.

2013-08-07  Arni Magnusson  <arnima@hafro.is>

	* progmodes/dos.el: New file.
	* generic-x.el (bat-generic-mode): Redefine as an obsolete alias to
	dos-mode.

2013-08-06  Glenn Morris  <rgm@gnu.org>

	* calendar/calendar.el: Add new faces, and day-header-array.
	(calendar-weekday-header, calendar-weekend-header)
	(calendar-month-header): New faces.
	(calendar-day-header-construct): New function.
	(calendar-day-header-width): Also :set calendar-day-header-array.
	(calendar-american-month-header, calendar-european-month-header)
	(calendar-iso-month-header): Use calendar- faces.
	(calendar-generate-month):
	Use calendar-day-header-array for day headers; apply faces to them.
	(calendar-mode): Check calendar-font-lock-keywords non-nil.
	(calendar-abbrev-construct): Add optional maxlen argument.
	(calendar-day-name-array): Doc fix.
	(calendar-day-name-array, calendar-abbrev-length)
	(calendar-day-abbrev-array):
	Also :set calendar-day-header-array, and maybe redraw.
	(calendar-day-header-array): New option.  (Bug#15007)
	(calendar-font-lock-keywords): Set to nil and make obsolete.
	(calendar-day-name): Add option to use header array.

2013-08-06  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-render-td): Remove debugging.
	(shr-render-td): Make width computation consistent by defaulting
	all zero-width columns to 10 characters.  This may not be optimal,
	but it's at least consistent.
	(shr-make-table-1): Redo last change to fix the real problem in
	colspan handling.

2013-08-06  Dmitry Antipov  <dmantipov@yandex.ru>

	* files.el (cache-long-line-scans):
	Make obsolete alias to `cache-long-scans'.

2013-08-06  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset, frameset-filter-alist)
	(frameset-filter-params, frameset-save, frameset--reuse-frame)
	(frameset--minibufferless-last-p, frameset-restore): Doc fixes.
	(frameset-compute-pos): Rename from frameset--compute-pos,
	and add docstring.
	(frameset-move-onscreen): Use frameset-compute-pos.
	Most changes suggested by Drew Adams <drew.adams@oracle.com>.

	* find-lisp.el (find-lisp-line-indent, find-lisp-find-dired-filter):
	Fix typos in docstrings.

2013-08-06  Dmitry Antipov  <dmantipov@yandex.ru>

	* frame.el (get-other-frame): Tiny cleanup.

2013-08-06  Juanma Barranquero  <lekktu@gmail.com>

	* vc/vc.el (vc-default-ignore-completion-table):
	Silence byte-compiler warning.

	* frameset.el (frameset-p): Don't check non-nullness of the `properties'
	slot , which can indeed be nil.
	(frameset-live-filter-alist, frameset-persistent-filter-alist):
	Move entry for `left' from persistent to live filter alist.
	(frameset-filter-alist, frameset--minibufferless-last-p, frameset-save):
	Doc fixes.
	(frameset-filter-params): When restoring a frame, copy items added to
	`filtered', to avoid unwittingly modifying the original parameters.
	(frameset-move-onscreen): Rename from frameset--move-onscreen.  Doc fix.
	(frameset--restore-frame): Fix reference to frameset-move-onscreen.

	* dired.el (dired-insert-directory): Revert change in 2013-06-21T12:24:37Z!lekktu@gmail.com
	to use looking-at-p instead of looking-at.  (Bug#15028)

2013-08-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	Revert introduction of isearch-filter-predicates (bug#14714).
	Rely on add-function instead.
	* isearch.el (isearch-filter-predicates): Rename it back to
	isearch-filter-predicate.
	(isearch-message-prefix): Use advice-function-mapc and advice
	properties to get the isearch-message-prefix.
	(isearch-search, isearch-lazy-highlight-search): Revert to funcall
	instead of run-hook-with-args-until-failure.
	(isearch-filter-visible): Not obsolete any more.
	* loadup.el: Preload nadvice.
	* replace.el (perform-replace): Revert to funcall
	instead of run-hook-with-args-until-failure.
	* wdired.el (wdired-change-to-wdired-mode): Use add-function.
	* dired-aux.el (dired-isearch-filenames-mode): Rename from
	dired-isearch-filenames-toggle; make it into a proper minor mode.
	Use add/remove-function.
	(dired-isearch-filenames-setup, dired-isearch-filenames-end):
	Call the minor-mode rather than add/remove-hook.
	(dired-isearch-filter-filenames):
	Remove isearch-message-prefix property.
	* info.el (Info--search-loop): New function, extracted from Info-search.
	Funcall isearch-filter-predicate instead of
	run-hook-with-args-until-failure isearch-filter-predicates.
	(Info-search): Use it.
	(Info-mode): Use isearch-filter-predicate instead of
	isearch-filter-predicates.

2013-08-05  Dmitry Antipov  <dmantipov@yandex.ru>

	Do not call to `selected-window' where it is assumed by default.
	Affected functions are `window-minibuffer-p', `window-dedicated-p',
	`window-hscroll', `window-width', `window-height', `window-buffer',
	`window-frame', `window-start', `window-point', `next-window'
	and `window-display-table'.
	* abbrev.el (abbrev--default-expand):
	* bs.el (bs--show-with-configuration):
	* buff-menu.el (Buffer-menu-mouse-select):
	* calc/calc.el (calc):
	* calendar/calendar.el (calendar-generate-window):
	* calendar/diary-lib.el (diary-simple-display, diary-show-all-entries)
	(diary-make-entry):
	* comint.el (send-invisible, comint-dynamic-complete-filename)
	(comint-dynamic-simple-complete, comint-dynamic-list-completions):
	* completion.el (complete):
	* dabbrev.el (dabbrev-expand, dabbrev--make-friend-buffer-list):
	* disp-table.el (describe-current-display-table):
	* doc-view.el (doc-view-insert-image):
	* ebuff-menu.el (Electric-buffer-menu-mouse-select):
	* ehelp.el (with-electric-help):
	* emacs-lisp/easy-mmode.el (easy-mmode-define-navigation):
	* emacs-lisp/edebug.el (edebug-two-window-p, edebug-pop-to-buffer):
	* emacs-lisp/helper.el (Helper-help-scroller):
	* emulation/cua-base.el (cua--post-command-handler-1):
	* eshell/esh-mode.el (eshell-output-filter):
	* ffap.el (ffap-gnus-wrapper):
	* help-macro.el (make-help-screen):
	* hilit-chg.el (highlight-compare-buffers):
	* hippie-exp.el (hippie-expand, try-expand-dabbrev-visible):
	* hl-line.el (global-hl-line-highlight):
	* icomplete.el (icomplete-simple-completing-p):
	* isearch.el (isearch-done):
	* jit-lock.el (jit-lock-stealth-fontify):
	* mail/rmailsum.el (rmail-summary-scroll-msg-up):
	* lisp/mouse-drag.el (mouse-drag-should-do-col-scrolling):
	* mpc.el (mpc-tagbrowser, mpc):
	* net/rcirc.el (rcirc-any-buffer):
	* play/gomoku.el (gomoku-max-width, gomoku-max-height):
	* play/landmark.el (landmark-max-width, landmark-max-height):
	* play/zone.el (zone):
	* progmodes/compile.el (compilation-goto-locus):
	* progmodes/ebrowse.el (ebrowse-view/find-file-and-search-pattern):
	* progmodes/etags.el (find-tag-other-window):
	* progmodes/fortran.el (fortran-column-ruler):
	* progmodes/gdb-mi.el (gdb-mouse-toggle-breakpoint-fringe):
	* progmodes/verilog-mode.el (verilog-point-text):
	* reposition.el (reposition-window):
	* rot13.el (toggle-rot13-mode):
	* server.el (server-switch-buffer):
	* shell.el (shell-dynamic-complete-command)
	(shell-dynamic-complete-environment-variable):
	* simple.el (insert-buffer, set-selective-display)
	(delete-completion-window):
	* speedbar.el (speedbar-timer-fn, speedbar-center-buffer-smartly)
	(speedbar-recenter):
	* startup.el (fancy-splash-head):
	* textmodes/ispell.el (ispell-command-loop):
	* textmodes/makeinfo.el (makeinfo-compilation-sentinel-region):
	* tutorial.el (help-with-tutorial):
	* vc/add-log.el (add-change-log-entry):
	* vc/compare-w.el (compare-windows):
	* vc/ediff-help.el (ediff-indent-help-message):
	* vc/ediff-util.el (ediff-setup-control-buffer, ediff-position-region):
	* vc/ediff-wind.el (ediff-skip-unsuitable-frames)
	(ediff-setup-control-frame):
	* vc/emerge.el (emerge-position-region):
	* vc/pcvs-util.el (cvs-bury-buffer):
	* window.el (walk-windows, mouse-autoselect-window-select):
	* winner.el (winner-set-conf, winner-undo): Related users changed.

2013-08-05  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset--set-id): Doc fix.
	(frameset-frame-id, frameset-frame-id-equal-p)
	(frameset-locate-frame-id): New functions.
	(frameset--process-minibuffer-frames, frameset--reuse-frame)
	(frameset-restore): Use them.

2013-08-05  Dmitry Antipov  <dmantipov@yandex.ru>

	Do not call to `selected-frame' where it is assumed by default.
	Affected functions are `raise-frame', `redraw-frame',
	`frame-first-window', `frame-terminal' and `delete-frame'.
	* calendar/appt.el (appt-disp-window):
	* epg.el (epg-wait-for-completion):
	* follow.el (follow-delete-other-windows-and-split)
	(follow-avoid-tail-recenter):
	* international/mule.el (set-terminal-coding-system):
	* mail/rmail.el (rmail-mail-return):
	* net/newst-plainview.el (newsticker--buffer-set-uptodate):
	* progmodes/f90.el (f90-add-imenu-menu):
	* progmodes/idlw-toolbar.el (idlwave-toolbar-toggle):
	* server.el (server-switch-buffer):
	* simple.el (delete-completion-window):
	* talk.el (talk):
	* term/xterm.el (terminal-init-xterm-modify-other-keys)
	(xterm-turn-on-modify-other-keys, xterm-remove-modify-other-keys):
	* vc/ediff-util.el (ediff-status-info, ediff-show-diff-output):
	* vc/ediff.el (ediff-documentation): Related users changed.
	* frame.el (selected-terminal): Remove the leftover.

2013-08-05  Glenn Morris  <rgm@gnu.org>

	* calendar/calendar.el (calendar-generate-month):
	Fix for calendar-column-width != 1 + calendar-day-digit-width.
	(calendar-generate-month, calendar-font-lock-keywords):
	Fix for calendar-day-header-width > length of any day name.

2013-08-05  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-clear): Use new name of sort predicate.

	* frameset.el (frameset): Add docstring.  Move :version property to its
	own `version' slot.
	(frameset-copy): Rename from copy-frameset.
	(frameset-p): Check more thoroughly.
	(frameset-prop): Do not check for :version, which is no longer a prop.
	(frameset-live-filter-alist, frameset-persistent-filter-alist):
	Use new :never value instead of t.
	(frameset-filter-alist): Expand and clarify docstring.
	(frameset-filter-tty-to-GUI, frameset-filter-sanitize-color)
	(frameset-filter-minibuffer, frameset-filter-save-param)
	(frameset-filter-restore-param, frameset-filter-iconified):
	Add pointer to docstring of frameset-filter-alist.
	(frameset-filter-params): Rename filter values to be more meaningful:
	:never instead of t, and reverse the meanings of :save and :restore.
	(frameset--process-minibuffer-frames): Clarify error message.
	(frameset-save): Avoid unnecessary and confusing call to framep.
	Use new BOA constructor for framesets.
	(frameset--reuse-list): Doc fix.
	(frameset--restore-frame): Rename from frameset--get-frame.  Doc fix.
	(frameset--minibufferless-last-p): Rename from frameset--sort-states.
	(frameset-minibufferless-first-p): Doc fix.
	Rename from frameset-sort-frames-for-deletion.
	(frameset-restore): Doc fixes.  Use new function names.
	Most changes suggested by Drew Adams <drew.adams@oracle.com>.

2013-08-04  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-forces-onscreen)
	(desktop-restore-reuses-frames): Document :keyword constant values.
	(desktop-filter-parameters-alist): Remove, now identical to
	frameset-filter-alist.
	(desktop--filter-tty*): Remove, moved to frameset.el.
	(desktop-save-frameset, desktop-restore-frameset):
	Do not pass :filters argument.

	* frameset.el (frameset-live-filter-alist)
	(frameset-persistent-filter-alist): New variables.
	(frameset-filter-alist): Use them.  Add autoload cookie.
	(frameset-filter-tty-to-GUI): Move from desktop.el and rename.
	(frameset--set-id, frameset--reuse-frame): Rename `frame-id' to
	`frameset--id' (it's supposed to be internal to frameset.el).
	(frameset--process-minibuffer-frames): Ditto.  Doc fix.
	(frameset--initial-params): New function.
	(frameset--get-frame): Use it.  Doc fix.
	(frameset--move-onscreen): Accept new PRED value for FORCE-ONSCREEN.
	Accept :all, not 'all.
	(frameset-restore): Add new predicate values for FORCE-ONSCREEN and
	FORCE-DISPLAY.  Use :keywords for constant arguments to avoid collision
	with fbound symbols.  Fix frame id matching, and remove matching ids if
	the frame being restored is deleted.  Obey :delete.

2013-08-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (macrop): New function.
	(text-clone--maintaining): New var.
	(text-clone--maintain): Rename from text-clone-maintain.  Use it
	instead of inhibit-modification-hooks.

	* emacs-lisp/nadvice.el (advice--normalize): For aliases to macros, use
	a proxy, so as handle autoloads and redefinitions of the target.
	(advice--defalias-fset, advice-remove): Use advice--symbol-function.

	* emacs-lisp/pcase.el (pcase-mutually-exclusive-predicates):
	Remove bogus (arrayp . stringp) pair.  Add entries for `vectorp'.
	(pcase--mutually-exclusive-p): New function.
	(pcase--split-consp): Use it.
	(pcase--split-pred): Use it.  Optimize the case where `pat' is a qpat
	mutually exclusive with the current predicate.

	* emacs-lisp/edebug.el (edebug-lookup-function): Remove function.
	(edebug-macrop): Remove.  Use `macrop' instead.
	* emacs-lisp/advice.el (ad-subr-p): Remove.  Use `subrp' instead.
	(ad-macro-p):
	* eshell/esh-cmd.el (eshell-macrop):
	* apropos.el (apropos-macrop): Remove.  Use `macrop' instead.

2013-08-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice-function-mapc): Rename from advice-mapc.
	(advice-mapc): New function, using it.
	(advice-function-member-p): New function.
	(advice--normalize): Store the cdr in advice--saved-rewrite since
	that's the part that will be changed.
	(advice--symbol-function): New function.
	(advice-remove): Handle removal before the function is defined.
	Adjust to new advice--saved-rewrite.
	(advice-member-p): Use advice-function-member-p and
	advice--symbol-function.

2013-08-04  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-p, frameset-save): Fix autoload cookies.
	(frameset-filter-minibuffer): Doc fix.
	(frameset-restore): Fix autoload cookie.  Fix typo in docstring.
	(frameset--set-id, frameset--process-minibuffer-frames)
	(frameset-restore): Rename parameter `frameset-id' to `frame-id'.
	(frameset--reuse-frame): Pass correct frame-id to frameset--find-frame.

	* desktop.el (desktop-clear): Only delete frames when called
	interactively and desktop-restore-frames is non-nil.  Doc fix.
	(desktop-read): Set desktop-saved-frameset to nil.

2013-08-04  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc.el (vc-ignore): Rewrite.
	(vc-default-ignore-completion-table):
	(vc--read-lines):
	(vc--add-line, vc--remove-regexp): New functions.

	* vc/vc-svn.el (vc-svn-ignore): Doc fix.
	(vc-svn-ignore-completion-table): New function.

	* vc/vc-hg.el (vc-hg-ignore): Rewrite.
	(vc-hg-ignore-completion-table):
	(vc-hg-find-ignore-file): New functions.

	* vc/vc-git.el (vc-git-ignore): Rewrite.
	(vc-git-ignore-completion-table):
	(vc-git-find-ignore-file): New functions.

	* vc/vc-dir.el (vc-dir-menu-map): Add menu for vc-dir-ignore.

	* vc/vc-bzr.el (vc-bzr-ignore): Rewrite.
	(vc-bzr-ignore-completion-table):
	(vc-bzr-find-ignore-file): New functions.

2013-08-03  Juanma Barranquero  <lekktu@gmail.com>

	* frameset.el (frameset-prop): New function and setter.
	(frameset-save): Do not modify frame list passed by the caller.

2013-08-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-desc-from-define): Ignore unknown keys.

2013-08-02  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/easy-mmode.el (define-globalized-minor-mode)
	(easy-mmode-define-navigation): Avoid ((lambda (..) ..) ...).

	* custom.el (custom-initialize-default, custom-initialize-set)
	(custom-initialize-reset, custom-initialize-changed): Affect the
	toplevel-default-value (bug#6275, bug#14586).
	* emacs-lisp/advice.el (ad-compile-function): Undo previous workaround
	for bug#6275.

2013-08-02  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/lisp-mode.el (lisp-imenu-generic-expression):
	Add cl-def* expressions.

	* frameset.el (frameset-filter-params): Fix order of arguments.

2013-08-02  Juanma Barranquero  <lekktu@gmail.com>

	Move code related to saving frames to frameset.el.
	* desktop.el: Require frameset.
	(desktop-restore-frames): Doc fix.
	(desktop-restore-reuses-frames): Rename from
	desktop-restoring-reuses-frames.
	(desktop-saved-frameset): Rename from desktop-saved-frame-states.
	(desktop-clear): Clear frames too.
	(desktop-filter-parameters-alist): Set from frameset-filter-alist.
	(desktop--filter-tty*, desktop-save, desktop-read):
	Use frameset functions.
	(desktop-before-saving-frames-functions, desktop--filter-*-color)
	(desktop--filter-minibuffer, desktop--filter-restore-desktop-parm)
	(desktop--filter-save-desktop-parm, desktop--filter-iconified-position)
	(desktop-restore-in-original-display-p, desktop--filter-frame-parms)
	(desktop--process-minibuffer-frames, desktop-save-frames)
	(desktop--reuse-list, desktop--compute-pos, desktop--move-onscreen)
	(desktop--find-frame, desktop--select-frame, desktop--make-frame)
	(desktop--sort-states, desktop-restoring-frames-p)
	(desktop-restore-frames): Remove.  Most code moved to frameset.el.
	(desktop-restoring-frameset-p, desktop-restore-frameset)
	(desktop--check-dont-save, desktop-save-frameset): New functions.
	(desktop--app-id): New constant.
	(desktop-first-buffer, desktop-buffer-ok-count)
	(desktop-buffer-fail-count): Move before first use.
	* frameset.el: New file.

2013-08-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files.el: Use lexical-binding.
	(dir-locals-read-from-file): Remove unused `err' variable.
	(hack-dir-local-variables--warned-coding): New var.
	(hack-dir-local-variables): Use it to avoid repeated warnings.
	(make-backup-file-name--default-function): New function.
	(make-backup-file-name-function): Use it as default.
	(buffer-stale--default-function): New function.
	(buffer-stale-function): Use it as default.
	(revert-buffer-insert-file-contents--default-function): New function.
	(revert-buffer-insert-file-contents-function): Use it as default.
	(insert-directory): Avoid add-to-list.

	* autorevert.el (auto-revert-handler): Simplify.
	Use buffer-stale--default-function.

2013-08-01  Tassilo Horn  <tsdh@gnu.org>

	* speedbar.el (speedbar-query-confirmation-method): Doc fix.

	* whitespace.el (whitespace-ensure-local-variables): New function.
	(whitespace-cleanup-region): Call it.
	(whitespace-turn-on): Call it.

2013-08-01  Michael Albinus  <michael.albinus@gmx.de>

	Complete file name handlers.

	* net/tramp.el (tramp-handle-set-visited-file-modtime)
	(tramp-handle-verify-visited-file-modtime)
	(tramp-handle-file-notify-rm-watch): New functions.
	(tramp-call-process): Do not bind `default-directory'.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	Order alphabetically.
	[access-file, add-name-to-file, dired-call-process]:
	[dired-compress-file, file-acl, file-notify-rm-watch]:
	[file-ownership-preserved-p, file-selinux-context]:
	[make-directory-internal, make-symbolic-link, set-file-acl]:
	[set-file-selinux-context, set-visited-file-modtime]:
	[verify-visited-file-modtime]: Add handler.
	(tramp-adb-handle-write-region): Apply `set-visited-file-modtime'.

	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist)
	[file-notify-add-watch, file-notify-rm-watch]:
	[set-file-times, set-visited-file-modtime]:
	[verify-visited-file-modtime]: Add handler.
	(with-tramp-gvfs-error-message)
	(tramp-gvfs-handle-set-visited-file-modtime)
	(tramp-gvfs-fuse-file-name): Remove.
	(tramp-gvfs-handle-file-notify-add-watch)
	(tramp-gvfs-file-gvfs-monitor-file-process-filter): New defuns.
	(tramp-gvfs-handle-write-region): Fix error in moving tmpfile.

	* net/tramp-sh.el (tramp-sh-file-name-handler-alist):
	Order alphabetically.
	[file-notify-rm-watch ]: Use default Tramp handler.
	[executable-find]: Remove private handler.
	(tramp-do-copy-or-rename-file-out-of-band): Do not bind
	`default-directory'.
	(tramp-sh-handle-executable-find)
	(tramp-sh-handle-file-notify-rm-watch): Remove functions.
	(tramp-sh-file-gvfs-monitor-dir-process-filter)
	(tramp-sh-file-inotifywait-process-filter, tramp-set-remote-path):
	Do not use `format' in `tramp-message'.

	* net/tramp-smb.el (tramp-smb-file-name-handler-alist)
	[file-notify-rm-watch, set-visited-file-modtime]:
	[verify-visited-file-modtime]: Add handler.
	(tramp-smb-call-winexe): Do not bind `default-directory'.

2013-08-01  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-hooks.el (vc-menu-map): Fix menu entry for vc-ignore.

2013-07-31  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/log-view.el (log-view-diff): Extract `log-view-diff-common',
	use it.
	(log-view-diff-changeset): Same.
	(log-view-diff-common): Call backend command `previous-revision'
	to find out the previous revision, in both cases.  Swap the
	variables `to' and `fr', so that `fr' usually refers to the
	earlier revision (Bug#14989).

2013-07-31  Kan-Ru Chen  <kanru@kanru.info>

	* ibuf-ext.el (ibuffer-filter-by-filename):
	Make it work with dired buffers too.

2013-07-31  Dmitry Antipov  <dmantipov@yandex.ru>

	* emacs-lisp/re-builder.el (reb-color-display-p):
	* files.el (save-buffers-kill-terminal):
	* net/browse-url.el (browse-url):
	* server.el (server-save-buffers-kill-terminal):
	* textmodes/reftex-toc.el (reftex-toc, reftex-toc-revert):
	Prefer nil to selected-frame for the first arg of frame-parameter.

2013-07-31  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-hooks.el (vc-menu-map): Add menu entry for vc-ignore.

2013-07-30  Stephen Berman  <stephen.berman@gmx.net>

	* minibuffer.el (completion--twq-all): Try and preserve each
	completion's case choice (bug#14907).

2013-07-30  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/network-stream.el (open-network-stream): Mention the new
	:nogreeting parameter.
	(network-stream-open-starttls): Use the :nogreeting parameter
	(bug#14938).

	* net/shr.el (shr-mouse-browse-url): Remove and use `shr-browse-url'.

	* net/eww.el (eww-setup-buffer): Switching to the buffer seems
	more natural than popping.

	* net/shr.el (shr-urlify): Put `follow-link' on URLs (bug#14815).
	(shr-urlify): Highlight under mouse.

2013-07-30  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-hooks.el (vc-prefix-map): Add key binding for vc-ignore.

	* vc/vc-dir.el (vc-dir-mode-map): Change key binding for vc-dir-ignore.

	* vc/vc-svn.el (vc-svn-ignore): Remove `interactive'.  Use `*vc*'
	buffer for output.

	* vc/vc-hg.el (vc-hg-ignore): Remove `interactive'.  Do not assume
	point-min==1.  Fix search string.  Fix parentheses missing.

	* vc/vc-git.el (vc-git-ignore): Remove `interactive'.  Do not
	assume point-min==1.  Fix search string.  Fix parentheses missing.

	* vc/vc-cvs.el (vc-cvs-ignore): Remove `interactive'.

	* vc/vc-bzr.el (vc-bzr-ignore): Remove `interactive'.  Use `*vc*'
	buffer for output.

2013-07-29  Eli Zaretskii  <eliz@gnu.org>

	* frame.el (frame-notice-user-settings): Avoid inflooping when the
	initial frame is minibuffer-less.  (Bug#14841)

2013-07-29  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-use-ssh-controlmaster-options): New customer
	option.

	* net/tramp-sh.el (tramp-do-copy-or-rename-file-out-of-band)
	(tramp-maybe-open-connection): Use it.

2013-07-28  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--make-frame): Include `minibuffer' in the
	minimal set of parameters passed when creating a frame, because
	the minibuffer status of a frame cannot be changed later.

2013-07-28  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el (todo-rename-file): Fix incorrect use of
	replace-regexp-in-string and inadvertent omissions in previous change.
	(todo-filter-items): Ensure only file names are comma-separated in
	name of filtered items buffer.

2013-07-28  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el: Optionally force offscreen frames back onscreen.
	(desktop-restoring-reuses-frames): New option.
	(desktop--compute-pos, desktop--move-onscreen): New functions.
	(desktop--make-frame): Use desktop--move-onscreen.

2013-07-27  Alan Mackenzie  <acm@muc.de>

	Fontify a Java generic method as a function.
	* progmodes/cc-langs.el (c-recognize-<>-arglists): Set the Java
	value to t.

2013-07-27  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Add command to rename todo files.
	(todo-rename-file): New command.
	(todo-key-bindings-t): Add key binding for it.  Change the
	bindings of todo-filter-regexp-items(-multifile) to use `x'
	instead of `r', since the latter is better suited to the new
	renaming command.

2013-07-27  Alan Mackenzie  <acm@muc.de>

	Make Java try-with-resources statement parse properly.
	* progmodes/cc-langs.el (c-block-stmt-1-2-kwds)
	(c-block-stmt-1-2-key): New language constants/variables.
	* progmodes/cc-engine.el (c-beginning-of-statement-1)
	(c-after-conditional): Adapt to deal with c-block-stmt-1-2-key.
	* progmodes/cc-fonts.el (c-font-lock-declarations): Adapt to deal
	with c-block-stmt-1-2-key.

2013-07-27  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--make-frame): Apply most frame parameters after
	creating the frame to force (partially or totally) offscreen frames to
	be restored as such.

2013-07-26  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-dir.el (vc-dir-mode-map): Add binding for vc-root-diff.
	(Bug#14948)

2013-07-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--called-interactively-skip): Use the new
	`base' arg of backtrace-frame.

2013-07-26  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (list-processes): Doc fix.

2013-07-26  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--select-frame):
	Try harder to reuse existing frames.

2013-07-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el: Use backtrace-eval to handle lexical variables.
	(edebug-eval): Use backtrace-eval.
	(edebug--display, edebug--recursive-edit): Don't let-bind the
	edebug-outer-* vars that keep track of variables we locally let-bind.
	(edebug-outside-excursion): Don't restore outside values of locally
	let-bound vars.
	(edebug--display): Use user-error.
	(cl-lexical-debug, cl-debug-env): Remove.

2013-07-26  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-frames): Call `sit-for' once all frames
	are restored to be sure that they are visible before deleting any
	remaining ones.

2013-07-26  Matthias Meulien  <orontee@gmail.com>

	* vc/vc-dir.el (vc-dir-mode-map): Add binding for
	vc-print-root-log.  (Bug#14948)

2013-07-26  Richard Stallman  <rms@gnu.org>

	Add aliases for encrypting mail.
	* epa.el (epa-mail-aliases): New option.
	* epa-mail.el (epa-mail-encrypt): Rewrite to be callable from programs.
	Bind inhibit-read-only so read-only text doesn't ruin everything.
	(epa-mail-default-recipients): New subroutine broken out.
	Handle epa-mail-aliases.

2013-07-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	Add support for lexical variables to the debugger's `e' command.
	* emacs-lisp/debug.el (debug): Don't let-bind the debugger-outer-*
	vars, except for debugger-outer-match-data.
	(debugger-frame-number): Move check for "on a function call" from
	callers into it.  Add `skip-base' argument.
	(debugger-frame, debugger-frame-clear): Simplify accordingly.
	(debugger-env-macro): Only reset the state stored in non-variables,
	i.e. current-buffer and match-data.
	(debugger-eval-expression): Rewrite using backtrace-eval.
	* subr.el (internal--called-interactively-p--get-frame): Remove.
	(called-interactively-p):
	* emacs-lisp/edebug.el (edebug--called-interactively-skip): Use the new
	`base' arg of backtrace-frame instead.

2013-07-26  Glenn Morris  <rgm@gnu.org>

	* align.el (align-regexp): Doc fix.  (Bug#14857)
	(align-region): Explicit error if subexpression missing/does not match.

	* simple.el (global-visual-line-mode):
	Do not duplicate the mode lighter.  (Bug#14858)

2013-07-25  Martin Rudalics  <rudalics@gmx.at>

	* window.el (display-buffer): In display-buffer bind
	split-window-keep-point to t, bug#14829.

2013-07-25  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el: Rename internal "desktop-X" frame params to "desktop--X".
	(desktop-filter-parameters-alist, desktop--filter-restore-desktop-parm)
	(desktop--filter-save-desktop-parm, desktop--process-minibuffer-frames)
	(desktop--select-frame, desktop--sort-states, desktop-restore-frames):
	Change accordingly.
	(desktop--select-frame, desktop--sort-states, desktop-restore-frames):
	Use pcase-let, pcase-let* to deobfuscate access to desktop--mini values.

2013-07-25  Glenn Morris  <rgm@gnu.org>

	* dired-x.el (dired-mark-extension): Convert comment to doc string.

2013-07-25  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--make-frame): Do not pass the `fullscreen'
	parameter to modify-frame-parameters if the value has not changed;
	this is a workaround for bug#14949.
	(desktop--make-frame): On cl-delete-if call, check parameter name,
	not full parameter.

2013-07-30  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc.el (vc-ignore): New function.

	* vc/vc-svn.el (vc-svn-ignore): New function.

	* vc/vc-hg.el (vc-hg-ignore): New function.

	* vc/vc-git.el (vc-git-ignore): New function.

	* vc/vc-dir.el (vc-dir-mode-map): Add key binding for vc-dir-ignore
	(vc-dir-ignore): New function.

	* vc/vc-cvs.el (vc-cvs-ignore): New function.
	(cvs-append-to-ignore): Move here from pcvs.el.

	* vc/vc-bzr.el (vc-bzr-ignore): New function.

	* vc/pcvs.el (vc-cvs): Require 'vc-cvs.

2013-07-24  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restoring-frames-p): Return a true boolean.
	(desktop-restore-frames): Warn when deleting an existing frame failed.

2013-07-24  Glenn Morris  <rgm@gnu.org>

	* ffap.el (ffap-machine-p): Handle "not known" response.  (Bug#14929)

2013-07-24  Michael Albinus  <michael.albinus@gmx.de>

	* filenotify.el (file-notify-supported-p):
	* net/tramp-sh.el (tramp-sh-handle-file-notify-supported-p):
	Remove functions.

	* autorevert.el (auto-revert-use-notify):
	(auto-revert-notify-add-watch):
	* net/tramp.el (tramp-file-name-for-operation):
	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist):
	* net/tramp-sh.el (tramp-sh-file-name-handler-alist):
	* net/tramp-smb.el (tramp-smb-file-name-handler-alist):
	Remove `file-notify-supported-p' entry.

2013-07-24  Glenn Morris  <rgm@gnu.org>

	* printing.el: Replace all uses of deleted ps-windows-system,
	ps-lp-system, ps-flatten-list with lpr- versions.

2013-07-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/pcase.el (pcase--u1): Verify if self-quoting values can be
	checked with memq (bug#14935).

	* files.el (revert-buffer-function): Use a non-nil default.
	(revert-buffer-preserve-modes): Declare var to
	provide access to the `preserve-modes' argument.
	(revert-buffer): Let-bind it.
	(revert-buffer--default): New function, extracted from revert-buffer.

2013-07-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* lpr.el: Signal print errors more prominently.
	(print-region-function): Don't default to nil.
	(lpr-print-region): New function, extracted from print-region-1.
	Check lpr's return value and signal an error in case of problem.
	(print-region-1): Use it.
	* ps-print.el (ps-windows-system, ps-lp-system): Remove.  Use the lpr-*
	versions instead.
	(ps-printer-name): Default to nil.
	(ps-printer-name-option): Default to lpr-printer-switch.
	(ps-print-region-function): Don't default to nil.
	(ps-postscript-code-directory): Simplify default.
	(ps-do-despool): Use lpr-print-region to properly check the outcome.
	(ps-string-list, ps-eval-switch, ps-flatten-list)
	(ps-flatten-list-1): Remove.
	(ps-multibyte-buffer): Avoid setq.
	* dos-w32.el (direct-print-region-helper): Use proper regexp operators.
	(print-region-function, ps-print-region-function): Don't set them here.

2013-07-24  Xue Fuqiao  <xfq.free@gmail.com>

	* ido.el (ido-fractionp):
	(ido-cache-ftp-work-directory-time, ido-max-prospects, ido-mode)
	(ido-max-file-prompt-width, ido-unc-hosts-cache)
	(ido-max-directory-size, ido-max-dir-file-cache)
	(ido-decorations): Doc fix.

	* ansi-color.el: Fix old URL.

2013-07-23  Michael R. Mauger  <michael@mauger.com>

	* progmodes/sql.el Version 3.3
	(sql-product-alist): Improve oracle :prompt-cont-regexp.
	(sql-starts-with-prompt-re, sql-ends-with-prompt-re): New functions.
	(sql-interactive-remove-continuation-prompt): Rewrite, use
	functions above.  Fix continuation prompt and complete output line
	handling.
	(sql-redirect-one, sql-execute): Use `read-only-mode' on
	redirected output buffer.
	(sql-mode): Restore deleted code (Bug#13591).

2013-07-23  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-clear, desktop-list*): Fix previous change.

2013-07-23  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-handle-file-notify-add-watch): New defun.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist):
	* net/tramp-smb.el (tramp-smb-file-name-handler-alist): Use it.

2013-07-23  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-clear): Simplify; remove useless checks
	against invalid buffer names.
	(desktop-list*): Use cl-list*.
	(desktop-buffer-info, desktop-create-buffer): Simplify.

2013-07-23  Leo Liu  <sdl.web@gmail.com>

	* bookmark.el (bookmark-make-record): Restore NAME as a default
	value.  (Bug#14933)

2013-07-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/autoload.el (autoload--setup-output): New function,
	extracted from autoload--insert-text.
	(autoload--insert-text): Remove.
	(autoload--print-cookie-text): New function, extracted from
	autoload--insert-cookie-text.
	(autoload--insert-cookie-text): Remove.
	(autoload-generate-file-autoloads): Adjust calls accordingly.

	* winner.el (winner-hook-installed-p): Remove.
	(winner-mode): Simplify accordingly.

	* subr.el (add-to-list): Fix compiler-macro when `append' is
	not constant.  Don't use `cl-member' for the base case.

	* progmodes/subword.el: Fix boundary case (bug#13758).
	(subword-forward-regexp): Make it a constant.  Wrap optional \\W in its
	own group.
	(subword-backward-regexp): Make it a constant.
	(subword-forward-internal): Don't treat a trailing capital as the
	beginning of a word.

2013-07-22  Ari Roponen  <ari.roponen@gmail.com>  (tiny change)

	* emacs-lisp/package.el (package-menu-mode): Don't modify the
	global value of tabulated-list-revert-hook (bug#14930).

2013-07-22  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el: Require 'cl-lib.
	(desktop-before-saving-frames-functions): New hook.
	(desktop--process-minibuffer-frames): Set desktop-mini parameter only
	for frames being saved.  Rename from desktop--save-minibuffer-frames.
	(desktop-save-frames): Run hook desktop-before-saving-frames-functions.
	Do not save frames with non-nil `desktop-dont-save' parameter.
	Filter out deleted frames.
	(desktop--find-frame): Use cl-find-if.
	(desktop--select-frame): Use cl-(first|second|third) to access values
	of desktop-mini.
	(desktop--make-frame): Use cl-delete-if.
	(desktop--sort-states): Fix sorting of minibuffer-owning frames.
	(desktop-restore-frames): Use cl-(first|second|third) to access values
	of desktop-mini.  Look for visible frame at the end, not while
	restoring frames.

	* dired-x.el (dired-mark-unmarked-files, dired-virtual)
	(dired-guess-default, dired-mark-sexp, dired-filename-at-point):
	Use string-match-p, looking-at-p (bug#14927).

2013-07-21  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-saved-frame-states):
	Rename from desktop--saved-states; all users changed.
	(desktop-save-frames): Rename from desktop--save-frames.
	Do not save state to desktop file.
	(desktop-save): Save desktop-saved-frame-states to desktop file
	and reset to nil.
	(desktop-restoring-frames-p): New function.
	(desktop-restore-frames): Use it.  Rename from desktop--restore-frames.
	(desktop-read): Use desktop-restoring-frames-p.  Do not try to fix
	buffer-lists when restoring frames.  Suggested by Martin Rudalics.

	* desktop.el: Correctly restore iconified frames.
	(desktop--filter-iconified-position): New function.
	(desktop-filter-parameters-alist): Add entries for `top' and `left'.

2013-07-20  Glenn Morris  <rgm@gnu.org>

	* progmodes/gdb-mi.el (gdb-delete-handler, gdb-stopped):
	Let `message' do the formatting.
	(def-gdb-preempt-display-buffer): Add explicit format.

	* image-dired.el (image-dired-track-original-file):
	Use with-current-buffer.
	(image-dired-track-thumbnail): Use with-current-buffer.
	Avoid changing point of wrong window.

	* image-dired.el (image-dired-track-original-file):
	Avoid changing point of wrong window.  (Bug#14909)

2013-07-20  Richard Copley  <rcopley@gmail.com>  (tiny change)

	* progmodes/gdb-mi.el (gdb-done-or-error):
	Guard against "%" in gdb output.  (Bug#14127)

2013-07-20  Andreas Schwab  <schwab@linux-m68k.org>

	* progmodes/sh-script.el (sh-read-variable): Remove interactive spec.
	(Bug#14826)

	* international/mule.el (coding-system-iso-2022-flags): Fix last
	change.

2013-07-20  Kenichi Handa  <handa@gnu.org>

	* international/mule.el (coding-system-iso-2022-flags):
	Add `8-bit-level-4'.  (Bug#8522)

2013-07-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-mouse-browse-url): New command and keystroke
	(bug#14815).

	* net/eww.el (eww-process-text-input): Allow inputting when the
	point is at the start of the line, as the properties aren't
	front-sticky.

	* net/shr.el (shr-make-table-1): Ensure that we don't infloop on
	degenerate widths.

2013-07-19  Richard Stallman  <rms@gnu.org>

	* epa.el (epa-popup-info-window): Doc fix.

	* subr.el (split-string): New arg TRIM.

2013-07-18  Juanma Barranquero  <lekktu@gmail.com>

	* frame.el (blink-cursor-timer-function, blink-cursor-suspend):
	Add check for W32 (followup to 2013-07-16T11:41:06Z!jan.h.d@swipnet.se).

2013-07-18  Michael Albinus  <michael.albinus@gmx.de>

	* filenotify.el (file-notify--library): Rename from
	`file-notify-support'.  Do not autoload.  Adapt all uses.
	(file-notify-supported-p): New defun.

	* autorevert.el (auto-revert-use-notify):
	Use `file-notify-supported-p' instead of `file-notify-support'.
	Adapt docstring.
	(auto-revert-notify-add-watch): Use `file-notify-supported-p'.

	* net/tramp.el (tramp-file-name-for-operation):
	Add `file-notify-supported-p'.

	* net/tramp-sh.el (tramp-sh-handle-file-notify-supported-p):
	New defun.
	(tramp-sh-file-name-handler-alist): Add it as handler for
	`file-notify-supported-p '.

	* net/tramp-adb.el (tramp-adb-file-name-handler-alist):
	* net/tramp-gvfs.el (tramp-gvfs-file-name-handler-alist):
	* net/tramp-smb.el (tramp-smb-file-name-handler-alist):
	Add `ignore' as handler for `file-notify-*' functions.

2013-07-17  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial, line-move): Don't start vscroll or
	scroll-up if the current line is not taller than the window.
	(Bug#14881)

2013-07-16  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Do not
	highlight question marks in the method names as strings.
	(ruby-block-beg-keywords): Inline.
	(ruby-font-lock-keyword-beg-re): Extract from
	`ruby-font-lock-keywords'.

2013-07-16  Jan Djärv  <jan.h.d@swipnet.se>

	* frame.el (blink-cursor-blinks): New defcustom.
	(blink-cursor-blinks-done): New defvar.
	(blink-cursor-start): Set blink-cursor-blinks-done to 1.
	(blink-cursor-timer-function): Check if number of blinks has been
	done on X and NS.
	(blink-cursor-suspend, blink-cursor-check): New defuns.

2013-07-15  Glenn Morris  <rgm@gnu.org>

	* edmacro.el (edmacro-format-keys): Fix previous change.

2013-07-15  Paul Eggert  <eggert@cs.ucla.edu>

	* shell.el (explicit-bash-args): Remove obsolete hack for Bash 1.x.
	The hack didn't work outside English locales anyway.

2013-07-15  Juanma Barranquero  <lekktu@gmail.com>

	* simple.el (define-alternatives): Rename from alternatives-define,
	per RMS' suggestion.

2013-07-14  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-frames): Change default to t.
	(desktop-restore-in-current-display): Now offer more options.
	(desktop-restoring-reuses-frames): New customization option.
	(desktop--saved-states): Doc fix.
	(desktop-filter-parameters-alist): New variable, renamed and expanded
	from desktop--excluded-frame-parameters.
	(desktop--target-display): New variable.
	(desktop-switch-to-gui-p, desktop-switch-to-tty-p)
	(desktop--filter-tty*, desktop--filter-*-color)
	(desktop--filter-minibuffer, desktop--filter-restore-desktop-parm)
	(desktop--filter-save-desktop-parm)
	(desktop-restore-in-original-display-p): New functions.
	(desktop--filter-frame-parms): Use new desktop-filter-parameters-alist.
	(desktop--save-minibuffer-frames): New function, inspired by a similar
	function from Martin Rudalics.
	(desktop--save-frames): Call it; play nice with desktop-globals-to-save.
	(desktop--restore-in-this-display-p): Remove.
	(desktop--find-frame): Rename from desktop--find-frame-in-display
	and add predicate argument.
	(desktop--make-full-frame): Remove, integrated into desktop--make-frame.
	(desktop--reuse-list): New variable.
	(desktop--select-frame, desktop--make-frame, desktop--sort-states):
	New functions.
	(desktop--restore-frames): Add support for "minibuffer-special" frames.

2013-07-14  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-vc-registered): Use `ignore-error'.

2013-07-13  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Highlight conversion methods on Kernel.

2013-07-13  Alan Mackenzie  <acm@muc.de>

	* progmodes/cc-engine.el (c-forward-decl-or-cast-1): Label CASE 13
	and comment it out.  This out-commenting enables certain C++
	declarations to be parsed correctly.

2013-07-13  Eli Zaretskii  <eliz@gnu.org>

	* international/mule.el (define-coding-system): Doc fix.

	* simple.el (default-font-height): Don't call font-info if the
	frame's default font didn't change since the frame was created.
	(Bug#14838)

2013-07-13  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-file-name): Guard against non-symbol value.

2013-07-13  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-imenu--build-tree): Fix corner case
	in nested defuns.

2013-07-13  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-exhibit): Handle ido-enter-matching-directory before
	ido-set-matches call.  (Bug#6852)

2013-07-12  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-percent-literals-beg-re):
	(ruby-syntax-expansion-allowed-p): Support array of symbols, for
	Ruby 2.0.
	(ruby-font-lock-keywords): Distinguish calls to functions with
	module-like names from module references.  Highlight character
	literals.

2013-07-12  Sergio Durigan Junior  <sergiodj@riseup.net>  (tiny change)

	* progmodes/gdb-mi.el (gdb-strip-string-backslash): New function.
	(gdb-send): Handle continued commands.  (Bug#14847)

2013-07-12  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop--v2s): Remove unused local variable.
	(desktop-save-buffer): Make defvar-local; adjust docstring.
	(desktop-auto-save-timeout, desktop-owner): Use ignore-errors.
	(desktop-clear, desktop-save-buffer-p): Use string-match-p.

2013-07-12  Andreas Schwab  <schwab@linux-m68k.org>

	* emacs-lisp/map-ynp.el (map-y-or-n-p): Fix last change.

2013-07-12  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (next-line, previous-line): Document TRY-VSCROLL and ARG.
	(Bug#14842)

2013-07-12  Glenn Morris  <rgm@gnu.org>

	* doc-view.el: Require cl-lib at runtime too.
	(doc-view-remove-if): Remove.
	(doc-view-search-next-match, doc-view-search-previous-match):
	Use cl-remove-if.

	* edmacro.el: Require cl-lib at runtime too.
	(edmacro-format-keys, edmacro-parse-keys): Use cl-mismatch, cl-subseq.
	(edmacro-mismatch, edmacro-subseq): Remove.

	* shadowfile.el: Require cl-lib.
	(shadow-remove-if): Remove.
	(shadow-set-cluster, shadow-shadows-of-1, shadow-remove-from-todo):
	Use cl-remove-if.

	* wid-edit.el: Require cl-lib.
	(widget-choose): Use cl-remove-if.
	(widget-remove-if): Remove.

	* progmodes/ebrowse.el: Require cl-lib at runtime too.
	(ebrowse-delete-if-not): Remove.
	(ebrowse-browser-buffer-list, ebrowse-member-buffer-list)
	(ebrowse-tree-buffer-list, ebrowse-same-tree-member-buffer-list):
	Use cl-delete-if-not.

2013-07-12  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/cl-macs.el (cl-multiple-value-bind, cl-multiple-value-setq)
	(cl-the, cl-declare, cl-defstruct): Fix typos in docstrings.

2013-07-12  Leo Liu  <sdl.web@gmail.com>

	* ido.el (dired-do-copy, dired): Set 'ido property.  (Bug#11954)

2013-07-11  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/edebug.el: Require cl-lib at run-time too.
	(edebug-gensym-index, edebug-gensym):
	Remove reimplementation of cl-gensym.
	(edebug-make-enter-wrapper, edebug-make-form-wrapper): Use cl-gensym.

	* thumbs.el: Require cl-lib at run-time too.
	(thumbs-gensym-counter, thumbs-gensym):
	Remove reimplementation of cl-gensym.
	(thumbs-temp-file): Use cl-gensym.

	* emacs-lisp/ert.el: Require cl-lib at runtime too.
	(ert--cl-do-remf, ert--remprop, ert--remove-if-not)
	(ert--intersection, ert--set-difference, ert--set-difference-eq)
	(ert--union, ert--gensym-counter, ert--gensym-counter)
	(ert--coerce-to-vector, ert--remove*, ert--string-position)
	(ert--mismatch, ert--subseq): Remove reimplementations of cl funcs.
	(ert-make-test-unbound, ert--expand-should-1)
	(ert--expand-should, ert--should-error-handle-error)
	(should-error, ert--explain-equal-rec)
	(ert--plist-difference-explanation, ert-select-tests)
	(ert--make-stats, ert--remove-from-list, ert--string-first-line):
	Use cl-lib functions rather than reimplementations.

2013-07-11  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-methods): Extend docstring.
	(tramp-connection-timeout): New defcustom.
	(tramp-error-with-buffer): Reset timestamp only when appropriate.
	(with-tramp-progress-reporter): Simplify.
	(tramp-process-actions): Improve messages.

	* net/tramp-gvfs.el (tramp-gvfs-maybe-open-connection):
	* net/tramp-sh.el (tramp-maybe-open-connection):
	Use `tramp-connection-timeout'.
	(tramp-methods) [su, sudo, ksu]: Add method specific timeouts.
	(Bug#14808)

2013-07-11  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-file-name): Conform to the requirements of
	read-file-name.  (Bug#11861)
	(ido-read-directory-name): Conform to the requirements of
	read-directory-name.

2013-07-11  Juanma Barranquero  <lekktu@gmail.com>

	* subr.el (delay-warning): New function.

2013-07-10  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (default-line-height): New function.
	(line-move-partial, line-move): Use it instead of computing the
	line height inline.
	(line-move-partial): Always compute ROWH.  If the last line is
	partially-visible, but its text is completely visible, allow
	cursor to enter such a partially-visible line.

2013-07-10  Michael Albinus  <michael.albinus@gmx.de>

	Improve error messages.  (Bug#14808)

	* net/tramp.el (tramp-current-connection): New defvar, moved from
	tramp-sh.el.
	(tramp-message-show-progress-reporter-message): Remove, not
	needed anymore.
	(tramp-error-with-buffer): Show message in minibuffer.
	Discard input before waiting.  Reset connection timestamp.
	(with-tramp-progress-reporter): Improve messages.
	(tramp-process-actions): Use progress reporter.  Delete process in
	case of error.  Improve messages.

	* net/tramp-sh.el (tramp-barf-if-no-shell-prompt): Use condition-case.
	Call `tramp-error-with-buffer' with vector and buffer.
	(tramp-current-connection): Remove.
	(tramp-maybe-open-connection): The car of
	`tramp-current-connection' are the first 3 slots of the vector.

2013-07-10  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine3-indent-line): Do not indent
	inside continued strings.

2013-07-10  Paul Eggert  <eggert@cs.ucla.edu>

	Timestamp fixes for undo (Bug#14824).
	* files.el (clear-visited-file-modtime): Move here from fileio.c.

2013-07-10  Leo Liu  <sdl.web@gmail.com>

	* files.el (require-final-newline): Allow safe local value.
	(Bug#14834)

2013-07-09  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-directory-name): Handle fallback.
	(ido-read-file-name): Update DIR to ido-current-directory.
	(Bug#1516)
	(ido-add-virtual-buffers-to-list): Robustify.  (Bug#14552)

2013-07-09  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Remove extra
	"autoload".  Remove "warn lower camel case" section, previously
	commented out.  Highlight negation char.  Do not highlight the
	target in singleton method definitions.

2013-07-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* faces.el (tty-setup-hook): Declare the hook.

	* emacs-lisp/pcase.el (pcase--split-pred): Add `vars' argument to try
	and detect when a guard/pred depends on local vars (bug#14773).
	(pcase--u1): Adjust caller.

2013-07-08  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial, line-move): Account for
	line-spacing.
	(line-move-partial): Avoid setting vscroll when the last
	partially-visible line in window is of default height.

2013-07-08  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-map): Reinstate the `u' key binding, since it's
	been used a while.

2013-07-07  Juanma Barranquero  <lekktu@gmail.com>

	* subr.el (read-quoted-char): Remove unused local variable `char'.

2013-07-07  Michael Kifer  <kifer@cs.stonybrook.edu>

	* ediff.el (ediff-version): Version update.
	(ediff-files-command, ediff3-files-command, ediff-merge-command)
	(ediff-merge-with-ancestor-command, ediff-directories-command)
	(ediff-directories3-command, ediff-merge-directories-command)
	(ediff-merge-directories-with-ancestor-command): New functions.
	All are command-line interfaces to ediff: to facilitate calling
	Emacs with the appropriate ediff functions invoked.

	* viper-cmd.el (viper-del-forward-char-in-insert): New function.
	(viper-save-kill-buffer): Check if buffer is modified.

	* viper.el (viper-version): Version update.
	(viper-emacs-state-mode-list): Add egg-status-buffer-mode.

2013-07-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* faces.el (tty-run-terminal-initialization): Run new tty-setup-hook.
	* viper-cmd.el (viper-envelop-ESC-key): Remove function.
	(viper-intercept-ESC-key): Simplify.
	* viper-keym.el (viper-ESC-key): Make it a constant, don't use kbd.
	* viper.el (viper--tty-ESC-filter, viper--lookup-key)
	(viper-catch-tty-ESC, viper-uncatch-tty-ESC)
	(viper-setup-ESC-to-escape): New functions.
	(viper-go-away, viper-set-hooks): Call viper-setup-ESC-to-escape.
	(viper-set-hooks): Do not modify flyspell-mode-hook.  (Bug#13793)

2013-07-07  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (default-font-height, window-screen-lines):
	New functions.
	(line-move, line-move-partial): Use them instead of
	frame-char-height and window-text-height.  This makes scrolling
	text smoother when the buffer's default face uses a font that is
	different from the frame's default font.

2013-07-06  Jan Djärv  <jan.h.d@swipnet.se>

	* files.el (write-file): Do not display confirm dialog for NS,
	it does its own dialog, which can't be cancelled (Bug#14578).

2013-07-06  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial): Adjust the row returned by
	posn-at-point for the current window-vscroll.  (Bug#14567)

2013-07-06  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-file-gvfs-monitor-dir-process-filter):
	(tramp-sh-file-inotifywait-process-filter): Handle file names with
	spaces.

2013-07-06  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window-state-put-stale-windows): New variable.
	(window--state-put-2): Save list of windows without matching buffer.
	(window-state-put): Remove "bufferless" windows if possible.

2013-07-06  Juanma Barranquero  <lekktu@gmail.com>

	* simple.el (alternatives-define): Remove leftover :group keyword.
	Tweak docstring.

2013-07-06  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-use-virtual-buffers): Allow new value 'auto.
	(ido-enable-virtual-buffers): New variable.
	(ido-buffer-internal, ido-toggle-virtual-buffers)
	(ido-make-buffer-list): Use it.
	(ido-exhibit): Support turning on and off virtual buffers
	automatically.

2013-07-06  Juanma Barranquero  <lekktu@gmail.com>

	* simple.el (alternatives-define): New macro.

2013-07-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (read-quoted-char): Use read-key.
	(sit-for): Let read-event decode tty input (bug#14782).

2013-07-05  Stephen Berman  <stephen.berman@gmx.net>

	* calendar/todo-mode.el: Add handling of file deletion, both by
	mode command and externally.  Fix various related bugs.
	Clarify Commentary and improve some documentation strings and code.
	(todo-delete-file): New command.
	(todo-check-file): New function.
	(todo-show): Handle external deletion of the file we're trying to
	show (bug#14688).  Replace called-interactively-p by an optional
	prefix argument to avoid problematic interaction with catch form
	when byte compiled (bug#14702).
	(todo-quit): Handle external deletion of the archive's todo file.
	Make sure the buffer that was visiting the archive file is still
	live before trying to bury it.
	(todo-category-completions): Handle external deletion of any
	category completion files.
	(todo-jump-to-category, todo-basic-insert-item): Recalculate list
	of todo files, in case of external deletion.
	(todo-add-file): Replace unnecessary setq by let-binding.
	(todo-find-archive): Check whether there are any archives.
	Replace unnecessary setq by let-binding.
	(todo-archive-done-item): Use find-file-noselect to get the
	archive buffer whether or not the archive already exists.
	Remove superfluous code.  Use file size instead of buffer-file-name to
	check if the archive is new; if it is, update list of archives.
	(todo-default-todo-file): Allow nil to be a valid value for when
	there are no todo files.
	(todo-reevaluate-default-file-defcustom): Use corrected definition
	of todo-default-todo-file.
	(todo-key-bindings-t+a+f): Add key binding for todo-delete-file.
	(todo-delete-category, todo-show-categories-table)
	(todo-category-number): Clarify comment.
	(todo-filter-items): Clarify documentation string.
	(todo-show-current-file, todo-display-as-todo-file)
	(todo-reset-and-enable-done-separator): Tweak documentation string.
	(todo-done-separator): Make separator length window-width, since
	bug#2749 is now fixed.

2013-07-05  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-file-notify-add-watch):
	Support both "gvfs-monitor-dir" and "inotifywait".
	(tramp-sh-file-inotifywait-process-filter): Rename from
	`tramp-sh-file-notify-process-filter'.
	(tramp-sh-file-gvfs-monitor-dir-process-filter)
	(tramp-get-remote-gvfs-monitor-dir): New defuns.

2013-07-05  Leo Liu  <sdl.web@gmail.com>

	* autoinsert.el (auto-insert-alist): Default to lexical-binding.

2013-07-04  YAMAMOTO Mitsuharu  <mituharu@math.s.chiba-u.ac.jp>

	* frame.el (display-pixel-height, display-pixel-width)
	(display-mm-height, display-mm-width): Mention behavior on
	multi-monitor setups in docstrings.
	(w32-display-monitor-attributes-list): Declare function.
	(display-monitor-attributes-list): Use it.

2013-07-04  Michael Albinus  <michael.albinus@gmx.de>

	* filenotify.el: New package.

	* autorevert.el (top): Require filenotify.el.
	(auto-revert-notify-enabled): Remove.  Use `file-notify-support'
	instead.
	(auto-revert-notify-rm-watch, auto-revert-notify-add-watch)
	(auto-revert-notify-handler): Use `file-notify-*' functions.

	* subr.el (file-notify-handle-event): Move function to filenotify.el.

	* net/tramp.el (tramp-file-name-for-operation):
	Handle `file-notify-add-watch' and `file-notify-rm-watch'.

	* net/tramp-sh.el (tramp-sh-file-name-handler-alist): Add handler
	for `file-notify-add-watch' and `file-notify-rm-watch'.
	(tramp-process-sentinel): Improve trace.
	(tramp-sh-handle-file-notify-add-watch)
	(tramp-sh-file-notify-process-filter)
	(tramp-sh-handle-file-notify-rm-watch)
	(tramp-get-remote-inotifywait): New defuns.

2013-07-03  Juri Linkov  <juri@jurta.org>

	* buff-menu.el (Buffer-menu-multi-occur): Add args and move the
	call of `occur-read-primary-args' to interactive spec.

	* ibuffer.el (ibuffer-mode-map): Bind "M-s a C-o" to
	`ibuffer-do-occur' like in buff-menu.el.  (Bug#14673)

2013-07-03  Matthias Meulien  <orontee@gmail.com>

	* buff-menu.el (Buffer-menu-mode-map): Bind "M-s a C-o" to
	`Buffer-menu-multi-occur'.  Add it to the menu.
	(Buffer-menu-mode): Document it in docstring.
	(Buffer-menu-multi-occur): New command.  (Bug#14673)

2013-07-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Highlight more
	keywords and built-ins.

2013-07-03  Glenn Morris  <rgm@gnu.org>

	* subr.el (y-or-n-p): Handle empty prompts.  (Bug#14770)

	Make info-xref checks case-sensitive by default
	* info.el (Info-find-node, Info-find-in-tag-table)
	(Info-find-node-in-buffer, Info-find-node-2, Info-goto-node):
	Add option for exact case matching of nodes.
	* info-xref.el (info-xref): New custom group.
	(info-xref-case-fold): New option.
	(info-xref-goto-node-p): Pass info-xref-case-fold to Info-goto-node.

2013-07-03  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-delete-file-at-head): Respect delete-by-moving-to-trash.

2013-07-03  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-move-to-block): When we're at a
	middle of block statement initially, lower the depth.  Remove
	FIXME comment, not longer valid.  Remove middle of block statement
	detection, no need to do that anymore since we've been using
	`ruby-parse-region' here.

2013-07-02  Jan Djärv  <jan.h.d@swipnet.se>

	* term/ns-win.el (display-format-alist): Use .* (Bug#14765).

2013-07-01  Katsumi Yamaoka  <yamaoka@jpl.org>

	* wid-edit.el (widget-default-get): Don't modify widget (Bug#14738).

2013-07-01  Juanma Barranquero  <lekktu@gmail.com>

	* desktop.el (desktop-restore-frames): Rename from desktop-save-windows.
	(desktop-restore-in-current-display): New customization option.
	(desktop--excluded-frame-parameters): Add `font'.
	(desktop--save-frames): Rename from desktop--save-windows.
	(desktop--restore-in-this-display-p): New function.
	(desktop--make-full-frame): Remove unwanted width/height from
	full(width|height) frames.
	(desktop--restore-frames): Rename from desktop--restore-windows.
	Obey desktop-restore-current-display.  Do not delete old frames or
	select a new frame unless we were able to restore at least one frame.

2013-06-30  Michal Nazarewicz  <mina86@mina86.com>

	* files.el (find-file-noselect): Simplify conditional expression.

	* remember.el (remember-append-to-file):
	Don't mix `find-buffer-visiting' and `get-file-buffer'.

	Add `remember-notes' function to store random notes across Emacs
	restarts.
	* remember.el (remember-data-file): Add :set callback to affect
	notes buffer (if any).
	(remember-notes): New command.
	(remember-notes-buffer-name, bury-remember-notes-on-kill):
	New defcustoms for the `remember-notes' function.
	(remember-notes-save-and-bury-buffer): New command.
	(remember-notes-mode-map): New variable.
	(remember-mode): New minor mode.
	(remember-notes--kill-buffer-query): New function.
	* startup.el (initial-buffer-choice): Add notes to custom type.

2013-06-30  Eli Zaretskii  <eliz@gnu.org>

	* bindings.el (right-char, left-char): Don't call sit-for, this is
	no longer needed.  Use arithmetic comparison only for numerical
	arguments.

	* international/mule-cmds.el (select-safe-coding-system):
	Handle the case of FROM being a string correctly.  (Bug#14755)

2013-06-30  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-make-table-1): Add a sanity check that allows
	progression on degenerate tables.
	(shr-rescale-image): ImageMagick animated images currently don't work.

2013-06-30  Juanma Barranquero  <lekktu@gmail.com>

	Some fixes and improvements for desktop frame restoration.
	It is still experimental and disabled by default.
	* desktop.el (desktop--save-windows): Put the selected frame at
	the head of the list.
	(desktop--make-full-frame): New function.
	(desktop--restore-windows): Try to re-select the frame that was
	selected upon saving.  Do not abort if some frames fail to restore,
	just show an error message and continue.  Set up maximized frames
	so they have default non-maximized dimensions.

2013-06-30  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-propertize-function):
	Don't start heredoc inside a string or comment.

2013-06-29  Eli Zaretskii  <eliz@gnu.org>

	* bindings.el (visual-order-cursor-movement): New defcustom.
	(right-char, left-char): Provide visual-order cursor motion by
	calling move-point-visually.  Update the doc strings.

2013-06-28  Kenichi Handa  <handa@gnu.org>

	* international/mule.el (define-coding-system): New coding system
	properties :inhibit-null-byte-detection,
	:inhibit-iso-escape-detection, and :prefer-utf-8.
	(set-buffer-file-coding-system): If :charset-list property of
	CODING-SYSTEM is `emacs', do not check if CODING-SYSTEM is
	appropriate for setting.

	* international/mule-cmds.el (select-safe-coding-system):
	If DEFAULT-CODING-SYSTEM is prefer-utf-8 and the buffer contains
	multibyte characters, return utf-8 (or one of its siblings).

	* international/mule-conf.el (prefer-utf-8): New coding system.
	(file-coding-system-alist): Use prefer-utf-8 as default for Elisp
	files.

2013-06-28  Ivan Kanis  <ivan@kanis.fr>

	* net/shr.el (shr-render-region): New function.

	* net/eww.el: Autoload `eww-browse-url'.

2013-06-27  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Adapt to `package-desc-version' being a list.
	Use `package--ac-desc-version' to retrieve version from a package
	archive element.

2013-06-27  Juanma Barranquero  <lekktu@gmail.com>

	New experimental feature to save&restore window and frame setup.
	* desktop.el (desktop-save-windows): New defcustom.
	(desktop--saved-states): New var.
	(desktop--excluded-frame-parameters): New defconst.
	(desktop--filter-frame-parms, desktop--find-frame-in-display)
	(desktop--restore-windows, desktop--save-windows): New functions.
	(desktop-save): Call `desktop--save-windows'.
	(desktop-read): Call `desktop--restore-windows'.

2013-06-27  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (add-face-text-property): Remove compat definition.

2013-06-27  Stephen Berman  <stephen.berman@gmx.net>

	* info.el (Info-try-follow-nearest-node): Move search for footnote
	above search for node name to prevent missing a footnote (bug#14717).

2013-06-27  Stephen Berman  <stephen.berman@gmx.net>

	* obsolete/otodo-mode.el: Add obsolescence info to file header.

2013-06-27  Leo Liu  <sdl.web@gmail.com>

	* net/eww.el (eww-read-bookmarks): Check file size.

2013-06-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--defalias-fset): Move advice back to
	advice--pending if newdef is nil or an autoload (bug#13820).
	(advice-mapc): New function.

2013-06-26  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-mode): Undo isn't necessary in eww buffers,
	probably.
	(eww-mode-map): Add a menu bar.
	(eww-add-bookmark): New command.
	(eww-bookmark-mode): New mode and commands.
	(eww-add-bookmark): Remove newlines from the title.
	(eww-bookmark-browse): Don't bug out if it's the only window.

2013-06-26  Glenn Morris  <rgm@gnu.org>

	* htmlfontify.el (hfy-triplet): Handle unspecified-fg, bg.
	(hfy-size): Handle ttys.  (Bug#14668)

	* info-xref.el: Update for Texinfo 5 change in *note format.
	(info-xref-node-re, info-xref-note-re): New constants.
	(info-xref-check-buffer): Use info-xref-note-re.

2013-06-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (set-variable): Use read-from-minibuffer (bug#14710).

	* emacs-lisp/package.el (package--add-to-archive-contents): Add missing
	nil terminate the loop (bug#14718).

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el: Rework history traversal.  When going forward/back,
	put these actions into the history, too, so that they can be
	replayed.
	(eww-render): Move the history reset to the correct buffer.

2013-06-25  Juri Linkov  <juri@jurta.org>

	* files-x.el (modify-dir-local-variable): Change the header comment
	in the file with directory local variables.  (Bug#14692)

	* files-x.el (read-file-local-variable-value): Add `default'.
	(Bug#14710)

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-make-unique-file-name): Create a unique file
	name before saving to entering `y' accidentally asynchronously.

2013-06-25  Ivan Kanis  <ivan@kanis.fr>

	* net/eww.el (eww-download): New command and keystroke.

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-copy-page-url): Change name of command.

	* net/shr.el (shr-map): Change `shr-copy-url' from `u' to `w' to
	be more consistent with Info and dired.

	* net/eww.el (eww-mode-map): Ditto.

2013-06-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el: Use lexical-binding.  Include obsolete
	packages from archives.
	(package-archive-contents): Change format; include obsolete packages.
	(package-desc): Use `dir' to mark builtin packages.
	(package--from-builtin): Set the `dir' field to `builtin'.
	(generated-autoload-file, version-control): Declare.
	(package-compute-transaction): Change first arg and return value to be
	lists of package-descs.  Adjust to new package-archive-contents format.
	(package--add-to-archive-contents): Adjust to new
	package-archive-contents format.
	(package-download-transaction): Arg is now a list of package-descs.
	(package-install): If `pkg' is a package name, pass it as
	a requirement, so it is subject to the usual (e.g. disabled) checks.
	(describe-package): Accept package-desc as well.
	(describe-package-1): Describe a specific package-desc.  Add links to
	other package-descs for the same package name.
	(package-menu-describe-package): Pass the actual package-desc.
	(package-menu-mode): Add to tabulated-list-revert-hook so revert-buffer
	works correctly.
	(package-desc-status): New function.
	(package-menu--refresh): New function, extracted
	from package-menu--generate.
	(package-menu--generate): Use it.
	(package-delete): Update package-alist.
	(package-menu-execute): Don't call package-initialize.

	* progmodes/idlw-toolbar.el, progmodes/idlw-shell.el,
	progmodes/idlw-help.el, progmodes/idlw-complete-structtag.el,
	progmodes/ebnf-yac.el, progmodes/ebnf-otz.el, progmodes/ebnf-iso.el,
	progmodes/ebnf-ebx.el, progmodes/ebnf-dtd.el, progmodes/ebnf-bnf.el,
	progmodes/ebnf-abn.el, emacs-lisp/package-x.el, emacs-lisp/cl-seq.el,
	emacs-lisp/cl-macs.el: Neuter the "Version:" header.

2013-06-25  Martin Rudalics  <rudalics@gmx.at>

	* window.el (window--state-get-1): Workaround for bug#14527.
	http://lists.gnu.org/archive/html/emacs-devel/2013-06/msg00941.html

2013-06-25  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-back-url): Implement the history by stashing all
	the data into a list.
	(eww-forward-url): Allow going forward in the history, too.

2013-06-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files-x.el (read-file-local-variable-value): Use read-from-minibuffer
	for values and use read--expression for expressions (bug#14710).
	(read-file-local-variable): Avoid setq.
	(read-file-local-variable-mode): Use minor-mode-list.

2013-06-25  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* textmodes/bibtex.el (bibtex-generate-url-list): Add support
	for DOI URLs.

2013-06-25  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* textmodes/bibtex.el (bibtex-mode, bibtex-set-dialect):
	Update imenu-support when dialect changes.

2013-06-25  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-internal): Allow forward slash on windows.

2013-06-24  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww): Start of strings is \\`, not ^.

2013-06-24  Ivan Kanis  <ivan@kanis.fr>

	* net/shr.el (shr-browse-url): Fix interactive spec.

	* net/eww.el (eww): Add a trailing slash to domain names.

2013-06-24  Juanma Barranquero  <lekktu@gmail.com>

	* faces.el (face-spec-recalc): Revert part of 2013-06-23T20:29:18Z!lekktu@gmail.com (bug#14705).

2013-06-24  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-browse-url): Use an external browser if given a
	prefix.

	* net/eww.el (eww-external-browser): Move to shr.

2013-06-24  Ivan Kanis  <ivan@kanis.fr>

	* net/eww.el (eww): Work more correctly for file: URLs.
	(eww-detect-charset): Allow quoted charsets.
	(eww-yank-page-url): New command and keystroke.

2013-06-24  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-make-context): Check if PROTOCOL is valid; embed the
	file name of gpg executable.
	(epg-context-program): New function.
	(epg-context-home-directory): New function.
	(epg-context-set-program): New function.
	(epg-context-set-home-directory): New function.
	(epg--start): Use `epg-context-program' instead of
	'epg-gpg-program'.
	(epg--list-keys-1): Likewise.

2013-06-24  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-read-internal): Fix bug#14620.

2013-06-23  Juanma Barranquero  <lekktu@gmail.com>

	* faces.el (face-documentation): Simplify.
	(read-face-attribute, tty-find-type, x-resolve-font-name):
	Use `string-match-p'.
	(list-faces-display): Use `string-match-p'.  Simplify.
	(face-spec-recalc): Check face to avoid face alias loops.
	(read-color): Use `string-match-p' and non-capturing parenthesis.

2013-06-23  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-rescale-image): Use the new
	:max-width/:max-height functionality.

2013-06-23  Ivan Kanis  <ivan@kanis.fr>

	* net/eww.el (eww-search-prefix): New variable.
	(eww): Use it.
	(eww-external-browser): New variable.
	(eww-mode-map): New keystroke.
	(eww-browse-with-external-browser): New command.

	* net/eww.el: Bind `C-c C-c' to "submit" in all form keymaps.

2013-06-23  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/tabulated-list.el (tabulated-list-init-header):
	Don't skip aligning the next header field when padding is 0;
	otherwise, field width is not respected unless the title is as
	wide as the field.

2013-06-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-el-version): Remove.
	(package-process-define-package): Fix inf-loop.
	(package-install): Allow symbols as arguments again.

2013-06-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords): Move `catch',
	add some more keyword-like methods.
	http://lists.gnu.org/archive/html/emacs-devel/2013-06/msg00911.html

2013-06-22  Juanma Barranquero  <lekktu@gmail.com>

	* bs.el (bs-buffer-show-mark): Make defvar-local.
	(bs-mode): Use setq-local.

	* emacs-lock.el (emacs-lock-mode, emacs-lock--old-mode)
	(emacs-lock--try-unlocking): Make defvar-local.

2013-06-22  Glenn Morris  <rgm@gnu.org>

	* play/cookie1.el (cookie-apropos): Minor simplification.

	* progmodes/gdb-mi.el (gdb-mapcar*): Remove, replace with cl-mapcar.

2013-06-22  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (auto-mode-alist): Do not use
	`regexp-opt', it breaks the build during dumping.

2013-06-21  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-font-lock-keywords):
	Highlight keyword-like methods on Kernel and Module with
	font-lock-builtin-face.
	(auto-mode-alist): Consolidate different entries into one regexp
	and add more *file-s.

2013-06-21  Stephen Berman  <stephen.berman@gmx.net>

	* obsolete/otodo-mode.el: Move and rename from calendar/todo-mode.el.

	* calendar/diary-lib.el (diary-goto-entry-function): New variable.
	(diary-entry): Use it in the action of this button type instead of
	diary-goto-entry.

	* calendar/todo-mode.el: New version.
	(todo-add-category): Append new category to end of file and give
	it the highest number, instead of putting it at the beginning and
	giving it 0.  Incorporate noninteractive functionality.
	(todo-forward-category): Adapt to 1-based category numbering.
	Allow skipping over archived categories.
	(todo-backward-category): Derive from todo-forward-category.
	(todo-backward-item, todo-forward-item): Make noninteractive and
	delegate interactive part to new commands.  Make sensitive to done items.
	(todo-categories): Make value an alist of category names and
	vectors of item counts.
	(todo-category-beg): Make a defconst.
	(todo-category-number): Use 1 instead of 0 as initial value.
	(todo-category-select): Make sensitive to overlays, optional item
	highlighting and done items.
	(todo-delete-item): Make sensitive to overlays and marked and done items.
	(todo-edit-item): Make sensitive to overlays and editing of
	date/time header optional.  Add format checks.
	(todo-edit-multiline): Rename to todo-edit-multiline-item.  Make a
	no-op if point is not on an item.  Advertise using todo-edit-quit.
	(todo-edit-mode): Make sensitive to new format, font-locking, and
	multiple todo files.
	(todo-insert-item, todo-insert-item-here): Derive from
	todo-basic-insert-item and extend functionality.
	(todo-item-end, todo-item-start): Make sensitive to done items.
	(todo-item-string): Don't return text properties.  Restore point.
	(todo-jump-to-category): Make sensitive to multiple todo files and
	todo archives.  Use extended category completion.
	(todo-lower-item, todo-raise-item): Rename to *-priority and
	derive from todo-set-item-priority.
	(todo-mode): Derive from special-mode.  Make sensitive to new
	format, font-locking and multiple todo files.  Make read-only.
	(todo-mode-map): Don't suppress digit keys, so they can supply
	prefix arguments.  Add many new key bindings.
	(todo-prefix): Insert as an overlay instead of file text.
	Change semantics from diary date expression to purely visual mark.
	(todo-print): Rename to todo-print-buffer.  Make buffer display
	features printable.  Remove option to restrict number of items
	printed.  Add option to print to file.
	(todo-print-function): Rename to todo-print-buffer-function.
	(todo-quit): Extend to handle exiting new todo modes.
	(todo-remove-item): Make sensitive to overlays.
	(todo-save): Extend to buffers of filtered items.
	(todo-show): Make sensitive to done items, multiple todo files and
	new todo modes.  Offer to convert legacy todo file before creating
	first new todo file.
	(todo-show-priorities): Rename to todo-top-priorities.
	Change semantics of value 0.
	(todo-top-priorities): Rename to todo-filter-top-priorities,
	derive from todo-filter-items and extend functionality.
	(todo-save-top-priorities): Rename to todo-save-filtered-items-buffer
	and extend functionality to other types of filtered items.
	(todo-add-item-non-interactively, todo-ask-p, todo-cat-slct)
	(todo-category-end, todo-category-sep, todo-cats, todo-cmd-back)
	(todo-cmd-done, todo-cmd-edit, todo-cmd-forw, todo-cmd-inst)
	(todo-cmd-kill, todo-cmd-lowr, todo-cmd-next, todo-cmd-prev)
	(todo-cmd-rais, todo-cmd-save, todo-completing-read, todo-cp)
	(todo-edit-mode-hook, todo-entry-prefix-function)
	(todo-entry-timestamp-initials, todo-file-do, todo-file-done)
	(todo-file-item, todo-file-top, todo-header, todo-initial-setup)
	(todo-initials, todo-insert-threshold, todo-item-string-start)
	(todo-line-string, todo-menu, todo-mode-hook)
	(todo-more-important-p, todo-previous-answer, todo-previous-line)
	(todo-print-priorities, todo-remove-separator)
	(todo-save-top-priorities-too, todo-string-count-lines)
	(todo-string-multiline-p, todo-time-string-format)
	(todo-tmp-buffer-name): Remove.
	(todo-add-file, todo-archive-done-item, todo-choose-archive)
	(todo-convert-legacy-files, todo-copy-item, todo-delete-category)
	(todo-edit-category-diary-inclusion)
	(todo-edit-category-diary-nonmarking, todo-edit-done-item-comment)
	(todo-edit-file, todo-edit-item-date-day)
	(todo-edit-item-date-day-name, todo-edit-item-date-from-calendar)
	(todo-edit-item-date-month, todo-edit-item-date-to-today)
	(todo-edit-item-date-year, todo-edit-item-diary-inclusion)
	(todo-edit-item-diary-nonmarking, todo-edit-item-header)
	(todo-edit-item-time, todo-edit-quit, todo-filter-diary-items)
	(todo-filter-diary-items-multifile, todo-filter-regexp-items)
	(todo-filter-regexp-items-multifile, todo-filter-top-priorities)
	(todo-filter-top-priorities-multifile, todo-find-archive)
	(todo-find-filtered-items-file, todo-go-to-source-item)
	(todo-insert-item-from-calendar, todo-item-done, todo-item-undone)
	(todo-jump-to-archive-category, todo-lower-category)
	(todo-mark-category, todo-marked-item-p, todo-merge-category)
	(todo-move-category, todo-move-item, todo-next-button)
	(todo-next-item, todo-padded-string, todo-powerset)
	(todo-previous-button, todo-previous-item)
	(todo-print-buffer-to-file, todo-raise-category)
	(todo-rename-category, todo-repair-categories-sexp, todo-search)
	(todo-set-category-number, todo-set-item-priority)
	(todo-set-top-priorities-in-category)
	(todo-set-top-priorities-in-file, todo-show-categories-table)
	(todo-sort-categories-alphabetically-or-numerically)
	(todo-sort-categories-by-archived, todo-sort-categories-by-diary)
	(todo-sort-categories-by-done, todo-sort-categories-by-todo)
	(todo-toggle-item-header, todo-toggle-item-highlighting)
	(todo-toggle-mark-item, todo-toggle-prefix-numbers)
	(todo-toggle-view-done-items, todo-toggle-view-done-only)
	(todo-unarchive-items, todo-unmark-category): New commands.
	(todo-absolute-file-name, todo-add-to-buffer-list)
	(todo-adjusted-category-label-length, todo-basic-edit-item-header)
	(todo-basic-insert-item, todo-category-completions)
	(todo-category-number, todo-category-string-matcher-1)
	(todo-category-string-matcher-2, todo-check-filtered-items-file)
	(todo-check-format, todo-clear-matches)
	(todo-comment-string-matcher, todo-convert-legacy-date-time)
	(todo-current-category, todo-date-string-matcher)
	(todo-define-insertion-command, todo-diary-expired-matcher)
	(todo-diary-goto-entry, todo-diary-item-p)
	(todo-diary-nonmarking-matcher, todo-display-as-todo-file)
	(todo-display-categories, todo-display-sorted, todo-done-item-p)
	(todo-done-item-section-p, todo-done-separator)
	(todo-done-string-matcher, todo-files, todo-filter-items)
	(todo-filter-items-1, todo-filter-items-filename, todo-find-item)
	(todo-gen-arglists, todo-get-count, todo-get-overlay, todo-indent)
	(todo-insert-category-line, todo-insert-item-from-calendar)
	(todo-insert-sort-button, todo-insert-with-overlays)
	(todo-insertion-command-name, todo-insertion-key-bindings)
	(todo-label-to-key, todo-longest-category-name-length)
	(todo-make-categories-list, todo-mode-external-set)
	(todo-mode-line-control, todo-modes-set-1, todo-modes-set-2)
	(todo-modes-set-3, todo-multiple-filter-files)
	(todo-nondiary-marker-matcher, todo-prefix-overlays)
	(todo-read-category, todo-read-date, todo-read-dayname)
	(todo-read-file-name, todo-read-time)
	(todo-reevaluate-category-completions-files-defcustom)
	(todo-reevaluate-default-file-defcustom)
	(todo-reevaluate-filelist-defcustoms)
	(todo-reevaluate-filter-files-defcustom)
	(todo-reset-and-enable-done-separator, todo-reset-comment-string)
	(todo-reset-done-separator, todo-reset-done-separator-string)
	(todo-reset-done-string, todo-reset-global-current-todo-file)
	(todo-reset-highlight-item, todo-reset-nondiary-marker)
	(todo-reset-prefix, todo-set-categories)
	(todo-set-date-from-calendar, todo-set-show-current-file)
	(todo-set-top-priorities, todo-short-file-name)
	(todo-show-current-file, todo-sort, todo-time-string-matcher)
	(todo-total-item-counts, todo-update-buffer-list)
	(todo-update-categories-display, todo-update-categories-sexp)
	(todo-update-count, todo-validate-name, todo-y-or-n-p):
	New functions.
	(todo-archive-mode, todo-categories-mode, todo-filtered-items-mode):
	New major modes.
	(todo-categories, todo-display, todo-edit, todo-faces)
	(todo-filtered): New defgroups.
	(todo-archived-only, todo-button, todo-category-string, todo-date)
	(todo-diary-expired, todo-done, todo-done-sep, todo-comment)
	(todo-mark, todo-nondiary, todo-prefix-string, todo-search)
	(todo-sorted-column, todo-time, todo-top-priority): New deffaces.
	(todo-add-item-if-new-category, todo-always-add-time-string)
	(todo-categories-align, todo-categories-archived-label)
	(todo-categories-category-label, todo-categories-diary-label)
	(todo-categories-done-label, todo-categories-number-separator)
	(todo-categories-todo-label, todo-categories-totals-label)
	(todo-category-completions-files, todo-completion-ignore-case)
	(todo-default-todo-file, todo-diary-nonmarking, todo-directory)
	(todo-done-separator-string, todo-done-string)
	(todo-files-function, todo-filter-done-items, todo-filter-files)
	(todo-highlight-item, todo-include-in-diary, todo-indent-to-here)
	(todo-initial-category, todo-initial-file, todo-item-mark)
	(todo-legacy-date-time-regexp, todo-mode-line-function)
	(todo-nondiary-marker, todo-number-prefix)
	(todo-print-buffer-function, todo-show-current-file)
	(todo-show-done-only, todo-show-first, todo-show-with-done)
	(todo-skip-archived-categories, todo-top-priorities-overrides)
	(todo-undo-item-omit-comment, todo-use-only-highlighted-region)
	(todo-visit-files-commands, todo-wrap-lines, todo-y-with-space):
	New defcustoms.
	(todo-category-done, todo-date-pattern, todo-date-string-start)
	(todo-diary-items-buffer, todo-done-string-start)
	(todo-filtered-items-buffer, todo-item-start)
	(todo-month-abbrev-array, todo-month-name-array)
	(todo-nondiary-end, todo-nondiary-start, todo-regexp-items-buffer)
	(todo-top-priorities-buffer): New defconsts.
	(todo-archive-mode-map, todo-archives, todo-categories-mode-map)
	(todo-categories-with-marks, todo-category-string-face)
	(todo-comment-face, todo-comment-string, todo-current-todo-file)
	(todo-date-face, todo-date-from-calendar, todo-descending-counts)
	(todo-diary-expired-face, todo-done-face, todo-done-sep-face)
	(todo-done-separator, todo-edit-buffer, todo-edit-mode-map)
	(todo-file-buffers, todo-files, todo-filtered-items-mode-map)
	(todo-font-lock-keywords, todo-global-current-todo-file)
	(todo-insertion-commands, todo-insertion-commands-arg-key-list)
	(todo-insertion-commands-args)
	(todo-insertion-commands-args-genlist)
	(todo-insertion-commands-names, todo-insertion-map)
	(todo-key-bindings-t, todo-key-bindings-t+a)
	(todo-key-bindings-t+a+f, todo-key-bindings-t+f, todo-mode-map)
	(todo-multiple-filter-files, todo-multiple-filter-files-widget)
	(todo-nondiary-face, todo-print-buffer, todo-time-face)
	(todo-visited): New variables.

2013-06-21  Glenn Morris  <rgm@gnu.org>

	* play/cookie1.el (cookie-apropos): Add optional display argument.
	* obsolete/yow.el (apropos-zippy): Use cookie-apropos.
	(psychoanalyze-pinhead): Use cookie-doctor.

2013-06-21  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/package.el (tar-get-file-descriptor)
	(tar--extract): Declare.

2013-06-21  Eduard Wiebe  <usenet@pusto.de>

	Extend flymake's warning predicate to be a function (bug#14217).
	* progmodes/flymake.el (flymake-warning-predicate): New.
	(flymake-parse-line): Use it.
	(flymake-warning-re): Make obsolete alias to
	`flymake-warning-predicate'.

2013-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-alist): Include obsolete packages.
	(package-obsolete-list): Remove.
	(package-activate): Remove min-version argument.  Add `force' argument.
	Adjust to new package-alist format.
	(package-mark-obsolete): Remove.
	(package-unpack): Force reload of the package's autoloads.
	(package-installed-p): Check builtins if the installed package is not
	recent enough.
	(package-initialize): Don't reset package-obsolete-list.
	Don't specify which package version to activate.
	(package-process-define-package, describe-package-1)
	(package-menu--generate): Adjust to new package-alist format.

2013-06-21  Juanma Barranquero  <lekktu@gmail.com>

	* allout-widgets.el (allout-widgets-mode-off)
	(allout-widgets-mode-on, allout-widgets-pre-command-business)
	(allout-widgets-post-command-business)
	(allout-widgets-after-copy-or-kill-function)
	(allout-widgets-after-undo-function, allout-test-range-overlaps)
	(allout-decorate-item-and-context)
	(allout-graphics-modification-handler): Fix typos in docstrings.
	(allout-get-or-create-parent-widget): Use `looking-at-p'.

	* cmuscheme.el (scheme-start-file): Doc fix.
	(inferior-scheme-mode, switch-to-scheme): Fix typos in docstrings.
	(scheme-input-filter): Use `string-match-p'.

	* composite.el (compose-gstring-for-terminal): Fix typo in docstring.

	* dired-x.el: Use Dired consistently in docstrings.

	* dired.el: Use Dired consistently in docstrings.
	(dired-readin, dired-mode): Use `setq-local'.
	(dired-switches-alist): Make defvar-local.
	(dired-buffers-for-dir): Use `zerop'.
	(dired-safe-switches-p, dired-switches-escape-p)
	(dired-insert-old-subdirs, dired-move-to-end-of-filename)
	(dired-glob-regexp, dired-in-this-tree, dired-goto-file-1)
	(dired-sort-set-mode-line, dired-sort-toggle, dired-sort-R-check):
	(dired-goto-next-nontrivial-file): Use `string-match-p'.
	(dired-align-file, dired-insert-directory, dired-mark-files-in-region)
	(dired-toggle-marks, dired-mark-files-containing-regexp)
	(dired-mark-symlinks, dired-mark-directories, dired-mark-executables)
	(dired-flag-auto-save-files, dired-flag-backup-files):
	Use `looking-at-p'.
	(dired-mark-files-regexp, dired-build-subdir-alist):
	Use `string-match-p', `looking-at-p'.

	* dos-w32.el (untranslated-canonical-name, untranslated-file-p)
	(direct-print-region-helper): Use `string-match-p'.

2013-06-21  Leo Liu  <sdl.web@gmail.com>

	* comint.el (comint-redirect-results-list-from-process):
	Fix infinite loop.

2013-06-21  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-update-header-line-format): Quote % characters.

2013-06-21  Glenn Morris  <rgm@gnu.org>

	* play/cookie1.el (cookie): New custom group.
	(cookie-file): New option.
	(cookie-check-file): New function.
	(cookie): Make it interactive.  Make start and end messages optional.
	Interactively, display the result.  Default to cookie-file.
	(cookie-insert): Default to cookie-file.
	(cookie-snarf): Make start and end messages optional.
	Default to cookie-file.  Use with-temp-buffer.
	(cookie-read): Rename from read-cookie.
	Make start and end messages optional.  Default to cookie-file.
	(cookie-shuffle-vector): Rename from shuffle-vector.  Use dotimes.
	Do not autoload it.
	(cookie-apropos, cookie-doctor): New functions, copied from yow.el
	* obsolete/yow.el (read-zippyism): Use new name for read-cookie.

2013-06-21  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode): Backward compatibility fix.

2013-06-21  Glenn Morris  <rgm@gnu.org>

	* font-lock.el (lisp-font-lock-keywords-2): Add with-eval-after-load.

2013-06-21  Stefan Monnier  <monnier@iro.umontreal.ca>
	    Daniel Hackney  <dan@haxney.org>

	* emacs-lisp/package.el: Use tar-mode rather than tar executable.
	Consolidate the single-file vs tarball code.
	(package-desc-suffix): New function.
	(package-desc-full-name): Don't bother inlining it.
	(package-load-descriptor): Return the new package-desc.
	(package-mark-obsolete): Remove unused arg `package'.
	(package-unpack): Make it work for single files as well.
	Make it update package-alist.
	(package--make-autoloads-and-stuff): Rename from
	package--make-autoloads-and-compile.  Don't compile any more.
	(package--compile): New function.
	(package-generate-description-file): New function, extracted from
	package-unpack-single.
	(package-unpack-single): Remove.
	(package--with-work-buffer): Add indentation and debugging info.
	(package-download-single): Remove.
	(package-install-from-archive): Rename from package-download-tar, make
	it take a pkg-desc, and make it work for single files as well.
	(package-download-transaction): Simplify.
	(package-tar-file-info): Remove `file' arg.  Rewrite not to use an
	external tar program.
	(package-install-from-buffer): Remove `pkg-desc' argument.
	Use package-tar-file-info for tar-mode buffers.
	(package-install-file): Simplify accordingly.
	(package-archive-base): Change to take a pkg-desc.
	* tar-mode.el (tar--check-descriptor): New function, extracted from
	tar-get-descriptor.
	(tar-get-descriptor): Use it.
	(tar-get-file-descriptor): New function.
	(tar--extract): New function, extracted from tar-extract.
	(tar--extract): Use it.
	* emacs-lisp/package-x.el (package-upload-file): Decode the file, in
	case the summary uses non-ascii.  Adjust to new calling convention of
	package-tar-file-info.

2013-06-21  Leo Liu  <sdl.web@gmail.com>

	* comint.el (comint-redirect-results-list-from-process):
	Fix random delay.  (Bug#14681)

2013-06-21  Juanma Barranquero  <lekktu@gmail.com>

	* profiler.el (profiler-format-number): Use log, not log10.

2013-06-20  Juanma Barranquero  <lekktu@gmail.com>

	* term/x-win.el (emacs-session-filename): Use `locate-user-emacs-file'.

2013-06-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-loaddefs.el: Don't version-control any more.
	* emacs-lisp/cl-lib.el: Load cl-macs when cl-loaddefs is not
	yet available.
	* Makefile.in (AUTOGEN_VCS): Move cl-loaddefs.el...
	(AUTOGENEL): ... here.
	* emacs-lisp/cl-macs.el (cl--sublis): New function.
	(cl--defsubst-expand): Use it.

2013-06-20  Paul Eggert  <eggert@cs.ucla.edu>

	* subr.el (log10): Move here from C code, and declare as obsolete.
	All uses of (log10 X) replaced with (log X 10).

2013-06-20  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/tabulated-list.el (tabulated-list-format): Fix typo.
	Declare with `defvar-local'.
	(tabulated-list-use-header-line, tabulated-list-entries)
	(tabulated-list-padding, tabulated-list-printer)
	(tabulated-list-sort-key): Declare with `defvar-local'.
	(tabulated-list-init-header, tabulated-list-print-fake-header):
	Use `setq-local'.

2013-06-20  Michael Albinus  <michael.albinus@gmx.de>

	* arc-mode.el (archive-mode): Add `archive-write-file' to
	`write-contents-functions' also for remote files.  (Bug#14652)

2013-06-20  Juanma Barranquero  <lekktu@gmail.com>

	* cus-edit.el (custom-commands): Fix typos.
	(custom-display): Fix tooltip text.
	(custom-magic-alist, custom-filter-face-spec, custom-group-members):
	Fix typos in docstrings.
	(custom--initialize-widget-variables, Custom-mode): Use `setq-local'.
	(custom-unlispify-menu-entry, custom-magic-value-create)
	(custom-add-see-also, custom-group-value-create): Use ?\s.
	(custom-guess-type, customize-apropos, editable-field)
	(custom-face-value-create): Use `string-match-p'.
	(custom-save-variables, custom-save-faces): Use `looking-at-p'.

	* custom.el (custom-load-symbol): Use `string-match-p'.

	* ansi-color.el: Convert to lexical binding.
	(ansi-colors): Fix URL.
	(ansi-color-context, ansi-color-context-region): Use defvar-local.
	(ansi-color-apply-sequence, ansi-color-map): Fix typos in docstrings.
	(ansi-color-make-color-map): Rename local var ansi-color-map to map.

2013-06-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el (eww-process-text-input): Display passwords as asterisks.

	* net/shr.el (shr-make-table-1): Protect against invalid column-spans.

2013-06-19  Tom Tromey  <tromey@redhat.com>

	* net/eww.el (eww-top-url): Remove.
	(eww-home-url, eww-start-url, eww-contents-url): New defvars.
	(eww-render): Set new variables.  Don't set eww-top-url.
	(eww-handle-link): Handle "prev", "home", and "contents".
	Downcase the rel text.
	(eww-top-url): Choose best top URL.

2013-06-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/eww.el: Rewrite to implement form elements "by hand" instead of
	relying in widget.el.  Using widget.el leads to too many
	user interface inconsistencies.
	(eww-self-insert): Implement entering commands in text fields.
	(eww-process-text-input): New function to make text input field editing
	work.
	(eww-submit): Rewrite to use the new-style form methods.
	(eww-select-display): Display the correct selected item.
	(eww-change-select): Implement changing the select value.
	(eww-toggle-checkbox): Implement radio/checkboxes.
	(eww-update-field): Fix compilation error.
	(eww-tag-textarea): Implement <textarea>.

	* net/shr.el (shr-urlify): Use `keymap' instead of `local-map' so that
	we don't shadow mode-specific bindings.

	* net/eww.el (eww-browse-url): Don't push stuff onto history if there's
	nothing to push.

	* net/shr.el (shr-map): Bind [down-mouse-1] to browse URLs.

2013-06-19  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/eieio.el (defclass): Make it eval-and-compile once more.

2013-06-19  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el (tramp-adb-get-toolbox): Remove function, it is
	not needed.

	* net/tramp-sh.el (tramp-find-shell): Don't set "busybox" property.

2013-06-19  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/browse-url.el (browse-url-browser-function):
	`eww-browse-url' has the right calling signature, `eww' does not.

2013-06-19  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-file-form-autoload):
	Only eval autoloaded macros.
	(byte-compile-autoload): Only give the macro warning for macros.

	* progmodes/cperl-mode.el (ps-bold-faces, ps-italic-faces)
	(ps-underlined-faces): Declare.

	* progmodes/idlwave.el (func-menu): Only set it up on XEmacs.
	(speedbar-add-supported-extension): Declare.

	* international/titdic-cnv.el (tit-process-header, miscdic-convert):
	Don't include a date stamp in the header of the generated file;
	it leads to needless differences between output files.

2013-06-19  Michael Albinus  <michael.albinus@gmx.de>

	* net/secrets.el (secrets-struct-secret-content-type):
	Replace check of introspection data by a test call of "CreateItem".
	Some servers do not offer introspection.

2013-06-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-pair-mode): Improve interaction with
	electric-layout-mode.
	(electric-pair-default-inhibit): Don't assume (eq char (char-before)).
	(electric-pair-syntax): Use text-mode-syntax-table in comments
	and strings.
	(electric-pair--insert): New function.
	(electric-pair-post-self-insert-function): Use it and
	electric--after-char-pos.

2013-06-19  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-help): Fix regexp.

2013-06-18  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/shr.el (shr-make-table-1): Implement <td rowspan>.
	(shr-table-horizontal-line): Allow nil as a value, and change the
	default.
	(shr-insert-table-ruler): Respect the nil value.

2013-06-18  Tom Tromey  <tromey@barimba>

	* net/eww.el (eww-next-url, eww-previous-url, eww-up-url, eww-top-url):
	New defvars.
	(eww-open-file): New defun.
	(eww-render): Initialize new variables.
	(eww-display-html): Handle "link" and "a".
	(eww-handle-link, eww-tag-link, eww-tag-a): New defuns.
	(eww-mode-map): Move "p" to "l".  Bind "p", "n", "t", and "u".
	(eww-back-url): Rename from eww-previous-url.
	(eww-next-url, eww-previous-url, eww-up-url, eww-top-url):
	New defuns.

2013-06-18  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-before-regexp-re):
	Distinguish ternary operator tokens from slash symbol and slash
	char literal.

2013-06-18  Juanma Barranquero  <lekktu@gmail.com>

	Convert symbol prettification into minor mode and global minor mode.

	* progmodes/prog-mode.el (prettify-symbols-alist): Rename from
	`prog-prettify-symbols', and make a local defvar instead of defcustom.
	(prettify-symbols--keywords): Rename from
	`prog-prettify-symbols-alist' and make a local defvar.
	(prettify-symbols--compose-symbol): Rename from
	`prog--prettify-font-lock-compose-symbol'.
	(prettify-symbols--make-keywords): Rename from
	`prog-prettify-font-lock-symbols-keywords' and simplify.
	(prog-prettify-install): Remove.
	(prettify-symbols-mode): New minor mode, based on
	`prog-prettify-install'.
	(turn-on-prettify-symbols-mode): New function.
	(global-prettify-symbols-mode): New globalized minor mode.

	* emacs-lisp/lisp-mode.el (lisp-mode-variables):
	* progmodes/cfengine.el (cfengine3-mode):
	* progmodes/perl-mode.el (perl-mode): Don't call
	`prog-prettify-install'; set `prettify-symbols-alist' instead.

2013-06-18  Juri Linkov  <juri@jurta.org>

	* files-x.el (modify-file-local-variable-message): New function.
	(modify-file-local-variable)
	(modify-file-local-variable-prop-line): Add arg INTERACTIVE
	and call `modify-file-local-variable-message' when it's non-nil.
	(add-file-local-variable, delete-file-local-variable)
	(add-file-local-variable-prop-line)
	(delete-file-local-variable-prop-line): Add arg INTERACTIVE
	and use it.  (Bug#9820)

2013-06-18  Juri Linkov  <juri@jurta.org>

	* emulation/vi.el (vi-shell-op):
	* emulation/vip.el (vip-execute-com, ex-command):
	* emulation/viper-cmd.el (viper-exec-bang):
	* emulation/viper-ex.el (ex-command): Add non-nil arg REPLACE to
	the call of `shell-command-on-region'.  (Bug#14637)

	* simple.el (shell-command-on-region): Doc fix.

2013-06-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/eieio-custom.el: Remove misleading Version: header
	(bug#14633).

2013-06-18  Glenn Morris  <rgm@gnu.org>

	* net/eww.el, net/shr.el, net/shr-color.el: Move here from gnus/.

	* newcomment.el (comment-search-forward, comment-search-backward):
	Doc fix.  (Bug#14376)

2013-06-18  Juanma Barranquero  <lekktu@gmail.com>

	* face-remap.el (buffer-face-toggle): Fix typo in docstring.
	(buffer-face-mode-invoke): Doc fix.

2013-06-18  Matthias Meulien  <orontee@gmail.com>

	* tabify.el (untabify, tabify): With prefix, apply to entire buffer.
	<http://lists.gnu.org/archive/html/emacs-devel/2013-03/msg00545.html>

2013-06-18  Glenn Morris  <rgm@gnu.org>

	* generic-x.el (bat-generic-mode, rc-generic-mode, rul-generic-mode):
	Replace obsolete function generic-make-keywords with its expansion.

	* progmodes/python.el (ffap-alist): Declare.

	* textmodes/reftex.el (bibtex-mode-map): Declare.

2013-06-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el: Update package-alist after install (bug#14632).
	(package-unpack, package-unpack-single): Return the pkg-dir.
	(package-download-transaction): Use it to update package-alist.

2013-06-17  Lars Magne Ingebrigtsen  <larsi@gnus.org>

	* net/browse-url.el (browse-url-browser-function): Add `eww' as a
	possible choice.

2013-06-17  Juri Linkov  <juri@jurta.org>

	* net/webjump.el (webjump-sample-sites): Add DuckDuckGo.

2013-06-17  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-load-descriptor):
	Remove `with-syntax-table' call, `read' doesn't need it.
	http://lists.gnu.org/archive/html/emacs-devel/2013-06/msg00539.html

2013-06-17  Juanma Barranquero  <lekktu@gmail.com>

	* startup.el (command-line): Expand package name returned by
	`package--description-file' (bug#14639).

2013-06-17  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/package.el (package-load-descriptor): Do not call
	`emacs-lisp-mode', just use its syntax table.

2013-06-17  Juanma Barranquero  <lekktu@gmail.com>

	* progmodes/prog-mode.el (prog-prettify-install): Add `composition' to
	`font-lock-extra-managed-props' if any prettifying keyword is added.
	(prog--prettify-font-lock-compose-symbol): Use ?\s instead of ?\ .
	(prog-mode): Use `setq-local'.

2013-06-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/characters.el (standard-case-table): Set syntax of ?»
	and ?« to punctuation.

2013-06-16  Juanma Barranquero  <lekktu@gmail.com>

	* progmodes/prog-mode.el (prog--prettify-font-lock-compose-symbol):
	Save relevant match data before calling `syntax-ppss' (bug#14595).

2013-06-15  Juri Linkov  <juri@jurta.org>

	* files-x.el (modify-file-local-variable-prop-line): Add local
	variables to the end of the existing comment on the first line.
	Use `file-auto-mode-skip' to skip interpreter magic line,
	and also skip XML declaration.

2013-06-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* startup.el (package--builtin-versions): New var.
	(package-subdirectory-regexp): Remove.
	(package--description-file): Hard code its value instead.

	* emacs-lisp/package.el: Don't activate packages older than builtin.
	(package-obsolete-list): Rename from package-obsolete-alist, and make
	it into a simple list of package-desc.
	(package-strip-version): Remove.
	(package-built-in-p): Use package--builtin-versions.
	(package-mark-obsolete): Simplify.
	(package-process-define-package): Mark it obsolete if older than the
	builtin version.
	(package-handle-response): Use line-end-position.
	(package-read-archive-contents, package--download-one-archive):
	Simplify.
	(package--add-to-archive-contents): Skip if older than the builtin or
	installed version.
	(package-menu-describe-package): Fix last change.
	(package-list-unversioned): New var.
	(package-menu--generate): Use it.

	* emacs-lisp/autoload.el: Manage package--builtin-versions.
	(autoload--insert-text, autoload--insert-cookie-text): New functions.
	(autoload-builtin-package-versions): New variable.
	(autoload-generate-file-autoloads): Use them.
	Remove the list of autoloaded functions/macros from the
	(autoload...) comments.

	* Makefile.in (autoloads): Set autoload-builtin-package-versions.

2013-06-15  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-partial): Don't jump to the next screen
	line as soon as it becomes visible.  Instead, continue enlarging
	the vscroll until the portion of a tall screen line that's left on
	display is about the height of the frame's default font.
	(Bug#14567)

2013-06-15  Glenn Morris  <rgm@gnu.org>

	* vc/vc-dispatcher.el (vc-compilation-mode): Avoid making
	compilation-error-regexp-alist void, or local while let-bound.

	* progmodes/make-mode.el (makefile-mode-syntax-table):
	Treat "=" as punctuation.  (Bug#14614)

2013-06-15  Juanma Barranquero  <lekktu@gmail.com>

	* help-fns.el (describe-variable):
	Add extra line for permanent-local variables.

2013-06-15  Simen Heggestøyl  <simenheg@ifi.uio.no>  (tiny change)

	* progmodes/scheme.el (scheme-font-lock-keywords-2):
	Add export, import, library.  (Bug#9164)
	(library): Set indent function.

2013-06-14  Glenn Morris  <rgm@gnu.org>

	* term/xterm.el (xterm--query):
	Stop after first matching handler.  (Bug#14615)

2013-06-14 Ivan Kanis  <ivan@kanis.fr>

	Add support for dired in saveplace.
	* dired.el (dired-initial-position-hook): New variable.
	(dired-initial-position): Call hook to place cursor position.
	* saveplace.el (save-place-to-alist): Add dired position.
	(save-place-dired-hook): New function.

2013-06-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (eval-after-load, set-temporary-overlay-map): Use indirection
	through a symbol rather than letrec.

	* emacs-lisp/package.el: Don't recompute dir.  Use pkg-descs more.
	(package-desc): Add `dir' field.
	(package-desc-full-name): New function.
	(package-load-descriptor): Combine the two arguments.  Don't use `load'.
	(package-maybe-load-descriptor): Remove.
	(package-load-all-descriptors): Just call package-load-descriptor.
	(package--disabled-p): New function.
	(package-desc-vers, package-desc-doc): Remove aliases.
	(package--dir): Remove function.
	(package-activate): Check if a package is disabled.
	(package-process-define-package): New function, extracted from
	define-package.
	(define-package): Turn into a place holder.
	(package-unpack-single, package-tar-file-info):
	Use package--description-file.
	(package-compute-transaction): Use package--disabled-p.
	(package-download-transaction): Don't call
	package-maybe-load-descriptor since they're all loaded anyway.
	(package-install): Change argument to be a pkg-desc.
	(package-delete): Use a single pkg-desc argument.
	(describe-package-1): Use package-desc-dir instead of package--dir.
	Use package-desc property instead of package-symbol.
	(package-install-button-action): Adjust accordingly.
	(package--push): Rewrite.
	(package-menu--print-info): Adjust accordingly.  Change the ID format
	to be a pkg-desc.
	(package-menu-describe-package, package-menu-get-status)
	(package-menu--find-upgrades, package-menu-mark-upgrades)
	(package-menu-execute, package-menu--name-predicate):
	Adjust accordingly.
	* startup.el (package--description-file): New function.
	(command-line): Use it.
	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Use package-desc-version.

	* emacs-lisp/bytecomp.el (byte-compile-force-lexical-warnings): New var.
	(byte-compile-preprocess): Use it.
	(byte-compile-file-form-defalias): Try a bit harder to use macros we
	can't quite recognize.
	(byte-compile-add-to-list): Remove.
	* emacs-lisp/cconv.el (cconv-warnings-only): New function.
	(cconv-closure-convert): Add assertion.

	* emacs-lisp/map-ynp.el: Use lexical-binding.
	(map-y-or-n-p): Remove unused vars `tail' and `object'.
	Factor out some repeated code.

2013-06-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (with-eval-after-load): New macro.
	(eval-after-load): Allow form to be a function.
	take advantage of lexical-binding.
	(do-after-load-evaluation): Use dolist and adjust to new format.
	* simple.el (bad-packages-alist): Use dolist and with-eval-after-load.

2013-06-13  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Display "symbol " and other search
	modes from `isearch-message-prefix' in the *Help* buffer.

	* isearch.el (isearch-query-replace): Add " symbol" and other
	possible search modes from `isearch-message-prefix' to the prompt.
	(isearch-occur): Use `with-isearch-suspended' to not exit Isearch
	when reading a regexp to collect.

2013-06-13  Juri Linkov  <juri@jurta.org>

	* isearch.el (word-search-regexp): Match whitespace if the search
	string begins or ends in whitespace.  The LAX arg is applied to
	both ends of the search string.  Use `regexp-quote' and explicit
	\< and \> instead of \b.  Use \` and \' instead of ^ and $.
	(isearch-symbol-regexp): Sync with `word-search-regexp' where word
	boundaries are replaced with symbol boundaries, and characters
	between symbols match non-word non-symbol syntax.  (Bug#14602)

2013-06-13  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-del-char): Don't exceed the length of
	`isearch-string' by the prefix arg.  (Bug#14563)

2013-06-13  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-yank-word, isearch-yank-line)
	(isearch-char-by-name, isearch-quote-char)
	(isearch-printing-char, isearch-process-search-char):
	Add optional count prefix arg.  (Bug#14563)

	* international/isearch-x.el
	(isearch-process-search-multibyte-characters):
	Add optional count prefix arg.

2013-06-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (internal-push-keymap, internal-pop-keymap): New functions.
	(set-temporary-overlay-map): Use them (bug#14095); and take advantage of
	lexical-binding.

2013-06-13  Vitalie Spinu  <spinuvit@gmail.com>

	* subr.el (set-temporary-overlay-map): Add on-exit argument.

2013-06-13  Glenn Morris  <rgm@gnu.org>

	* startup.el (tty-handle-args):
	Don't just discard "--" and anything after.  (Bug#14608)

	* emacs-lisp/lisp.el (forward-sexp, backward-sexp): Doc fixes.

2013-06-13  Michael Albinus  <michael.albinus@gmx.de>

	Implement changes in Secret Service API.  Make it backward compatible.
	* net/secrets.el (secrets-struct-secret-content-type): New defonst.
	(secrets-create-item): Use it.  Prefix properties with interface.

2013-06-13  Michael Hoffman  <9qobl2n02@sneakemail.com>  (tiny change)

	* term.el (term-suppress-hard-newline): New option.  (Bug#12017)
	(term-emulate-terminal): Respect term-suppress-hard-newline.

2013-06-13  E Sabof  <esabof@gmail.com>  (tiny change)

	* image-dired.el (image-dired-dired-toggle-marked-thumbs):
	Only remove a `thumb-file' overlay.  (Bug#14548)

2013-06-12  Grégoire Jadi  <daimrod@gmail.com>

	* mail/reporter.el (reporter-submit-bug-report):
	Handle missing package-name.  (Bug#14600)

2013-06-12  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* textmodes/reftex-cite.el (reftex-cite-regexp-hist)
	(reftex-citation-prompt, reftex-default-bibliography)
	(reftex-bib-or-thebib, reftex-get-bibfile-list)
	(reftex-pop-to-bibtex-entry, reftex-extract-bib-entries)
	(reftex-bib-sort-author, reftex-bib-sort-year)
	(reftex-bib-sort-year-reverse, reftex-get-crossref-alist)
	(reftex-extract-bib-entries-from-thebibliography)
	(reftex-get-bibkey-default, reftex-get-bib-names)
	(reftex-parse-bibtex-entry, reftex-get-bib-field)
	(reftex-format-bib-entry, reftex-parse-bibitem)
	(reftex-format-bibitem, reftex-do-citation)
	(reftex-figure-out-cite-format, reftex-offer-bib-menu)
	(reftex-restrict-bib-matches, reftex-extract-bib-file)
	(reftex-insert-bib-matches, reftex-format-citation)
	(reftex-make-cite-echo-string, reftex-bibtex-selection-callback)
	(reftex-create-bibtex-file): Add docstrings, mostly by converting
	existing comments into docstrings.

2013-06-12  Xue Fuqiao  <xfq.free@gmail.com>

	* ibuf-ext.el (ibuffer-mark-help-buffers): Doc fix.

2013-06-12  Andreas Schwab  <schwab@suse.de>

	* international/mule.el (auto-coding-alist): Use utf-8-emacs-unix
	for auto-save files.

2013-06-12  Glenn Morris  <rgm@gnu.org>

	* ido.el (ido-delete-ignored-files): Remove.
	(ido-wide-find-dirs-or-files, ido-make-file-list-1):
	Go back to calling ido-ignore-item-p directly.

2013-06-12  Eyal Lotem  <eyal.lotem@gmail.com>  (tiny change)

	* ido.el (ido-wide-find-dirs-or-files): Respect ido-case-fold.

	* ido.el (ido-delete-ignored-files): New function,
	split from ido-make-file-list-1.
	(ido-wide-find-dirs-or-files): Maybe ignore files.  (Bug#13003)
	(ido-make-file-list-1): Use ido-delete-ignored-files.

2013-06-12  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup)
	(inferior-octave-completion-table)
	(inferior-octave-track-window-width-change)
	(octave-eldoc-function-signatures, octave-help)
	(octave-find-definition): Use single quoted strings.
	(inferior-octave-startup-args): Change default value.
	(inferior-octave-startup): Do not hard code "-i" and
	"--no-line-editing".
	(inferior-octave-resync-dirs): Add optional arg NOERROR.
	(inferior-octave-directory-tracker): Use it.
	(octave-goto-function-definition): Robustify.
	(octave-help): Support highlighting operators in 'See also'.
	(octave-find-definition): Find subfunctions only in Octave mode.

2013-06-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* help-fns.el (help-fns--compiler-macro): If the handler function is
	named, then put a link to it.
	* help-mode.el (help-function-cmacro): Adjust regexp for cl-lib names.
	* emacs-lisp/cl-macs.el (cl--compiler-macro-typep): New function.
	(cl-typep): Use it.
	(cl-eval-when): Simplify debug spec.
	(cl-define-compiler-macro): Use eval-and-compile.  Give a name to the
	compiler-macro function instead of setting `compiler-macro-file'.

2013-06-12  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/vc-cvs.el (vc-cvs-stay-local): Doc fix.
	* vc/vc-hooks.el (vc-stay-local): Doc fix.

2013-06-12  Stefan Monnier  <monnier@iro.umontreal.ca>
	    Daniel Hackney  <dan@haxney.org>

	First part of Daniel Hackney's patch to package.el.
	* emacs-lisp/package.el: Use defstruct.
	(package-desc): New, main struct.
	(package--bi-desc, package--ac-desc): New structs, used to describe the
	format in external files.
	(package-desc-vers): Replace with package-desc-version accessor.
	(package-desc-doc): Replace with package-desc-summary accessor.
	(package-activate-1): Remove `package' arg since the pkg-vec now
	includes the name.
	(define-package): Use package-desc-from-define.
	(package-unpack-single): Change file-name arg to be a symbol.
	(package--add-to-archive-contents): Use package-desc-create and new
	accessor functions to package--ac-desc.
	(package-buffer-info, package-tar-file-info): Return a package-desc.
	(package-install-from-buffer): Remove `type' argument.  Change pkg-info
	arg to be a package-desc.
	(package-install-file): Adjust accordingly.  Use \' to match EOS.
	(package--from-builtin): New function.
	(describe-package-1, package-menu--generate): Use it.
	(package--make-autoloads-and-compile): Change name arg to be a symbol.
	(package-generate-autoloads): Idem and return the name of the file.
	* emacs-lisp/package-x.el (package-upload-buffer-internal):
	Change pkg-info arg to be a package-desc.
	Use package-make-ac-desc.
	(package-upload-file): Use \' to match EOS.
	* finder.el (finder-compile-keywords): Use package-make-builtin.

2013-06-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc.el (vc-deduce-fileset): Change error message.
	(vc-read-backend): New function.
	(vc-next-action): Use it.

	* subr.el (function-arity): Remove (mistakenly added) (bug#14590).

	* progmodes/prolog.el (prolog-make-keywords-regexp): Remove.
	(prolog-font-lock-keywords): Use regexp-opt instead.
	Don't manually highlight strings.
	(prolog-mode-variables): Simplify comment-start-skip.
	(prolog-consult-compile): Use display-buffer.  Remove unused old-filter.

	* emacs-lisp/generic.el (generic--normalise-comments)
	(generic-set-comment-syntax, generic-set-comment-vars): New functions.
	(generic-mode-set-comments): Use them.
	(generic-bracket-support): Use setq-local.
	(generic-make-keywords-list): Declare obsolete.

2013-06-11  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/lisp-mode.el (lisp-mode-variables):
	Prettify after setting font-lock-defaults.  (Bug#14574)

2013-06-11  Juanma Barranquero  <lekktu@gmail.com>

	* replace.el (query-replace, occur-read-regexp-defaults-function)
	(replace-search):
	* subr.el (declare-function, number-sequence, local-set-key)
	(substitute-key-definition, locate-user-emacs-file)
	(with-silent-modifications, split-string, eval-after-load):
	Fix typos, remove unneeded backslashes and reflow some docstrings.

2013-06-11  Stefan Monnier  <monnier@iro.umontreal.ca>

	* international/mule-conf.el (file-coding-system-alist): Use utf-8 as
	default for Elisp files.

2013-06-11  Glenn Morris  <rgm@gnu.org>

	* vc/log-view.el (log-view-mode-map): Inherit from special-mode-map,
	although define-derived-mode was doing this anyway.  (Bug#14583)

2013-06-10  Juanma Barranquero  <lekktu@gmail.com>

	* allout.el (allout-encryption-plaintext-sanitization-regexps):
	Fix make-variable-buffer-local call to refer to the correct variable.

2013-06-10  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-term.el (eshell-visual-commands)
	(eshell-visual-subcommands, eshell-visual-options):
	Add summary line to docstrings.  Add cross-references.

2013-06-10  Glenn Morris  <rgm@gnu.org>

	* epa.el (epa-read-file-name): New function.  (Bug#14510)
	(epa-decrypt-file): Make plain-file optional.  Use epa-read-file-name.

2013-06-09  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-term.el (eshell-visual-command-p): Fix bug that caused
	output redirection to be ignored with visual commands.

2013-06-09  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-term.el (eshell-visual-command-p): New function.
	(eshell-term-initialize): Move long lambda to separate function
	eshell-visual-command-p.
	* eshell/em-dirs.el (eshell-dirs-initialise):
	* eshell/em-script.el (eshell-script-initialize):
	Add missing #' to lambda.

2013-06-08  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-add-log-current-defun): New function.
	(octave-mode): Set add-log-current-defun-function.
	(octave-goto-function-definition): Do not move point if not found.
	(octave-find-definition): Enhance to try subfunctions first.

2013-06-08  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-char-before)
	(byte-compile-backward-char, byte-compile-backward-word):
	Improve previous change, to handle non-explicit nil.

2013-06-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el: Improve show-paren-mode behavior.
	(smie--opener/closer-at-point): New function.
	(smie--matching-block-data): Use it.  Don't match from right after an
	opener or right before a closer.  Obey smie-blink-matching-inners.
	Don't signal a mismatch for repeated inners like "switch..case..case".

2013-06-07  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode): Set comment-use-global-state
	to t.  (Bug#14303)
	(octave-function-header-regexp): Fix.  (Bug#14570)
	(octave-help-mode-finish-hook, octave-help-mode-finish):
	Remove.  Just use temp-buffer-show-hook.

	* newcomment.el (comment-search-backward): Revert last change.
	(Bug#14434)

	* emacs-lisp/smie.el (smie--matching-block-data): Minor simplification.

2013-06-07  Eli Zaretskii  <eliz@gnu.org>

	* Makefile.in (TAGS TAGS-LISP): Pass the (long) list of *.el files
	through xargs, to avoid failure due to MS-Windows limitations on
	command-line length.

2013-06-06  Glenn Morris  <rgm@gnu.org>

	* font-lock.el (lisp-font-lock-keywords-2):
	Treat user-error like error.

	* emacs-lisp/bytecomp.el (byte-compile-char-before)
	(byte-compile-backward-char, byte-compile-backward-word):
	Handle explicit nil arguments.  (Bug#14565)

2013-06-05  Alan Mackenzie  <acm@muc.de>

	* isearch.el (isearch-allow-prefix): New user option.
	(isearch-other-meta-char): Don't exit isearch when a prefix
	argument is typed whilst `isearch-allow-prefix' is non-nil.
	(Bug#9706)

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* autorevert.el (auto-revert-notify-handler): Use memq.
	Hide assertion failure.

	* skeleton.el: Use cl-lib.
	(skeleton-further-elements): Use defvar-local.
	(skeleton-insert): Use cl-progv.

2013-06-05  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/prog-mode.el (prog-prettify-symbols)
	(prog-prettify-install): Update docstrings.

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el: Move all the prog-mode code to prog-mode.el.
	* progmodes/prog-mode.el: New file.
	* loadup.el: Add prog-mode.el.

2013-06-05  Teodor Zlatanov  <tzz@lifelogs.com>

	* simple.el (prog-prettify-symbols): Add version.
	(prog-prettify-install): Add convenience function to prettify symbols.

	* progmodes/perl-mode.el (perl--augmented-font-lock-keywords)
	(perl--augmented-font-lock-keywords-1)
	(perl--augmented-font-lock-keywords-2, perl-mode): Remove unneeded
	variables and use it.

	* progmodes/cfengine.el (cfengine3--augmented-font-lock-keywords)
	(cfengine3-mode): Remove unneeded variable and use it.

	* emacs-lisp/lisp-mode.el (lisp--augmented-font-lock-keywords)
	(lisp--augmented-font-lock-keywords-1)
	(lisp--augmented-font-lock-keywords-2, lisp-mode-variables):
	Remove unneeded variables and use it.

2013-06-05  João Távora  <joaotavora@gmail.com>

	* net/tls.el (open-tls-stream): Remove unneeded buffer contents up
	to point when opening the connection.  (Bug#14380)

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (load-history-regexp, load-history-filename-element)
	(eval-after-load, after-load-functions, do-after-load-evaluation)
	(eval-next-after-load, display-delayed-warnings)
	(collapse-delayed-warnings, delayed-warnings-hook): Move after the
	definition of save-match-data.
	(overriding-local-map): Remove accidental obsolescence declaration.

	* emacs-lisp/edebug.el (edebug-result): Move before first use.

2013-06-05  Teodor Zlatanov  <tzz@lifelogs.com>

	Generalize symbol prettify support to prog-mode and implement it
	for perl-mode, cfengine3-mode, and emacs-lisp-mode.
	* simple.el (prog-prettify-symbols-alist, prog-prettify-symbols)
	(prog--prettify-font-lock-compose-symbol)
	(prog-prettify-font-lock-symbols-keywords): New variables and
	functions to support symbol prettification.
	* emacs-lisp/lisp-mode.el (lisp--augmented-font-lock-keywords)
	(lisp--augmented-font-lock-keywords-1)
	(lisp--augmented-font-lock-keywords-2, lisp-mode-variables)
	(lisp--prettify-symbols-alist): Implement prettify of lambda.
	* progmodes/cfengine.el (cfengine3--augmented-font-lock-keywords)
	(cfengine3--prettify-symbols-alist, cfengine3-mode):
	Implement prettify of -> => :: strings.
	* progmodes/perl-mode.el (perl-prettify-symbols)
	(perl--font-lock-compose-symbol)
	(perl--font-lock-symbols-keywords): Move to prog-mode.
	(perl--prettify-symbols-alist): Prettify -> => :: strings.
	(perl-font-lock-keywords-1)
	(perl-font-lock-keywords-2): Remove explicit prettify support.
	(perl--augmented-font-lock-keywords)
	(perl--augmented-font-lock-keywords-1)
	(perl--augmented-font-lock-keywords-2, perl-mode):
	Implement prettify support.

2013-06-05  Leo Liu  <sdl.web@gmail.com>

	Re-implement smie matching block highlight using
	show-paren-data-function.  (Bug#14395)
	* emacs-lisp/smie.el (smie-matching-block-highlight)
	(smie--highlight-matching-block-overlay)
	(smie--highlight-matching-block-lastpos)
	(smie-highlight-matching-block)
	(smie-highlight-matching-block-mode): Remove.
	(smie--matching-block-data-cache): New variable.
	(smie--matching-block-data): New function.
	(smie-setup): Use smie--matching-block-data for
	show-paren-data-function.

	* progmodes/octave.el (octave-mode-menu): Fix.
	(octave-find-definition): Skip garbage lines.

2013-06-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	Fix compilation error with simultaneous dynamic+lexical scoping.
	Add warning when a defvar appears after the first let-binding.
	* emacs-lisp/bytecomp.el (byte-compile-lexical-variables): New var.
	(byte-compile-close-variables): Initialize it.
	(byte-compile--declare-var): New function.
	(byte-compile-file-form-defvar)
	(byte-compile-file-form-define-abbrev-table)
	(byte-compile-file-form-custom-declare-variable): Use it.
	(byte-compile-make-lambda-lexenv): Change the argument.  Simplify.
	(byte-compile-lambda): Share call to byte-compile-arglist-vars.
	(byte-compile-bind): Handle dynamic bindings that shadow
	lexical bindings.
	(byte-compile-unbind): Make arg non-optional.
	(byte-compile-let): Simplify.
	* emacs-lisp/cconv.el (byte-compile-lexical-variables): Declare var.
	(cconv--analyse-function, cconv-analyse-form): Populate it.
	Protect byte-compile-bound-variables to limit the scope of defvars.
	(cconv-analyse-form): Add missing rule for (defvar <foo>).
	Remove unneeded rule for `declare'.

	* emacs-lisp/cl-macs.el (cl--compiler-macro-adjoin): Use macroexp-let2
	so as to avoid depending on cl-adjoin at run-time.
	* emacs-lisp/cl-lib.el (cl-pushnew): Use backquotes.

	* emacs-lisp/macroexp.el (macroexp--compiling-p): New function.
	(macroexp--warn-and-return): Use it.

2013-06-05  Leo Liu  <sdl.web@gmail.com>

	* eshell/esh-mode.el (eshell-mode): Fix key bindings.

2013-06-04  Leo Liu  <sdl.web@gmail.com>

	* progmodes/compile.el (compile-goto-error): Add optional arg NOMSG.
	(compilation-auto-jump): Suppress the "Mark set" message to give
	way to exit message.

2013-06-04  Alan Mackenzie  <acm@muc.de>

	Remove faulty optimisation from indentation calculation.
	* progmodes/cc-engine.el (c-guess-basic-syntax): Don't calculate
	search limit based on 2000 characters back from indent-point.

2013-06-03  Tassilo Horn  <tsdh@gnu.org>

	* eshell/em-term.el (cl-lib): Require `cl-lib'.

2013-06-03  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp.el: Use lexical-binding.
	(lisp--local-variables-1, lisp--local-variables): New functions.
	(lisp--local-variables-completion-table): New var.
	(lisp-completion-at-point): Use it complete let-bound vars.

	* emacs-lisp/lisp-mode.el (eval-sexp-add-defvars): Expand macros
	eagerly (bug#14422).

2013-06-03  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-notify-enabled)
	(auto-revert-notify-rm-watch, auto-revert-notify-add-watch)
	(auto-revert-notify-event-p, auto-revert-notify-event-file-name)
	(auto-revert-notify-handler): Handle also gfilenotify.

	* subr.el (file-notify-handle-event): New defun.  Replacing ...
	(inotify-event-p, inotify-handle-event, w32notify-handle-event):
	Remove.

2013-06-03  Juri Linkov  <juri@jurta.org>

	* bindings.el (search-map): Bind `highlight-symbol-at-point' to
	`M-s h .'.  (Bug#14427)

	* hi-lock.el (highlight-symbol-at-point): New alias for the new
	command `hi-lock-face-symbol-at-point'.
	(hi-lock-face-symbol-at-point): New command.
	(hi-lock-map): Bind `highlight-symbol-at-point' to `C-x w .'.
	(hi-lock-menu): Add `highlight-symbol-at-point'.
	(hi-lock-mode): Doc fix.

	* isearch.el (isearch-forward-symbol-at-point): New command.
	(search-map): Bind `isearch-forward-symbol-at-point' to `M-s .'.
	(isearch-highlight-regexp): Add a regexp which matches
	words/symbols for word/symbol mode.

	* subr.el (find-tag-default-bounds): New function with the body
	mostly moved from `find-tag-default'.
	(find-tag-default): Move most code to `find-tag-default-bounds',
	call it and apply `buffer-substring-no-properties' afterwards.

2013-06-03  Tassilo Horn  <tsdh@gnu.org>

	* eshell/em-term.el (eshell-term-initialize):
	Use `cl-intersection' rather than `intersection'.

2013-06-02  Xue Fuqiao  <xfq.free@gmail.com>

	* vc/log-view.el: Doc fix.
	(log-view-mode-map): Copy keymap from `special-mode-map'.

2013-06-02  Eric Ludlam  <zappo@gnu.org>

	* emacs-lisp/eieio.el (eieio--defalias, eieio-hook)
	(eieio-error-unsupported-class-tags, eieio-skip-typecheck)
	(eieio-optimize-primary-methods-flag, eieio-initializing-object)
	(eieio-unbound, eieio-default-superclass)
	(eieio--define-field-accessors, method-static, method-before)
	(method-primary, method-after, method-num-lists)
	(method-generic-before, method-generic-primary)
	(method-generic-after, method-num-slots)
	(eieio-specialized-key-to-generic-key)
	(eieio--check-type, class-v, class-p)
	(eieio-class-name, define-obsolete-function-alias)
	(eieio-class-parents-fast, eieio-class-children-fast)
	(same-class-fast-p, class-constructor, generic-p)
	(generic-primary-only-p, generic-primary-only-one-p)
	(class-option-assoc, class-option, eieio-object-p)
	(class-abstract-p, class-method-invocation-order)
	(eieio-defclass-autoload-map, eieio-defclass-autoload)
	(eieio-class-un-autoload, eieio-defclass)
	(eieio-eval-default-p, eieio-perform-slot-validation-for-default)
	(eieio-add-new-slot, eieio-copy-parents-into-subclass)
	(eieio--defgeneric-init-form, eieio-defgeneric-form)
	(eieio-defgeneric-reset-generic-form)
	(eieio-defgeneric-form-primary-only)
	(eieio-defgeneric-reset-generic-form-primary-only)
	(eieio-defgeneric-form-primary-only-one)
	(eieio-defgeneric-reset-generic-form-primary-only-one)
	(eieio-unbind-method-implementations)
	(eieio--defmethod, eieio--typep)
	(eieio-perform-slot-validation, eieio-validate-slot-value)
	(eieio-validate-class-slot-value, eieio-barf-if-slot-unbound)
	(eieio-oref, eieio-oref-default, eieio-default-eval-maybe)
	(eieio-oset, eieio-oset-default, eieio-slot-originating-class-p)
	(eieio-slot-name-index, eieio-class-slot-name-index)
	(eieio-set-defaults, eieio-initarg-to-attribute)
	(eieio-attribute-to-initarg, eieio-c3-candidate)
	(eieio-c3-merge-lists, eieio-class-precedence-c3)
	(eieio-class-precedence-dfs, eieio-class-precedence-bfs)
	(eieio-class-precedence-list, eieio-generic-call-methodname)
	(eieio-generic-call-arglst, eieio-generic-call-key)
	(eieio-generic-call-next-method-list)
	(eieio-pre-method-execution-functions, eieio-generic-call)
	(eieio-generic-call-primary-only, eieiomt-method-list)
	(eieiomt-optimizing-obarray, eieiomt-install)
	(eieiomt-add, eieiomt-next, eieiomt-sym-optimize)
	(eieio-generic-form, eieio-defmethod, make-obsolete)
	(eieio-defgeneric, make-obsolete): Move to eieio-core.el.
	(defclass): Remove `eval-and-compile' from macro.
	(call-next-method, shared-initialize): Instead of using
	`scoped-class' variable, use new eieio--scoped-class, and
	eieio--with-scoped-class.
	(initialize-instance): Rename local variable 'scoped-class' to
	'this-class' to remove ambiguitity from old global.

	* emacs-lisp/eieio-core.el: New file.  Derived from key parts of
	eieio.el.
	(eieio--scoped-class-stack): New variable.
	(eieio--scoped-class): New fcn.
	(eieio--with-scoped-class): New scoping macro.
	(eieio-defclass): Use pushnew instead of add-to-list.
	(eieio-defgeneric-form-primary-only-one, eieio-oset-default)
	(eieio-slot-name-index, eieio-set-defaults, eieio-generic-call)
	(eieio-generic-call-primary-only, eieiomt-add): Instead of using
	`scoped-class' variable, use new eieio--scoped-class, and
	eieio--with-scoped-class.

	* emacs-lisp/eieio-base.el (cl-lib): Require during compile.

2013-06-02  Tassilo Horn  <tsdh@gnu.org>

	* eshell/esh-ext.el (eshell-external-command): Pass args to
	`eshell-find-interpreter'.
	(eshell-find-interpreter): Add new second parameter ARGS.

	* eshell/em-script.el (eshell-script-initialize): Add second arg
	to the function added as MATCH to `eshell-interpreter-alist'.

	* eshell/em-dirs.el (eshell-dirs-initialize): Add second arg to
	the function added as MATCH to `eshell-interpreter-alist'.

	* eshell/em-term.el (eshell-visual-subcommands): New defcustom.
	(eshell-visual-options): New defcustom.
	(eshell-escape-control-x): Adapt docstring.
	(eshell-term-initialize): Test `eshell-visual-subcommands' and
	`eshell-visual-options' in addition to `eshell-visual-commands'.
	(eshell-exec-visual): Pass args to `eshell-find-interpreter'.

2013-06-01  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-indent-block-enders): Add break,
	continue and raise keywords.

2013-06-01  Glenn Morris  <rgm@gnu.org>

	* pcmpl-gnu.el (pcomplete/tar): Check obsolete variable is bound.

	Plain (f)boundp silences compilation warnings since Emacs 22.1.
	* progmodes/cc-cmds.el (delete-forward-p):
	* progmodes/cc-defs.el (buffer-syntactic-context-depth):
	* progmodes/cc-engine.el (buffer-syntactic-context):
	* progmodes/cc-fonts.el (face-property-instance):
	* progmodes/cc-mode.el (set-keymap-parents):
	* progmodes/cc-vars.el (get-char-table): No need for cc-bytecomp-defun.
	* progmodes/cc-defs.el (c-set-region-active, c-beginning-of-defun-1)
	* progmodes/cc-mode.el (c-make-inherited-keymap): Use plain fboundp.
	* progmodes/cc-defs.el (zmacs-region-stays, zmacs-regions)
	(lookup-syntax-properties): Remove unecessary cc-bytecomp-defvar.

	* progmodes/cc-vars.el (other): Emacs has this widget since
	at least 21.1, so don't (re)define it.

	* eshell/em-cmpl.el (eshell-cmpl-initialize):
	Replace the obsolete alias pcomplete-arg-quote-list.

2013-06-01  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode-syntax-table): Give `.'
	punctuation syntax.
	(inferior-octave-minimal-columns)
	(inferior-octave-last-column-width): New variables.
	(inferior-octave-track-window-width-change): New function.
	(inferior-octave-mode): Adjust column width so that Octave output,
	for example from 'ls', can fit into the window nicely.

2013-05-31  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-expansion-allowed-p):
	Highlight expansions inside regexp literals.

2013-05-31  Glenn Morris  <rgm@gnu.org>

	* obsolete/sym-comp.el (symbol-complete):
	Replace obsolete completion-annotate-function.

	* progmodes/cc-vars.el (c-make-macro-with-semi-re): Silence compiler.

2013-05-31  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-syntax-expansion-allowed-p):
	New function, checks if point is inside a literal that allows
	expression expansion.
	(ruby-syntax-propertize-expansion): Use it.
	(ruby-syntax-propertize-function): Bind `case-fold-search' to nil
	around the body.

2013-05-30  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-mode-map): Bind `isearch-toggle-invisible'
	to "\M-si".
	(isearch-invisible): New variable.
	(isearch-forward): Doc fix.
	(isearch-mode): Set `isearch-invisible'
	to the value of `search-invisible'.
	(isearch-toggle-case-fold): Doc fix.
	(isearch-toggle-invisible): New command.
	(isearch-query-replace): Let-bind `search-invisible'
	to the value of `isearch-invisible'.
	(isearch-search): Use `isearch-invisible' instead of
	`search-invisible'.  Let-bind `search-invisible'
	to the value of `isearch-invisible'.  (Bug#11378)

2013-05-30  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Avoid `isearch-range-invisible'
	call when `query-flag' is nil and `search-invisible' is non-nil.
	(Bug#11746)

2013-05-30  Glenn Morris  <rgm@gnu.org>

	* progmodes/gdb-mi.el (gdb-wait-for-pending): Fix typo.

	* progmodes/cc-bytecomp.el (cc-bytecomp-noruntime-functions): New.
	(cc-require): Suppress spurious "noruntime" warnings.
	(cc-require-when-compile): Use fboundp, for sake of compiler.

	* progmodes/cc-mode.el: Move load of cc-vars before that of
	cc-langs (which in turn loads cc-vars), to quieten compiler.

2013-05-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* paren.el: Simplify the code.
	(show-paren-mode): Always start the timer.
	(show-paren--idle-timer): Rename from show-paren-idle-timer.
	(show-paren--overlay, show-paren--overlay-1): Rename from
	show-paren-overlay and show-paren-overlay-1, and initialize to an
	overlay rather than to nil.
	(show-paren-function): Misc cleanup and simplifications.

2013-05-30  Stefan Monnier  <monnier@iro.umontreal.ca>

	* paren.el (show-paren-data-function): New hook.
	(show-paren--default): New function, extracted from show-paren-function.
	(show-paren-function): Use show-paren-data-function.

2013-05-30  Glenn Morris  <rgm@gnu.org>

	* ielm.el (ielm-map, ielm-complete-symbol):
	Use completion-at-point rather than obsolete functions.
	(inferior-emacs-lisp-mode): Doc fix.
	Set completion-at-point-functions, rather than
	comint-dynamic-complete-functions.

	* eshell/em-cmpl.el (eshell-complete-lisp-symbol): New function.
	(eshell-cmpl-initialize, eshell-complete-parse-arguments):
	Replace obsolete lisp-complete-symbol with eshell-complete-lisp-symbol.

	* image.el (image-animated-p): Tweak definition.

	* net/rlogin.el (rlogin-program, rlogin-explicit-args): Default to ssh.
	(rlogin-process-connection-type): Tweak default.  Add set-after.
	(rlogin-host): Doc fix.
	(rlogin): Tweak prompt.
	(rlogin-tab-or-complete): Use completion-at-point rather than alias.

	* net/net-utils.el (nslookup-mode-map, ftp-mode-map):
	* progmodes/tcl.el (inferior-tcl-mode-map):
	Use completion-at-point rather than obsolete alias.

	* emacs-lisp/eieio.el (eieio-eval-default-p): Move before use.

	* minibuffer.el (read-file-name-completion-ignore-case):
	Move before completion--in-region, for eager macro expansion.

2013-05-29  Juri Linkov  <juri@jurta.org>

	* replace.el (occur-engine): Rename `globalcount' to `global-lines'
	for total count of matching lines.  Add `global-matches' for total
	count of matches.  Rename `matches' to `lines' for count of
	matching lines.  Add `matches' for count of matches.
	Rename `lines' to `curr-line' for line count.  Rename `prev-lines'
	to `prev-line' for line number of prev match endpt.
	Increment `matches' for every match.  Print the number of
	matching lines in the header.
	(occur-context-lines): Rename `lines' to `curr-line'.
	Rename `prev-lines' to `prev-line'.  (Bug#14017)

2013-05-29  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Add `skip-read-only-count',
	`skip-filtered-count', `skip-invisible-count' let-bound to 0.
	Increment them for corresponding conditions and report the number
	of skipped occurrences in the final message.  (Bug#11746)
	(query-replace, query-replace-regexp, query-replace-regexp-eval)
	(replace-string, replace-regexp): Doc fix.

2013-05-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/trace.el (trace--read-args): Provide a default.

	* emacs-lisp/lisp-mode.el (lisp-mode-shared-map): Inherit from
	prog-mode-map (bug#14504).

2013-05-29  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-comment): Tweak regexps.
	(octave-help): Small simplification.

	* emacs-lisp/smie.el (smie-highlight-matching-block): Always turn
	off the highlight first.

2013-05-29  Glenn Morris  <rgm@gnu.org>

	* progmodes/idlwave.el (idlwave-concatenate-rinfo-lists):
	Handle idlwave-last-system-routine-info-cons-cell being nil.

	* progmodes/idlwave.el (idlwave-scan-user-lib-files)
	(idlwave-write-paths): Simplify via with-temp-buffer.

	* emulation/cua-gmrk.el: Also load cua-base, cua-rect at run time.
	* emulation/cua-rect.el: Also load cua-base at run time.

	* progmodes/cperl-mode.el (imenu-choose-buffer-index)
	(file-of-tag, etags-snarf-tag, etags-goto-tag-location): Declare.
	(cperl-imenu-on-info): Require imenu.

2013-05-28  Alan Mackenzie  <acm@muc.de>

	Handle "capitalised keywords" correctly.
	* progmodes/cc-mode.el (c-after-change): Bind case-fold-search to nil.

2013-05-28  Aidan Gauland  <aidalgol@amuri.net>

	* eshell/em-unix.el: Add -r option to cp.

2013-05-28  Glenn Morris  <rgm@gnu.org>

	* vc/vc-arch.el (vc-exec-after): Declare.
	(vc-switches): Autoload.
	* vc/vc-bzr.el: No need to require vc when compiling.
	(vc-exec-after, vc-set-async-update, vc-default-dir-printer)
	(vc-resynch-buffer, vc-dir-refresh): Declare.
	(vc-setup-buffer, vc-switches): Autoload.
	* vc/vc-cvs.el (vc-exec-after, vc-coding-system-for-diff)
	(vc-resynch-buffer): Declare.
	(vc-switches, vc-default-revert, vc-version-backup-file): Autoload.
	* vc/vc-dir.el (desktop-missing-file-warning): Declare.
	* vc/vc-git.el (vc-exec-after, vc-set-async-update)
	(grep-read-regexp, grep-read-files, grep-expand-template)
	(vc-dir-refresh): Declare.
	(vc-setup-buffer, vc-switches, vc-resynch-buffer): Autoload.
	* vc/vc-hg.el (vc-exec-after, vc-set-async-update): Declare.
	(vc-setup-buffer, vc-switches, vc-do-async-command): Autoload.
	* vc/vc-mtn.el (vc-exec-after): Declare.
	(vc-switches): Autoload.
	* vc/vc-rcs.el (vc-expand-dirs, vc-switches)
	(vc-tag-precondition, vc-buffer-sync, vc-rename-master): Autoload.
	(vc-file-tree-walk): Declare.
	* vc/vc-sccs.el (vc-file-tree-walk): Declare.
	(vc-expand-dirs, vc-switches, vc-setup-buffer, vc-delistify)
	(vc-tag-precondition, vc-rename-master): Autoload.
	* vc/vc-svn.el (vc-exec-after): Declare.
	(vc-switches, vc-setup-buffer): Autoload.
	* obsolete/vc-mcvs.el (vc-checkout, vc-switches, vc-default-revert):
	Autoload.
	(vc-resynch-buffer): Declare.

	* obsolete/fast-lock.el (byte-compile-warnings):
	Don't warn about obsolete features in this obsolete file.

	* progmodes/cc-vars.el (c-macro-names-with-semicolon):
	Move definition before use.

	* play/dunnet.el (byte-compile-warnings): Don't disable them all.
	(dun-unix-verbs): Remove dun-zippy.
	(dun-zippy): Remove function.

	* emacs-lisp/bytecomp.el (byte-compile-warnings): Doc fix.

2013-05-27  Juri Linkov  <juri@jurta.org>

	* replace.el (replace-search): New function with code moved out
	from `perform-replace'.
	(replace-highlight, replace-dehighlight): Move function definitions
	up closer to `replace-search'.  (Bug#11746)

2013-05-27  Juri Linkov  <juri@jurta.org>

	* replace.el (perform-replace): Ignore invisible matches.
	In addition to checking `query-replace-skip-read-only', also
	filter out matches by calling `run-hook-with-args-until-failure'
	on `isearch-filter-predicates', and also check `search-invisible'
	for t or call `isearch-range-invisible'.
	(replace-dehighlight): Call `isearch-clean-overlays'.  (Bug#11746)

2013-05-27  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-filter-predicates): Rename from
	`isearch-filter-predicate'.  Doc fix.  (Bug#11378)
	(isearch-message-prefix): Display text from the property
	`isearch-message-prefix' of the currently active filters.
	(isearch-search): Don't compare `isearch-filter-predicate' with
	`isearch-filter-visible'.  Call `run-hook-with-args-until-failure'
	on `isearch-filter-predicates'.  Also check `search-invisible' for t
	or call `isearch-range-invisible'.
	(isearch-filter-visible): Make obsolete.
	(isearch-lazy-highlight-search):
	Call `run-hook-with-args-until-failure' on
	`isearch-filter-predicates' and use `isearch-range-invisible'.

	* info.el (Info-search): Call `run-hook-with-args-until-failure' on
	`isearch-filter-predicates' instead of `funcall'ing
	`isearch-filter-predicate'.
	(Info-mode): Set `Info-isearch-filter' to
	`isearch-filter-predicates' instead of `isearch-filter-predicate'.

	* dired-aux.el (dired-isearch-filter-predicate-orig):
	Remove variable.
	(dired-isearch-filenames-toggle, dired-isearch-filenames-setup)
	(dired-isearch-filenames-end): Add and remove
	`dired-isearch-filter-filenames' in `isearch-filter-predicates'
	instead of changing the value of `isearch-filter-predicate'.
	Rebind `dired-isearch-filenames-toggle' from "\M-sf" to "\M-sff".
	(dired-isearch-filter-filenames): Don't use `isearch-filter-visible'.
	Put property `isearch-message-prefix' to "filename " on
	`dired-isearch-filter-filenames'.

	* wdired.el (wdired-change-to-wdired-mode):
	Add `isearch-filter-predicates' to `wdired-isearch-filter-read-only'
	locally instead of changing `isearch-filter-predicate'.
	(wdired-isearch-filter-read-only): Don't use `isearch-filter-visible'.

2013-05-27  Dmitry Gutov  <dgutov@yandex.ru>

	* vc/vc-git.el (vc-git-working-revision): When in detached mode,
	return the commit hash (Bug#14459).  Also set the
	`vc-git-detached' property.
	(vc-git--rev-parse): Extract from `vc-git-previous-revision'.
	(vc-git-mode-line-string): Use the same help-echo format whether
	in detached mode or not, because we know the actual revision now.
	When in detached mode, shorten the revision to 7 chars.

2013-05-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/easy-mmode.el (define-minor-mode):
	* emacs-lisp/derived.el (define-derived-mode): Always defvar the
	mode hook and provide a docstring.

2013-05-27  Alan Mackenzie  <acm@muc.de>

	Remove spurious syntax-table text properties inserted by C-y.
	* progmodes/cc-mode.el (c-after-change): Also clear hard
	syntax-table property with value nil.

2013-05-27  Michael Albinus  <michael.albinus@gmx.de>

	* net/dbus.el (dbus-call-method): Let-bind `inhibit-redisplay'
	when reading the events; the buffer layout shall not be changed.

2013-05-27  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-directory-tracker-resync):
	New variable.
	(inferior-octave-directory-tracker): Automatically re-sync
	default-directory.
	(octave-help): Improve handling of 'See also'.

2013-05-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* doc-view.el: Minor naming convention tweaks.
	(desktop-buffer-mode-handlers): Don't add to it repeatedly.

	* image-mode.el (image-mode-reapply-winprops): Call image-mode-winprops
	even if there's no `display' property yet (bug#14435).

2013-05-25  Eli Zaretskii  <eliz@gnu.org>

	* subr.el (unmsys--file-name): Rename from reveal-filename.

	* Makefile.in (custom-deps, finder-data, autoloads)
	($(MH_E_DIR)/mh-loaddefs.el, $(TRAMP_DIR)/tramp-loaddefs.el)
	($(CAL_DIR)/cal-loaddefs.el, $(CAL_DIR)/diary-loaddefs.el)
	($(CAL_DIR)/hol-loaddefs.el): All users changed.

2013-05-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp.el (lisp-completion-at-point): Don't use
	error-completion on the first 2 args of condition-case (bug#14446).
	Don't burp at EOB.

2013-05-25  Leo Liu  <sdl.web@gmail.com>

	* comint.el (comint-previous-matching-input): Do not flood the
	*Messages* buffer with trivial messages.

2013-05-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/flymake.el (flymake-nop): Don't return a string.
	(flymake-set-at): Fix typo.

	* simple.el (read--expression): New function, extracted from
	eval-expression.  Set completion-at-point-functions (bug#14465).
	(eval-expression, eval-minibuffer): Use it.

2013-05-25  Xue Fuqiao  <xfq.free@gmail.com>

	* progmodes/flymake.el (flymake-save-buffer-in-file)
	(flymake-makehash, flymake-posn-at-point-as-event, flymake-nop)
	(flymake-selected-frame, flymake-log, flymake-ins-after)
	(flymake-set-at, flymake-get-buildfile-from-cache)
	(flymake-add-buildfile-to-cache, flymake-clear-buildfile-cache)
	(flymake-find-possible-master-files, flymake-save-buffer-in-file):
	Refine the doc string.
	(flymake-get-file-name-mode-and-masks): Reformat.
	(flymake-get-real-file-name-function): Fix a minor bug.

2013-05-24  Juri Linkov  <juri@jurta.org>

	* progmodes/grep.el (grep-mode-font-lock-keywords):
	Support =linenumber= format used by git-grep for lines with
	function names.  (Bug#13549)

2013-05-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/octave.el (octave-smie-rules): Return nil rather than
	0 after a semi-colon; it works better for smie-auto-fill.
	(octave--indent-new-comment-line): New function.
	(octave-indent-new-comment-line): Use it (indirectly).
	(octave-mode): Don't disable smie-auto-fill.  Use add-function to
	modify comment-line-break-function.

	* emacs-lisp/smie.el (smie-auto-fill): Rework to be more robust.
	(smie-setup): Use add-function to set it.

2013-05-24  Sam Steingold  <sds@gnu.org>

	* sort.el (delete-duplicate-lines): Accept an optional `keep-blanks'
	argument (before the `interactive' argument).

2013-05-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* image-mode.el (image-mode-winprops): Add winprops to
	image-mode-winprops-alist before running
	image-mode-new-window-functions.
	* doc-view.el (doc-view-new-window-function): Don't delay
	doc-view-goto-page via timers (bug#14435).

2013-05-24  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el: Integrate with desktop.el.  (Bug#14435)
	(doc-view-desktop-save-buffer): New function.
	(doc-view-restore-desktop-buffer): New function.
	(desktop-buffer-mode-handlers):
	Add `doc-view-restore-desktop-buffer' as desktop.el buffer mode
	handler.
	(doc-view-mode): Set `doc-view-desktop-save-buffer' as custom
	`desktop-save-buffer' function.

2013-05-24  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-gvfs.el (tramp-gvfs-enabled): New defconst.
	(tramp-gvfs-file-name-handler): Raise a user error when
	`tramp-gvfs-enabled' is nil.
	(top): Register signals only when `tramp-gvfs-enabled' is non-nil.
	Do not raise a user error when loading package.  (Bug#14447)

	* net/xesam.el: Move to obsolete/.

2013-05-24  Glenn Morris  <rgm@gnu.org>

	* font-lock.el (lisp-font-lock-keywords-2): Add with-coding-priority.

	* emacs-lisp/chart.el (chart-sort): Replace obsolete `object-name'.

	* progmodes/cperl-mode.el (cperl-mode): Use fboundp.
	(Info-find-node, Man-getpage-in-background): Declare.

	* mail/unrmail.el (unrmail):
	Replace obsolete detect-coding-with-priority.

	* net/socks.el (socks-split-string): Use this rather than split-string.
	(socks-nslookup-host): Update for above change.
	(dynamic-choice, s5-dynamic-choice-match)
	(s5-dynamic-choice-match-inline, s5-widget-value-create):
	Comment out unused code.

	* tooltip.el (tooltip-use-echo-area): Warn only on 'set.
	* progmodes/gud.el (gud-gdb-completion-function): Move before use.
	(gud-tooltip-echo-area): Make obsolete.
	(gud-tooltip-process-output, gud-tooltip-tips): Also check tooltip-mode.

	* progmodes/js.el (js--optimize-arglist): Declare.

	* progmodes/ruby-mode.el (ruby-syntax-propertize-expansion): Declare.

	* progmodes/which-func.el (ediff-window-A, ediff-window-B)
	(ediff-window-C): Declare.

	* obsolete/pgg-gpg.el, obsolete/pgg-pgp.el, obsolete/pgg-pgp5.el:
	Tweak requires to silence compiler.

	* obsolete/sym-comp.el: No need to load hipper-exp when compiling.
	(he-search-string, he-tried-table, he-expand-list)
	(he-init-string, he-string-member, he-substitute-string)
	(he-reset-string): Declare.

	* obsolete/options.el (list-options): Use custom-variable-p,
	rather than obsolete alias.

2013-05-23  Sam Steingold  <sds@gnu.org>

	* simple.el (shell-command-on-region): Pass the `replace' argument
	down to `call-process-region' to comply with the doc as reported on
	<http://stackoverflow.com/questions/16720458/emacs-noninteractive-call-to-shell-command-on-region-always-deletes-region>

2013-05-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-indent-forward-token)
	(smie-indent-backward-token): Handle string tokens (bug#14381).

2013-05-23  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* ielm.el (ielm-menu): New menu.
	(inferior-emacs-lisp-mode): Set comment-start.

2013-05-23  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* lisp/textmodes/reftex.el (reftex-ref-style-toggle):
	Fix deactivate action.

	* lisp/textmodes/reftex-vars.el (reftex-ref-style-alist):
	Add cleveref macros.

	* lisp/textmodes/reftex-parse.el
	(reftex-locate-bibliography-files): Accept options for
	bibliography commands.
	* lisp/textmodes/reftex-vars.el (reftex-bibliography-commands):
	Add addbibresource.  Basic Biblatex support.

2013-05-23  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-gvfs.el (top):
	* net/xesam.el (xesam-dbus-unique-names): Suppress D-Bus errors
	when loading package.  (Bug#14447)

2013-05-23  Glenn Morris  <rgm@gnu.org>

	* progmodes/js.el: No need to load comint when compiling.
	(ring-insert, comint-send-string, comint-send-input)
	(comint-last-input-end, ido-chop): Declare.

	* vc/ediff-diff.el, vc/ediff-merg.el: Require ediff-util at run-time.
	* vc/ediff-mult.el: Adjust requires.
	(ediff-directories-internal, ediff-directory-revisions-internal)
	(ediff-patch-file-internal): Declare.
	* vc/ediff-ptch.el: Adjust requires.
	(ediff-use-last-dir, ediff-buffers-internal): Declare.
	(ediff-find-file): Autoload.
	* vc/ediff-util.el: No need to load ediff when compiling.
	(ediff-regions-internal): Declare.
	* vc/ediff-wind.el: Adjust requires.
	(ediff-compute-toolbar-width): Define when compiling.
	(ediff-setup-control-buffer, ediff-make-bottom-toolbar): Declare.
	* vc/ediff.el: No need to load dired, ediff-ptch when compiling.
	(dired-get-filename, dired-get-marked-files)
	(ediff-last-dir-patch, ediff-patch-default-directory)
	(ediff-get-patch-buffer, ediff-dispatch-file-patching-job)
	(ediff-patch-buffer-internal): Declare.

	* emacs-lisp/checkdoc.el: No need to load ispell when compiling.
	(ispell-process, ispell-buffer-local-words, lm-summary)
	(lm-section-start, lm-section-end): Declare.
	(checkdoc-ispell-init): Simplify.

	* progmodes/vera-mode.el (he-init-string, he-dabbrev-beg)
	(he-string-member, he-reset-string, he-substitute-string): Declare.

	* eshell/em-ls.el: Adjust requires.
	(eshell-glob-regexp): Declare.
	* eshell/em-tramp.el: Adjust requires.
	(eshell-parse-command): Autoload.
	* eshell/em-xtra.el: Adjust requires.
	(eshell-parse-command): Autoload.
	* eshell/esh-ext.el: Adjust requires.
	(eshell-parse-command, eshell-close-handles): Autoload.
	* eshell/esh-io.el: Adjust requires.
	(eshell-output-filter): Autoload.
	* eshell/esh-util.el: No need to load tramp when compiling.
	(tramp-file-name-structure, ange-ftp-ls, ange-ftp-file-modtime):
	Declare.
	(eshell-parse-ange-ls): Require ange-ftp and tramp.
	* eshell/em-alias.el, eshell/em-banner.el, eshell/em-basic.el:
	* eshell/em-cmpl.el, eshell/em-glob.el, eshell/em-pred.el:
	* eshell/em-prompt.el, eshell/em-rebind.el, eshell/em-smart.el:
	* eshell/em-term.el, eshell/esh-arg.el, eshell/esh-mode.el:
	* eshell/esh-opt.el, eshell/esh-proc.el:
	* eshell/esh-var.el: Adjust requires.
	* eshell/eshell.el: Do not require esh-util twice.
	(eshell-add-input-to-history): Declare.
	(eshell-command): Check history module is active before using it.

	* eshell/em-ls.el (eshell-ls-dir): Fix -A handling.

2013-05-22  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup): Fix bug#14433.

2013-05-22  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-notify-add-watch)
	(auto-revert-notify-handler): Add `attrib' for the inotify case,
	it indicates changes in file modification time.

2013-05-22  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-file-form-autoload):
	Always delete the autoloaded function from the noruntime and
	unresolved functions lists.

	* allout.el: No need to load epa, epg, overlay when compiling.
	(epg-context-set-passphrase-callback, epg-list-keys)
	(epg-decrypt-string, epg-encrypt-string, epg-user-id-string)
	(epg-key-user-id-list): Declare.

	* emulation/viper-cmd.el (viper-set-searchstyle-toggling-macros)
	(viper-set-parsing-style-toggling-macro)
	(viper-set-emacs-state-searchstyle-macros):
	Use called-interactively-p on Emacs.
	(viper-looking-back): Make it an obsolete alias.  Update callers.
	* emulation/viper-ex.el: Load viper-keym, not viper-cmd.
	Use looking-back rather than viper-looking-back.
	(viper-tmp-insert-at-eob, viper-enlarge-region)
	(viper-read-string-with-history, viper-register-to-point)
	(viper-append-to-register, viper-change-state-to-vi)
	(viper-backward-char-carefully, viper-forward-char-carefully)
	(viper-Put-back, viper-put-back, viper-add-newline-at-eob-if-necessary)
	(viper-change-state-to-emacs): Declare.
	* emulation/viper-macs.el: Load viper-mous, viper-ex, not viper-cmd.
	(viper-change-state-to-insert, viper-change-state-to-vi): Declare.
	* emulation/viper-mous.el: Do not load viper-cmd.
	(viper-backward-char-carefully, viper-forward-char-carefully)
	(viper-forward-word, viper-adjust-window): Declare.

	* vc/ediff.el (ediff-version): Use called-interactively-p on Emacs.

	* progmodes/idlw-help.el (idlwave-help-fontify):
	Use called-interactively-p.

	* term/w32console.el (w32-get-console-codepage)
	(w32-get-console-output-codepage): Declare.

	* dframe.el (x-sensitive-text-pointer-shape, x-pointer-shape):
	Remove unnecessary declarations.
	(dframe-message): Doc fix.

	* info.el (dframe-select-attached-frame, dframe-current-frame):
	Declare.

	* speedbar.el (speedbar-message): Make it an obsolete alias.
	Update all callers.
	(speedbar-with-attached-buffer)
	(speedbar-maybee-jump-to-attached-frame): Make these aliases obsolete.
	(speedbar-with-writable): Use backquote.
	* emacs-lisp/eieio-opt.el (eieio-describe-class-sb):
	* emacs-lisp/eieio-speedbar.el (eieio-speedbar-handle-click):
	Use dframe-with-attached-buffer, dframe-maybee-jump-to-attached-frame
	rather than speedbar- aliases.
	* mail/rmail.el: Load dframe rather than speedbar when compiling.
	(speedbar-make-specialized-keymap, speedbar-insert-button)
	(dframe-select-attached-frame, dframe-maybee-jump-to-attached-frame)
	(speedbar-do-function-pointer): Declare.
	(rmail-speedbar-button, rmail-speedbar-find-file)
	(rmail-speedbar-move-message):
	Use dframe-with-attached-buffer rather than speedbar- alias.
	* progmodes/gud.el: Load dframe rather than speedbar when compiling.
	(dframe-message, speedbar-make-specialized-keymap)
	(speedbar-add-expansion-list, speedbar-mode-functions-list)
	(speedbar-make-tag-line, speedbar-remove-localized-speedbar-support)
	(speedbar-insert-button, dframe-select-attached-frame)
	(dframe-maybee-jump-to-attached-frame)
	(speedbar-change-initial-expansion-list)
	(speedbar-previously-used-expansion-list-name): Declare.
	(gud-speedbar-item-info, gud-gdb-goto-stackframe):
	Use dframe-message, dframe-with-attached-buffer rather than
	speedbar- aliases.
	(gud-sentinel): Silence compiler.
	* progmodes/vhdl-mode.el (speedbar-refresh)
	(speedbar-do-function-pointer, speedbar-add-supported-extension)
	(speedbar-add-mode-functions-list, speedbar-make-specialized-keymap)
	(speedbar-change-initial-expansion-list, speedbar-add-expansion-list)
	(speedbar-extension-list-to-regex, speedbar-directory-buttons)
	(speedbar-file-lists, speedbar-make-tag-line)
	(speedbar-line-directory, speedbar-goto-this-file)
	(speedbar-center-buffer-smartly, speedbar-change-expand-button-char)
	(speedbar-delete-subblock, speedbar-position-cursor-on-line)
	(speedbar-make-button, speedbar-reset-scanners)
	(speedbar-files-item-info, speedbar-line-text)
	(speedbar-find-file-in-frame, speedbar-set-timer)
	(dframe-maybee-jump-to-attached-frame, speedbar-line-file): Declare.
	(speedbar-with-writable): Do not (re)define it.
	(vhdl-speedbar-find-file): Use dframe-maybee-jump-to-attached-frame
	rather than speedbar- alias.

2013-05-21  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode-menu): Update and re-organize
	menu items.
	(octave-mode): Tweak fill-nobreak-predicate.
	(inferior-octave-startup): Check process to avoid infinite loop.
	(inferior-octave): Pop to buffer first to show abornmal process
	exit information.

2013-05-21  Glenn Morris  <rgm@gnu.org>

	* printing.el (pr-menu-bar): Define when compiling.

2013-05-21  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-auto-fill): Remove.
	(octave-indent-new-comment-line): Improve.
	(octave-mode): Use auto fill mode through
	comment-line-break-function and fill-nobreak-predicate.
	(octave-goto-function-definition): Support DEFUN_DLD.
	(octave-beginning-of-defun): Small tweak.
	(octave-help): Show parent directory.

2013-05-21  Glenn Morris  <rgm@gnu.org>

	* files.el (dired-unmark):
	* progmodes/gud.el (gdb-input): Update declarations.

	* calculator.el (electric, ehelp): No need to load when compiling.
	(Electric-command-loop, electric-describe-mode): Declare.

	* doc-view.el (doc-view-current-converter-processes): Move before use.

	* emacs-lisp/easy-mmode.el (define-globalized-minor-mode):
	Move MODE-set-explicitly definition before use.

	* international/mule-diag.el (mule-diag):
	Don't use obsolete window-system-version.

	* mail/feedmail.el (smtpmail): No need to load when compiling.
	(smtpmail-via-smtp, smtpmail-smtp-server): Declare.

	* mail/mail-utils.el (rfc822): No need to load when compiling.
	(rfc822-addresses): Autoload it.
	(mail-strip-quoted-names): Trivial simplification.

	* mail/rmail.el (rmail-mime-message-p, rmail-mime-toggle-raw): Declare.
	(rmail-retry-failure): Don't assume that rmail-mime-feature == rmailmm.

	* net/snmp-mode.el (tempo): Don't duplicate requires.

	* progmodes/prolog.el (info): No need to load when compiling.
	(comint): Require before shell requires it.
	(Info-goto-node): Autoload it.
	(Info-follow-nearest-node): Declare.
	(prolog-help-info, prolog-goto-predicate-info): No need to require info.

	* textmodes/artist.el (picture-mode-exit): Declare.

	* textmodes/reftex-parse.el (reftex-parse-from-file):
	Trivial rewrite so the compiler can parse it better.

2013-05-20  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-help-mode-map)
	(octave-help-mode-finish-hook): New variables.
	(octave-help-mode, octave-help-mode-finish): New functions.
	(octave-help): Use octave-help-mode.

2013-05-20  Glenn Morris  <rgm@gnu.org>

	* format-spec.el (format-spec): Allow spec chars with nil.  (Bug#14420)

2013-05-19  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-expression-expansion-re): Allow to
	start at point, so that expansion starting right after opening
	slash in a regexp is recognized.
	(ruby-syntax-before-regexp-re): New defvar, extracted from
	ruby-syntax-propertize-function.  Since the value of this regexp
	is looked up at runtime now, we should be able to turn
	`ruby-syntax-methods-before-regexp' into a defcustom later.
	(ruby-syntax-propertize-function): Split regexp matching into two
	parts, for opening and closing slashes.  That allows us to skip
	over string interpolations and support multiline regexps.
	Don't call `ruby-syntax-propertize-expansions', instead use another rule
	for them, which calls `ruby-syntax-propertize-expansion'.
	(ruby-syntax-propertize-expansions): Move `remove-text-properties'
	call to `ruby-syntax-propertize-function'.
	(ruby-syntax-propertize-expansion): Extracted from
	`ruby-syntax-propertize-expansions'.  Handles one expansion.
	(ruby-syntax-propertize-percent-literal): Leave point right after
	the percent symbol, so that the expression expansion rule can
	propertize the contents.
	(ruby-syntax-propertize-heredoc): Leave point at bol following the
	heredoc openers.
	(ruby-syntax-propertize-expansions): Remove.

2013-05-18  Juri Linkov  <juri@jurta.org>

	* man.el (Man-default-man-entry): Remove `-' from the end
	of the default value.  (Bug#14400)

2013-05-18  Glenn Morris  <rgm@gnu.org>

	* comint.el (comint-password-prompt-regexp):
	Allow "password for XXX" where XXX contains colons (eg https://...).

2013-05-18  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup): Use OCTAVE_SRCDIR
	instead.  Include "--no-gui" to prevent hangs for Octave > 3.7.
	(octave-source-directories): Don't check process.
	(octave-source-directories, octave-find-definition): Doc fix.

2013-05-18  Glenn Morris  <rgm@gnu.org>

	* progmodes/vhdl-mode.el (vhdl-mode-map-init):
	Remove backspace/delete bindings.  (Bug#14392)

	* cus-dep.el (custom-make-dependencies): Sort the output.
	(custom-versions-load-alist): Convert comment to doc.

2013-05-17  Leo Liu  <sdl.web@gmail.com>

	* newcomment.el (comment-search-backward): Stricter in finding
	comment start.  (Bug#14303)

	* progmodes/octave.el (octave-comment-start): Remove the SPC char.
	(octave-comment-start-skip): Properly anchored.

2013-05-17  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/smie.el (smie-highlight-matching-block-mode):
	Clean up when turned off.  (Bug#14395)
	(smie--highlight-matching-block-overlay): No longer buffer-local.
	(smie-highlight-matching-block): Adjust.

2013-05-17  Paul Eggert  <eggert@cs.ucla.edu>

	Doc string fix for "nanoseconds" (Bug#14406).
	* emacs-lisp/timer.el (timer-relative-time, timer-inc-time):
	Fix doc string typo that had "nanoseconds" instead of "microseconds".

2013-05-17  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-units.el (math-extract-units): Preserve powers
	of units.

2013-05-17  Leo Liu  <sdl.web@gmail.com>

	* subr.el (delete-consecutive-dups): New function.
	* ido.el (ido-set-matches-1): Use it.
	* progmodes/octave.el (inferior-octave-completion-table): Use it.
	* ido.el (ido-remove-consecutive-dups): Remove.

2013-05-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/f90.el (f90-keywords-re, f90-keywords-level-3-re)
	(f90-hpf-keywords-re, f90-constants-re): Use \\_< rather than
	regexp-opt's `words'.

2013-05-16  Leo Liu  <sdl.web@gmail.com>

	* emacs-lisp/smie.el (smie-matching-block-highlight): New face.
	(smie--highlight-matching-block-overlay)
	(smie--highlight-matching-block-lastpos)
	(smie--highlight-matching-block-timer): New variables.
	(smie-highlight-matching-block): New function.
	(smie-highlight-matching-block-mode): New minor mode.  (Bug#14395)
	(smie-setup): Conditionally enable smie-blink-matching-open.

2013-05-16  Wilson Snyder  <wsnyder@wsnyder.org>

	Sync with upstream verilog-mode r840.
	* progmodes/verilog-mode.el (verilog-mode-version)
	(verilog-mode-release-date): Update.
	(verilog-auto-lineup, verilog-auto-reset): Doc fixes.
	(verilog-sig-tieoff): Fix string error on
	AUTORESET with colon define, bug594.  Reported by Andrew Hou.
	(verilog-read-decls): Fix parameters confusing
	AUTOINST interfaces, bug565.  Reported by Leith Johnson.

2013-05-16  Eli Zaretskii  <eliz@gnu.org>

	* subr.el (reveal-filename): New function.

	* loadup.el: Compute Emacs executable versions on MS-Windows,
	where executables have the .exe extension.  Add a hard link
	emacs-XX.YY.ZZ.exe on MS-Windows.

	* Makefile.in (XARGS_LIMIT): New variable.
	(custom-deps, finder-data, autoloads)
	($(MH_E_DIR)/mh-loaddefs.el, $(TRAMP_DIR)/tramp-loaddefs.el)
	($(CAL_DIR)/cal-loaddefs.el, $(CAL_DIR)/diary-loaddefs.el)
	($(CAL_DIR)/hol-loaddefs.el): Use reveal-filename.
	(compile-main): Limit xargs according to $(XARGS_LIMIT).

2013-05-16  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-defun): Mark obsolete.
	(octave-mode-menu, octave-mode-map): Remove its uses.

2013-05-16  Reto Zimmermann  <reto@gnu.org>

	Sync with upstream vhdl mode v3.34.2.
	* progmodes/vhdl-mode.el: Use `push' throughout.
	(vhdl-version, vhdl-time-stamp, vhdl-doc-release-notes): Update.
	(vhdl-compiler-alist): Replace "\t\n" by "\\t\\n".
	Add IBM & Quartus compiler.  Enhance entry for ADVance MS compiler.
	(vhdl-actual-generic-name): New option to derive actual generic name.
	(vhdl-port-paste-signals): Replace formal by actual generics.
	(vhdl-beautify): New name for old group vhdl-align.  Update users.
	(vhdl-beautify-options): New option.
	(vhdl-last-input-event): New compat alias.  Use throughout.
	(vhdl-goto-line): Replace user level function `goto-line'.
	(vhdl-mode-map): Add bindings for vhdl-fix-statement-region,
	vhdl-fix-statement-buffer.
	(vhdl-create-mode-menu): Add some entries.
	(vhdl-align-region-groups): Respect vhdl-beautify-options.
	(vhdl-align-inline-comment-region-1): Handle "--" inside string.
	(vhdl-fixup-whitespace-region): Handle symbols at EOL.
	(vhdl-fix-statement-region, vhdl-fix-statement-buffer): New commands,
	to force statements on one line.
	(vhdl-remove-trailing-spaces-region):
	New, split from vhdl-remove-trailing-spaces.
	(vhdl-beautify-region): Fix statements, trailing spaces, ^M character.
	Respect vhdl-beautify-options.
	(vhdl-update-sensitivity-list-buffer): If non-interactive save buffer.
	(vhdl-update-sensitivity-list): Not add with index if exists without.
	Not include array index with signal.  Ignore keywords in comments.
	(vhdl-get-visible-signals): Regexp tweaks.
	(vhdl-template-component-inst): Handle empty library.
	(vhdl-template-type): Add template for 'enum' type.
	(vhdl-port-paste-generic-map, vhdl-port-paste-constants):
	Use vhdl-replace-string.
	(vhdl-port-paste-signals): Use vhdl-prepare-search-1.
	(vhdl-speedbar-mode-map): Rename from vhdl-speedbar-key-map.
	(vhdl-speedbar-initialize): Update for above name change.
	(vhdl-compose-wire-components): Fix in handling of constants.
	(vhdl-error-regexp-emacs-alist): New variable.
	(vhdl-error-regexp-add-emacs): New function;
	adds support for new compile.el (Emacs 22+)
	(vhdl-generate-makefile-1): Change target order for single lib. units.
	Allow use of absolute file names.

2013-05-16  Leo Liu  <sdl.web@gmail.com>

	* simple.el (prog-indent-sexp): Indent enclosing defun.

2013-05-15  Glenn Morris  <rgm@gnu.org>

	* cus-start.el (show-trailing-whitespace): Move to editing basics.
	* faces.el (trailing-whitespace): Don't use whitespace-faces group.
	* obsolete/old-whitespace.el (whitespace-faces): Remove group.
	(whitespace-highlight): Move to whitespace group.

	* comint.el (comint-source):
	* pcmpl-linux.el (pcmpl-linux):
	* shell.el (shell-faces):
	* eshell/esh-opt.el (eshell-opt):
	* international/ccl.el (ccl): Remove empty custom groups.

	* completion.el (dynamic-completion-mode):
	* jit-lock.el (jit-lock-debug-mode):
	* minibuffer.el (completion-in-region-mode):
	* type-break.el (type-break-mode-line-message-mode)
	(type-break-query-mode):
	* emulation/tpu-edt.el (tpu-edt-mode):
	* progmodes/subword.el (global-subword-mode, global-superword-mode):
	* progmodes/vhdl-mode.el (vhdl-electric-mode, vhdl-stutter-mode):
	* term/vt100.el (vt100-wide-mode): Specify explicit :group.

	* term/xterm.el (xterm): Change parent group to terminals.

	* master.el (master): Remove empty custom group.
	(master-mode): Remove unused :group argument.
	* textmodes/refill.el (refill): Remove empty custom group.
	(refill-mode): Remove unused :group argument.

	* textmodes/rst.el (rst-compile-toolsets): Use rst-compile group.

	* cus-dep.el: Provide a feature.
	(custom-make-dependencies): Ignore dotfiles (dir-locals).
	Don't mistakenly ignore files whose basenames match a basename
	from preloaded-file-list (eg cedet/ede/simple.el).
	Add a fallback method for getting :group.

2013-05-15  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-char-by-name): Rename from
	`isearch-insert-char-by-name'.  Doc fix.
	(isearch-forward): Mention `isearch-char-by-name' in
	the docstring.  (Bug#13348)

	* isearch.el (minibuffer-local-isearch-map): Bind "\r" to
	`exit-minibuffer' instead of
	`isearch-nonincremental-exit-minibuffer'.
	(isearch-edit-string): Remove mention of
	`isearch-nonincremental-exit-minibuffer' from docstring.
	(isearch-nonincremental-exit-minibuffer): Mark as obsolete.
	(isearch-forward-exit-minibuffer)
	(isearch-reverse-exit-minibuffer): Add docstring.  (Bug#13348)

2013-05-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* loadup.el: Just use unversioned DOC.

	* nxml/nxml-mode.el: Treat unclosed <[[, <?, comment, and other
	literals as extending to EOB.
	(nxml-last-fontify-end): Remove unused variable.
	(nxml-after-change1): Use with-silent-modifications.
	(nxml-extend-after-change-region): Simplify.
	(nxml-extend-after-change-region1): Remove function.
	(nxml-after-change1): Don't adjust for dependent regions.
	(nxml-fontify-matcher): Simplify.
	* nxml/xmltok.el (xmltok-dependent-regions): Remove variable.
	(xmltok-add-dependent): Remove function.
	(xmltok-scan-after-lt, xmltok-scan-after-processing-instruction-open)
	(xmltok-scan-after-comment-open, xmltok-scan-prolog-literal)
	(xmltok-scan-prolog-after-processing-instruction-open): Treat
	unclosed <[[, <?, comment, and other literals as extending to EOB.
	* nxml/rng-valid.el (rng-mark-xmltok-dependent-regions)
	(rng-mark-xmltok-dependent-region, rng-dependent-region-changed):
	Remove functions.
	(rng-do-some-validation-1): Don't mark dependent regions.
	* nxml/nxml-rap.el (nxml-adjust-start-for-dependent-regions)
	(nxml-mark-parse-dependent-regions, nxml-mark-parse-dependent-region)
	(nxml-clear-dependent-regions): Remove functions.
	(nxml-scan-after-change, nxml-scan-prolog, nxml-tokenize-forward)
	(nxml-ensure-scan-up-to-date):
	Don't clear&mark dependent regions.

2013-05-15  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-goto-function-definition):
	Improve and fix callers.

2013-05-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/cl-extra.el (cl-getf): Return the proper value in
	the setter (bug#14387).

	* progmodes/f90.el (f90-blocks-re): Include the terminating \> in the
	surrounding group (bug#14402).

2013-05-14  Juri Linkov  <juri@jurta.org>

	* subr.el (find-tag-default-as-regexp): Return nil if `tag' is nil.
	(Bug#14390)

2013-05-14  Glenn Morris  <rgm@gnu.org>

	* progmodes/f90.el (f90-imenu-generic-expression):
	Fix typo in 2013-05-08 change.  (Bug#14402)

2013-05-14  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el (gdb-running, gdb-starting):
	Remove signals for which replies are never received.

2013-05-14  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el: Fix non-responsive gud commands (bug#13845)
	(gdb-handler-alist, gdb-handler-number): Remove variables.
	(gdb-handler-list): New variable.
	(gdb-add-handler, gdb-delete-handler, gdb-get-handler-function)
	(gdb-pending-handler-p, gdb-handle-reply)
	(gdb-remove-all-pending-triggers): New functions.
	(gdb-discard-unordered-replies): New defcustom.
	(gdb-handler): New defstruct.
	(gdb-wait-for-pending): Fix invalid backquote.  Use gdb-handler-list.
	instead of gdb-pending-triggers.  Update docstring.
	(gdb-init-1): Remove dead variables.  Initialize gdb-handler-list.
	(gdb-speedbar-update, gdb-speedbar-timer-fn, gdb-var-update)
	(gdb-var-update-handler, def-gdb-auto-update-trigger)
	(def-gdb-auto-update-handler, gdb-get-changed-registers)
	(gdb-changed-registers-handler, gdb-get-main-selected-frame)
	(gdb-frame-handler): Pending triggers are now automatically managed.
	(def-gdb-trigger-and-handler, def-gdb-auto-update-handler):
	Remove argument.
	(gdb-input): Automatically handles pending triggers.  Update docstring.
	(gdb-resync): Replace gdb-pending-triggers by gdb-handler-list.
	(gdb-thread-exited, gdb-thread-selected, gdb-register-names-handler):
	Update comments.
	(gdb-done-or-error): Now use gdb-handle-reply.

2013-05-14  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el (gdb-input): Include token numbers in
	gdb-debug-log.

2013-05-14  Glenn Morris  <rgm@gnu.org>

	* subr.el (user-emacs-directory-warning): New option.
	(locate-user-emacs-file): Handle non-accessible .emacs.d.  (Bug#13930)

2013-05-14  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords): Fix error
	during redisplay.
	(octave-goto-function-definition, octave-find-definition): Minor tweaks.
	(octave-font-lock-texinfo-comment): Fix invalid search bound
	error: wrong side of point.

2013-05-14  Glenn Morris  <rgm@gnu.org>

	* progmodes/flymake.el (flymake-xml-program): New option.
	(flymake-xml-init): Use it.

	* term/xterm.el: Provide a feature.

	* term/sup-mouse.el: Move to obsolete/.  Provide a feature.

2013-05-13  Glenn Morris  <rgm@gnu.org>

	* cus-dep.el (defcustom-mh, defgroup-mh, defface-mh):
	Add compat aliases as a hack workaround.  (Bug#14384)

2013-05-13  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-comment): Fix indentation for
	###, and %!.
	(octave-mode-map): Bind octave-indent-defun to C-c C-q instead of
	C-M-q.
	(octave-comment-start-skip): Include %!.
	(octave-mode): Set comment-start-skip to octave-comment-start-skip.

2013-05-12  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup): Store the value
	of __octave_srcdir__ for octave-source-directories.
	(inferior-octave-check-process): New function refactored out of
	inferior-octave-send-list-and-digest.
	(octave-source-directories)
	(octave-find-definition-filename-function): New variables.
	(octave-source-directories)
	(octave-find-definition-default-filename): New functions.
	(octave-find-definition): Improve to find functions implemented in C++.

2013-05-12  Glenn Morris  <rgm@gnu.org>

	* calendar/diary-lib.el (diary-outlook-format-1):
	Don't include dayname in the output.  (Bug#14349)

2013-05-11  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/autoload.el (generated-autoload-load-name): Doc fix.

	* cus-dep.el (custom-make-dependencies): Only use safe local variables.
	Treat cc-provide like provide.

2013-05-11  Kevin Ryde  <user42@zip.com.au>

	* cus-dep.el (custom-make-dependencies):
	Use generated-autoload-load-name for the sake of files such
	such cedet/semantic/bovine/c.el, where the base file name
	is not in load-path.  (Bug#5277)

2013-05-11  Glenn Morris  <rgm@gnu.org>

	* dos-vars.el, emacs-lisp/cl-indent.el, emulation/tpu-extras.el:
	Provide features.

2013-05-11  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-indent-comment): Improve.
	(octave-eldoc-message-style, octave-eldoc-cache): New variables.
	(octave-eldoc-function-signatures, octave-eldoc-function):
	New functions.
	(octave-mode, inferior-octave-mode): Add eldoc support.

2013-05-11  Richard Stallman  <rms@gnu.org>

	* epa.el (epa-decrypt-file): Take output file name as argument
	and read it using `interactive'.

2013-05-11  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-beginning-of-line)
	(octave-end-of-line): Check before using up-list because it jumps
	out of more syntactic contructs since moving to smie.
	(octave-indent-comment): New function.
	(octave-mode): Use it in smie-indent-functions.  (Bug#14350)
	(octave-begin-keywords, octave-end-keywords)
	(octave-reserved-words, octave-smie-bnf-table)
	(octave-smie-rules): Add new keywords from Octave 3.6.4.

2013-05-11  Glenn Morris  <rgm@gnu.org>

	* faces.el (internal-face-x-get-resource):
	* frame.el (ns-display-monitor-attributes-list):
	* calc/calc-aent.el (math-to-radians-2):
	* emacs-lisp/package.el (tar-header-name, tar-header-link-type):
	Fix declarations.

	* calc/calc-menu.el: Make it loadable in isolation.

	* net/eudcb-bbdb.el: Make it loadable without bbdb.
	(eudc-bbdb-filter-non-matching-record, eudc-bbdb-extract-phones)
	(eudc-bbdb-extract-addresses, eudc-bbdb-format-record-as-result)
	(eudc-bbdb-query-internal): Require 'bbdb.

	* lpr.el (lpr-headers-switches):
	* emacs-lisp/testcover.el (testcover-compose-functions): Fix :type.

	* progmodes/sql.el (sql-login-params): Fix and improve :type.

	* emulation/edt-mapper.el: In batch mode, error rather than hang.

	* term.el (term-set-escape-char): Make it idempotent.

2013-05-10  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-completion-table):
	No longer a function and all uses changed.  Use cache to speed up
	completion due to bug#11906.
	(octave-beginning-of-defun): Re-write to be more general.

2013-05-10  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/cl-macs.el (cl-loop): Doc fix.

2013-05-09  Stefan Monnier  <monnier@iro.umontreal.ca>

	* comint.el (comint-redirect-send-command-to-process): Use :around
	rather than :override for comint-redirect-filter.
	(comint-redirect-filter): Add the corresponding `orig-filter' argument.
	Call it instead of comint-redirect-original-filter-function (which
	is gone).  Reported by Juanma Barranquero <lekktu@gmail.com>.

2013-05-09  Jan Djärv  <jan.h.d@swipnet.se>

	* frame.el (display-monitor-attributes-list): Add NS case.
	(ns-display-monitor-attributes-list): Declare.

2013-05-09  Ulrich Mueller  <ulm@gentoo.org>

	* descr-text.el (describe-char): Fix %d/%x typo.  (Bug#14360)

2013-05-09  Glenn Morris  <rgm@gnu.org>

	* international/fontset.el (vertical-centering-font-regexp):
	Set standard-value.

	* tar-mode.el (tar-superior-buffer, tar-superior-descriptor): Add doc.

	* bookmark.el (bookmark-search-delay):
	* cus-start.el (vertical-centering-font-regexp):
	* ps-mule.el (ps-mule-font-info-database-default):
	* ps-print.el (ps-default-fg, ps-default-bg):
	* type-break.el (type-break-good-break-interval):
	* whitespace.el (whitespace-indentation-regexp)
	(whitespace-space-after-tab-regexp):
	* emacs-lisp/testcover.el (testcover-1value-functions)
	(testcover-noreturn-functions, testcover-progn-functions)
	(testcover-prog1-functions):
	* emulation/viper-init.el (viper-emacs-state-cursor-color):
	* eshell/em-glob.el (eshell-glob-translate-alist):
	* play/tetris.el (tetris-tty-colors):
	* progmodes/cpp.el (cpp-face-default-list):
	* progmodes/flymake.el (flymake-allowed-file-name-masks):
	* progmodes/idlw-help.el (idlwave-help-browser-generic-program)
	(idlwave-help-browser-generic-args):
	* progmodes/make-mode.el (makefile-special-targets-list):
	* progmodes/python.el (python-shell-virtualenv-path):
	* progmodes/verilog-mode.el (verilog-active-low-regexp)
	(verilog-auto-input-ignore-regexp, verilog-auto-inout-ignore-regexp)
	(verilog-auto-output-ignore-regexp, verilog-auto-tieoff-ignore-regexp)
	(verilog-auto-unused-ignore-regexp, verilog-typedef-regexp):
	* textmodes/reftex-vars.el (reftex-format-label-function):
	* textmodes/remember.el (remember-diary-file): Fix custom types.

	* jka-cmpr-hook.el (jka-compr-mode-alist-additions): Fix typo.
	Add :version.

2013-05-09  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-completion-at-point):
	Restore file completion.  (Bug#14300)
	(inferior-octave-startup): Fix incorrect highlighting for the
	first prompt.

2013-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/ruby-mode.el: First cut at SMIE support.
	(ruby-use-smie): New var.
	(ruby-smie-grammar): New constant.
	(ruby-smie--bosp, ruby-smie--implicit-semi-p)
	(ruby-smie--forward-token, ruby-smie--backward-token)
	(ruby-smie-rules): New functions.
	(ruby-mode-variables): Setup SMIE if applicable.

2013-05-08  Eli Zaretskii  <eliz@gnu.org>

	* simple.el (line-move-visual): Signal beginning/end of buffer
	only if vertical-motion moved less than it was requested.  Avoids
	silly incorrect error messages when there are display strings with
	multiple newlines at EOL.

2013-05-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/vera-mode.el (vera-underscore-is-part-of-word):
	* progmodes/prolog.el (prolog-underscore-wordchar-flag)
	(prolog-char-quote-workaround):
	* progmodes/cperl-mode.el (cperl-under-as-char):
	* progmodes/vhdl-mode.el (vhdl-underscore-is-part-of-word):
	Mark as obsolete.
	(vhdl-mode-syntax-table, vhdl-mode-ext-syntax-table): Initialize in
	their declaration.
	(vhdl-mode-syntax-table-init): Remove.

	* progmodes/m4-mode.el (m4-mode-syntax-table): Add comment on
	last change.

	* progmodes/ld-script.el (ld-script-mode-syntax-table): Use symbol
	syntax for "_".
	(ld-script-font-lock-keywords):
	Change regexps to use things like \_< and \_>.

	* progmodes/f90.el (f90-mode-syntax-table): Use symbol syntax for "_".
	Change all regexps to use things like \_< and \_>.

	* progmodes/autoconf.el (autoconf-definition-regexp)
	(autoconf-font-lock-keywords, autoconf-current-defun-function):
	Handle a _ with symbol syntax.
	(autoconf-mode): Don't change the syntax-table for imenu and font-lock.

	* progmodes/ada-mode.el (ada-mode-abbrev-table):
	Consolidate declaration.
	(ada-mode-syntax-table, ada-mode-symbol-syntax-table): Initialize in
	the declaration.
	(ada-create-syntax-table): Remove.
	(ada-capitalize-word): Don't mess with the syntax of "_" since it
	already has the right syntax nowadays.
	(ada-goto-next-word): Don't change the syntax of "_".

	* font-lock.el (lisp-font-lock-keywords-2): Don't highlight obsolete
	with-wrapper-hook.

2013-05-08  Sam Steingold  <sds@gnu.org>

	* thingatpt.el (thing-at-point): Accept optional second argument
	NO-PROPERTIES to strip the text properties from the return value.
	* net/browse-url.el (browse-url-url-at-point): Pass NO-PROPERTIES
	to `thing-at-point' instead of stripping the properties ourselves.
	Also, when `thing-at-point' fails to find a url, prepend "http://"
	to the filename at point on the assumption that the user is
	pointing at something like gnu.org/gnu.

2013-05-08  Juanma Barranquero  <lekktu@gmail.com>

	* emacs-lisp/bytecomp.el (byte-compile-insert-header):
	* faces.el (crm-separator):
	Silence byte-compiler.

	* progmodes/gud.el (gdb-speedbar-auto-raise, gud-tooltip-mode)
	(tool-bar-map): Remove unneeded defvars.

2013-05-08  Leo Liu  <sdl.web@gmail.com>

	Re-work a fix for bug#10994 based on Le Wang's patch.
	* ido.el (ido-remove-consecutive-dups): New helper.
	(ido-completing-read): Use it.
	(ido-chop): Revert fix for bug#10994.

2013-05-08  Adam Spiers  <emacs@adamspiers.org>

	* cus-edit.el (custom-save-variables):
	Pretty-print long values.  (Bug#14187)

2013-05-08  Glenn Morris  <rgm@gnu.org>

	* progmodes/m4-mode.el (m4-program): Assume it is in PATH.
	(m4-mode-syntax-table): Init in the defvar.
	(m4-mode-abbrev-table): Let define-derived-mode define it.

2013-05-08  Tom Tromey  <tromey@redhat.com>

	* progmodes/m4-mode.el (m4-mode-syntax-table):
	Do not treat "_" as word constituent.  (Bug#14167)

2013-05-07  Glenn Morris  <rgm@gnu.org>

	* eshell/em-hist.el (eshell-isearch-map): Initialize in the defvar.
	Remove explicit eshell-isearch-cancel-map.

	* progmodes/f90.el (f90-smart-end-names): New option.
	(f90-smart-end): Doc fix.
	(f90-end-block-optional-name): New constant.
	(f90-block-match): Respect f90-smart-end-names.

2013-05-07  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/octave.el (octave-smie-forward-token): Be more careful
	about implicit semi-colons (bug#14218).

2013-05-07  YAMAMOTO Mitsuharu  <mituharu@math.s.chiba-u.ac.jp>

	* frame.el (display-monitor-attributes-list)
	(frame-monitor-attributes): New functions.

2013-05-06  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-syntax-propertize-function): Change
	\'s syntax to escape when inside double-quoted strings.  (Bug#14332)
	(octave-font-lock-keywords): Use octave-operator-regexp.
	(octave-completion-at-point): Rename from
	octave-completion-at-point-function.
	(inferior-octave-directory-tracker): Robustify.
	(octave-text-functions): Remove and fix its uses.  No such things
	any more.

2013-05-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/trace.el (trace--display-buffer): New function.
	(trace-make-advice): Use it.

2013-05-06  Juri Linkov  <juri@jurta.org>

	* emacs-lisp/lisp-mode.el (eval-defun-2): Doc fix.  (Bug#14344)
	(eval-defun-2, eval-defun, eval-last-sexp, eval-last-sexp-1):
	Doc fix.
	(emacs-lisp-mode-map): Replace "minibuffer" with "echo area"
	in the help string.  (Bug#12985)

2013-05-06  Kelly Dean  <kellydeanch@yahoo.com>  (tiny change)

	* simple.el (shell-command-on-region): Doc fix.  (Bug#14279)

2013-05-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/perl-mode.el: Add support for here documents.
	(perl-syntax-propertize-function): Match here-doc markers.
	(perl-syntax-propertize-special-constructs): Find their end.
	(perl-imenu-generic-expression): Use [:alnum:].

	* emacs-lisp/nadvice.el (advice--member-p): Return the advice if found.
	(advice--add-function): Refresh the advice if already present
	(bug#14317).

2013-05-06  Ivan Andrus  <darthandrus@gmail.com>

	* find-file.el (cc-other-file-alist): Add ".m" for ObjC.  (Bug#14339)

2013-05-06  Glenn Morris  <rgm@gnu.org>

	* w32-fns.el (w32-charset-info-alist): Declare.

	* eshell/em-cmpl.el: Simply require pcomplete; eg we use a bunch
	of its defcustom properties.
	(eshell-cmpl-initialize): No need to load pcomplete.

	* generic-x.el: No need to require comint when compiling.

	* net/eudc-export.el: Make it loadable without bbdb.
	(top-level): Use require rather than load-library.
	(eudc-create-bbdb-record, eudc-bbdbify-phone)
	(eudc-batch-export-records-to-bbdb)
	(eudc-insert-record-at-point-into-bbdb, eudc-try-bbdb-insert):
	Require bbdb.

2013-05-06  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/octave.el (octave-texinfo-font-lock-keywords): Remove.
	(octave-font-lock-texinfo-comment): Use texinfo-font-lock-keywords with
	some tweaks, instead.

2013-05-05  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords)
	(octave-font-lock-texinfo-comment): Adjust for the byte-compiler.
	(inferior-octave-send-list-and-digest): Improve error message.
	(octave-mode, inferior-octave-mode): Use setq-local.
	(octave-help): Set info-lookup-mode.

2013-05-05  Richard Stallman  <rms@gnu.org>

	* vc/compare-w.el (compare-windows-whitespace):
	Treat no-break space as whitespace.

	* mail/rmailsum.el (rmail-summary-rmail-update):
	Detect empty summary and don't change selected message.
	(rmail-summary-goto-msg): Likewise.

	* mail/rmailsum.el (rmail-new-summary, rmail-new-summary-1):
	Doc fixes, rename args.

2013-05-05  Alan Mackenzie  <acm@muc.de>

	* progmodes/cc-defs.el (c-version): Increment to 5.32.5.

2013-05-05  Juri Linkov  <juri@jurta.org>

	* info.el (Info-read-subfile): Use (point-min) instead of (point)
	to not add the length of the summary segment to the return value.
	(Bug#14125)

2013-05-05  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-strip-ctrl-g)
	(inferior-octave-output-filter): Remove.
	(octave-send-region, inferior-octave-startup): Fix callers.
	(inferior-octave-mode-map): Don't use comint-dynamic-complete.
	(octave-binary-file-extensions): New user variable.
	(octave-find-definition): Confirm if opening binary files.
	(octave-help-file): Use octave-find-definition to get the binary
	confirmation.
	(octave-help): Adjust for octave-help-file change.

2013-05-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/pascal.el (pascal-font-lock-keywords): Use backquotes.
	Merge the two entries that handle function definitions.
	(pascal--syntax-propertize): New const.
	(pascal-mode): Use it.  Use setq-local.

2013-05-04  Glenn Morris  <rgm@gnu.org>

	* calendar/diary-lib.el (diary-from-outlook-function): New variable.
	(diary-from-outlook): Respect diary-from-outlook-function.

2013-05-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* simple.el (read-expression-map): Use completion-at-point (bug#14255).
	Move the declaration from C.
	(read-minibuffer, eval-minibuffer): Move from C.
	(completion-setup-function): Avoid minibuffer-completion-contents.

2013-05-03  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords): Do not
	dehighlight 'end' in comments or strings.
	(octave-completing-read, octave-goto-function-definition):
	New helpers.
	(octave-help-buffer): New user variable.
	(octave-help-file, octave-help-function): New button types.
	(octave-help): New command and bind it to C-h ;.
	(octave-find-definition): New command and bind it to M-.
	(user-error): Alias to error if not defined.

2013-05-02  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-mode-syntax-table): Correct syntax
	for \.  (bug#14332)
	(octave-font-lock-keywords): Include [ and {.

2013-05-02  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup-file): Change default.
	(inferior-octave): Remove calling comint-mode and return the buffer.
	(inferior-octave-startup): Cosmetic changes.

2013-05-02  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-syntax-propertize-function):
	Include the case when ' is at line beginning.  (Bug#14336)

2013-05-02  Glenn Morris  <rgm@gnu.org>

	* vc/vc-dir.el (vc-dir-mode): Don't autoload it for everyone.
	* desktop.el (vc-dir-mode): Just autoload it here.

2013-05-02  Alan Mackenzie  <acm@muc.de>

	Eliminate variable c-standard-font-lock-fontify-region-function.
	* progmodes/cc-mode.el
	(c-standard-font-lock-fontify-region-function): Remove.
	(c-font-lock-fontify-region, c-after-font-lock-init): Adapt.

2013-05-01  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el: Compatible with older emacs-24 releases.
	(inferior-octave-has-built-in-variables): Remove.  Built-in
	variables were removed from Octave in 2007.
	(inferior-octave-startup): Fix uses.
	(comint-line-beginning-position): Remove compatibility code for
	emacs 21.

2013-05-01  Juri Linkov  <juri@jurta.org>

	* isearch.el (isearch-forward, isearch-mode): Doc fix.  (Bug#13923)

2013-05-01  Juri Linkov  <juri@jurta.org>

	* comint.el (comint-previous-matching-input): Don't print message
	"History item: %d" when `isearch-mode' is active.
	(comint-history-isearch-message): Print message "History item: %d"
	when `comint-input-ring-index' is not empty and this function is
	called from `isearch-update' with a nil `ellipsis'.  (Bug#13223)

2013-05-01  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-abbrev-table): Remove abbrev
	definitions.  Use completion-at-point to insert keywords.
	(octave-abbrev-start): Remove.
	(inferior-octave-mode, octave-mode): Use :abbrev-table instead.

2013-04-30  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-prompt-read-only): Fix last
	change.

2013-04-30  Alan Mackenzie  <acm@muc.de>

	Handle arbitrarily long C++ member initialisation lists.
	* progmodes/cc-engine.el (c-back-over-member-initializers):
	new function.
	(c-guess-basic-syntax): New CASE 5R (extracted from 5B) to handle
	(most) member init lists.

2013-04-30  Rüdiger Sonderfeld  <ruediger@c-plusplus.de>

	* progmodes/octave.el (inferior-octave-prompt-read-only): New user
	variable.

2013-04-30  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-variables): Remove.  No builtin
	variables any more.  All converted to functions.
	(octave-font-lock-keywords, octave-completion-at-point-function):
	Fix uses.
	(octave-font-lock-texinfo-comment): New user variable.
	(octave-texinfo-font-lock-keywords): New variable for texinfo
	comment block.
	(octave-function-comment-block): New face.
	(octave-font-lock-texinfo-comment): New function.
	(octave-mode): Font lock texinfo comment block.

2013-04-29  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-font-lock-keywords): Handle 'end' in
	indexing expression.
	(octave-continuation-string): Do not use \.
	(inferior-octave-complete-impossible): Remove.
	(inferior-octave-completion-table)
	(inferior-octave-completion-at-point): Remove its uses.
	(inferior-octave-startup): completion_matches was introduced to
	Octave in 1996 so safe to assume it.
	(octave-function-file-comment): Improve to follow how Octave does it.
	(octave-update-function-file-comment): Tweak.

2013-04-29  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (inferior-octave-startup-hook): Obsolete.
	(inferior-octave-startup): Remove inferior-octave-startup-hook.
	(octave-function-file-comment): Fix typo.
	(octave-sync-function-file-names): Use read-char-choice.

2013-04-28  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc.el (math-normalize): Don't set `math-normalize-error'
	to t for the less important warnings.

2013-04-27  Darren Hoo  <darren.hoo@gmail.com>  (tiny change)

	* isearch.el (isearch-fail-pos): Check for empty `cmds'.  (Bug#14268)

2013-04-27  Glenn Morris  <rgm@gnu.org>

	* vc/log-view.el (log-view-current-entry):
	Treat "---" separator lines as part of the following rev.  (Bug#14169)

2013-04-27  Juri Linkov  <juri@jurta.org>

	* subr.el (read-number): Doc fix about using it by interactive
	code letter `n'.  (Bug#14254)

2013-04-27  Juri Linkov  <juri@jurta.org>

	* desktop.el (desktop-auto-save-timeout): New option.
	(desktop-file-checksum): New variable.
	(desktop-save): Add optional arg `auto-save' and don't auto-save
	if nothing changed.
	(desktop-auto-save-timer): New variable.
	(desktop-auto-save, desktop-auto-save-set-timer): New functions.
	(after-init-hook): Call `desktop-auto-save-set-timer'.
	Suggested by Reuben Thomas <rrt@sc3d.org> in
	<http://lists.gnu.org/archive/html/emacs-devel/2013-04/msg00327.html>.

2013-04-27  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-function-file-p)
	(octave-skip-comment-forward, octave-function-file-comment)
	(octave-update-function-file-comment): New functions.
	(octave-mode-map): Bind C-c ; to
	octave-update-function-file-comment.
	(octave-mode-menu): Add octave-update-function-file-comment.
	(octave-mode, inferior-octave-mode): Fix doc-string.
	(octave-insert-defun): Conform to Octave's coding convention.
	(Bug#14285)

	* files.el (basic-save-buffer): Don't let errors in
	before-save-hook prevent saving buffer.

2013-04-20  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Use completing-read if arg multiple
	is nil.

2013-04-27  Ingo Lohmar  <i.lohmar@gmail.com>  (tiny change)

	* ls-lisp.el (ls-lisp-insert-directory): If no files are
	displayed, move point to after the totals line.
	See http://lists.gnu.org/archive/html/emacs-devel/2013-04/msg00677.html
	for the details.

2013-04-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-autoload-ensure-default-file):
	Add current dir to the load-path.
	(package-generate-autoloads): Don't rely on
	autoload-ensure-default-file.

2013-04-26  Reuben Thomas  <rrt@sc3d.org>

	* textmodes/remember.el (remember-store-in-files): Document that
	the file name format is passed to `format-time-string'.

2013-04-26  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-sync-function-file-names): New function.
	(octave-mode): Use it in before-save-hook.

2013-04-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/tabulated-list.el (tabulated-list-mode): Disable undo
	(bug#14274).

	* progmodes/octave.el (octave-smie-forward-token): Properly skip
	\n and comment, even if it's not an implicit ; (bug#14218).

2013-04-26  Glenn Morris  <rgm@gnu.org>

	* subr.el (read-number): Once more use `read' rather than
	`string-to-number', to trap non-numeric input.  (Bug#14254)

2013-04-26  Erik Charlebois  <erikcharlebois@gmail.com>

	* emacs-lisp/syntax.el (syntax-propertize-multiline):
	Use `syntax-multiline' text property consistently instead of
	`font-lock-multiline'.  (Bug#14237)

2013-04-26  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/shadow.el (list-load-path-shadows):
	No longer necessary to check for duplicate simple.el, since
	2012-07-07 change to init_lread to not include installation lisp
	directories in load-path when running uninstalled.  (Bug#14270)

2013-04-26  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-submit-bug-report): Obsolete.
	(octave-mode, inferior-octave-mode): Use setq-local.
	(octave-not-in-string-or-comment-p): Rename to
	octave-in-string-or-comment-p.
	(octave-in-comment-p, octave-in-string-p)
	(octave-in-string-or-comment-p): Replace defsubst with defun.

2013-04-25  Paul Eggert  <eggert@cs.ucla.edu>

	* Makefile.in (distclean): Remove $(lisp)/loaddefs.el~.

2013-04-25  Bastien Guerry  <bzg@gnu.org>

	* textmodes/remember.el (remember-data-directory)
	(remember-directory-file-name-format): Fix custom types.

2013-04-25  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave.el (octave-completion-at-point-function):
	Make use of inferior octave process.
	(octave-initialize-completions): Remove.
	(inferior-octave-completion-table): New function.
	(inferior-octave-completion-at-point): Use it.
	(octave-completion-alist): Remove.

2013-04-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/opascal.el: Use font-lock and syntax-propertize.
	(opascal-mode-syntax-table): New var.
	(opascal-literal-kind, opascal-is-literal-end)
	(opascal-literal-token-at): Rewrite.
	(opascal--literal-start-re, opascal-font-lock-keywords)
	(opascal--syntax-propertize): New constants.
	(opascal-font-lock-defaults): Adjust.
	(opascal-mode): Use them.  Set comment-<foo> variables as well.
	(delphi-comment-face, opascal-comment-face, delphi-string-face)
	(opascal-string-face, delphi-keyword-face, opascal-keyword-face)
	(delphi-other-face, opascal-other-face): Remove face variables.
	(opascal-save-state): Remove macro.
	(opascal-fontifying-progress-step): Remove constant.
	(opascal--ignore-changes): Remove var.
	(opascal-set-token-property, opascal-parse-next-literal)
	(opascal-is-stable-literal, opascal-complete-literal)
	(opascal-is-literal-start, opascal-face-of)
	(opascal-parse-region, opascal-parse-region-until-stable)
	(opascal-fontify-region, opascal-after-change)
	(opascal-debug-show-is-stable, opascal-debug-unparse-buffer)
	(opascal-debug-parse-region, opascal-debug-parse-window)
	(opascal-debug-parse-buffer, opascal-debug-fontify-window)
	(opascal-debug-fontify-buffer): Remove.
	(opascal-debug-mode-map): Adjust accordingly.

2013-04-25  Leo Liu  <sdl.web@gmail.com>

	Merge octave-mod.el and octave-inf.el into octave.el with some
	cleanups.
	* progmodes/octave.el: New file renamed from octave-mod.el.
	* progmodes/octave-inf.el: Merged into octave.el.
	* progmodes/octave-mod.el: Renamed to octave.el.

2013-04-25  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el
	(reftex-label-ignored-macros-and-environments): New defcustom.

	* textmodes/reftex-parse.el (reftex-parse-from-file): Use it.

2013-04-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-indent--hanging-p): Don't burp at EOB.
	(smie-indent-keyword): Improve the check to ensure that the next
	comment is really on the same line.
	(smie-indent-comment): Don't align with a subsequent closer (or eob).

	* progmodes/octave-mod.el (octave-smie-forward-token): Only emit
	semi-colons if the line is not otherwise empty (bug#14218).

2013-04-25  Glenn Morris  <rgm@gnu.org>

	* vc/vc-bzr.el (vc-bzr-print-log): Tweak LIMIT = 1 case.

2013-04-24  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/opascal.el (opascal-set-token-property): Rename from
	opascal-set-text-properties and only set `token' (bug#14134).
	Suggested by Erik Knowles <eknowles@geosystemsoftware.com>.
	(opascal-literal-text-properties): Remove.
	(opascal-parse-next-literal, opascal-debug-unparse-buffer):
	Adjust callers.

2013-04-24  Reuben Thomas  <rrt@sc3d.org>

	* textmodes/remember.el (remember-handler-functions): Add an
	option for a new handler `remember-store-in-files'.
	(remember-data-directory, remember-directory-file-name-format):
	New options.
	(remember-store-in-files): New function to store remember notes
	as separate files within a directory.

2013-04-24  Magnus Henoch  <magnus.henoch@gmail.com>

	* progmodes/compile.el (compilation-next-error-function):
	Pass "formats" to compilation-find-file (bug#11777).

2013-04-24  Glenn Morris  <rgm@gnu.org>

	* vc/vc-bzr.el (vc-bzr-print-log):
	* vc/vc-hg.el (vc-hg-print-log):
	* vc/vc-svn.el (vc-svn-print-log):
	Fix START-REVISION with LIMIT != 1.  (Bug#14168)

	* vc/vc-bzr.el (vc-bzr-print-log):
	* vc/vc-cvs.el (vc-cvs-print-log):
	* vc/vc-git.el (vc-git-print-log):
	* vc/vc-hg.el (vc-hg-print-log):
	* vc/vc-mtn.el (vc-mtn-print-log):
	* vc/vc-rcs.el (vc-rcs-print-log):
	* vc/vc-sccs.el (vc-sccs-print-log):
	* vc/vc-svn.el (vc-svn-print-log):
	* vc/vc.el (vc-print-log-internal): Doc fixes.

2013-04-23  Glenn Morris  <rgm@gnu.org>

	* startup.el (normal-no-mouse-startup-screen, normal-about-screen):
	Remove venerable code attempting to avoid substitute-command-keys.

2013-04-23  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (reftex-label-regexps):
	Call `reftex-compile-variables' after changes to this variable.

2013-04-23  Stefan Monnier  <monnier@iro.umontreal.ca>

	* jit-lock.el: Fix signals in jit-lock-force-redisplay (bug#13542).
	Use lexical-binding.
	(jit-lock-force-redisplay): Use markers, check buffer's continued
	existence and beware narrowed buffers.
	(jit-lock-fontify-now): Adjust call accordingly.

2013-04-22  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (minibuffer-completion-contents): Fix obsolescence info
	to avoid misleading the user.

2013-04-22  Leo Liu  <sdl.web@gmail.com>

	* info-look.el: Prefer latex2e.info.  (Bug#14240)

2013-04-22  Michael Albinus  <michael.albinus@gmx.de>

	Fix pack/unpack coding.  Reported by David Smith <davidsmith@acm.org>.

	* net/tramp-compat.el (tramp-compat-call-process): Move function ...
	* net/tramp.el (tramp-call-process): ... here.
	(tramp-set-completion-function, tramp-parse-putty):
	* net/tramp-adb.el (tramp-adb-execute-adb-command):
	* net/tramp-gvfs.el (tramp-gvfs-send-command):
	* net/tramp-sh.el (tramp-sh-handle-set-file-times)
	(tramp-set-file-uid-gid, tramp-sh-handle-write-region)
	(tramp-call-local-coding-command): Use `tramp-call-process'
	instead of `tramp-compat-call-process'.

	* net/tramp-sh.el (tramp-perl-pack, tramp-perl-unpack): New defconst.
	(tramp-local-coding-commands, tramp-remote-coding-commands): Use them.
	(tramp-sh-handle-file-local-copy, tramp-sh-handle-write-region):
	(tramp-find-inline-compress): Improve traces.
	(tramp-maybe-send-script): Check for Perl binary.
	(tramp-get-inline-coding): Do not redirect STDOUT for local decoding.

2013-04-22  Daiki Ueno  <ueno@gnu.org>

	* epg.el (epg-context-pinentry-mode): New function.
	(epg-context-set-pinentry-mode): New function.
	(epg--start): Pass --pinentry-mode option to gpg command.

2013-04-21  Xue Fuqiao  <xfq.free@gmail.com>

	* comint.el (comint-dynamic-complete-functions, comint-mode-map):
	`comint-dynamic-complete' is obsolete since 24.1, replaced by
	`completion-at-point'.  (Bug#13774)

	* startup.el (normal-no-mouse-startup-screen): Bug fix, the
	default key binding for `describe-distribution' has been moved to
	`C-h C-o'.  (Bug#13970)

2013-04-21  Glenn Morris  <rgm@gnu.org>

	* vc/vc.el (vc-print-log-setup-buttons, vc-print-log-internal):
	Add doc strings.
	(vc-print-log): Clarify interactive prompt.

2013-04-20  Glenn Morris  <rgm@gnu.org>

	* emacs-lisp/bytecomp.el (byte-compile-insert-header):
	No longer include timestamp etc information.

2013-04-20  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Bug fix, return just one face if arg
	multiple is nil.  (Bug#14209)

2013-04-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (advice--where-alist): Add :override.
	(remove-function): Autoload.

	* comint.el (comint-redirect-original-filter-function): Remove.
	(comint-redirect-cleanup, comint-redirect-send-command-to-process):
	* vc/vc-cvs.el (vc-cvs-annotate-process-filter)
	(vc-cvs-annotate-command):
	* progmodes/octave-inf.el (inferior-octave-send-list-and-digest):
	* progmodes/prolog.el (prolog-consult-compile):
	* progmodes/gdb-mi.el (gdb, gdb--check-interpreter):
	Use add/remove-function instead.
	* progmodes/gud.el (gud-tooltip-original-filter): Remove.
	(gud-tooltip-process-output, gud-tooltip-tips):
	Use add/remove-function instead.
	* progmodes/xscheme.el (xscheme-previous-process-state): Remove.
	(scheme-interaction-mode, exit-scheme-interaction-mode):
	Use add/remove-function instead.

	* vc/vc-dispatcher.el: Use lexical-binding.
	(vc--process-sentinel): Rename from vc-process-sentinel.
	Change last arg to be the code to run.  Don't use vc-previous-sentinel
	and vc-sentinel-commands any more.
	(vc-exec-after): Allow code to be a function.  Use add/remove-function.
	(compilation-error-regexp-alist, view-old-buffer-read-only): Declare.

2013-04-19 Masatake YAMATO  <yamato@redhat.com>

	* progmodes/sh-script.el (sh-imenu-generic-expression):
	Handle function names with a single character.   (Bug#14111)

2013-04-19  Dima Kogan  <dima@secretsauce.net>    (tiny change)

	* progmodes/gud.el (gud-perldb-marker-filter): Understand position info
	for subroutines defined in an eval (bug#14182).

2013-04-19  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* bookmark.el (bookmark-completing-read): Improve handling of empty
	string (bug#14176).

2013-04-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-dispatcher.el (vc-do-command): Get rid of default sentinel msg.

2013-04-19  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	New faster Imenu implementation (bug#14058).
	* progmodes/python.el:
	(python-imenu-prev-index-position):
	(python-imenu-format-item-label-function)
	(python-imenu-format-parent-item-label-function)
	(python-imenu-format-parent-item-jump-label-function):
	New vars.
	(python-imenu-format-item-label)
	(python-imenu-format-parent-item-label)
	(python-imenu-format-parent-item-jump-label)
	(python-imenu--put-parent, python-imenu--build-tree)
	(python-imenu-create-index, python-imenu-create-flat-index)
	(python-util-popn): New functions.
	(python-mode): Set imenu-create-index-function to
	python-imenu-create-index.

2013-04-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* winner.el (winner-active-region): Use region-active-p, activate-mark
	and deactivate-mark (bug#14225).

	* simple.el (deactivate-mark): Don't inline it.

2013-04-18  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-remote-process-environment): Add "TMOUT=0".

2013-04-18  Tassilo Horn  <tsdh@gnu.org>

	* files.el (auto-mode-alist): Delete OpenDocument and StarOffice
	file extensions from the archive-mode entry in order to prefer
	doc-view-mode-maybe with archive-mode as fallback (bug#14188).

2013-04-18  Leo Liu  <sdl.web@gmail.com>

	* bindings.el (help-event-list): Add ?\?.

2013-04-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (with-wrapper-hook): Declare obsolete.
	* simple.el (filter-buffer-substring-function): New hook.
	(filter-buffer-substring): Use it.
	(filter-buffer-substring-functions): Mark obsolete.
	* minibuffer.el (completion-in-region-function): New hook.
	(completion-in-region): Use it.
	(completion-in-region-functions): Mark obsolete.
	* mail/mailabbrev.el (mail-abbrevs-setup): Use abbrev-expand-function.
	* abbrev.el (abbrev-expand-function): New hook.
	(expand-abbrev): Use it.
	(abbrev-expand-functions): Mark obsolete.
	* emacs-lisp/nadvice.el (advice--where-alist): Add :filter-args
	and :filter-return.

2013-04-17  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-nav--syntactically): Fix cornercases
	and do not care about match data.

2013-04-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/lisp.el (lisp-completion-at-point): Provide specialized
	completion tables when completing error conditions and
	`declare' arguments.
	(lisp-complete-symbol, field-complete): Mark as obsolete.
	(check-parens): Unmatched parens are user errors.
	* minibuffer.el (minibuffer-completion-contents): Mark as obsolete.

2013-04-17  Michal Nazarewicz  <mina86@mina86.com>

	* textmodes/flyspell.el (flyspell-check-pre-word-p): Return nil if
	command changed buffer (ie. `flyspell-pre-buffer' is not current
	buffer), which prevents making decisions based on invalid value of
	`flyspell-pre-point' in the wrong buffer.  Most notably, this used to
	cause an error when `flyspell-pre-point' was nil after switching
	buffers.
	(flyspell-post-command-hook): No longer needs to change buffers when
	checking pre-word.  While at it remove unnecessary progn.

2013-04-17  Nicolas Richard  <theonewiththeevillook@yahoo.fr>  (tiny change)

	* textmodes/ispell.el (ispell-add-per-file-word-list):
	Fix `flyspell-correct-word-before-point' error when accepting
	words and `coment-padding' is an integer by using
	`comment-normalize-vars' (Bug #14214).

2013-04-17  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	New defun movement commands.
	* progmodes/python.el (python-nav--syntactically)
	(python-nav--forward-defun, python-nav-backward-defun)
	(python-nav-forward-defun): New functions.

2013-04-17  Fabián Ezequiel Gallina  <fgallina@gnu.org>

	* progmodes/python.el (python-syntax--context-compiler-macro): New defun.
	(python-syntax-context): Use named compiler-macro for backwards
	compatibility with Emacs 24.x.

2013-04-17  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave-mod.el (octave-mode-map): Fix key binding to
	octave-hide-process-buffer.

2013-04-17  Stefan Monnier  <monnier@iro.umontreal.ca>

	* vc/vc-hg.el (vc-hg-annotate-re): Disallow ": " in file names
	(bug#14216).

2013-04-17  Jean-Philippe Gravel  <jpgravel@gmail.com>

	* progmodes/gdb-mi.el (gdbmi-bnf-incomplete-record-result):
	Fix adjustment of offset when receiving incomplete responses from GDB
	(bug#14129).

2013-04-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* progmodes/python.el (python-mode-skeleton-abbrev-table): Rename from
	python-mode-abbrev-table.
	(python-skeleton-define): Adjust accordingly.
	(python-mode-abbrev-table): New table that inherits from it so that
	python-skeleton-autoinsert does not affect non-skeleton abbrevs.

	* abbrev.el (abbrev--symbol): New function, extracted from abbrev-symbol.
	(abbrev-symbol): Use it.
	(abbrev--before-point): Use it since we already handle inheritance.

2013-04-16  Leo Liu  <sdl.web@gmail.com>

	* progmodes/octave-mod.el (octave-mode-map): Remove redundant key
	binding to info-lookup-symbol.

2013-04-16  Juanma Barranquero  <lekktu@gmail.com>

	* minibuffer.el (completion--twq-all):
	* term/ns-win.el (ns-initialize-window-system):
	* term/w32-win.el (w32-initialize-window-system): Silence byte-compiler.

2013-04-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el (add-function): Default simple vars to their
	global bindings.

	* doc-view.el (doc-view-start-process): Handle url-handler directories.

2013-04-15  Dmitry Gutov  <dgutov@yandex.ru>

	* progmodes/ruby-mode.el (ruby-beginning-of-defun)
	(ruby-end-of-defun, ruby-move-to-block): Bind `case-fold-search'
	to nil.
	(ruby-end-of-defun): Remove the unused arg, change the docstring
	to reflect that this function is only used as the value of
	`end-of-defun-function'.
	(ruby-beginning-of-defun): Remove "top-level" from the docstring,
	to reflect an earlier change that beginning/end-of-defun functions
	jump between methods in a class definition, as well as top-level
	functions.

2013-04-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (minibuffer-complete): Don't just scroll
	a *Completions* that's been iconified.
	(minibuffer-force-complete): Make sure repetitions do cycle when going
	through completion-in-region -> minibuffer-complete.

2013-04-15  Alan Mackenzie  <acm@muc.de>

	Correct the placement of c-cpp-delimiters when there're #s not at
	col 0.

	* progmodes/cc-langs.el (c-anchored-cpp-prefix): Reformulate and
	place a submatch around the #.
	* progmodes/cc-mode.el(c-neutralize-syntax-in-and-mark-CPP):
	Start a search at BOL.  Put the c-cpp-delimiter category text propertiy
	on the #, not BOL.

2013-04-15  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/nadvice.el: Properly test names when adding advice.
	(advice--member-p): New arg `name'.
	(advice--add-function, advice-member-p): Use it (bug#14202).

2013-04-15  Filipp Gunbin  <fgunbin@fastmail.fm>

	Reformulate java imenu-generic-expression.
	The old expression contained ill formed regexps.

	* progmodes/cc-menus.el (cc-imenu-java-ellipsis-regexp)
	(cc-imenu-java-type-spec-regexp, cc-imenu-java-comment-regexp)
	(cc-imenu-java-method-arg-regexp): New defconsts.
	(cc-imenu-java-build-type-args-regex): New defun.
	(cc-imenu-java-generic-expression): Fix, to remove "ambiguous"
	handling of spaces in the regexp.

2013-03-15  Agustín Martín Domingo  <agustin.martin@hispalinux.es>

	* textmodes/ispell.el (ispell-command-loop): Remove
	flyspell highlight of a word when ispell accepts it (bug #14178).

2013-04-15  Michael Albinus  <michael.albinus@gmx.de>

	* net/ange-ftp.el (ange-ftp-run-real-handler-orig): New defun,
	uses code from the previous `ange-ftp-run-real-handler'.
	(ange-ftp-run-real-handler): Set it to `tramp-run-real-handler'
	only in case that function exist.  This is needed for proper
	unloading of Tramp.

2013-04-15  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-vars.el (reftex-label-regexps): New defcustom.

	* textmodes/reftex.el (reftex-compile-variables): Use it.

2013-04-14  Stefan Monnier  <monnier@iro.umontreal.ca>

	* files.el (normal-mode): Only use default major-mode if no other mode
	was specified.

	* emacs-lisp/trace.el (trace-values): New function.

	* files.el: Allow : in local variables (bug#14089).
	(hack-local-variable-regexp): New var.
	(hack-local-variables-prop-line, hack-local-variables): Use it.

2013-04-13  Roland Winkler  <winkler@gnu.org>

	* textmodes/bibtex.el (bibtex-search-entries): Bug fix.  Use match
	data before it gets modified by bibtex-beginning-of-entry.

2013-04-13  Roland Winkler  <winkler@gnu.org>

	* textmodes/bibtex.el (bibtex-url): Doc fix.

2013-04-13  Roland Winkler  <winkler@gnu.org>

	* textmodes/bibtex.el (bibtex-initialize): If the current buffer
	does not visit a BibTeX file, exclude it from the list of buffers
	returned by bibtex-initialize.

2013-04-13  Stephen Berman  <stephen.berman@gmx.net>

	* window.el (split-window): Remove interactive form, since as a
	command this function is a special case of split-window-below.
	Correct doc string.

2013-04-12  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Do not override value of arg default.
	Allow single faces and strings as default values.  Remove those
	elements from return value that are not faces.
	(describe-face): Simplify.
	(face-at-point): New optional args thing and multiple so that this
	function can provide the same functionality previously provided by
	read-face-name.
	(make-face-bold, make-face-unbold, make-face-italic)
	(make-face-unitalic, make-face-bold-italic, invert-face)
	(modify-face, read-face-and-attribute): Use face-at-point.

	* cus-edit.el (customize-face, customize-face-other-window)
	* cus-theme.el (custom-theme-add-face)
	* face-remap.el (buffer-face-set)
	* facemenu.el (facemenu-set-face): Use face-at-point.

2013-04-12  Michael Albinus  <michael.albinus@gmx.de>

	* info.el (Info-file-list-for-emacs): Add "tramp" and "dbus".

2013-04-10  Tassilo Horn  <tsdh@gnu.org>

	* textmodes/reftex-cite.el (reftex-parse-bibtex-entry): Don't cut
	off leading { and trailing } from field values.

2013-04-10  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/timer.el (timer--check): New function.
	(timer--time, timer-set-function, timer-event-handler): Use it.
	(timer-set-idle-time): Simplify.
	(timer--activate): CSE.
	(timer-event-handler): Give more info in error message.
	(internal-timer-start-idle): New function, moved from C.

	* mpc.el (mpc-proc): Add `restart' argument.
	(mpc-proc-cmd): Use it.
	(mpc--status-timer-run): Also catch signals from `mpc-proc'.
	(mpc-status-buffer-show, mpc-tagbrowser-dir-toggle): Call `mpc-proc'
	less often.

2013-04-10  Masatake YAMATO  <yamato@redhat.com>

	* progmodes/sh-script.el: Implement `sh-mode' own
	`add-log-current-defun-function' (bug#14112).
	(sh-current-defun-name): New function.
	(sh-mode): Use the function.

2013-04-09  Bastien Guerry  <bzg@gnu.org>

	* simple.el (choose-completion-string): Fix docstring (bug#14163).

2013-04-08  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-mode): Fix typo (bug#14144).

	* emacs-lisp/timer.el (timer-event-handler): Don't retrigger a canceled
	timer (bug#14156).

2013-04-07  Nic Ferrier  <nferrier@ferrier.me.uk>

	* emacs-lisp/ert.el (should, should-not, should-error): Add edebug
	declaration.

2013-04-07  Leo Liu  <sdl.web@gmail.com>

	* pcmpl-x.el: New file.

2013-04-06  Dmitry Antipov  <dmantipov@yandex.ru>

	Do not set x-display-name until X connection is established.
	This is needed to prevent from weird situation described at
	<http://lists.gnu.org/archive/html/emacs-devel/2013-04/msg00212.html>.
	* frame.el (make-frame): Set x-display-name after call to
	window system initialization function, not before.
	* term/x-win.el (x-initialize-window-system): Add optional
	display argument and use it.
	* term/w32-win.el (w32-initialize-window-system):
	* term/ns-win.el (ns-initialize-window-system):
	* term/pc-win.el (msdos-initialize-window-system):
	Add compatible optional display argument.

2013-04-06  Eli Zaretskii  <eliz@gnu.org>

	* files.el (normal-backup-enable-predicate): On MS-Windows and
	MS-DOS compare truenames of temporary-file-directory and of the
	file, so that 8+3 aliases (usually found in $TEMP on Windows)
	don't fail comparison by compare-strings.  Also, compare file
	names case-insensitively on MS-Windows and MS-DOS.

2013-04-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-compute-transaction): Fix last fix.
	Suggested by Donald Curtis <dcurtis@coe.edu> (bug#14082).

2013-04-05  Dmitry Gutov  <dgutov@yandex.ru>

	* whitespace.el (whitespace-color-on, whitespace-color-off):
	Only call `font-lock-fontify-buffer' when `font-lock-mode' is on.

2013-04-05  Jacek Chrząszcz  <chrzaszcz@mimuw.edu.pl>  (tiny change)

	* ispell.el (ispell-set-spellchecker-params):
	Really set `ispell-args' for all equivs.

2013-04-05  Stefan Monnier  <monnier@iro.umontreal.ca>

	* ido.el (ido-completions): Use extra elements of ido-decorations
	(bug#14143).
	(ido-decorations): Update docstring.

2013-04-05  Michael Albinus  <michael.albinus@gmx.de>

	* autorevert.el (auto-revert-mode, auto-revert-tail-mode)
	(global-auto-revert-mode): Let-bind `auto-revert-use-notify' to
	nil during initialization, in order not to miss changes since the
	file was opened.  (Bug#14140)

2013-04-05  Leo Liu  <sdl.web@gmail.com>

	* kmacro.el (kmacro-call-macro): Fix bug#14135.

2013-04-05  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-units.el (calc-convert-units): Rewrite conditional.

2013-04-04  Glenn Morris  <rgm@gnu.org>

	* electric.el (electric-pair-inhibit-predicate): Add :version.

2013-04-04  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/package.el (package-compute-transaction): Fix ordering
	when a package is required several times (bug#14082).

2013-04-04  Roland Winkler  <winkler@gnu.org>

	* faces.el (read-face-name): Behave as promised by the docstring.
	Assume that arg default is a list of faces.
	(describe-face): Call read-face-name with list of default faces.

2013-04-04  Thierry Volpiatto  <thierry.volpiatto@gmail.com>

	* bookmark.el: Fix deletion of bookmarks (bug#13972).
	(bookmark-bmenu-list): Don't toggle filenames if alist is empty.
	(bookmark-bmenu-execute-deletions): Only skip first line if it's
	the header.
	(bookmark-exit-hook-internal): Save even if list is empty.

2013-04-04  Yann Hodique  <yann.hodique@gmail.com>  (tiny change)

	* emacs-lisp/package.el (package-pinned-packages): New var.
	(package--add-to-archive-contents): Obey it (bug#14118).

2013-04-03  Alan Mackenzie  <acm@muc.de>

	Handle `parse-partial-sexp' landing inside a comment opener (Bug#13244).
	Also adapt to the new values of element 7 of a parse state.

	* progmodes/cc-engine.el (c-state-pp-to-literal): New optional
	parameter `not-in-delimiter'.  Handle being inside comment opener.
	(c-invalidate-state-cache-1): Reckon with an extra "invalid"
	character in case we're typing a '*' after a '/'.
	(c-literal-limits): Handle the awkward "not-in-delimiter" cond arm
	instead by passing the parameter to c-state-pp-to-literal.

	* progmodes/cc-fonts.el (c-font-lock-doc-comments): New handling
	for elt. 7 of a parse state.

2013-04-01  Paul Eggert  <eggert@cs.ucla.edu>

	Use UTF-8 for most files with non-ASCII characters (Bug#13936).
	* international/latin1-disp.el, international/mule-util.el:
	* language/cyril-util.el, language/european.el, language/ind-util.el:
	* language/lao-util.el, language/thai.el, language/tibet-util.el:
	* language/tibetan.el, language/viet-util.el:
	Switch from iso-2022-7bit to utf-8 or (if needed) utf-8-emacs.

2013-04-01  Stefan Monnier  <monnier@iro.umontreal.ca>

	* electric.el (electric-pair-inhibit-predicate): New var (bug#14000).
	(electric-pair-post-self-insert-function): Use it.
	(electric-pair-default-inhibit): New function, extracted from
	electric-pair-post-self-insert-function.

2013-03-31  Roland Winkler  <winkler@gnu.org>

	* emacs-lisp/crm.el (completing-read-multiple): Doc fix.

2013-03-31  Stefan Monnier  <monnier@iro.umontreal.ca>

	* hi-lock.el (hi-lock-mode): Cleanup after revert-buffer (bug#13891).

2013-03-30  Fabián Ezequiel Gallina  <fabian@anue.biz>

	Un-indent after "pass" and "return" statements (Bug#13888)
	* progmodes/python.el (python-indent-block-enders): New var.
	(python-indent-calculate-indentation): Use it.

2013-03-30  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp.el (tramp-drop-volume-letter): Make it an ordinary
	defun.  Defining it as defalias could introduce too eager
	byte-compiler optimization.  (Bug#14030)

2013-03-30  Chong Yidong  <cyd@gnu.org>

	* iswitchb.el (iswitchb-read-buffer): Fix typo.

2013-03-30  Leo Liu  <sdl.web@gmail.com>

	* kmacro.el (kmacro-call-macro): Add optional arg MACRO.
	(kmacro-execute-from-register): Pass the keyboard macro to
	kmacro-call-macro or repeating won't work correctly.

2013-03-30  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/subword.el: Back to using `forward-symbol'.

	* subr.el (forward-whitespace, forward-symbol)
	(forward-same-syntax): Move from thingatpt.el.

2013-03-29  Leo Liu  <sdl.web@gmail.com>

	* kmacro.el (kmacro-to-register): New command.
	(kmacro-execute-from-register): New function.
	(kmacro-keymap): Bind to 'x'.  (Bug#14071)

2013-03-29  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mpc.el: Use defvar-local and setq-local.
	(mpc--proc-connect): Connection failures are not bugs.
	(mpc-mode-map): `follow-link' only applies to the buffer's content.
	(mpc-volume-map): Bind to the up-events.

2013-03-29  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/subword.el (superword-mode): Use `forward-sexp'
	instead of `forward-symbol'.

2013-03-28  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/edebug.el (edebug-mode): Make it a minor mode.
	(edebug--recursive-edit): Use it.
	(edebug-kill-buffer): Don't let-bind kill-buffer-hook.
	(edebug-temp-display-freq-count): Don't let-bind buffer-read-only.

2013-03-28  Leo Liu  <sdl.web@gmail.com>

	* vc/vc-bzr.el (vc-bzr-revert): Don't backup.  (Bug#14066)

2013-03-27  Eli Zaretskii  <eliz@gnu.org>

	* facemenu.el (list-colors-callback): New defvar.
	(list-colors-redisplay): New function.
	(list-colors-display): Install list-colors-redisplay as the
	revert-buffer-function.  (Bug#14063)

2013-03-27  Stefan Monnier  <monnier@iro.umontreal.ca>

	* minibuffer.el (completion-pcm--merge-completions): Make sure prefixes
	and suffixes don't overlap (bug#14061).

	* case-table.el: Use lexical-binding.
	(case-table-get-table): New function.
	(get-upcase-table): Use it.  Mark as obsolete.  Adjust callers.

2013-03-27  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/subword.el: Add `superword-mode' to do word motion
	over symbol_words (parallels and leverages `subword-mode' which
	does word motion inside MixedCaseWords).

2013-03-27  Aidan Gauland  <aidalgol@no8wireless.co.nz>

	* eshell/em-unix.el: Move su and sudo to...
	* eshell/em-tramp.el: ...Eshell tramp module.

2013-03-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* desktop.el (desktop--v2s): Rename from desktop-internal-v2s.
	Change return value to be a sexp.  Delay `get-buffer' to after
	restoring the desktop (bug#13951).

2013-03-26  Leo Liu  <sdl.web@gmail.com>

	* register.el: Move semantic tag handling back to
	cedet/semantic/senator.el.  (Bug#14052)

2013-03-26  Stefan Monnier  <monnier@iro.umontreal.ca>

	* eshell/em-prompt.el (eshell-emit-prompt): Make sure we can't insert
	into the prompt either (bug#13963).

2013-03-25  Stefan Monnier  <monnier@iro.umontreal.ca>

	* font-lock.el (lisp-font-lock-keywords-2): Don't highlight the "error"
	part of "(error-foo)".

2013-03-24  Juri Linkov  <juri@jurta.org>

	* replace.el (list-matching-lines-prefix-face): New defcustom.
	(occur-1): Pass `list-matching-lines-prefix-face' to the function
	`occur-engine' if `face-differs-from-default-p' returns t.
	(occur-engine): Add `,' inside backquote construct to evaluate
	`prefix-face'.  Propertize the prefix with the `prefix-face' face.
	Pass `prefix-face' to the functions `occur-context-lines' and
	`occur-engine-add-prefix'.
	(occur-engine-add-prefix, occur-context-lines): Add optional arg
	`prefix-face' and propertize the prefix with `prefix-face'.
	(Bug#14017)

2013-03-24  Leo Liu  <sdl.web@gmail.com>

	* nxml/rng-valid.el (rng-validate-while-idle)
	(rng-validate-quick-while-idle): Guard against deleted buffer.
	(Bug#13999)

	* emacs-lisp/edebug.el (edebug-mode): Make sure edebug-kill-buffer
	is the last entry in kill-buffer-hook.

	* files.el (kill-buffer-hook): Doc fix.

2013-03-23  Dmitry Gutov  <dgutov@yandex.ru>

	* emacs-lisp/lisp-mode.el (emacs-lisp-docstring-fill-column):
	Make it safe-local.

	* vc/diff-mode.el (diff-mode-shared-map): Unbind "/" (Bug#14034).

2013-03-23  Leo Liu  <sdl.web@gmail.com>

	* nxml/nxml-util.el (nxml-with-unmodifying-text-property-changes):
	Remove.

	* nxml/rng-valid.el (rng-validate-mode)
	(rng-after-change-function, rng-do-some-validation):
	* nxml/rng-maint.el (rng-validate-buffer):
	* nxml/nxml-rap.el (nxml-tokenize-forward, nxml-ensure-scan-up-to-date):
	* nxml/nxml-outln.el (nxml-show-all, nxml-set-outline-state):
	* nxml/nxml-mode.el (nxml-mode, nxml-degrade, nxml-after-change)
	(nxml-extend-after-change-region): Use with-silent-modifications.

	* nxml/rng-nxml.el (rng-set-state-after): Do not let-bind
	timer-idle-list.

	* nxml/rng-valid.el (rng-validate-while-idle-continue-p)
	(rng-next-error-1, rng-previous-error-1): Do not let-bind
	timer-idle-list.  (Bug#13999)

2013-03-23  Juri Linkov  <juri@jurta.org>

	* info.el (info-index-match): New face.
	(Info-index, Info-apropos-matches): Add a nested subgroup to the
	main pattern and add text properties with the new face to matches
	in index entries relative to the beginning of the index entry.
	(Bug#14015)

2013-03-21  Eric Ludlam  <zappo@gnu.org>

	* eieio/eieio-datadebug.el (data-debug/eieio-insert-slots):
	Inhibit read only while inserting objects.

2013-03-22  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el: Update docs to mention
	`cfengine-auto-mode'.  Use \_> and \_< instead of \> and \< for
	symbol motion.  Remove "_" from the word syntax.

2013-03-21  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine-common-syntax): Add "_" to word
	syntax for both `cfengine2-mode' and `cfengine3-mode'.

2013-03-20  Juri Linkov  <juri@jurta.org>

	* info.el (Info-next-reference-or-link)
	(Info-prev-reference-or-link): New functions.
	(Info-next-reference, Info-prev-reference): Use them.
	(Info-try-follow-nearest-node): Handle footnote navigation.
	(Info-fontify-node): Fontify footnotes.  (Bug#13989)

2013-03-20  Stefan Monnier  <monnier@iro.umontreal.ca>

	* subr.el (posn-point, posn-string): Fix it here instead (bug#13979).
	* mouse.el (mouse-on-link-p): Undo scroll-bar fix.

2013-03-20  Paul Eggert  <eggert@cs.ucla.edu>

	Suppress unnecessary non-ASCII chatter during build process.
	* international/ja-dic-cnv.el (skkdic-collect-okuri-nasi)
	(batch-skkdic-convert): Suppress most of the chatter.
	It's not needed so much now that machines are faster,
	and its non-ASCII component was confusing; see Dmitry Gutov in
	<http://lists.gnu.org/archive/html/emacs-devel/2013-03/msg00508.html>.

2013-03-20  Leo Liu  <sdl.web@gmail.com>

	* ido.el (ido-chop): Fix bug#10994.

2013-03-19  Dmitry Gutov  <dgutov@yandex.ru>

	* whitespace.el (whitespace-font-lock, whitespace-font-lock-mode):
	Remove vars.
	(whitespace-color-on, whitespace-color-off):
	Use `font-lock-fontify-buffer' (Bug#13817).

2013-03-19  Stefan Monnier  <monnier@iro.umontreal.ca>

	* mouse.el (mouse--down-1-maybe-follows-link): Fix follow-link
	remapping in mode-line.
	(mouse-on-link-p): Also check [mode-line follow-link] bindings.

2013-03-19  Dmitry Gutov  <dgutov@yandex.ru>

	* whitespace.el (whitespace-color-on): Use `prepend' OVERRIDE
	value for `whitespace-line' face (Bug#13875).
	(whitespace-font-lock-keywords): Change description.
	(whitespace-color-on): Don't save `font-lock-keywords' value, save
	the constructed keywords instead.
	(whitespace-color-off): Use `font-lock-remove-keywords' (Bug#13817).

2013-03-19  Leo Liu  <sdl.web@gmail.com>

	* progmodes/compile.el (compilation-display-error): New command.
	(compilation-mode-map, compilation-minor-mode-map): Bind it to
	C-o.  (Bug#13992)

2013-03-18  Paul Eggert  <eggert@cs.ucla.edu>

	* term/x-win.el (x-keysym-pair): Add a Fixme (Bug#13936).

2013-03-18  Jan Djärv  <jan.h.d@swipnet.se>

	* mouse.el (mouse-on-link-p): Check for scroll bar (Bug#13979).

2013-03-18  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-compat.el (tramp-compat-user-error): New defun.

	* net/tramp-adb.el (tramp-adb-handle-shell-command):
	* net/tramp-gvfs.el (top):
	* net/tramp.el (tramp-find-method, tramp-dissect-file-name)
	(tramp-handle-shell-command): Use it.
	(tramp-dissect-file-name): Raise an error when hostname is a
	method name, and neither method nor user is specified.

	* net/trampver.el: Update release number.

2013-03-18  Leo Liu  <sdl.web@gmail.com>

	Make sure eldoc can be turned off properly.
	* emacs-lisp/eldoc.el (eldoc-schedule-timer): Conditionalize on
	eldoc-mode.
	(eldoc-display-message-p): Revert last change.
	(eldoc-display-message-no-interference-p)
	(eldoc-print-current-symbol-info): Tweak.

2013-03-18  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el (doc-view-new-window-function): Check the new window
	overlay's display property instead the char property of the
	buffer's first char.  Use `with-selected-window' instead of
	`save-window-excursion' with `select-window'.
	(doc-view-document->bitmap): Check the current doc-view overlay's
	display property instead the char property of the buffer's first char.

2013-03-18  Paul Eggert  <eggert@cs.ucla.edu>

	Automate the build of ja-dic.el (Bug#13984).
	* international/ja-dic-cnv.el (skkdic-convert): Remove the annotations
	from the input, rather than assume that it's been done for us by the
	SKK script unannotate.awk.  Switch ja-dic.el to UTF-8.  Don't put
	the current date into a ja-dic.el comment, as that complicates
	regression testing.

2013-03-18  Stefan Monnier  <monnier@iro.umontreal.ca>

	* whitespace.el: Fix double evaluation.
	(whitespace-space, whitespace-hspace, whitespace-tab)
	(whitespace-newline, whitespace-trailing, whitespace-line)
	(whitespace-space-before-tab, whitespace-indentation)
	(whitespace-empty, whitespace-space-after-tab): Turn defcustoms into
	obsolete defvars.
	(whitespace-hspace-regexp): Fix regexp for emacs-unicode.
	(whitespace-color-on): Use a single font-lock-add-keywords call.
	Fix double-evaluation of face variables.

2013-03-17  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-adb.el (tramp-adb-parse-device-names):
	Use `start-process' instead of `call-process'.  Otherwise, the
	function might be blocked under MS Windows.  (Bug#13299)

2013-03-17  Leo Liu  <sdl.web@gmail.com>

	Extend eldoc to display info in the mode-line.  (Bug#13978)
	* emacs-lisp/eldoc.el (eldoc-post-insert-mode): New minor mode.
	(eldoc-mode-line-string): New variable.
	(eldoc-minibuffer-message): New function.
	(eldoc-message-function): New variable.
	(eldoc-message): Use it.
	(eldoc-display-message-p)
	(eldoc-display-message-no-interference-p):
	Support eldoc-post-insert-mode.

	* simple.el (eval-expression-minibuffer-setup-hook): New hook.
	(eval-expression): Run it.

2013-03-17  Roland Winkler  <winkler@gnu.org>

	* emacs-lisp/crm.el (completing-read-multiple): Ignore empty
	strings in the list of return values.

2013-03-17  Jay Belanger  <jay.p.belanger@gmail.com>

	* calc/calc-ext.el (math-read-number-fancy): Check for an explicit
	radix before checking for HMS forms.

2013-03-16  Leo Liu  <sdl.web@gmail.com>

	* progmodes/scheme.el: Add indentation and font-locking for λ.
	(Bug#13975)

2013-03-16  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/smie.el (smie-auto-fill): Don't inf-loop if there's no
	token before point (bug#13942).

2013-03-16  Leo Liu  <sdl.web@gmail.com>

	* thingatpt.el (end-of-sexp): Fix bug#13952.  Use syntax-after.

2013-03-16  Eli Zaretskii  <eliz@gnu.org>

	* startup.el (command-line-normalize-file-name): Fix handling of
	backslashes in DOS and Windows file names.  Reported by Xue Fuqiao
	<xfq.free@gmail.com> in
	http://lists.gnu.org/archive/html/help-gnu-emacs/2013-03/msg00245.html.

2013-03-15  Michael Albinus  <michael.albinus@gmx.de>

	Sync with Tramp 2.2.7.

	* net/trampver.el: Update release number.

2013-03-14  Tassilo Horn  <tsdh@gnu.org>

	* doc-view.el Fix bug#13887.
	(doc-view-insert-image): Don't modify overlay associated to
	non-live windows, and implement horizontal centering of image in
	case it's smaller than the window.
	(doc-view-new-window-function): Force redisplay of new windows on
	doc-view buffers.

2013-03-13  Karl Fogel  <kfogel@red-bean.com>

	* saveplace.el (save-place-alist-to-file): Don't sort
	`save-place-alist', just pretty-print it (bug#13882).

2013-03-13  Michael Albinus  <michael.albinus@gmx.de>

	* net/tramp-sh.el (tramp-sh-handle-insert-directory):
	Check whether `default-file-name-coding-system' is bound.
	It isn't in XEmacs.

2013-03-13  Stefan Monnier  <monnier@iro.umontreal.ca>

	* emacs-lisp/byte-run.el (defun-declarations-alist): Don't use
	backquotes for `obsolete' (bug#13929).

	* international/mule.el (find-auto-coding): Include file name in
	obsolescence warning (bug#13922).

2013-03-12  Teodor Zlatanov  <tzz@lifelogs.com>

	* progmodes/cfengine.el (cfengine-parameters-indent): New variable
	for CFEngine 3-specific indentation.
	(cfengine3-indent-line): Use it.  Fix up category regex.
	(cfengine3-font-lock-keywords): Add bundle and namespace characters.

2013-03-12  Stefan Monnier  <monnier@iro.umontreal.ca>

	* type-break.el (type-break-file-name):
	* textmodes/remember.el (remember-data-file):
	* strokes.el (strokes-file):
	* shadowfile.el (shadow-initialize):
	* saveplace.el (save-place-file):
	* ps-bdf.el (bdf-cache-file):
	* progmodes/idlwave.el (idlwave-config-directory):
	* net/quickurl.el (quickurl-url-file):
	* international/kkc.el (kkc-init-file-name):
	* ido.el (ido-save-directory-list-file):
	* emulation/viper.el (viper-custom-file-name):
	* emulation/vip.el (vip-startup-file):
	* calendar/todo-mode.el (todo-file-do, todo-file-done, todo-file-top):
	* calendar/timeclock.el (timeclock-file): Use locate-user-emacs-file.

2013-03-12  Paul Eggert  <eggert@cs.ucla.edu>

	Switch encodings of tutorials, thai-word to UTF-8 (Bug#13880).
	* language/thai-word.el: Switch to UTF-8.

See ChangeLog.16 for earlier changes.

;; Local Variables:
;; coding: utf-8
;; End:

  Copyright (C) 2011-2013 Free Software Foundation, Inc.

  This file is part of GNU Emacs.

  GNU Emacs is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  GNU Emacs is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with GNU Emacs.  If not, see <http://www.gnu.org/licenses/>.
